<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta name="generator" content=
"HTML Tidy for HTML5 for Linux version 5.7.27" />
<meta charset="utf-8" />
<meta name="generator" content="ReSpec 24.33.2" />
<meta name="viewport" content=
"width=device-width, initial-scale=1, shrink-to-fit=no" />
<style>
<![CDATA[
  /* --- EXAMPLES --- */
  span.example-title {
    text-transform: none;
  }
  aside.example, div.example, div.illegal-example {
    padding: 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
  }
  div.illegal-example { color: red }
  div.illegal-example p { color: black }
  aside.example, div.example {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
    border-color: #e0cb52;
    background: #fcfaee;
  }

  aside.example div.example {
    border-left-width: .1em;
    border-color: #999;
    background: #fff;
  }
  aside.example div.example span.example-title {
    color: #999;
  }
]]>
</style>

<style>
<![CDATA[
  /* --- ISSUES/NOTES --- */
  .issue-label {
    text-transform: initial;
  }

  .warning > p:first-child { margin-top: 0 }
  .warning {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
  }
  span.warning { padding: .1em .5em .15em; }

  .issue.closed span.issue-number {
    text-decoration: line-through;
  }

  .warning {
    border-color: #f11;
    border-width: .2em;
    border-style: solid;
    background: #fbe9e9;
  }

  .warning-title:before{
    content: "⚠"; /*U+26A0 WARNING SIGN*/
    font-size: 3em;
    float: left;
    height: 100%;
    padding-right: .3em;
    vertical-align: top;
    margin-top: -0.5em;
  }

  li.task-list-item {
    list-style: none;
  }

  input.task-list-item-checkbox {
    margin: 0 0.35em 0.25em -1.6em;
    vertical-align: middle;
  }

  .issue a.respec-gh-label {
  padding: 5px;
  margin: 0 2px 0 2px;
  font-size: 10px;
  text-transform: none;
  text-decoration: none;
  font-weight: bold;
  border-radius: 4px;
  position: relative;
  bottom: 2px;
  border: none;
  }

  .issue a.respec-label-dark {
  color: #fff;
  background-color: #000;
  }

  .issue a.respec-label-light {
  color: #000;
  background-color: #fff;
  }
]]>
</style>

<style>
<![CDATA[
  /* --- WEB IDL --- */

  pre.idl {
  padding: 1em;
  position: relative;
  }

  @media print {
  pre.idl {
    white-space: pre-wrap;
  }
  }

  pre.idl::before {
  content: "WebIDL";
  display: block;
  width: 150px;
  background: #90b8de;
  color: #fff;
  font-family: sans-serif;
  font-weight: bold;
  margin: -1em 0 1em -1em;
  height: 28px;
  line-height: 28px;  
  }

  .idlID {
  font-weight: bold;
  color: #005a9c;
  }

  .idlType {
  color: #005a9c;
  }

  .idlName {
  color: #ff4500;
  }

  .idlName a {
  color: #ff4500;
  border-bottom: 1px dotted #ff4500;
  text-decoration: none;
  }

  a.idlEnumItem {
  color: #000;
  border-bottom: 1px dotted #ccc;
  text-decoration: none;
  }

  .idlSuperclass {
  font-style: italic;
  color: #005a9c;
  }


  /*.idlParam*/

  .idlParamName,
  .idlDefaultValue {
  font-style: italic;
  }

  .extAttr {
  color: #666;
  }


  /*.idlSectionComment*/

  .idlSectionComment {
  color: gray;
  }

  .idlIncludes a {
  font-weight: bold;
  }

  .respec-button-copy-paste:focus {
  text-decoration: none;
  border-color: #51a7e8;
  outline: none;
  box-shadow: 0 0 5px rgba(81, 167, 232, 0.5);
  }

  .respec-button-copy-paste:focus:hover,
  .respec-button-copy-paste.selected:focus {
  border-color: #51a7e8;
  }

  .respec-button-copy-paste:hover,
  .respec-button-copy-paste:active,
  .respec-button-copy-paste.zeroclipboard-is-hover,
  .respec-button-copy-paste.zeroclipboard-is-active {
  text-decoration: none;
  background-color: #ddd;
  background-image: linear-gradient(#eee, #ddd);
  border-color: #ccc;
  }

  .respec-button-copy-paste:active,
  .respec-button-copy-paste.selected,
  .respec-button-copy-paste.zeroclipboard-is-active {
  background-color: #dcdcdc;
  background-image: none;
  border-color: #b5b5b5;
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15)
  }

  .respec-button-copy-paste.selected:hover {
  background-color: #cfcfcf;
  }

  .respec-button-copy-paste:disabled,
  .respec-button-copy-paste:disabled:hover,
  .respec-button-copy-paste.disabled,
  .respec-button-copy-paste.disabled:hover {
  color: rgba(102, 102, 102, 0.5);
  cursor: default;
  background-color: rgba(229, 229, 229, 0.5);
  background-image: none;
  border-color: rgba(197, 197, 197, 0.5);
  box-shadow: none;
  }

  @media print {
  .respec-button-copy-paste {
    visibility: hidden;
  }
  }
]]>
</style>
<title>Web of Things (WoT) Scripting API</title>

<style id="respec-mainstyle">
<![CDATA[
  /*****************************************************************
  * ReSpec 3 CSS
  * Robin Berjon - http://berjon.com/
  *****************************************************************/

  @keyframes pop {
  0% {
    transform: scale(1, 1);
  }
  25% {
    transform: scale(1.25, 1.25);
    opacity: 0.75;
  }
  100% {
    transform: scale(1, 1);
  }
  }

  /* Override code highlighter background */
  .hljs {
  background: transparent !important;
  }

  /* --- INLINES --- */
  h1 abbr,
  h2 abbr,
  h3 abbr,
  h4 abbr,
  h5 abbr,
  h6 abbr,
  a abbr {
  border: none;
  }

  dfn {
  font-weight: bold;
  }

  a.internalDFN {
  color: inherit;
  border-bottom: 1px solid #99c;
  text-decoration: none;
  }

  a.externalDFN {
  color: inherit;
  border-bottom: 1px dotted #ccc;
  text-decoration: none;
  }

  a.bibref {
  text-decoration: none;
  }

  .respec-offending-element:target {
  animation: pop 0.25s ease-in-out 0s 1;
  }

  .respec-offending-element,
  a[href].respec-offending-element {
  text-decoration: red wavy underline;
  }
  @supports not (text-decoration: red wavy underline) {
  .respec-offending-element:not(pre) {
    display: inline-block;
  }
  .respec-offending-element {
    /* Red squiggly line */
    background: url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=)
      bottom repeat-x;
  }
  }

  #references :target {
  background: #eaf3ff;
  animation: pop 0.4s ease-in-out 0s 1;
  }

  cite .bibref {
  font-style: normal;
  }

  code {
  color: #c83500;
  }

  th code {
  color: inherit;
  }

  a[href].orcid {
    padding-left: 4px;
    padding-right: 4px;
  }

  a[href].orcid > svg {
    margin-bottom: -2px;
  }

  /* --- TOC --- */

  .toc a,
  .tof a {
  text-decoration: none;
  }

  a .secno,
  a .figno {
  color: #000;
  }

  ul.tof,
  ol.tof {
  list-style: none outside none;
  }

  .caption {
  margin-top: 0.5em;
  font-style: italic;
  }

  /* --- TABLE --- */

  table.simple {
  border-spacing: 0;
  border-collapse: collapse;
  border-bottom: 3px solid #005a9c;
  }

  .simple th {
  background: #005a9c;
  color: #fff;
  padding: 3px 5px;
  text-align: left;
  }

  .simple th[scope="row"] {
  background: inherit;
  color: inherit;
  border-top: 1px solid #ddd;
  }

  .simple td {
  padding: 3px 10px;
  border-top: 1px solid #ddd;
  }

  .simple tr:nth-child(even) {
  background: #f0f6ff;
  }

  /* --- DL --- */

  .section dd > p:first-child {
  margin-top: 0;
  }

  .section dd > p:last-child {
  margin-bottom: 0;
  }

  .section dd {
  margin-bottom: 1em;
  }

  .section dl.attrs dd,
  .section dl.eldef dd {
  margin-bottom: 0;
  }

  #issue-summary > ul,
  .respec-dfn-list {
  column-count: 2;
  }

  #issue-summary li,
  .respec-dfn-list li {
  list-style: none;
  }

  details.respec-tests-details {
  margin-left: 1em;
  display: inline-block;
  vertical-align: top;
  }

  details.respec-tests-details > * {
  padding-right: 2em;
  }

  details.respec-tests-details[open] {
  z-index: 999999;
  position: absolute;
  border: thin solid #cad3e2;
  border-radius: 0.3em;
  background-color: white;
  padding-bottom: 0.5em;
  }

  details.respec-tests-details[open] > summary {
  border-bottom: thin solid #cad3e2;
  padding-left: 1em;
  margin-bottom: 1em;
  line-height: 2em;
  }

  details.respec-tests-details > ul {
  width: 100%;
  margin-top: -0.3em;
  }

  details.respec-tests-details > li {
  padding-left: 1em;
  }

  a[href].self-link:hover {
  opacity: 1;
  text-decoration: none;
  background-color: transparent;
  }

  h2,
  h3,
  h4,
  h5,
  h6 {
  position: relative;
  }

  aside.example .marker > a.self-link {
  color: inherit;
  }

  h2 > a.self-link,
  h3 > a.self-link,
  h4 > a.self-link,
  h5 > a.self-link,
  h6 > a.self-link {
  border: none;
  color: inherit;
  font-size: 83%;
  height: 2em;
  left: -1.6em;
  opacity: 0.5;
  position: absolute;
  text-align: center;
  text-decoration: none;
  top: 0;
  transition: opacity 0.2s;
  width: 2em;
  }

  h2 > a.self-link::before,
  h3 > a.self-link::before,
  h4 > a.self-link::before,
  h5 > a.self-link::before,
  h6 > a.self-link::before {
  content: "§";
  display: block;
  }

  @media (max-width: 767px) {
  dd {
    margin-left: 0;
  }

  /* Don't position self-link in headings off-screen */
  h2 > a.self-link,
  h3 > a.self-link,
  h4 > a.self-link,
  h5 > a.self-link,
  h6 > a.self-link {
    left: auto;
    top: auto;
  }
  }

  @media print {
  .removeOnSave {
    display: none;
  }
  }
]]>
</style>

<style type="text/css">
/*<![CDATA[*/
  @-webkit-keyframes vex-fadein {
  0% {
    opacity: 0; }
  100% {
    opacity: 1; } }

  @keyframes vex-fadein {
  0% {
    opacity: 0; }
  100% {
    opacity: 1; } }

  @-webkit-keyframes vex-fadeout {
  0% {
    opacity: 1; }
  100% {
    opacity: 0; } }

  @keyframes vex-fadeout {
  0% {
    opacity: 1; }
  100% {
    opacity: 0; } }

  @-webkit-keyframes vex-rotation {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg); }
  100% {
    -webkit-transform: rotate(359deg);
    transform: rotate(359deg); } }

  @keyframes vex-rotation {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg); }
  100% {
    -webkit-transform: rotate(359deg);
    transform: rotate(359deg); } }

  .vex, .vex *, .vex *:before, .vex *:after {
  -moz-box-sizing: border-box;
  box-sizing: border-box; }

  .vex {
  position: fixed;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  z-index: 1111;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0; }

  .vex-scrollbar-measure {
  position: absolute;
  top: -9999px;
  width: 50px;
  height: 50px;
  overflow: scroll; }

  .vex-overlay {
  -webkit-animation: vex-fadein .5s;
  animation: vex-fadein .5s;
  position: fixed;
  z-index: 1111;
  background: rgba(0, 0, 0, 0.4);
  top: 0;
  right: 0;
  bottom: 0;
  left: 0; }

  .vex-overlay.vex-closing {
  -webkit-animation: vex-fadeout .5s forwards;
  animation: vex-fadeout .5s forwards; }

  .vex-content {
  -webkit-animation: vex-fadein .5s;
  animation: vex-fadein .5s;
  background: #fff; }

  .vex.vex-closing .vex-content {
  -webkit-animation: vex-fadeout .5s forwards;
  animation: vex-fadeout .5s forwards; }

  .vex-close:before {
  font-family: Arial, sans-serif;
  content: "\D7"; }

  .vex-dialog-form {
  margin: 0; }

  .vex-dialog-button {
  text-rendering: optimizeLegibility;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent; }

  .vex-loading-spinner {
  -webkit-animation: vex-rotation .7s linear infinite;
  animation: vex-rotation .7s linear infinite;
  box-shadow: 0 0 1em rgba(0, 0, 0, 0.1);
  position: fixed;
  z-index: 1112;
  margin: auto;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  height: 2em;
  width: 2em;
  background: #fff; }

  body.vex-open {
  overflow: hidden; }
/*]]>*/
</style>

<style type="text/css">
/*<![CDATA[*/
  @-webkit-keyframes vex-pulse {
  0% {
    box-shadow: inset 0 0 0 300px transparent; }
  70% {
    box-shadow: inset 0 0 0 300px rgba(255, 255, 255, 0.25); }
  100% {
    box-shadow: inset 0 0 0 300px transparent; } }

  @keyframes vex-pulse {
  0% {
    box-shadow: inset 0 0 0 300px transparent; }
  70% {
    box-shadow: inset 0 0 0 300px rgba(255, 255, 255, 0.25); }
  100% {
    box-shadow: inset 0 0 0 300px transparent; } }

  .vex.vex-theme-wireframe {
  padding-top: 160px;
  padding-bottom: 160px; }
  .vex.vex-theme-wireframe .vex-overlay {
    background: rgba(255, 255, 255, 0.4); }
  .vex.vex-theme-wireframe .vex-content {
    font-family: "Helvetica Neue", sans-serif;
    background: #fff;
    color: #000;
    border: 2px solid #000;
    padding: 2em;
    position: relative;
    margin: 0 auto;
    max-width: 100%;
    width: 400px;
    font-size: 1.1em;
    line-height: 1.5em; }
    .vex.vex-theme-wireframe .vex-content h1, .vex.vex-theme-wireframe .vex-content h2, .vex.vex-theme-wireframe .vex-content h3, .vex.vex-theme-wireframe .vex-content h4, .vex.vex-theme-wireframe .vex-content h5, .vex.vex-theme-wireframe .vex-content h6, .vex.vex-theme-wireframe .vex-content p, .vex.vex-theme-wireframe .vex-content ul, .vex.vex-theme-wireframe .vex-content li {
      color: inherit; }
  .vex.vex-theme-wireframe .vex-close {
    position: absolute;
    top: 0;
    right: 0;
    cursor: pointer; }
    .vex.vex-theme-wireframe .vex-close:before {
      position: absolute;
      content: "\D7";
      font-size: 40px;
      font-weight: normal;
      line-height: 80px;
      height: 80px;
      width: 80px;
      text-align: center;
      top: 3px;
      right: 3px;
      color: #000; }
    .vex.vex-theme-wireframe .vex-close:hover:before, .vex.vex-theme-wireframe .vex-close:active:before {
      color: #000; }
  .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-message {
    margin-bottom: .5em; }
  .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input {
    margin-bottom: 1em; }
    .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input select, .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input textarea, .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="date"], .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="datetime"], .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="datetime-local"], .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="email"], .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="month"], .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="number"], .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="password"], .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="search"], .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="tel"], .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="text"], .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="time"], .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="url"], .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="week"] {
      background: #fff;
      width: 100%;
      padding: .25em .67em;
      font-family: inherit;
      font-weight: inherit;
      font-size: inherit;
      min-height: 2.5em;
      margin: 0 0 .25em;
      border: 2px solid #000; }
      .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input select:focus, .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input textarea:focus, .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="date"]:focus, .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="datetime"]:focus, .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="datetime-local"]:focus, .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="email"]:focus, .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="month"]:focus, .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="number"]:focus, .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="password"]:focus, .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="search"]:focus, .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="tel"]:focus, .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="text"]:focus, .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="time"]:focus, .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="url"]:focus, .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-input input[type="week"]:focus {
        border-style: dashed;
        outline: none; }
  .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-buttons {
    *zoom: 1; }
    .vex.vex-theme-wireframe .vex-dialog-form .vex-dialog-buttons:after {
      content: "";
      display: table;
      clear: both; }
  .vex.vex-theme-wireframe .vex-dialog-button {
    border-radius: 0;
    border: 0;
    float: right;
    margin: 0 0 0 .5em;
    font-family: inherit;
    text-transform: uppercase;
    letter-spacing: .1em;
    font-size: .8em;
    line-height: 1em;
    padding: .75em 2em; }
    .vex.vex-theme-wireframe .vex-dialog-button.vex-last {
      margin-left: 0; }
    .vex.vex-theme-wireframe .vex-dialog-button:focus {
      -webkit-animation: vex-pulse 1.1s infinite;
      animation: vex-pulse 1.1s infinite;
      outline: none; }
      @media (max-width: 568px) {
        .vex.vex-theme-wireframe .vex-dialog-button:focus {
          -webkit-animation: none;
          animation: none; } }
    .vex.vex-theme-wireframe .vex-dialog-button.vex-dialog-button-primary {
      background: #000;
      color: #fff;
      border: 2px solid transparent; }
    .vex.vex-theme-wireframe .vex-dialog-button.vex-dialog-button-secondary {
      background: #fff;
      color: #000;
      border: 2px solid #000; }

  .vex-loading-spinner.vex-theme-wireframe {
  height: 2.5em;
  width: 2.5em; }
/*]]>*/
</style>

<style type="text/css">
/*<![CDATA[*/
  .vex-dialog-message {
  font-weight: bold;
  text-align: center;
  }

  .vex-dialog-input p {
  margin-bottom: 1em;
  }
/*]]>*/
</style>
<link rel="canonical" href=
"https://www.w3.org/TR/wot-scripting-api/" />
<style>
<![CDATA[
  /*

  github.com style (c) Vasily Polovnyov <vast@whiteants.net>

  */

  .hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  color: #333;
  background: #f8f8f8;
  }

  .hljs-comment,
  .hljs-quote {
  color: #998;
  font-style: italic;
  }

  .hljs-keyword,
  .hljs-selector-tag,
  .hljs-subst {
  color: #333;
  font-weight: bold;
  }

  .hljs-number,
  .hljs-literal,
  .hljs-variable,
  .hljs-template-variable,
  .hljs-tag .hljs-attr {
  color: #008080;
  }

  .hljs-string,
  .hljs-doctag {
  color: #d14;
  }

  .hljs-title,
  .hljs-section,
  .hljs-selector-id {
  color: #900;
  font-weight: bold;
  }

  .hljs-subst {
  font-weight: normal;
  }

  .hljs-type,
  .hljs-class .hljs-title {
  color: #458;
  font-weight: bold;
  }

  .hljs-tag,
  .hljs-name,
  .hljs-attribute {
  color: #000080;
  font-weight: normal;
  }

  .hljs-regexp,
  .hljs-link {
  color: #009926;
  }

  .hljs-symbol,
  .hljs-bullet {
  color: #990073;
  }

  .hljs-built_in,
  .hljs-builtin-name {
  color: #0086b3;
  }

  .hljs-meta {
  color: #999;
  font-weight: bold;
  }

  .hljs-deletion {
  background: #fdd;
  }

  .hljs-addition {
  background: #dfd;
  }

  .hljs-emphasis {
  font-style: italic;
  }

  .hljs-strong {
  font-weight: bold;
  }
]]>
</style>

<style>
<![CDATA[
  var {
  position: relative;
  cursor: pointer;
  }

  var[data-type]::before,
  var[data-type]::after {
  position: absolute;
  left: 50%;
  top: -6px;
  opacity: 0;
  transition: opacity 0.4s;
  pointer-events: none;
  }

  /* the triangle or arrow or caret or whatever */
  var[data-type]::before {
  content: "";
  transform: translateX(-50%);
  border-width: 4px 6px 0 6px;
  border-style: solid;
  border-color: transparent;
  border-top-color: #000;
  }

  /* actual text */
  var[data-type]::after {
  content: attr(data-type);
  transform: translateX(-50%) translateY(-100%);
  background: #000;
  text-align: center;
  /* additional styling */
  font-family: "Dank Mono", "Fira Code", monospace;
  font-style: normal;
  padding: 6px;
  border-radius: 3px;
  color: #daca88;
  text-indent: 0;
  font-weight: normal;
  }

  var[data-type]:hover::after,
  var[data-type]:hover::before {
  opacity: 1;
  }
]]>
</style>

<script id="initialUserConfig" type="application/json">
<![CDATA[
  {
  "specStatus": "WD",
  "shortName": "wot-scripting-api",
  "copyrightStart": 2017,
  "noLegacyStyle": true,
  "publishDate": "2019-10-28",
  "previousPublishDate": "2018-11-29",
  "previousMaturity": "",
  "edDraftURI": "https://w3c.github.io/wot-scripting-api/",
  "crEnd": "",
  "inlineCSS": true,
  "noIDLIn": true,
  "format": "markdown",
  "editors": [
    {
      "name": "Zoltan Kis",
      "w3cid": "57789",
      "company": "Intel",
      "companyURL": "https://www.intel.com/"
    },
    {
      "name": "Daniel Peintner",
      "w3cid": "39497",
      "company": "Siemens AG",
      "companyURL": "https://www.siemens.com/"
    },
    {
      "name": "Johannes Hund",
      "w3cid": "74472",
      "note": "Former Editor, when at Siemens AG"
    },
    {
      "name": "Kazuaki Nimura",
      "w3cid": "59208",
      "note": "Former Editor, at Fujitsu Ltd."
    }
  ],
  "wg": "Web of Things Working Group",
  "wgURI": "https://www.w3.org/WoT/WG/",
  "wgPublicList": "public-wot-wg",
  "issueBase": "https://www.github.com/w3c/wot-scripting-api/issues/",
  "githubAPI": "https://api.github.com/repos/w3c/wot-scripting-api",
  "otherLinks": [
    {
      "key": "Repository",
      "data": [
        {
          "value": "On GitHub",
          "href": "https://github.com/w3c/wot-scripting-api"
        },
        {
          "value": "File a bug",
          "href": "https://github.com/w3c/wot-scripting-api/issues"
        }
      ]
    },
    {
      "key": "Contributors",
      "data": [
        {
          "value": "Contributors on GitHub",
          "href": "https://github.com/w3c/wot-scripting-api/graphs/contributors"
        }
      ]
    }
  ],
  "localBiblio": {
    "WOT-ARCHITECTURE": {
      "href": "https://www.w3.org/TR/2019/CR-wot-architecture-20190516/",
      "title": "Web of Things Architecture",
      "publisher": "W3C",
      "date": "16 May 2019",
      "id": "wot-architecture"
    },
    "WOT-TD": {
      "href": "https://www.w3.org/TR/2019/CR-wot-thing-description-20190516/",
      "title": "WoT Thing Description ",
      "publisher": "W3C",
      "date": "16 May 2019",
      "id": "wot-td"
    },
    "WOT-PROTOCOL-BINDINGS": {
      "href": "https://w3c.github.io/wot-binding-templates/",
      "title": "Web of Things Protocol Binding Templates",
      "publisher": "W3C",
      "date": "20 August 2017",
      "id": "wot-protocol-bindings"
    },
    "WOT-PRACTICES": {
      "href": "http://w3c.github.io/wot/current-practices/wot-practices.html",
      "title": "Web of Things Current Practices",
      "publisher": "W3C",
      "date": "6 February 2017"
    },
    "WOT-SECURITY-GUIDELINES": {
      "href": "https://w3c.github.io/wot-security/",
      "title": "Web of Things Security and Privacy Guidelines",
      "publisher": "W3C",
      "date": "28 August 2017",
      "id": "wot-security-guidelines"
    },
    "WOT-SECURITY-BEST-PRACTICES": {
      "href": "https://github.com/w3c/wot-security/blob/master/wot-security-best-practices.md",
      "title": "Web of Things Security and Privacy Best Practices",
      "publisher": "W3C",
      "date": "WIP",
      "id": "wot-security-best-practices"
    },
    "WOT-SECURITY-TESTING": {
      "href": "https://github.com/w3c/wot-security/blob/master/wot-security-testing.md",
      "title": "Web of Things Security Testing and Validation",
      "publisher": "W3C",
      "date": "WIP",
      "id": "wot-security-testing"
    },
    "TYPESCRIPT": {
      "href": "https://github.com/Microsoft/TypeScript/blob/master/doc/spec.md",
      "title": "TypeScript Language Specification",
      "publisher": "Microsoft",
      "date": "1 October 2012",
      "id": "typescript"
    },
    "WEBAPPSEC": {
      "href": "https://w3c.github.io/webappsec/specs/powerfulfeatures",
      "title": "Secure Contexts",
      "publisher": "W3C",
      "date": "17 July 2015",
      "id": "webappsec"
    }
  },
  "publishISODate": "2019-10-28T00:00:00.000Z",
  "generatedSubtitle": "WOrking Draft 28 October 2019"
  }
]]>
</script>
<meta name="description" content=
"The main Web of Things (WoT) concepts are described in the WoT Architecture document. The Web of Things is made of entities (Things) that can describe their capabilities in a machine-interpretable Thing Description (TD) and expose these capabilities through the WoT Interface, that is, network interactions modeled as Properties (for reading and writing values), Actions (to execute remote procedures with or without return values) and Events (for signaling notifications)." />
<link rel="stylesheet" href=
"https://www.w3.org/StyleSheets/TR/2016/W3C-WD" />
<style type='text/css'>
.diff-old-a {
  font-size: smaller;
  color: red;
}

.diff-new { background-color: yellow; }
.diff-chg { background-color: lime; }
.diff-new:before,
.diff-new:after
    { content: "\2191" }
.diff-chg:before, .diff-chg:after
    { content: "\2195" }
.diff-old { text-decoration: line-through; background-color: #FBB; }
.diff-old:before,
.diff-old:after
    { content: "\2193" }
:focus { border: thin red solid}
</style>
</head>
<body class="h-entry" data-cite="WebIDL">
<div class="head">
<a class="logo" href= "https://www.w3.org/">
<img alt="W3C" width="72" height="48" src= "https://www.w3.org/StyleSheets/TR/2016/logos/W3C" />
</a>
<h1 id="title" class="title p-name">
Web
of
Things
(WoT)
Scripting
API
</h1>
<h2>
W3C
Working
Draft
<del class="diff-old">29
November
2018
</del>
<time class="dt-published" datetime= "2019-10-28">
<ins class="diff-chg">28
October
2019
</ins>
</time>
</h2>
<dl>
<dt>
This
version:
</dt>
<dd>
<del class="diff-old">https://www.w3.org/TR/2018/WD-wot-scripting-api-20181129/
</del>
<a class="u-url" href= "https://www.w3.org/TR/2019/WD-wot-scripting-api-20191028/">
<ins class="diff-chg">https://www.w3.org/TR/2019/WD-wot-scripting-api-20191028/
</ins>
</a>
</dd>
<dt>
Latest
published
version:
</dt>
<dd>
<a href= "https://www.w3.org/TR/wot-scripting-api/">
https://www.w3.org/TR/wot-scripting-api/
</a>
</dd>
<dt>
Latest
editor's
draft:
</dt>
<dd>
<a href= "https://w3c.github.io/wot-scripting-api/">
https://w3c.github.io/wot-scripting-api/
</a>
</dd>
<dt>
Previous
version:
</dt>
<dd>
<del class="diff-old">https://www.w3.org/TR/2018/WD-wot-scripting-api-20180405/
</del>
<a class="u-url" href= "https://www.w3.org/TR/2018/WD-wot-scripting-api-20181129/">
<ins class="diff-chg">https://www.w3.org/TR/2018/WD-wot-scripting-api-20181129/
</ins>
</a>
</dd>
<dt>
Editors:
</dt>
<dd class="p-author h-card vcard" data-editor-id="57789">
<span class="p-name fn">
Zoltan
Kis
</span>
(
<a class= "p-org org h-org h-card" href= "https://www.intel.com/">
Intel
</a>
)
</dd>
<del class="diff-old">Kazuaki
Nimura
(
Fujitsu
Ltd.
)
</del>
<dd class="p-author h-card vcard" data-editor-id="39497">
<span class="p-name fn">
Daniel
Peintner
</span>
(
<a class= "p-org org h-org h-card" href="https://www.siemens.com/">
Siemens
AG
</a>
)
</dd>
<dd class="p-author h-card vcard" data-editor-id="74472">
<span class="p-name fn">
Johannes
Hund
</span>
(Former
Editor,
when
at
Siemens
AG)
</dd>
<del class="diff-old">Contributors:
In
the
GitHub
repository
</del>
<dd class="p-author h-card vcard" data-editor-id="59208">
<span class="p-name fn">
<ins class="diff-chg">Kazuaki
Nimura
</ins></span><ins class="diff-chg">
(Former
Editor,
at
Fujitsu
Ltd.)
</ins>
</dd>
<dt>
Repository:
</dt>
<dd>
<a href="https://github.com/w3c/wot-scripting-api">
<del class="diff-old">We
are
on
</del>
<ins class="diff-chg">On
</ins>
GitHub
</a>
</dd>
<dd>
<a href="https://github.com/w3c/wot-scripting-api/issues">
File
a
bug
</a>
</dd>
<dt>
<ins class="diff-new">Contributors:
</ins></dt><dd><a href= "https://github.com/w3c/wot-scripting-api/graphs/contributors"><ins class="diff-new">
Contributors
on
GitHub
</ins></a></dd>
</dl>
<p class="copyright">
<a href= "https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">
Copyright
</a>
©
<del class="diff-old">2017-2018
</del>
<ins class="diff-chg">2017-2019
</ins>
<a href="https://www.w3.org/">
<abbr title= "World Wide Web Consortium">
W3C
</abbr>
</a>
<sup>
®
</sup>
(
<a href= "https://www.csail.mit.edu/">
<abbr title= "Massachusetts Institute of Technology">
MIT
</abbr>
</a>,
<a href= "https://www.ercim.eu/">
<abbr title= "European Research Consortium for Informatics and Mathematics">
ERCIM
</abbr>
</a>,
<a href="https://www.keio.ac.jp/">
Keio
</a>,
<a href= "https://ev.buaa.edu.cn/">
Beihang
</a>
).
W3C
<a href= "https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">
liability
</a>,
<a href= "https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">
trademark
</a>
and
<a rel="license" href= "https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document">
permissive
document
license
</a>
rules
apply.
</p>
<hr title="Separator for header" />
</div>
<section id="abstract" class="introductory">
<h2>
Abstract
</h2>
<p>
The
<del class="diff-old">overall
</del>
<ins class="diff-chg">main
</ins>
<a href="#dfn-web-of-things" class="internalDFN" data-link-type="dfn">
Web
of
Things
</a>
(WoT)
concepts
are
described
in
the
<a href= "https://www.w3.org/TR/2019/CR-wot-architecture-20190516/">
WoT
Architecture
</a>
document.
The
Web
of
Things
is
made
of
entities
(
<a href="#dfn-things" class="internalDFN" data-link-type= "dfn">
Thing
</a>
s)
that
can
describe
their
capabilities
in
a
machine-interpretable
<del class="diff-old">format,
the
</del>
<a href="#dfn-thing-descriptions" class= "internalDFN" data-link-type="dfn">
Thing
Description
</a>
(TD)
and
expose
these
capabilities
through
the
<a href="#dfn-wot-interface" class="internalDFN" data-link-type="dfn">
WoT
Interface
</a>,
that
is,
network
interactions
modeled
as
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Properties
</a>
<del class="diff-old">for
</del>
<ins class="diff-chg">(for
</ins>
reading
and
writing
<del class="diff-old">values,
</del>
<ins class="diff-chg">values),
</ins><a href="#dfn-actions" class= "internalDFN" data-link-type="dfn">
Action
</a>
s
<del class="diff-old">to
</del>
<ins class="diff-chg">(to
</ins>
execute
remote
procedures
with
or
without
return
<del class="diff-old">values
</del>
<ins class="diff-chg">values)
</ins>
and
<a href="#dfn-events" class="internalDFN" data-link-type="dfn">
Event
</a>
s
<del class="diff-old">for
</del>
<ins class="diff-chg">(for
</ins>
signaling
<del class="diff-old">notifications.
This
specification
describes
a
programming
interface
representing
the
WoT
Interface
that
allows
scripts
run
on
a
Thing
to
discover
and
consume
(retrieve)
other
Thing
Description
s
and
to
expose
Things
characterized
by
WoT
Interactions
specified
by
a
script.
</del>
<ins class="diff-chg">notifications).
</ins>
</p>
<p>
Scripting
is
an
optional
"convenience"
building
block
in
WoT
and
it
is
typically
used
in
gateways
that
are
able
to
run
a
<a href= "#dfn-wot-runtime" class="internalDFN" data-link-type="dfn">
WoT
Runtime
</a>
and
<a href= "https://github.com/w3c/wot-scripting-api/tree/master/applications/script-manager">
script
management
</a>,
providing
a
convenient
way
to
extend
WoT
support
to
new
types
of
endpoints
and
implement
WoT
applications
<del class="diff-old">like
</del>
<ins class="diff-chg">such
as
</ins>
<a href= "https://github.com/w3c/wot-scripting-api/tree/master/applications/thing-directory">
Thing
Directory
</a>.
</p>
<p>
<ins class="diff-new">This
specification
describes
a
programming
interface
representing
the
</ins><a href="#dfn-wot-interface" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
WoT
Interface
</ins></a><ins class="diff-new">
that
allows
scripts
to
discover,
operate
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Thing
</ins></a><ins class="diff-new">
s
and
to
expose
locally
defined
</ins><a href="#dfn-things" class="internalDFN" data-link-type= "dfn"><ins class="diff-new">
Things
</ins></a><ins class="diff-new">
characterized
by
</ins><a href="#dfn-wot-interactions" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
WoT
Interactions
</ins></a><ins class="diff-new">
specified
by
a
script.
</ins></p><p><ins class="diff-new">
The
specification
deliberately
follows
the
</ins><a href= "https://www.w3.org/TR/2019/CR-wot-thing-description-20190516/"><ins class="diff-new">
WoT
Thing
Description
specification
</ins></a><ins class="diff-new">
closely.
It
is
possible
to
implement
simpler
APIs
on
top
of
this
API,
or
implementing
directly
the
WoT
network
facing
interface
(i.e.
the
</ins><a href= "#dfn-wot-interface" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
WoT
Interface
</ins></a><ins class="diff-new">
).
</ins></p><div class="note" id="issue-container-generatedID"><div role="heading" class="ednote-title marker" id="h-ednote" aria-level="3"><span><ins class="diff-new">
Editor's
note
</ins></span></div><p class=""><ins class="diff-new">
This
specification
is
implemented
at
least
by
the
</ins><a href="http://www.thingweb.io/"><ins class="diff-new">
Thingweb
</ins></a><ins class="diff-new">
project
also
known
as
</ins><a href= "https://github.com/eclipse/thingweb.node-wot"><ins class="diff-new">
node-wot
</ins></a>,<ins class="diff-new">
which
is
considered
the
reference
open
source
implementation
at
the
moment.
Check
its
</ins><a href= "https://github.com/eclipse/thingweb.node-wot"><ins class="diff-new">
source
code
</ins></a>,<ins class="diff-new">
including
</ins><a href= "https://github.com/eclipse/thingweb.node-wot"><ins class="diff-new">
examples
</ins></a>.<ins class="diff-new">
Other,
closed
source
implementations
have
been
made
by
WG
member
companies
and
tested
against
</ins><a href= "https://github.com/eclipse/thingweb.node-wot"><ins class="diff-new">
node-wot
</ins></a><ins class="diff-new">
in
plug-fests.
</ins></p></div>
</section>
<section id="sotd" class="introductory">
<h2>
Status
of
This
Document
</h2>
<p>
<em>
This
section
describes
the
status
of
this
document
at
the
time
of
its
publication.
Other
documents
may
supersede
this
document.
A
list
of
current
<abbr title= "World Wide Web Consortium">
W3C
</abbr>
publications
and
the
latest
revision
of
this
technical
report
can
be
found
in
the
<a href= "https://www.w3.org/TR/">
<abbr title= "World Wide Web Consortium">
W3C
</abbr>
technical
reports
index
</a>
at
https://www.w3.org/TR/.
</em>
</p>
<p>
Implementers
need
to
be
aware
that
this
specification
is
considered
unstable.
Vendors
interested
in
implementing
this
specification
before
it
eventually
reaches
the
Candidate
Recommendation
phase
should
subscribe
to
the
<a href= "https://github.com/w3c/wot-scripting-api">
repository
</a>
and
take
part
in
the
discussions.
</p>
<div class="note" id="issue-container-generatedID-0">
<div role="heading" class="ednote-title marker" id="h-ednote-0" aria-level="3">
<span>
Editor's
note
</span>
<del class="diff-old">:
</del>
<span class= "issue-label">:
The
W3C
WoT
WG
is
asking
for
feedback
</span>
</div>
<p class="">
Please
contribute
to
this
draft
using
the
<a href= "https://github.com/w3c/wot-scripting-api/issues">
GitHub
Issue
</a>
feature
of
the
<a href= "https://github.com/w3c/wot-scripting-api/">
WoT
Scripting
API
</a>
repository.
For
feedback
on
security
and
privacy
considerations,
please
use
the
<a href= "https://github.com/w3c/wot-security/issues">
WoT
Security
and
Privacy
</a>
Issues.
</p>
</div>
<p>
This
document
was
published
by
the
<a href= "https://www.w3.org/WoT/WG/">
Web
of
Things
Working
Group
</a>
as
a
Working
Draft.
This
document
is
intended
to
become
a
W3C
Recommendation.
</p>
<p>
Comments
regarding
this
document
are
welcome.
Please
send
them
to
<a href="mailto:public-wot-wg@w3.org">
public-wot-wg@w3.org
</a>
(
<del class="diff-old">subscribe
,
</del>
<a href= "https://lists.w3.org/Archives/Public/public-wot-wg/">
archives
</a>
).
</p>
<p>
<del class="diff-old">Changes
from
the
previous
publication
can
be
found
in
Appendix
A
.
A
diff-marked
version
of
this
document
is
also
available
for
comparison
purposes.
</del>
Publication
as
a
Working
Draft
does
not
imply
endorsement
by
the
<abbr title="World Wide Web Consortium">
W3C
</abbr>
Membership.
This
is
a
draft
document
and
may
be
updated,
replaced
or
obsoleted
by
other
documents
at
any
time.
It
is
inappropriate
to
cite
this
document
as
other
than
work
in
progress.
</p>
<p>
This
document
was
produced
by
a
group
operating
under
the
<a href="https://www.w3.org/Consortium/Patent-Policy/">
<abbr title= "World Wide Web Consortium">
W3C
</abbr>
Patent
Policy
</a>.
<abbr title="World Wide Web Consortium">
W3C
</abbr>
maintains
a
<a rel="disclosure" href= "https://www.w3.org/2004/01/pp-impl/95969/status">
public
list
of
any
patent
disclosures
</a>
made
in
connection
with
the
deliverables
of
the
group;
that
page
also
includes
instructions
for
disclosing
a
patent.
An
individual
who
has
actual
knowledge
of
a
patent
which
the
individual
believes
contains
<a href= "https://www.w3.org/Consortium/Patent-Policy/#def-essential">
Essential
Claim(s)
</a>
must
disclose
the
information
in
accordance
with
<a href= "https://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">
section
6
of
the
<abbr title="World Wide Web Consortium">
W3C
</abbr>
Patent
Policy
</a>.
</p>
<p>
This
document
is
governed
by
the
<a id="w3c_process_revision" href="https://www.w3.org/2019/Process-20190301/">
1
<del class="diff-old">February
2018
</del>
<ins class="diff-chg">March
2019
</ins>
<abbr title="World Wide Web Consortium">
W3C
</abbr>
Process
Document
</a>.
</p>
</section>
<nav id="toc">
<h2 class="introductory" id="table-of-contents">
Table
of
Contents
</h2>
<ol class="toc">
<li class="tocline">
<a class="tocxref" href= "#introduction">
<bdi class="secno">
1.
</bdi>
Introduction
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#use-cases">
<bdi class="secno">
2.
</bdi>
Use
Cases
</a>
<ol class="toc">
<li class="tocline">
<a class="tocxref" href= "#consuming-a-thing">
<bdi class="secno">
2.1
<del class="diff-old">Discovery
</del>
</bdi>
<ins class="diff-chg">Consuming
a
Thing
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#exposing-a-thing">
<bdi class="secno">
2.2
<del class="diff-old">Consuming
</del>
</bdi>
<ins class="diff-chg">Exposing
</ins>
a
Thing
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#discovery">
<bdi class="secno">
2.3
<del class="diff-old">Exposing
a
Thing
</del>
</bdi>
<ins class="diff-chg">Discovery
</ins>
</a>
</li>
</ol>
</li>
<li class="tocline">
<a class="tocxref" href= "#conformance">
<bdi class="secno">
3.
<del class="diff-old">The
WoT
object
</del>
</bdi>
<ins class="diff-chg">Conformance
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-thingdescription-type">
<del class="diff-old">3.1
</del>
<bdi class="secno">
<ins class="diff-chg">4.
</ins></bdi>
The
<span data-dfn-type="typedef" data-export="" data-idl="typedef" data-title="ThingDescription">
<code>
<del class="diff-old">discover()
</del>
<ins class="diff-chg">ThingDescription
</ins>
</code>
</span>
<del class="diff-old">method
</del>
<ins class="diff-chg">type
</ins>
</a>
<ol class="toc">
<li class="tocline">
<del class="diff-old">3.1.1
The
DiscoveryMethod
</del>
<a class="tocxref" href= "#fetching-a-thing-description">
<del class="diff-old">enumeration
</del>
<bdi class="secno">
<ins class="diff-chg">4.1
</ins></bdi><ins class="diff-chg">
Fetching
a
Thing
Description
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#expanding-a-thing-description">
<del class="diff-old">3.1.2
The
</del>
<bdi class="secno">
<ins class="diff-chg">4.2
</ins></bdi><ins class="diff-chg">
Expanding
a
Thing
Description
</ins></a>
<del class="diff-old">ThingFilter
</del>
</li>
<li class="tocline">
<del class="diff-old">dictionary
</del>
<a class="tocxref" href= "#validating-a-thing-description">
<bdi class="secno">
<ins class="diff-chg">4.3
</ins></bdi><ins class="diff-chg">
Validating
a
Thing
Description
</ins>
</a>
</li>
</ol>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-wot-api-object">
<del class="diff-old">3.2
</del>
<bdi class="secno">
<ins class="diff-chg">5.
</ins></bdi>
The
<del class="diff-old">fetch()
</del>
<span data-dfn-type="dfn">
<ins class="diff-chg">WoT
API
object
</ins>
</span>
<del class="diff-old">method
</del>
</a>
<ol class="toc">
<li class="tocline">
<a class="tocxref" href= "#the-wot-interface">
<del class="diff-old">3.3
</del>
<bdi class="secno">
<ins class="diff-chg">5.1
</ins></bdi>
The
<span data-dfn-type="interface" data-export="" data-idl="interface" data-title="WOT">
<code>
<del class="diff-old">consume()
</del>
<ins class="diff-chg">WOT
</ins>
</code>
</span>
<del class="diff-old">method
</del>
<ins class="diff-chg">interface
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-consume-method">
<del class="diff-old">3.4
</del>
<bdi class="secno">
<ins class="diff-chg">5.2
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="consume()" data-dfn-for="WOT" data-type="Promise" data-lt= "WOT.consume()|WOT.consume|consume()|consume">
<code>
<del class="diff-old">produce()
</del>
<ins class="diff-chg">consume()
</ins>
</code>
</span>
method
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-produce-method">
<del class="diff-old">3.5
</del>
<bdi class="secno">
<ins class="diff-chg">5.3
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="produce()" data-dfn-for="WOT" data-type="Promise" data-lt= "WOT.produce()|WOT.produce|produce()|produce">
<code>
<del class="diff-old">register()
</del>
<ins class="diff-chg">produce()
</ins>
</code>
</span>
method
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-discover-method">
<del class="diff-old">3.6
</del>
<bdi class="secno">
<ins class="diff-chg">5.4
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="discover()" data-dfn-for="WOT" data-type= "ThingDiscovery" data-lt= "WOT.discover()|WOT.discover|discover()|discover">
<code>
<del class="diff-old">unregister()
</del>
<ins class="diff-chg">discover()
</ins>
</code>
</span>
method
</a>
</li>
<del class="diff-old">3.7
Examples
</del>
</ol>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-consumedthing-interface">
<del class="diff-old">4.
</del>
<bdi class="secno">
<ins class="diff-chg">6.
</ins></bdi>
The
<span data-dfn-type="interface" data-export="" data-idl="interface" data-title="ConsumedThing">
<code>
ConsumedThing
</code>
</span>
interface
</a>
<ol class="toc">
<li class="tocline">
<del class="diff-old">4.1
Examples
5.
The
</del>
<a class="tocxref" href= "#constructing-consumedthing">
<bdi class="secno">
<ins class="diff-new">6.1
</ins></bdi><ins class="diff-new">
Constructing
</ins>
<code>
<del class="diff-old">ExposedThing
</del>
<ins class="diff-chg">ConsumedThing
</ins>
</code>
<del class="diff-old">interface
</del>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-getthingdescription-method">
<del class="diff-old">5.1
</del>
<bdi class="secno">
<ins class="diff-chg">6.2
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="getThingDescription()" data-dfn-for="ConsumedThing" data-type="ThingDescription" data-lt= "ConsumedThing.getThingDescription()|ConsumedThing.getThingDescription|getThingDescription()|getThingDescription">
<code>
<del class="diff-old">expose()
</del>
<ins class="diff-chg">getThingDescription()
</ins>
</code>
</span>
method
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-interactionoptions-dictionary">
<del class="diff-old">5.2
</del>
<bdi class="secno">
<ins class="diff-chg">6.3
</ins></bdi>
The
<span data-dfn-type="dictionary" data-export="" data-idl= "dictionary" data-title= "InteractionOptions">
<code>
<del class="diff-old">destroy()
</del>
<ins class="diff-chg">InteractionOptions
</ins>
</code>
</span>
<del class="diff-old">method
</del>
<ins class="diff-chg">dictionary
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-propertymap-type">
<del class="diff-old">5.3
</del>
<bdi class="secno">
<ins class="diff-chg">6.4
</ins></bdi>
The
<span data-dfn-type="typedef" data-export="" data-idl="typedef" data-title="PropertyMap">
<code>
<del class="diff-old">addProperty()
</del>
<ins class="diff-chg">PropertyMap
</ins>
</code>
</span>
<del class="diff-old">method
</del>
<ins class="diff-chg">type
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-readproperty-method">
<del class="diff-old">5.4
</del>
<bdi class="secno">
<ins class="diff-chg">6.5
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="readProperty()" data-dfn-for="ConsumedThing" data-type= "Promise" data-lt= "ConsumedThing.readProperty()|ConsumedThing.readProperty|readProperty()|readProperty">
<code>
<del class="diff-old">removeProperty()
</del>
<ins class="diff-chg">readProperty()
</ins>
</code>
</span>
method
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-readmultipleproperties-method">
<del class="diff-old">5.5
</del>
<bdi class="secno">
<ins class="diff-chg">6.6
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl= "operation" data-title="readMultipleProperties()" data-dfn-for= "ConsumedThing" data-type="Promise" data-lt= "ConsumedThing.readMultipleProperties()|ConsumedThing.readMultipleProperties|readMultipleProperties()|readMultipleProperties">
<code>
<del class="diff-old">addAction()
</del>
<ins class="diff-chg">readMultipleProperties()
</ins>
</code>
</span>
method
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-readallproperties-method">
<del class="diff-old">5.6
</del>
<bdi class="secno">
<ins class="diff-chg">6.7
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="readAllProperties()" data-dfn-for="ConsumedThing" data-type="Promise" data-lt= "ConsumedThing.readAllProperties()|ConsumedThing.readAllProperties|readAllProperties()|readAllProperties">
<code>
<del class="diff-old">removeAction()
</del>
<ins class="diff-chg">readAllProperties()
</ins>
</code>
</span>
method
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-writeproperty-method">
<del class="diff-old">5.7
</del>
<bdi class="secno">
<ins class="diff-chg">6.8
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="writeProperty()" data-dfn-for="ConsumedThing" data-type="Promise" data-lt= "ConsumedThing.writeProperty()|ConsumedThing.writeProperty|writeProperty()|writeProperty">
<code>
<del class="diff-old">addEvent()
</del>
<ins class="diff-chg">writeProperty()
</ins>
</code>
</span>
method
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-writemultipleproperties-method">
<del class="diff-old">5.8
</del>
<bdi class="secno">
<ins class="diff-chg">6.9
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl= "operation" data-title="writeMultipleProperties()" data-dfn-for= "ConsumedThing" data-type="Promise" data-lt= "ConsumedThing.writeMultipleProperties()|ConsumedThing.writeMultipleProperties|writeMultipleProperties()|writeMultipleProperties">
<code>
<del class="diff-old">removeEvent()
</del>
<ins class="diff-chg">writeMultipleProperties()
</ins>
</code>
</span>
method
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-wotlistener-callback">
<del class="diff-old">5.9
</del>
<bdi class="secno">
<ins class="diff-chg">6.10
</ins></bdi>
The
<span data-dfn-type="callback" data-export="" data-idl="callback" data-title="WotListener">
<code>
<del class="diff-old">PropertyReadHandler
</del>
<ins class="diff-chg">WotListener
</ins>
</code>
</span>
callback
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-observeproperty-method">
<del class="diff-old">5.10
</del>
<bdi class="secno">
<ins class="diff-chg">6.11
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="observeProperty()" data-dfn-for="ConsumedThing" data-type="Promise" data-lt= "ConsumedThing.observeProperty()|ConsumedThing.observeProperty|observeProperty()|observeProperty">
<code>
<del class="diff-old">PropertyWriteHandler
</del>
<ins class="diff-chg">observeProperty()
</ins>
</code>
</span>
<del class="diff-old">callback
</del>
<ins class="diff-chg">method
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-unobserveproperty-method">
<del class="diff-old">5.11
</del>
<bdi class="secno">
<ins class="diff-chg">6.12
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="unobserveProperty()" data-dfn-for="ConsumedThing" data-type="Promise" data-lt= "ConsumedThing.unobserveProperty()|ConsumedThing.unobserveProperty|unobserveProperty()|unobserveProperty">
<code>
<del class="diff-old">ActionHandler
</del>
<ins class="diff-chg">unobserveProperty()
</ins>
</code>
</span>
<del class="diff-old">callback
</del>
<ins class="diff-chg">method
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-invokeaction-method">
<del class="diff-old">5.12
</del>
<bdi class="secno">
<ins class="diff-chg">6.13
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="invokeAction()" data-dfn-for="ConsumedThing" data-type= "Promise" data-lt= "ConsumedThing.invokeAction()|ConsumedThing.invokeAction|invokeAction()|invokeAction">
<code>
<del class="diff-old">setPropertyReadHandler()
</del>
<ins class="diff-chg">invokeAction()
</ins>
</code>
</span>
method
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-subscribeevent-method">
<del class="diff-old">5.13
</del>
<bdi class="secno">
<ins class="diff-chg">6.14
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="subscribeEvent()" data-dfn-for="ConsumedThing" data-type="Promise" data-lt= "ConsumedThing.subscribeEvent()|ConsumedThing.subscribeEvent|subscribeEvent()|subscribeEvent">
<code>
<del class="diff-old">setPropertyWriteHandler()
</del>
<ins class="diff-chg">subscribeEvent()
</ins>
</code>
</span>
method
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-unsubscribeevent-method">
<del class="diff-old">5.14
</del>
<bdi class="secno">
<ins class="diff-chg">6.15
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="unsubscribeEvent()" data-dfn-for="ConsumedThing" data-type="Promise" data-lt= "ConsumedThing.unsubscribeEvent()|ConsumedThing.unsubscribeEvent|unsubscribeEvent()|unsubscribeEvent">
<code>
<del class="diff-old">setActionHandler()
</del>
<ins class="diff-chg">unsubscribeEvent()
</ins>
</code>
</span>
method
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#consumedthing-examples">
<del class="diff-old">5.15
</del>
<bdi class="secno">
<ins class="diff-chg">6.16
</ins></bdi><ins class="diff-chg">
ConsumedThing
</ins>
Examples
</a>
</li>
</ol>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-exposedthing-interface">
<bdi class="secno">
<ins class="diff-chg">7.
</ins></bdi><ins class="diff-chg">
The
</ins><span data-dfn-type="interface" data-export="" data-idl="interface" data-title="ExposedThing"><code><ins class="diff-chg">
ExposedThing
</ins></code>
<del class="diff-old">6.
</del>
</span>
<del class="diff-old">Data
types
and
structures
</del>
<ins class="diff-chg">interface
</ins>
</a>
<ol class="toc">
<li class="tocline">
<a class="tocxref" href= "#constructing-exposedthing">
<del class="diff-old">6.1
The
</del>
<bdi class="secno">
<ins class="diff-chg">7.1
</ins></bdi><ins class="diff-chg">
Constructing
</ins><code><ins class="diff-chg">
ExposedThing
</ins></code></a></li><li class="tocline"><a class="tocxref" href= "#methods-inherited-from-consumedthing"><bdi class= "secno"><ins class="diff-chg">
7.2
</ins></bdi><ins class="diff-chg">
Methods
inherited
from
</ins><span class="formerLink" data-link-type="idl">
<code>
<del class="diff-old">DataSchema
</del>
<ins class="diff-chg">ConsumedThing
</ins>
</code>
</span>
<del class="diff-old">dictionary
and
its
subclasses
</del>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-propertyreadhandler-callback">
<del class="diff-old">6.2
</del>
<bdi class="secno">
<ins class="diff-chg">7.3
</ins></bdi>
The
<span data-dfn-type="callback" data-export="" data-idl= "callback" data-title= "PropertyReadHandler">
<code>
<del class="diff-old">SecurityScheme
</del>
<ins class="diff-chg">PropertyReadHandler
</ins>
</code>
</span>
<del class="diff-old">dictionary
and
its
subclasses
</del>
<ins class="diff-chg">callback
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-setpropertyreadhandler-method">
<del class="diff-old">6.3
</del>
<bdi class="secno">
<ins class="diff-chg">7.4
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl= "operation" data-title="setPropertyReadHandler()" data-dfn-for= "ExposedThing" data-type="ExposedThing" data-lt= "ExposedThing.setPropertyReadHandler()|ExposedThing.setPropertyReadHandler|setPropertyReadHandler()|setPropertyReadHandler">
<code>
<del class="diff-old">Link
</del>
<ins class="diff-chg">setPropertyReadHandler()
</ins>
</code>
</span>
<del class="diff-old">dictionary
</del>
<ins class="diff-chg">method
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#handling-property-read-requests">
<del class="diff-old">6.4
</del>
<bdi class="secno">
<ins class="diff-chg">7.5
</ins></bdi><ins class="diff-chg">
Handling
</ins><span class="formerLink" data-link-type= "dfn"><ins class="diff-chg">
Property
</ins></span><ins class="diff-chg">
read
requests
</ins></a></li><li class="tocline"><a class="tocxref" href= "#handling-property-observe-requests"><bdi class="secno"><ins class="diff-chg">
7.6
</ins></bdi><ins class="diff-chg">
Handling
</ins><span class="formerLink" data-link-type= "dfn"><ins class="diff-chg">
Property
</ins>
</span>
<ins class="diff-new">observe
requests
</ins></a></li><li class="tocline"><a class="tocxref" href= "#the-propertywritehandler-callback"><bdi class="secno"><ins class="diff-new">
7.7
</ins></bdi>
The
<span data-dfn-type="callback" data-export="" data-idl= "callback" data-title= "PropertyWriteHandler">
<code>
<del class="diff-old">Form
</del>
<ins class="diff-chg">PropertyWriteHandler
</ins>
</code>
</span>
<del class="diff-old">dictionary
</del>
<ins class="diff-chg">callback
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-setpropertywritehandler-method">
<del class="diff-old">6.5
</del>
<bdi class="secno">
<ins class="diff-chg">7.8
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl= "operation" data-title="setPropertyWriteHandler()" data-dfn-for= "ExposedThing" data-type="ExposedThing" data-lt= "ExposedThing.setPropertyWriteHandler()|ExposedThing.setPropertyWriteHandler|setPropertyWriteHandler()|setPropertyWriteHandler">
<code>
<ins class="diff-new">setPropertyWriteHandler()
</ins></code>
<del class="diff-old">InteractionFragment
</del>
</span>
<del class="diff-old">dictionary
</del>
<ins class="diff-chg">method
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#handling-property-write-requests">
<del class="diff-old">6.6
</del>
<bdi class="secno">
<ins class="diff-chg">7.9
</ins></bdi><ins class="diff-chg">
Handling
</ins><span class="formerLink" data-link-type= "dfn"><ins class="diff-chg">
Property
</ins>
</span>
<ins class="diff-new">write
requests
</ins></a></li><li class="tocline"><a class="tocxref" href= "#the-actionhandler-callback"><bdi class="secno"><ins class="diff-new">
7.10
</ins></bdi>
The
<span data-dfn-type="callback" data-export="" data-idl="callback" data-title="ActionHandler">
<code>
<del class="diff-old">PropertyFragment
</del>
<ins class="diff-chg">ActionHandler
</ins>
</code>
</span>
<del class="diff-old">dictionary
</del>
<ins class="diff-chg">callback
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-setactionhandler-method">
<del class="diff-old">6.7
</del>
<bdi class="secno">
<ins class="diff-chg">7.11
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="setActionHandler()" data-dfn-for="ExposedThing" data-type="ExposedThing" data-lt= "ExposedThing.setActionHandler()|ExposedThing.setActionHandler|setActionHandler()|setActionHandler">
<code>
<del class="diff-old">ActionFragment
</del>
<ins class="diff-chg">setActionHandler()
</ins>
</code>
</span>
<del class="diff-old">dictionary
</del>
<ins class="diff-chg">method
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#handling-action-requests">
<del class="diff-old">6.8
</del>
<bdi class="secno">
<ins class="diff-chg">7.12
</ins></bdi><ins class="diff-chg">
Handling
</ins><span class="formerLink" data-link-type="dfn"><ins class="diff-chg">
Action
</ins>
</span>
<del class="diff-old">The
</del>
<ins class="diff-chg">requests
</ins></a></li><li class="tocline"><a class="tocxref" href= "#the-emitevent-method">
<bdi class="secno">
<ins class="diff-new">7.13
</ins></bdi><ins class="diff-new">
The
</ins><span data-dfn-type="method" data-export="" data-idl="operation" data-title="emitEvent()" data-dfn-for="ExposedThing" data-type= "void" data-lt= "ExposedThing.emitEvent()|ExposedThing.emitEvent|emitEvent()|emitEvent">
<code>
<del class="diff-old">EventFragment
</del>
<ins class="diff-chg">emitEvent()
</ins>
</code>
</span>
<del class="diff-old">dictionary
</del>
<ins class="diff-chg">method
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-expose-method">
<del class="diff-old">6.9
</del>
<bdi class="secno">
<ins class="diff-chg">7.14
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="expose()" data-dfn-for="ExposedThing" data-type= "Promise" data-lt= "ExposedThing.expose()|ExposedThing.expose|expose()|expose">
<code>
<del class="diff-old">ThingFragment
</del>
<ins class="diff-chg">expose()
</ins>
</code>
</span>
<del class="diff-old">dictionary
</del>
<ins class="diff-chg">method
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-destroy-method">
<del class="diff-old">6.10
</del>
<bdi class="secno">
<ins class="diff-chg">7.15
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="destroy()" data-dfn-for="ExposedThing" data-type= "Promise" data-lt= "ExposedThing.destroy()|ExposedThing.destroy|destroy()|destroy">
<code>
<del class="diff-old">ThingDescription
</del>
<ins class="diff-chg">destroy()
</ins>
</code>
</span>
<del class="diff-old">type
</del>
<ins class="diff-chg">method
</ins>
</a>
</li>
<li class="tocline">
<del class="diff-old">7.
Interfaces
for
WoT
Interactions
</del>
<a class="tocxref" href= "#exposedthing-examples">
<bdi class="secno">
<ins class="diff-new">7.16
</ins></bdi><ins class="diff-new">
ExposedThing
Examples
</ins>
</a>
</li>
</ol>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-thingdiscovery-interface">
<del class="diff-old">7.1
</del>
<bdi class="secno">
<ins class="diff-chg">8.
</ins></bdi>
The
<span data-dfn-type="interface" data-export="" data-idl="interface" data-title="ThingDiscovery">
<code>
<del class="diff-old">Interaction
</del>
<ins class="diff-chg">ThingDiscovery
</ins>
</code>
</span>
interface
</a>
<ol class="toc">
<li class="tocline">
<a class="tocxref" href= "#constructing-thingdiscovery">
<bdi class="secno">
<ins class="diff-new">8.1
</ins></bdi><ins class="diff-new">
Constructing
</ins><code><ins class="diff-new">
ThingDiscovery
</ins></code></a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-discoverymethod-enumeration">
<del class="diff-old">7.2
</del>
<bdi class="secno">
<ins class="diff-chg">8.2
</ins></bdi>
The
<span data-dfn-type="typedef" data-export="" data-idl="typedef" data-title="DiscoveryMethod">
<code>
<del class="diff-old">ThingProperty
</del>
<ins class="diff-chg">DiscoveryMethod
</ins>
</code>
</span>
<del class="diff-old">interface
</del>
<ins class="diff-chg">enumeration
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-thingfilter-dictionary">
<del class="diff-old">7.3
</del>
<bdi class="secno">
<ins class="diff-chg">8.3
</ins></bdi>
The
<span data-dfn-type="dictionary" data-export="" data-idl= "dictionary" data-title= "ThingFilter">
<code>
<del class="diff-old">ThingAction
</del>
<ins class="diff-chg">ThingFilter
</ins>
</code>
</span>
<del class="diff-old">interface
</del>
<ins class="diff-chg">dictionary
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-start-method">
<del class="diff-old">7.4
</del>
<bdi class="secno">
<ins class="diff-chg">8.4
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="start()" data-dfn-for="ThingDiscovery" data-type="void" data-lt= "ThingDiscovery.start()|ThingDiscovery.start|start()|start">
<code>
<del class="diff-old">ThingEvent
</del>
<ins class="diff-chg">start()
</ins>
</code>
</span>
<del class="diff-old">interface
</del>
<ins class="diff-chg">method
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-next-method">
<del class="diff-old">7.5
</del>
<bdi class="secno">
<ins class="diff-chg">8.5
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="next()" data-dfn-for="ThingDiscovery" data-type= "Promise" data-lt= "ThingDiscovery.next()|ThingDiscovery.next|next()|next">
<code>
<del class="diff-old">ExposedEvent
</del>
<ins class="diff-chg">next()
</ins>
</code>
</span>
<del class="diff-old">interface
</del>
<ins class="diff-chg">method
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#the-stop-method">
<del class="diff-old">7.5.1
</del>
<bdi class="secno">
<ins class="diff-chg">8.6
</ins></bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="stop()" data-dfn-for="ThingDiscovery" data-type="void" data-lt= "ThingDiscovery.stop()|ThingDiscovery.stop|stop()|stop">
<code>
<del class="diff-old">emit()
</del>
<ins class="diff-chg">stop()
</ins>
</code>
</span>
method
</a>
</li>
<li class="tocline">
<del class="diff-old">7.6
The
value-matching
algorithm
</del>
<a class="tocxref" href= "#discovery-examples">
<bdi class="secno">
<ins class="diff-new">8.7
</ins></bdi><ins class="diff-new">
Discovery
Examples
</ins>
</a>
</li>
</ol>
</li>
<li class="tocline">
<a class="tocxref" href= "#security-and-privacy">
<del class="diff-old">8.
Observables
</del>
<bdi class="secno">
<ins class="diff-chg">9.
</ins></bdi><ins class="diff-chg">
Security
and
Privacy
</ins>
</a>
<ol class="toc">
<li class="tocline">
<a class="tocxref" href= "#sec-security-consideration-runtime">
<del class="diff-old">8.1
The
</del>
<bdi class="secno">
<ins class="diff-chg">9.1
</ins></bdi><ins class="diff-chg">
Scripting
Runtime
Security
and
Privacy
Risks
</ins></a><ol class="toc"><li class="tocline">
<del class="diff-old">Subscription
</del>
<a class="tocxref" href= "#sec-security-consideration-input">
<del class="diff-old">interface
</del>
<bdi class="secno">
<ins class="diff-chg">9.1.1
</ins></bdi><ins class="diff-chg">
Corrupted
Input
Security
and
Privacy
Risk
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#sec-security-consideration-device-direct-access">
<del class="diff-old">8.2
The
</del>
<bdi class= "secno">
<ins class="diff-chg">9.1.2
</ins></bdi><ins class="diff-chg">
Physical
Device
Direct
Access
Security
and
Privacy
Risk
</ins></a>
<del class="diff-old">Observable
</del>
</li>
<li class="tocline">
<del class="diff-old">interface
</del>
<a class="tocxref" href= "#sec-security-consideration-update-provisioning">
<bdi class= "secno">
<ins class="diff-chg">9.1.3
</ins></bdi><ins class="diff-chg">
Provisioning
and
Update
Security
Risk
</ins></a></li><li class="tocline"><a class="tocxref" href= "#sec-security-consideration-credentials-storage"><bdi class= "secno"><ins class="diff-chg">
9.1.4
</ins></bdi><ins class="diff-chg">
Security
Credentials
Storage
Security
and
Privacy
Risk
</ins>
</a>
</li>
</ol>
</li>
<li class="tocline">
<a class="tocxref" href= "#sec-security-consideration-script">
<del class="diff-old">9.
</del>
<bdi class="secno">
<ins class="diff-chg">9.2
</ins></bdi><ins class="diff-chg">
Script
Security
and
Privacy
Risks
</ins></a><ol class="toc"><li class="tocline"><a class="tocxref" href= "#sec-security-consideration-script-input"><bdi class= "secno"><ins class="diff-chg">
9.2.1
</ins></bdi><ins class="diff-chg">
Corrupted
Script
Input
</ins>
Security
and
Privacy
<ins class="diff-new">Risk
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#sec-security-consideration-script-processing">
<bdi class= "secno">
<ins class="diff-chg">9.2.2
</ins></bdi><ins class="diff-chg">
Denial
Of
Service
Security
Risk
</ins></a></li><li class="tocline"><a class="tocxref" href= "#sec-security-consideration-script-stale-td"><bdi class= "secno"><ins class="diff-chg">
9.2.3
</ins></bdi><ins class="diff-chg">
Stale
TD
Security
Risk
</ins></a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href= "#terminology-and-conventions"><bdi class="secno">
10.
</bdi>
Terminology
and
conventions
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#api-design-rationale">
<del class="diff-old">11.
Conformance
</del>
<bdi class="secno">
<ins class="diff-chg">A.
</ins></bdi><ins class="diff-chg">
API
design
rationale
</ins></a><ol class="toc"><li class="tocline"><a class="tocxref" href= "#approaches-to-wot-application-development"><bdi class= "secno"><ins class="diff-chg">
A.1
</ins></bdi><ins class="diff-chg">
Approaches
to
WoT
application
development
</ins></a><ol class="toc"><li class="tocline"><a class="tocxref" href= "#no-scripting-api"><bdi class="secno"><ins class="diff-chg">
A.1.1
</ins></bdi><ins class="diff-chg">
No
Scripting
API
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#simple-scripting-api">
<del class="diff-old">A.
</del>
<bdi class="secno">
<ins class="diff-chg">A.1.2
</ins></bdi><ins class="diff-chg">
Simple
Scripting
API
</ins></a></li><li class="tocline"><a class="tocxref" href= "#this-api-aligned-with-wot-td"><bdi class="secno"><ins class="diff-chg">
A.1.3
</ins></bdi><ins class="diff-chg">
This
API,
aligned
with
[
</ins><cite><span class="formerLink" title= "WoT Thing Description " data-link-type= "biblio"><ins class="diff-chg">
WOT-TD
</ins>
</span>
<del class="diff-old">Changes
</del>
</cite>
<ins class="diff-chg">]
</ins>
</a>
</li>
</ol>
</li>
<li class="tocline">
<a class="tocxref" href= "#fetching-and-validating-a-td">
<bdi class="secno">
<ins class="diff-chg">A.2
</ins></bdi><ins class="diff-chg">
Fetching
and
validating
a
TD
</ins></a></li><li class="tocline"><a class="tocxref" href= "#factory-vs-constructors"><bdi class="secno"><ins class="diff-chg">
A.3
</ins></bdi><ins class="diff-chg">
Factory
vs
constructors
</ins></a></li><li class="tocline"><a class="tocxref" href= "#observers"><bdi class="secno"><ins class="diff-chg">
A.4
</ins></bdi><ins class="diff-chg">
Observers
</ins></a></li><li class="tocline"><a class="tocxref" href= "#using-events"><bdi class="secno"><ins class="diff-chg">
A.5
</ins></bdi><ins class="diff-chg">
Using
Events
</ins></a></li><li class="tocline"><a class="tocxref" href= "#polymorphic-functions"><bdi class="secno"><ins class="diff-chg">
A.6
</ins></bdi><ins class="diff-chg">
Polymorphic
functions
</ins></a></li></ol></li><li class="tocline"><a class="tocxref" href="#Changes"><bdi class= "secno">
B.
<del class="diff-old">Open
issues
</del>
</bdi>
<ins class="diff-chg">Changes
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#open-issues">
<bdi class="secno">
C.
<del class="diff-old">Acknowledgments
</del>
</bdi>
<ins class="diff-chg">Open
issues
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#idl-index">
<bdi class="secno">
D.
<del class="diff-old">References
</del>
</bdi>
<ins class="diff-chg">Full
Web
IDL
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#acknowledgements">
<del class="diff-old">D.1
Normative
references
</del>
<bdi class="secno">
<ins class="diff-chg">E.
</ins></bdi><ins class="diff-chg">
Acknowledgements
</ins>
</a>
</li>
<li class="tocline">
<a class="tocxref" href= "#references">
<del class="diff-old">D.2
Informative
</del>
<bdi class="secno">
<ins class="diff-chg">F.
</ins></bdi><ins class="diff-chg">
References
</ins></a><ol class="toc"><li class="tocline"><a class="tocxref" href= "#normative-references"><bdi class="secno"><ins class="diff-chg">
F.1
</ins></bdi><ins class="diff-chg">
Normative
</ins>
references
</a>
</li>
</ol>
</li>
</ol>
</nav>
<section id="introduction">
<h2 id="x1-introduction">
<bdi class="secno">
1.
</bdi>
Introduction
<a class="self-link" aria-label="§" href= "#introduction">
</a>
</h2>
<p>
WoT
provides
layered
interoperability
based
on
how
<a href= "#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>
s
are
<del class="diff-old">modeled:
as
being
</del>
<ins class="diff-chg">used:
</ins>
"consumed"
and
<del class="diff-old">"exposed".
</del>
<ins class="diff-chg">"exposed",
as
</ins><a href= "https://www.w3.org/TR/2019/CR-wot-architecture-20190516/#terminology"><ins class="diff-chg">
defined
</ins></a><ins class="diff-chg">
in
[
</ins><cite><a class="bibref" href= "#bib-wot-architecture" title="Web of Things Architecture" data-link-type="biblio"><ins class="diff-chg">
WOT-ARCHITECTURE
</ins></a></cite><ins class="diff-chg">
].
</ins>
</p>
<p>
By
<a href="#dfn-consume" class="internalDFN" data-link-type= "dfn">
consuming
a
TD
</a>,
a
client
<a href="#dfn-things" class= "internalDFN" data-link-type="dfn">
Thing
</a>
creates
a
<ins class="diff-new">local
</ins>
runtime
resource
model
that
allows
accessing
the
<a href= "#dfn-properties" class="internalDFN" data-link-type= "dfn">
Properties
</a>,
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Actions
</a>
and
<a href="#dfn-events" class= "internalDFN" data-link-type="dfn">
Events
</a>
exposed
by
the
server
<a href="#dfn-things" class="internalDFN" data-link-type= "dfn">
Thing
</a>
<del class="diff-old">exposed
</del>
on
a
remote
device.
</p>
<div>
<p>
Exposing
a
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>
<del class="diff-old">requires
</del>
<ins class="diff-chg">requires:
</ins></p><ul><li>
defining
a
<a href="#dfn-thing-descriptions" class= "internalDFN" data-link-type="dfn">
Thing
Description
</a>
<del class="diff-old">(TD)
and
</del>
<ins class="diff-chg">(TD),
</ins></li><li><ins class="diff-chg">
then
</ins>
instantiating
a
software
stack
<ins class="diff-new">that
implements
the
</ins><a href="#dfn-wot-interface" class="internalDFN" data-link-type= "dfn"><ins class="diff-new">
WoT
Interface
</ins></a><ins class="diff-new">
specified
by
the
</ins><a href="#dfn-td" class= "internalDFN" data-link-type="dfn"><ins class="diff-new">
TD
</ins></a><ins class="diff-new">
in
order
</ins>
to
serve
requests
for
accessing
the
exposed
<a href="#dfn-properties" class= "internalDFN" data-link-type="dfn">
Properties
</a>,
<a href= "#dfn-actions" class="internalDFN" data-link-type="dfn">
Actions
</a>
and
<a href="#dfn-events" class="internalDFN" data-link-type= "dfn">
Events
<del class="diff-old">.
</del>
</a>,
</li>
<li>
<ins class="diff-chg">then
eventually
publishing
the
</ins><a href= "#dfn-thing-descriptions" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Thing
Description
</ins></a><ins class="diff-chg">
(for
instance
to
a
</ins><a href= "#dfn-thing-directory" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Thing
Directory
</ins></a><ins class="diff-chg">
directory
for
easier
discovery).
</ins></li></ul>
This
specification
describes
how
to
expose
and
consume
<a href= "#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>
s
by
a
script.
<ins class="diff-chg">Also,
it
defines
a
generic
API
for
</ins><a href= "#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
discovery.
</ins></div><div class="note" role="note" id="issue-container-generatedID-1">
<div role="heading" class="note-title marker" id="h-note" aria-level="3">
<span>
Note
</span>
</div>
<p class="">
Typically
scripts
are
meant
to
be
used
on
<del class="diff-old">devices
able
to
provide
resources
(with
a
WoT
Interface
)
for
managing
(installing,
updating,
running)
scripts,
such
as
</del>
bridges
or
gateways
that
expose
and
control
simpler
devices
as
WoT
<a href= "#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>
<del class="diff-old">s.
</del>
<ins class="diff-chg">s
and
have
means
to
handle
(e.g.
install,
uninstall,
update
etc.)
and
run
scripts.
</ins>
</p>
</div>
<div class="note" role="note" id="issue-container-generatedID-2">
<div role="heading" class="note-title marker" id="h-note-0" aria-level="3">
<span>
Note
</span>
</div>
<p class="">
This
specification
does
not
make
assumptions
on
how
the
<a href="#dfn-wot-runtime" class="internalDFN" data-link-type= "dfn">
WoT
Runtime
</a>
handles
and
runs
scripts,
including
single
or
multiple
tenancy,
script
deployment
and
lifecycle
management.
The
API
already
supports
the
generic
mechanisms
that
make
it
possible
to
implement
script
management,
for
instance
by
exposing
a
manager
<a href="#dfn-things" class="internalDFN" data-link-type= "dfn">
Thing
</a>
whose
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Actions
</a>
(action
handlers)
implement
script
lifecycle
management
operations.
</p>
</div>
<del class="diff-old">For
an
introduction
on
how
scripts
could
be
used
in
Web
of
Things
,
check
the
Primer
document.
For
some
background
on
API
design
decisions
check
the
Rationale
document.
</del>
</section>
<section class="informative" id="use-cases">
<h2 id="x2-use-cases">
<bdi class="secno">
2.
</bdi>
Use
Cases
<a class="self-link" aria-label="§" href= "#use-cases">
</a>
</h2>
<p>
<em>
This
section
is
non-normative.
</em>
</p>
<p>
The
following
scripting
use
cases
are
supported
in
this
specification:
</p>
<del class="diff-old">2.1
Discovery
Discover
all
Thing
s
in
the
WoT
network
by
sending
a
broadcast
request.
Discover
Thing
s
running
in
the
local
WoT
Runtime
.
Discover
nearby
Thing
s,
for
instance
connected
by
NFC
or
Bluetooth.
Discover
Thing
s
by
sending
a
discovery
request
to
a
given
registry.
Discover
Thing
s
by
filters
defined
on
Thing
Description
s
Discover
Thing
s
by
semantic
queries.
Stop
or
suppress
an
ongoing
discovery
process.
Optionally
specify
a
timeout
to
the
discovery
process
after
which
it
is
stopped/suppressed.
</del>
<section id="consuming-a-thing">
<h3 id="x2-1-consuming-a-thing">
<del class="diff-old">2.2
</del>
<bdi class="secno">
<ins class="diff-chg">2.1
</ins></bdi>
Consuming
a
Thing
<a class="self-link" aria-label="§" href= "#consuming-a-thing">
</a>
</h3>
<ul>
<li>
<del class="diff-old">Fetch
a
Thing
Description
of
a
Thing
given
its
URL.
</del>
<a href="#dfn-consume" class="internalDFN" data-link-type= "dfn">
Consume
a
TD
<del class="diff-old">of
a
Thing
</del>
</a>,
<del class="diff-old">including
parsing
the
TD
and
generating
the
protocol
bindings
in
order
to
access
lower
level
functionality.
On
</del>
<ins class="diff-chg">i.e.
create
</ins>
a
<del class="diff-old">consumed
</del>
<ins class="diff-chg">programmatic
object
from
a
</ins><a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn">
Thing
<del class="diff-old">,
</del>
<ins class="diff-chg">Description
</ins></a><ins class="diff-chg">
that
exposes
</ins><a href= "#dfn-wot-interactions" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
WoT
Interactions
</ins></a>:
<ul>
<li>
Read
the
value
of
a
<a href="#dfn-properties" class= "internalDFN" data-link-type="dfn">
Property
</a>
or
<ins class="diff-new">a
</ins>
set
of
properties.
</li>
<li>
Set
the
value
of
a
<a href="#dfn-properties" class= "internalDFN" data-link-type="dfn">
Property
</a>
or
a
set
of
properties.
</li>
<li>
Observe
value
changes
of
a
<a href="#dfn-properties" class= "internalDFN" data-link-type="dfn">
Property
</a>.
</li>
<li>
Invoke
an
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
</a>.
</li>
<li>
Observe
<ins class="diff-new">WoT
</ins>
<a href="#dfn-events" class="internalDFN" data-link-type="dfn">
Events
</a>
emitted
by
the
<a href= "#dfn-things" class="internalDFN" data-link-type= "dfn">
Thing
</a>.
</li>
<li>
<del class="diff-old">Observe
changes
to
</del>
<ins class="diff-chg">Introspect
</ins>
the
<a href="#dfn-thing-descriptions" class= "internalDFN" data-link-type="dfn">
Thing
Description
<del class="diff-old">of
the
Thing
.
Get
the
Thing
Description
.
Get
</del>
</a>,
<ins class="diff-chg">including
</ins>
the
list
of
linked
resources
based
on
the
<a href= "#dfn-thing-descriptions" class="internalDFN" data-link-type= "dfn">
Thing
Description
</a>.
</li>
</ul>
</li>
</ul>
</section>
<section id="exposing-a-thing">
<h3 id="x2-2-exposing-a-thing">
<del class="diff-old">2.3
</del>
<bdi class="secno">
<ins class="diff-chg">2.2
</ins></bdi>
Exposing
a
Thing
<a class="self-link" aria-label="§" href= "#exposing-a-thing">
</a>
</h3>
<ul>
<li>
Exposing
the
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>
includes
generating
the
protocol
bindings
in
order
to
access
lower
level
functionality.
</li>
<li>
Create
a
local
<del class="diff-old">ExposedThing
</del>
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Thing
</ins>
</a>
to
be
exposed,
based
on
a
<a href= "#dfn-thing-descriptions" class="internalDFN" data-link-type= "dfn">
Thing
Description
</a>
provided
in
string
serialized
format,
or
out
of
<del class="diff-old">a
template
or
</del>
an
existing
<del class="diff-old">ConsumedThing
</del>
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Thing
</ins>
</a>
object.
</li>
<li>
Add
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
definition
to
the
<a href= "#dfn-things" class="internalDFN" data-link-type= "dfn">
Thing
</a>.
</li>
<li>
<del class="diff-old">Add
an
Action
</del>
<ins class="diff-chg">Remove
a
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins>
</a>
definition
<del class="diff-old">to
</del>
<ins class="diff-chg">from
</ins>
the
<a href= "#dfn-things" class="internalDFN" data-link-type= "dfn">
Thing
</a>.
</li>
<li>
Add
an
<del class="diff-old">Event
</del>
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Action
</ins>
</a>
definition
to
the
<a href= "#dfn-things" class="internalDFN" data-link-type= "dfn">
Thing
</a>.
</li>
<li>
<del class="diff-old">Attach
semantic
information
to
</del>
<ins class="diff-chg">Remove
an
</ins><a href="#dfn-actions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Action
</ins></a><ins class="diff-chg">
definition
from
</ins>
the
<a href= "#dfn-things" class="internalDFN" data-link-type= "dfn">
Thing
</a>.
</li>
<li>
<del class="diff-old">Attach
semantic
information
to
</del>
<ins class="diff-chg">Add
</ins>
a
<del class="diff-old">Property
.
Attach
semantic
information
</del>
<ins class="diff-chg">WoT
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
definition
</ins>
to
<del class="diff-old">an
Action
</del>
<ins class="diff-chg">the
</ins><a href= "#dfn-things" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Thing
</ins>
</a>.
</li>
<li>
<del class="diff-old">Attach
semantic
information
to
an
</del>
<ins class="diff-chg">Remove
a
WoT
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn">
Event
</a>
<ins class="diff-new">definition
from
the
</ins><a href= "#dfn-things" class="internalDFN" data-link-type= "dfn"><ins class="diff-new">
Thing
</ins>
</a>.
</li>
<li>
Emit
<del class="diff-old">an
</del>
<ins class="diff-chg">a
WoT
</ins>
<a href="#dfn-events" class="internalDFN" data-link-type="dfn">
Event
</a>,
i.e.
notify
all
<del class="diff-old">listeners
subscribed
to
that
Event
.
Provide
notifications
for
TD
changes
to
clients
</del>
subscribed
<del class="diff-old">to
that.
Mark/unmark
the
Thing
to
be
discoverable.
Mark/unmark
the
Thing
to
be
consumable.
Start
the
exposed
Thing
in
order
to
process
external
requests.
Stop
the
exposed
Thing
.
</del>
<ins class="diff-chg">listeners.
</ins>
</li>
<li>
Register
<ins class="diff-new">service
</ins>
handlers
for
external
requests:
<ul>
<li>
to
retrieve
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
value;
</li>
<li>
to
update
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
value;
</li>
<li>
to
<del class="diff-old">run
</del>
<ins class="diff-chg">invoke
</ins>
an
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
</a>:
take
the
parameters
from
the
request,
execute
the
defined
action,
and
return
the
result;
</li>
</ul>
</li>
</ul>
</section>
<del class="diff-old">3.
The
WoT
</del>
<section id="discovery">
<h3 id="x2-3-discovery">
<del class="diff-old">object
</del>
<bdi class="secno">
<ins class="diff-chg">2.3
</ins></bdi><ins class="diff-chg">
Discovery
</ins><a class="self-link" aria-label="§" href= "#discovery">
</a>
<del class="diff-old">The
WoT
object
is
the
API
entry
point
and
it
is
exposed
</del>
</h3>
<ul>
<li>
<ins class="diff-chg">Discover
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s
in
a
network
</ins>
by
<del class="diff-old">an
implementation
of
</del>
<ins class="diff-chg">sending
a
broadcast
request.
</ins></li><li><ins class="diff-chg">
Discover
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s
running
in
</ins>
the
<ins class="diff-chg">local
</ins><a href= "#dfn-wot-runtime" class="internalDFN" data-link-type="dfn">
WoT
Runtime
</a>.
<del class="diff-old">The
WoT
object
does
not
expose
properties,
only
methods
</del>
</li>
<li>
<ins class="diff-chg">Discover
nearby
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s,
</ins>
for
<del class="diff-old">discovering,
consuming
and
exposing
a
</del>
<ins class="diff-chg">instance
connected
by
NFC
or
Bluetooth.
</ins></li><li><ins class="diff-chg">
Discover
</ins>
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
<del class="diff-old">.
Note
Browser
implementations
SHOULD
use
</del>
</a>
<ins class="diff-chg">s
by
sending
</ins>
a
<del class="diff-old">namespace
object
such
as
navigator.wot
.
Node.js
</del>
<ins class="diff-chg">discovery
request
to
a
given
registry.
</ins></li><li><ins class="diff-chg">
Discover
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins>
</a>
<del class="diff-old">-like
runtimes
MAY
provide
the
API
object
through
the
require()
</del>
<ins class="diff-chg">s
filtered
by
filters
defined
on
</ins><a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Description
</ins>
</a>
<del class="diff-old">or
import
</del>
<ins class="diff-chg">s
</ins></li><li><ins class="diff-chg">
Discover
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins>
</a>
<del class="diff-old">mechanism.
&lt;span class="idlInterface" id="idl-def-wot"
data-idl="" data-title="WoT"&gt;&lt;span class=
"idlSectionComment"&gt;// [SecureContext]
// [NamespaceObject]
&lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-wot" class="internalDFN"
data-link-type="dfn"&gt; {&lt;span class=
"idlMethod" id="idl-def-wot-discover-filter" data-idl=""
data-title="discover" data-dfn-for="wot"&gt;
  &lt;a data-link-for="" href="#dom-observable" class="internalDFN"
data-link-type=
"dfn"&gt;&lt;a data-no-default=""
data-link-for="wot" data-lt=
"wot.discover()|wot.discover|discover()|discover" href=
"#dom-wot-discover" class="internalDFN" data-link-type=
"dfn"&gt;(&lt;span class=
"idlParam"&gt;optional &lt;a data-link-for=""
href="#dom-thingfilter" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlParamName"&gt;filter&lt;span class="idlMethod"
id="idl-def-wot-fetch-url" data-idl="" data-title="fetch"
data-dfn-for="wot"&gt;
  &lt;a href=
"https://heycam.github.io/webidl/#idl-promise"&gt;Promise&lt;&lt;a data-link-for=""
href="#dom-thingdescription" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlMethName"&gt;&lt;a data-no-default="" data-link-for="wot" data-lt=
"wot.fetch()|wot.fetch|fetch()|fetch" href="#dom-wot-fetch" class=
"internalDFN" data-link-type=
"dfn"&gt;(&lt;span class=
"idlParam"&gt;&lt;a href=
"https://heycam.github.io/webidl/#idl-USVString"&gt;USVString&lt;span class="idlMethod"
id="idl-def-wot-consume-td" data-idl="" data-title="consume"
data-dfn-for="wot"&gt;
  &lt;a data-link-for="" href="#dom-consumedthing" class="internalDFN"
data-link-type=
"dfn"&gt; &lt;span class=
"idlMethName"&gt;&lt;a data-no-default="" data-link-for="wot" data-lt=
"wot.consume()|wot.consume|consume()|consume" href=
"#dom-wot-consume" class="internalDFN" data-link-type=
"dfn"&gt;(&lt;span class=
"idlParam"&gt;&lt;a data-link-for="" href=
"#dom-thingdescription" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlParamName"&gt;td&lt;span class="idlMethod" id=
"idl-def-wot-produce-model" data-idl="" data-title="produce"
data-dfn-for="wot"&gt;
  &lt;a data-link-for="" href="#dom-exposedthing" class="internalDFN"
data-link-type=
"dfn"&gt; &lt;span class=
"idlMethName"&gt;&lt;a data-no-default="" data-link-for="wot" data-lt=
"wot.produce()|wot.produce|produce()|produce" href=
"#produce-method" class="internalDFN" data-link-type=
"dfn"&gt;(&lt;span class=
"idlParam"&gt;&lt;a data-link-for="" href=
"#dom-thingmodel" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlParamName"&gt;model&lt;span class="idlMethod"
id="idl-def-wot-register-directory-thing" data-idl="" data-title=
"register" data-dfn-for="wot"&gt;
  &lt;a href=
"https://heycam.github.io/webidl/#idl-promise"&gt;Promise&lt;a data-no-default=""
data-link-for="wot" data-lt=
"wot.register()|wot.register|register()|register" href=
"#dom-wot-register" class="internalDFN" data-link-type=
"dfn"&gt;(&lt;span class=
"idlParam"&gt;&lt;a href=
"https://heycam.github.io/webidl/#idl-USVString"&gt;USVString &lt;a data-link-for=""
href="#dom-exposedthing" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlParamName"&gt;thing&lt;span class="idlMethod"
id="idl-def-wot-unregister-directory-thing" data-idl="" data-title=
"unregister" data-dfn-for="wot"&gt;
  &lt;a href=
"https://heycam.github.io/webidl/#idl-promise"&gt;Promise&lt;a data-no-default=""
data-link-for="wot" data-lt=
"wot.unregister()|wot.unregister|unregister()|unregister" href=
"#dom-wot-unregister" class="internalDFN" data-link-type=
"dfn"&gt;(&lt;span class=
"idlParam"&gt;&lt;a href=
"https://heycam.github.io/webidl/#idl-USVString"&gt;USVString &lt;a data-link-for=""
href="#dom-exposedthing" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlParamName"&gt;thing
};&lt;span class="idlTypedef" id="idl-def-thingfragment"
data-idl="" data-title="ThingFragment"&gt;
typedef &lt;a href=
"https://heycam.github.io/webidl/#idl-object"&gt;object&lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-thingfragment" class=
"internalDFN" data-link-type=
"dfn"&gt;&lt;span class=
"idlTypedef" id="idl-def-propertyfragment" data-idl="" data-title=
"PropertyFragment"&gt;
typedef &lt;a href=
"https://heycam.github.io/webidl/#idl-object"&gt;object&lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-propertyfragment" class=
"internalDFN" data-link-type=
"dfn"&gt;&lt;span class=
"idlTypedef" id="idl-def-actionfragment" data-idl="" data-title=
"ActionFragment"&gt;
typedef &lt;a href=
"https://heycam.github.io/webidl/#idl-object"&gt;object&lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-actionfragment" class=
"internalDFN" data-link-type=
"dfn"&gt;&lt;span class=
"idlTypedef" id="idl-def-eventfragment" data-idl="" data-title=
"EventFragment"&gt;
typedef &lt;a href=
"https://heycam.github.io/webidl/#idl-object"&gt;object&lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-eventfragment" class=
"internalDFN" data-link-type=
"dfn"&gt;&lt;span class=
"idlTypedef" id="idl-def-dataschema" data-idl="" data-title=
"DataSchema"&gt;
typedef &lt;a href=
"https://heycam.github.io/webidl/#idl-object"&gt;object&lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-dataschema" class=
"internalDFN" data-link-type=
"dfn"&gt;&lt;span class=
"idlTypedef" id="idl-def-securityscheme" data-idl="" data-title=
"SecurityScheme"&gt;
typedef &lt;a href=
"https://heycam.github.io/webidl/#idl-object"&gt;object&lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-securityscheme" class=
"internalDFN" data-link-type=
"dfn"&gt;&lt;span class=
"idlTypedef" id="idl-def-link" data-idl="" data-title="Link"&gt;
typedef &lt;a href=
"https://heycam.github.io/webidl/#idl-object"&gt;object&lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-link" class="internalDFN"
data-link-type=
"dfn"&gt;&lt;span class="idlTypedef"
id="idl-def-form" data-idl="" data-title="Form"&gt;
typedef &lt;a href=
"https://heycam.github.io/webidl/#idl-object"&gt;object&lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-form" class="internalDFN"
data-link-type=
"dfn"&gt;&lt;span class="idlTypedef"
id="idl-def-thingdescription" data-idl="" data-title=
"ThingDescription"&gt;
typedef &lt;a href=
"https://heycam.github.io/webidl/#idl-USVString"&gt;USVString&lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-thingdescription" class=
"internalDFN" data-link-type=
"dfn"&gt;&lt;span class=
"idlTypedef" id="idl-def-thingmodel" data-idl="" data-title=
"ThingModel"&gt;
typedef (&lt;a data-link-for="" href=
"#dom-thingfragment" class="internalDFN" data-link-type=
"dfn"&gt; or &lt;a data-link-for="" href=
"#dom-thingdescription" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlTypedefID"&gt;&lt;a data-no-default="" data-link-for="" data-lt=""
href="#dom-thingmodel" class="internalDFN" data-link-type=
"dfn"&gt;
</del>
<ins class="diff-chg">s
filtered
by
semantic
queries.
</ins></li><li><ins class="diff-chg">
Stop
or
suppress
an
ongoing
discovery
process.
</ins></li><li><ins class="diff-chg">
Optionally
specify
a
timeout
to
the
discovery
process
after
which
it
is
stopped/suppressed.
</ins></li></ul></section></section><section id="conformance"><h2 id="x3-conformance">
<del class="diff-old">ThingModel
</del>
<bdi class="secno">
<ins class="diff-chg">3.
</ins></bdi><ins class="diff-chg">
Conformance
</ins><a class="self-link" aria-label="§" href= "#conformance">
</a>
<del class="diff-old">;
</del>
</h2>
<p>
<ins class="diff-chg">As
well
as
sections
marked
as
non-normative,
all
authoring
guidelines,
diagrams,
examples,
and
notes
in
this
specification
are
non-normative.
Everything
else
in
this
specification
is
normative.
</ins></p><p><ins class="diff-chg">
The
key
words
</ins><em class="rfc2119"><ins class="diff-chg">
MAY
</ins></em>,<em class= "rfc2119"><ins class="diff-chg">
MUST
</ins></em>,<ins class="diff-chg">
and
</ins><em class="rfc2119"><ins class="diff-chg">
SHOULD
</ins></em><ins class="diff-chg">
in
this
document
are
to
be
interpreted
as
described
in
</ins><a href= "https://tools.ietf.org/html/bcp14"><ins class="diff-chg">
BCP
14
</ins></a><ins class="diff-chg">
[
</ins><cite>
<a class= "bibref" href="#bib-rfc2119" title= "Key words for use in RFCs to Indicate Requirement Levels" data-link-type="biblio">
<ins class="diff-chg">RFC2119
</ins></a>
</cite>
<ins class="diff-chg">]
[
</ins><cite>
<del class="diff-old">Editor's
note
</del>
<a class= "bibref" href="#bib-rfc8174" title= "Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words" data-link-type="biblio">
<ins class="diff-chg">RFC8174
</ins></a>
<del class="diff-old">The
algorithms
for
the
WoT
methods
will
be
specified
later,
including
error
handling
</del>
</cite>
<ins class="diff-chg">]
when,
</ins>
and
<del class="diff-old">security
considerations.
</del>
<ins class="diff-chg">only
when,
they
appear
in
all
capitals,
as
shown
here.
</ins>
</p>
<p>
<del class="diff-old">The
ThingModel
</del>
<ins class="diff-chg">This
specification
describes
the
conformance
criteria
for
the
following
classes
of
</ins><dfn data-dfn-type="dfn" id= "dfn-user-agent"><ins class="diff-chg">
user
agent
</ins>
</dfn>
<del class="diff-old">type
represents
either
</del>
<ins class="diff-chg">(
</ins><dfn data-dfn-type="dfn" id= "dfn-ua"><ins class="diff-chg">
UA
</ins></dfn><ins class="diff-chg">
).
</ins></p><p><ins class="diff-chg">
Due
to
requirements
of
small
embedded
implementations,
splitting
WoT
client
and
server
interfaces
was
needed.
Then,
discovery
is
</ins>
a
<del class="diff-old">ThingFragment
,
or
</del>
<ins class="diff-chg">distributed
application,
but
typical
scenarios
have
been
covered
by
</ins>
a
<ins class="diff-chg">generic
discovery
API
in
this
specification.
This
resulted
in
using
3
conformance
classes
for
a
</ins><a href="#dfn-ua" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
UA
</ins></a><ins class="diff-chg">
that
implements
this
API,
one
for
client,
one
for
server,
and
one
for
discovery.
An
application
that
uses
this
API
can
introspect
for
the
presence
of
the
</ins>
<code>
<del class="diff-old">ThingDescription
</del>
<ins class="diff-chg">consume()
</ins></code>,<code><ins class="diff-chg">
produce()
</ins>
</code>
<del class="diff-old">.
3.1
The
</del>
<ins class="diff-chg">and
</ins>
<code>
discover()
</code>
<ins class="diff-new">methods
on
the
</ins><a href= "#dfn-wot-api-object" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
WoT
API
object
</ins></a><ins class="diff-new">
in
order
to
determine
which
conformance
class
the
</ins><a href="#dfn-ua" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
UA
</ins></a><ins class="diff-new">
implements.
</ins></p><dl><dt>
<dfn data-dfn-type="dfn" id="dfn-wot-consumer">
<ins class="diff-new">WoT
Consumer
</ins>
</dfn>
<del class="diff-old">method
</del>
<a href="#dfn-ua" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">UA
</ins>
</a>
</dt>
<dd>
<p>
<del class="diff-old">Starts
the
discovery
process
that
will
provide
ThingDescription
s
that
match
the
optional
argument
filter
</del>
<ins class="diff-chg">Implementations
</ins>
of
<del class="diff-old">type
</del>
<ins class="diff-chg">this
conformance
class
</ins><em class="rfc2119" title="MUST"><ins class="diff-chg">
MUST
</ins></em><ins class="diff-chg">
implement
the
</ins>
<code>
<a href= "#dom-consumedthing" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">ThingFilter
</del>
<ins class="diff-chg">ConsumedThing
</ins>
</code>
</a>
<del class="diff-old">.
Returns
an
[
Observable
</del>
</code>
<del class="diff-old">](https://github.com/tc39/proposal-observable)
object
that
can
be
subscribed
to
</del>
<ins class="diff-chg">interface
</ins>
and
<del class="diff-old">unsubscribed
from.
The
handler
function
provided
to
</del>
the
<del class="diff-old">Observable
during
subscription
will
receive
an
argument
of
type
USVString
representing
a
</del>
<code>
<del class="diff-old">ThingDescription
</del>
<ins class="diff-chg">consume()
</ins>
</code>
<ins class="diff-chg">method
on
the
</ins><a href="#dfn-wot-api-object" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
WoT
API
object
</ins>
</a>.
</p>
<del class="diff-old">3.1.1
The
DiscoveryMethod
</del>
</dd>
<dt>
<dfn data-dfn-type="dfn" id="dfn-wot-producer">
<ins class="diff-new">WoT
Producer
</ins>
</dfn>
<del class="diff-old">enumeration
</del>
<a href="#dfn-ua" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">UA
</ins>
</a>
<del class="diff-old">&lt;span class="idlTypedef" id=
"idl-def-discoverymethod" data-idl="" data-title=
"DiscoveryMethod"&gt;typedef &lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString&lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-discoverymethod" class=
"internalDFN" data-link-type=
"dfn"&gt;
</del>
</dt>
<dd>
<p>
<ins class="diff-chg">Implementations
of
this
conformance
class
</ins><em class="rfc2119" title="MUST"><ins class="diff-chg">
MUST
</ins></em><ins class="diff-chg">
implement
</ins><code><a href="#dom-exposedthing" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">DiscoveryMethod
</del>
<ins class="diff-chg">ExposedThing
</ins>
</code>
</a>
<del class="diff-old">;
</del>
</code>
<ins class="diff-chg">interface
and
the
</ins><code><ins class="diff-chg">
produce()
</ins></code><ins class="diff-chg">
method
on
the
</ins><a href="#dfn-wot-api-object" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
WoT
API
object
</ins></a>.</p></dd><dt>
<dfn data-dfn-type="dfn" id="dfn-wot-discovery">
<ins class="diff-chg">WoT
Discovery
</ins></dfn><a href="#dfn-ua" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
UA
</ins></a>
</dt>
<dd>
<p>
<ins class="diff-new">Implementations
of
this
conformance
class
</ins><em class="rfc2119" title="MUST"><ins class="diff-new">
MUST
</ins></em><ins class="diff-new">
implement
the
</ins><code>
<a href= "#dom-thingdiscovery" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">DiscoveryMethod
</del>
<ins class="diff-chg">ThingDiscovery
</ins>
</code>
</a>
<del class="diff-old">represents
</del>
</code>
<ins class="diff-chg">interface
and
</ins>
the
<del class="diff-old">discovery
type
to
</del>
<code>
<ins class="diff-chg">discover()
</ins></code><ins class="diff-chg">
method
on
the
</ins><a href="#dfn-wot-api-object" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
WoT
API
object
</ins></a>.</p></dd></dl><p><ins class="diff-chg">
These
conformance
classes
</ins><em class="rfc2119" title= "MAY"><ins class="diff-chg">
MAY
</ins></em>
be
<del class="diff-old">used:
</del>
<ins class="diff-chg">implemented
in
a
single
</ins><a href="#dfn-ua" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
UA
</ins></a>.
</p>
<p>
<ins class="diff-chg">This
specification
can
be
used
for
implementing
the
WoT
Scripting
API
in
multiple
programming
languages.
The
interface
definitions
are
specified
in
[
</ins><cite>
<del class="diff-old">"any"
does
not
provide
any
restriction
</del>
<a class="bibref" href= "#bib-webidl" title="Web IDL" data-link-type= "biblio">
<ins class="diff-chg">WEBIDL
</ins></a>
<del class="diff-old">"local"
for
discovering
Thing
</del>
</cite>
<ins class="diff-chg">].
</ins></p><p><ins class="diff-chg">
The
</ins><a href="#dfn-ua" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
UA
</ins>
</a>
<del class="diff-old">s
defined
</del>
<ins class="diff-chg">may
be
implemented
</ins>
in
the
<del class="diff-old">same
device
</del>
<ins class="diff-chg">browser,
</ins>
or
<del class="diff-old">connected
to
the
device
by
wired
</del>
<ins class="diff-chg">in
a
separate
runtime
environment,
such
as
</ins><a href= "https://nodejs.org/en/"><ins class="diff-chg">
Node.js
</ins></a>
or
<del class="diff-old">wireless
means.
"directory"
for
discovery
based
on
</del>
<ins class="diff-chg">in
small
embedded
runtimes.
</ins></p><p><ins class="diff-chg">
Implementations
that
use
ECMAScript
executed
in
</ins>
a
<del class="diff-old">service
provided
by
</del>
<ins class="diff-chg">browser
to
implement
the
APIs
defined
in
this
document
</ins><em class="rfc2119" title="MUST"><ins class="diff-chg">
MUST
</ins></em><ins class="diff-chg">
implement
them
in
</ins>
a
<del class="diff-old">Thing
Directory
.
</del>
<ins class="diff-chg">manner
consistent
with
the
ECMAScript
Bindings
defined
in
the
Web
IDL
specification
[
</ins><cite>
<del class="diff-old">"multicast"
for
discovering
Thing
</del>
<a class="bibref" href="#bib-webidl" title="Web IDL" data-link-type="biblio">
<ins class="diff-chg">WEBIDL
</ins>
</a>
<del class="diff-old">s
</del>
</cite>
<ins class="diff-chg">].
</ins></p><p><ins class="diff-chg">
Implementations
that
use
TypeScript
or
ECMAScript
</ins>
in
<ins class="diff-new">a
runtime
to
implement
</ins>
the
<del class="diff-old">device's
network
by
using
</del>
<ins class="diff-chg">APIs
defined
in
this
document
</ins><em class="rfc2119" title="MUST"><ins class="diff-chg">
MUST
</ins></em><ins class="diff-chg">
implement
them
in
</ins>
a
<del class="diff-old">supported
multicast
protocol.
</del>
<ins class="diff-chg">manner
consistent
with
the
TypeScript
Bindings
defined
in
the
TypeScript
specification
[
</ins><cite><a class="bibref" href="#bib-typescript" title= "TypeScript Language Specification" data-link-type= "biblio"><ins class="diff-chg">
TYPESCRIPT
</ins></a></cite><ins class="diff-chg">
].
</ins></p>
</section>
<section id="the-thingdescription-type">
<h2 id="x4-the-thingdescription-type">
<del class="diff-old">3.1.2
</del>
<bdi class="secno">
<ins class="diff-chg">4.
</ins></bdi>
The
<dfn data-dfn-type="typedef" data-export="" id= "dom-thingdescription" data-idl="typedef" data-title= "ThingDescription">
<code>
<del class="diff-old">ThingFilter
</del>
<ins class="diff-chg">ThingDescription
</ins>
</code>
</dfn>
<del class="diff-old">dictionary
</del>
<ins class="diff-chg">type
</ins><a class="self-link" aria-label="§" href= "#the-thingdescription-type">
</a>
<del class="diff-old">The
</del>
</h2>
<pre class="idl def"><span data-idl="" class="idlTypedef" id=
<ins class="diff-chg">"idl-def-thingdescription" data-title=
"ThingDescription">typedef<span class="idlType"> <a data-xref-type=
"interface" data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-object">object</a></span> <a class="internalDFN idlID"
data-link-for="" data-link-type="typedef" href=
"#dom-thingdescription">
</ins>
<code>
<del class="diff-old">ThingFilter
</del>
<ins class="diff-chg">ThingDescription
</ins>
</code>
</a>
<del class="diff-old">dictionary
that
represents
the
constraints
for
discovering
Thing
s
as
key-value
pairs.
&lt;span class="idlDictionary" id=
"idl-def-thingfilter" data-idl="" data-title=
"ThingFilter"&gt;dictionary &lt;span class=
"idlDictionaryID"&gt;&lt;a data-no-default="" data-link-for="" data-lt=""
href="#dom-thingfilter" class="internalDFN" data-link-type=
"dfn"&gt; {&lt;span class="idlMember"
id="idl-def-thingfilter-method" data-idl="" data-title="method"
data-dfn-for="thingfilter"&gt;
  (&lt;a data-link-for="" href="#dom-discoverymethod" class=
"internalDFN" data-link-type=
"dfn"&gt; or &lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString&lt;a data-no-default=""
data-link-for="thingfilter" data-lt="" href=
"#dom-thingfilter-method" class="internalDFN" data-link-type=
"dfn"&gt; = &lt;span class=
"idlMemberValue"&gt;"any"&lt;span class="idlMember" id=
"idl-def-thingfilter-url" data-idl="" data-title="url"
data-dfn-for="thingfilter"&gt;
  &lt;a href=
"https://heycam.github.io/webidl/#idl-USVString"&gt;USVString&lt;a data-no-default=""
data-link-for="thingfilter" data-lt="" href="#dom-thingfilter-url"
class="internalDFN" data-link-type=
"dfn"&gt;&lt;span class="idlMember"
id="idl-def-thingfilter-query" data-idl="" data-title="query"
data-dfn-for="thingfilter"&gt;
  &lt;a href=
"https://heycam.github.io/webidl/#idl-USVString"&gt;USVString&lt;a data-no-default=""
data-link-for="thingfilter" data-lt="" href=
"#dom-thingfilter-query" class="internalDFN" data-link-type=
"dfn"&gt;&lt;span class="idlMember"
id="idl-def-thingfilter-fragment" data-idl="" data-title="fragment"
data-dfn-for="thingfilter"&gt;
  &lt;a data-link-for="" href="#dom-thingfragment" class="internalDFN"
data-link-type=
"dfn"&gt; &lt;span class=
"idlMemberName"&gt;&lt;a data-no-default="" data-link-for="thingfilter"
data-lt="" href="#dom-thingfilter-fragment" class="internalDFN"
data-link-type="dfn"&gt;
};
</del>
<ins class="diff-chg">;
</ins>
</span>
</pre>
<p>
<del class="diff-old">The
method
property
represents
the
discovery
type
that
should
be
used
in
the
discovery
process.
The
possible
values
are
</del>
<ins class="diff-chg">Represents
a
</ins><a href="#dfn-thing-descriptions" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Description
</ins></a><ins class="diff-chg">
(
</ins><a href= "#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
TD
</ins></a><ins class="diff-chg">
)
as
</ins>
defined
<del class="diff-old">by
the
DiscoveryMethod
</del>
<ins class="diff-chg">in
[
</ins><cite>
<a class="bibref" href="#bib-wot-td" title= "WoT Thing Description " data-link-type= "biblio">
<ins class="diff-new">WOT-TD
</ins>
</a>
<del class="diff-old">enumeration
that
MAY
</del>
</cite>
<ins class="diff-chg">].
It
is
expected
to
</ins>
be
<del class="diff-old">extended
by
string
values
defined
by
solutions
(with
no
guarantee
of
interoperability).
The
url
property
represents
additional
information
for
the
discovery
method,
such
as
the
URL
of
the
target
entity
serving
the
discovery
request,
for
instance
</del>
a
<del class="diff-old">Thing
Directory
</del>
<a href= "https://infra.spec.whatwg.org/#parse-json-from-bytes">
<ins class="diff-chg">parsed
JSON
object
</ins>
</a>
<del class="diff-old">(if
method
</del>
<ins class="diff-chg">that
</ins>
is
<del class="diff-old">"directory"
)
or
</del>
<ins class="diff-chg">validated
using
</ins><a href= "https://www.w3.org/TR/2019/CR-wot-thing-description-20190516/#json-schema-for-validation"><ins class="diff-chg">
JSON
schema
validation
</ins></a>.</p><section id="fetching-a-thing-description"><h3 id="x4-1-fetching-a-thing-description"><bdi class= "secno"><ins class="diff-chg">
4.1
</ins></bdi><ins class="diff-chg">
Fetching
</ins>
a
Thing
<del class="diff-old">(otherwise).
The
</del>
<ins class="diff-chg">Description
</ins><a class="self-link" aria-label="§" href="#fetching-a-thing-description">
<del class="diff-old">query
</del>
</a>
<del class="diff-old">property
represents
</del>
</h3>
<p>
<ins class="diff-chg">Fetching
</ins>
a
<del class="diff-old">query
string
accepted
by
the
implementation,
for
instance
</del>
<a href="#dfn-td" class="internalDFN" data-link-type= "dfn">
<ins class="diff-chg">TD
</ins></a><ins class="diff-chg">
given
</ins>
a
<del class="diff-old">SPARQL
or
JSON
query.
Support
may
</del>
<ins class="diff-chg">URL
should
</ins>
be
<del class="diff-old">implemented
locally
in
</del>
<ins class="diff-chg">done
with
an
external
method,
such
as
</ins>
the
<del class="diff-old">WoT
Runtime
</del>
<a href= "https://fetch.spec.whatwg.org/#fetch-api">
<ins class="diff-chg">Fetch
API
</ins>
</a>
or
<del class="diff-old">remotely
as
</del>
a
<del class="diff-old">service
in
</del>
<ins class="diff-chg">HTTP
client
library,
which
offer
already
standardized
options
on
specifying
fetch
details.
</ins></p><div class="example" id="example-1-fetching-a-thing-description"><div class="marker"><a class="self-link" href= "#example-1-fetching-a-thing-description"><ins class="diff-chg">
Example
</ins><bdi><ins class="diff-chg">
1
</ins></bdi></a><span class="example-title">:<ins class="diff-chg">
Fetching
</ins>
a
Thing
<del class="diff-old">Directory
.
The
</del>
<ins class="diff-chg">Description
</ins></span>
<del class="diff-old">fragment
</del>
</div>
<pre aria-busy="false"><code class="hljs javascript"><span class=
<ins class="diff-chg">"hljs-keyword">try</span> {
</ins>  <span class="hljs-keyword">let</span> res = <span class=<ins class="diff-chg">
"hljs-keyword">await</span> fetch(<span class=
"hljs-string">'https://tds.mythings.biz/sensor11'</span>);
</ins>  <span class=<ins class="diff-chg">
"hljs-comment">// ... additional checks possible on res.headers</span>
</ins>  <span class="hljs-keyword">let</span> td = <span class=<ins class="diff-chg">
"hljs-keyword">await</span> res.json();
</ins>  <span class="hljs-keyword">let</span> thing = <span class=<ins class="diff-chg">
"hljs-keyword">new</span> ConsumedThing(td);
</ins>  <span class="hljs-built_in">console</span>.log(<span class=<ins class="diff-chg">
"hljs-string">"Thing name: "</span> + thing.getThingDescription().title);
} <span class="hljs-keyword">catch</span> (err) {
</ins>  <span class="hljs-built_in">console</span>.log(<span class=<ins class="diff-chg">
"hljs-string">"Fetching TD failed"</span>, err.message);
}
</ins>
</code>
<del class="diff-old">property
represents
</del>
</pre>
</div>
</section>
<section id="expanding-a-thing-description">
<h3 id="x4-2-expanding-a-thing-description">
<bdi class= "secno">
<ins class="diff-chg">4.2
</ins></bdi><ins class="diff-chg">
Expanding
</ins>
a
<ins class="diff-chg">Thing
Description
</ins><a class="self-link" aria-label="§" href="#expanding-a-thing-description">
<del class="diff-old">ThingFragment
</del>
</a>
</h3>
<p>
<ins class="diff-new">Note
that
[
</ins><cite><a class="bibref" href="#bib-wot-td" title= "WoT Thing Description " data-link-type="biblio"><ins class="diff-new">
WOT-TD
</ins>
</a>
<del class="diff-old">dictionary
used
for
matching
property
by
property
against
discovered
</del>
</cite>
<ins class="diff-chg">]
allows
using
a
shortened
</ins><a href="#dfn-thing-descriptions" class= "internalDFN" data-link-type="dfn">
Thing
<ins class="diff-new">Description
</ins>
</a>
<del class="diff-old">s.
</del>
<ins class="diff-chg">by
the
means
of
</ins><a href= "https://www.w3.org/TR/2019/CR-wot-thing-description-20190516/#sec-default-values"><ins class="diff-chg">
defaults
</ins></a><ins class="diff-chg">
and
requiring
clients
to
expand
them
with
default
values
specified
in
[
</ins><cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type= "biblio"><ins class="diff-chg">
WOT-TD
</ins></a></cite><ins class="diff-chg">
]
for
the
properties
that
are
not
explicitly
defined
in
a
given
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
TD
</ins></a>.
</p>
<div>
<p>
<del class="diff-old">The
discover(filter)
method
MUST
</del>
<ins class="diff-chg">To
</ins><dfn data-dfn-type="dfn" id="dfn-expand-a-td"><ins class="diff-chg">
expand
a
TD
</ins></dfn><ins class="diff-chg">
given
</ins><var><ins class="diff-chg">
td
</ins></var>,
run
the
following
steps:
</p>
<ol>
<li>
<del class="diff-old">If
invoking
discover()
</del>
<ins class="diff-chg">For
each
item
in
the
</ins><a href= "https://www.w3.org/TR/2019/CR-wot-thing-description-20190516/#sec-default-values"><ins class="diff-chg">
TD
default
values
</ins></a><ins class="diff-chg">
table
from
[
</ins><cite><a class="bibref" href= "#bib-wot-td" title="WoT Thing Description " data-link-type= "biblio"><ins class="diff-chg">
WOT-TD
</ins></a></cite><ins class="diff-chg">
],
if
the
term
</ins>
is
not
<del class="diff-old">allowed
for
</del>
<ins class="diff-chg">defined
in
</ins><a href= "#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
td
</ins></a>,<ins class="diff-chg">
add
</ins>
the
<del class="diff-old">current
scripting
context
for
security
reasons,
throw
SecurityError
and
terminate
these
steps.
</del>
<ins class="diff-chg">term
definition
with
the
default
value
specified
in
[
</ins><cite><a class="bibref" href="#bib-wot-td" title= "WoT Thing Description " data-link-type= "biblio"><ins class="diff-chg">
WOT-TD
</ins></a></cite><ins class="diff-chg">
].
</ins>
</li>
<del class="diff-old">Return
an
</del>
</ol>
</div>
</section>
<section id="validating-a-thing-description">
<h3 id="x4-3-validating-a-thing-description">
<bdi class= "secno">
<ins class="diff-chg">4.3
</ins></bdi><ins class="diff-chg">
Validating
a
Thing
Description
</ins><a class= "self-link" aria-label="§" href= "#validating-a-thing-description">
<del class="diff-old">Observable
</del>
</a>
</h3>
<p>
<ins class="diff-chg">The
[
</ins><cite>
<a class="bibref" href="#bib-wot-td" title= "WoT Thing Description " data-link-type="biblio">
<ins class="diff-new">WOT-TD
</ins>
</a>
<del class="diff-old">obs
and
execute
</del>
</cite>
<ins class="diff-chg">]
specification
defines
how
a
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
TD
</ins></a><ins class="diff-chg">
should
be
validated.
Therefore,
this
API
expects
</ins>
the
<del class="diff-old">next
steps
in
parallel
.
If
</del>
<a href="#dom-thingdescription" class="internalDFN" data-link-type="idl">
<code>
<del class="diff-old">obs.subscribe(handler,
errorHandler,
complete)
</del>
<ins class="diff-chg">ThingDescription
</ins>
</code>
<del class="diff-old">is
called,
execute
</del>
</a>
<ins class="diff-chg">objects
be
validated
before
used
as
parameters.
This
specification
defines
a
basic
</ins><a href="#dfn-td" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
TD
</ins></a><ins class="diff-chg">
validation
as
follows.
</ins></p><div><p><ins class="diff-chg">
To
</ins><dfn data-dfn-type="dfn" id="dfn-validate-a-td"><ins class="diff-chg">
validate
a
TD
</ins></dfn><ins class="diff-chg">
given
</ins><var><ins class="diff-chg">
td
</ins></var>,<ins class="diff-chg">
run
</ins>
the
following
<del class="diff-old">sub-steps:
</del>
<ins class="diff-chg">steps:
</ins></p>
<ol>
<li>
If
<del class="diff-old">the
first
argument
</del>
<var>
<del class="diff-old">handler
</del>
<ins class="diff-chg">td
</ins>
</var>
is
not
<del class="diff-old">defined
or
it
is
not
a
function,
</del>
<ins class="diff-chg">an
object,
</ins>
throw
<code>
<del class="diff-old">TypeError
</del>
<ins class="diff-chg">"TypeError"
</ins>
</code>
and
terminate
<del class="diff-old">the
algorithm.
Otherwise
configure
handler
to
be
invoked
when
a
discovery
hit
happens.
</del>
<ins class="diff-chg">these
steps.
</ins>
</li>
<li>
If
<ins class="diff-new">any
of
</ins>
the
<del class="diff-old">second
argument
</del>
<ins class="diff-chg">mandatory
properties
defined
in
[
</ins><cite><a class= "bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio"><ins class="diff-chg">
WOT-TD
</ins></a></cite><ins class="diff-chg">
]
for
</ins><a href= "https://www.w3.org/TR/2019/CR-wot-thing-description-20190516/#thing"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
that
don't
have
</ins><a href= "https://www.w3.org/TR/2019/CR-wot-thing-description-20190516/#sec-default-values"><ins class="diff-chg">
default
definitions
</ins></a><ins class="diff-chg">
are
missing
from
</ins>
<var>
<del class="diff-old">errorHandler
is
defined,
but
it
is
not
a
function,
</del>
<ins class="diff-chg">td
</ins></var>,
throw
<code>
<del class="diff-old">TypeError
</del>
<ins class="diff-chg">"TypeError"
</ins>
</code>
and
terminate
these
steps.
<del class="diff-old">Otherwise
if
defined,
save
it
to
be
invoked
in
error
conditions.
</del>
</li>
<li>
If
<del class="diff-old">the
third
argument
</del>
<a href= "https://www.w3.org/TR/2019/CR-wot-thing-description-20190516/#json-schema-for-validation">
<ins class="diff-chg">JSON
schema
validation
</ins></a><ins class="diff-chg">
fails
on
</ins>
<var>
<del class="diff-old">onComplete
is
defined,
but
it
is
not
a
function,
</del>
<ins class="diff-chg">td
</ins></var>,
throw
<code>
<del class="diff-old">TypeError
</del>
<ins class="diff-chg">"TypeError"
</ins>
</code>
and
terminate
these
steps.
<del class="diff-old">Otherwise
if
defined,
save
it
to
be
invoked
when
the
discovery
process
finished
for
other
reasons
than
having
been
canceled.
</del>
</li>
<del class="diff-old">If
filter.query
is
defined,
pass
it
as
an
opaque
string
to
the
underlying
implementation
to
be
matched
against
discovered
items.
</del>
</ol>
</div>
</section>
</section>
<section data-dfn-for="WOT" id="the-wot-api-object">
<h2 id="x5-the-wot-api-object">
<bdi class="secno">
<ins class="diff-chg">5.
</ins></bdi>
The
<del class="diff-old">underlying
implementation
is
responsible
to
parse
it
e.g.
as
a
SPARQL
or
JSON
query
and
match
it
against
the
Thing
Description
</del>
<dfn data-dfn-type="dfn" id="dfn-wot-api-object">
<ins class="diff-chg">WoT
API
object
</ins></dfn><a class="self-link" aria-label="§" href= "#the-wot-api-object">
</a>
<del class="diff-old">s
found
during
</del>
</h2>
<p>
<ins class="diff-chg">Defines
</ins>
the
<del class="diff-old">discovery
process.
If
queries
are
not
supported,
implementations
SHOULD
throw
</del>
<ins class="diff-chg">API
entry
point
exposed
as
</ins>
a
<del class="diff-old">NotSupported
error
and
terminate
these
steps.
If
filter.fragment
is
defined,
</del>
<ins class="diff-chg">singleton
</ins>
and
<del class="diff-old">if
it
</del>
contains
<del class="diff-old">other
properties
than
</del>
the
<del class="diff-old">ones
defined
in
</del>
<ins class="diff-chg">API
methods.
</ins></p><section id="the-wot-interface"><h3 id="x5-1-the-wot-interface"><bdi class="secno"><ins class="diff-chg">
5.1
</ins></bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="interface" data-export="" id="dom-wot" data-idl="interface" data-title="WOT">
<code>
<del class="diff-old">ThingFragment
</del>
<ins class="diff-chg">WOT
</ins>
</code>
<del class="diff-old">,
throw
</del>
</dfn>
<ins class="diff-chg">interface
</ins><a class="self-link" aria-label="§" href= "#the-wot-interface"></a></h3><pre class="idl def"><span data-idl="" class="idlInterface" id=<ins class="diff-chg">
"idl-def-wot" data-title="WOT">[<span class=
"extAttr"><a data-xref-type="extended-attribute" data-cite-path=""
data-type="extended-attribute" href=
"https://heycam.github.io/webidl/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-xref-type="extended-attribute"
data-cite-path="" data-type="extended-attribute" href=
"https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<a data-xref-type="interface"
data-cite-path="window-object.html" data-type="interface" href=
"https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>,<a data-xref-type="interface"
data-lt="WorkerGlobalScope" data-cite-path="workers.html"
data-type="interface" href=
"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">Worker</a>)</span>]
interface <a class="internalDFN idlID" data-link-for=""
data-link-type="interface" href=
"#dom-wot"><code>WOT</code></a> {<span class="idlSectionComment">
  // methods defined in UA conformance classes
</ins></span><ins class="diff-chg">
};
</ins></span></pre><div class="note" role="note" id="issue-container-generatedID-3"><div role="heading" class="note-title marker" id="h-note-1" aria-level="4"><span><ins class="diff-chg">
Note
</ins></span></div><p class=""><ins class="diff-chg">
Browser
implementations
should
use
a
namespace
object
such
as
</ins>
<code>
<del class="diff-old">TypeError
and
terminate
these
steps.
Otherwise
save
</del>
<ins class="diff-chg">navigator.wot
</ins></code>.<ins class="diff-chg">
Standalone
runtimes
may
expose
</ins>
the
<ins class="diff-new">API
</ins>
object
<del class="diff-old">for
matching
the
discovered
items
against
it.
Request
the
underlying
platform
to
start
the
discovery
process,
with
the
following
parameters:
If
filter.method
is
not
defined
</del>
<ins class="diff-chg">through
mechanisms
like
</ins><a href= "https://nodejs.org/api/modules.html"><ins class="diff-chg">
require()
</ins></a>
or
<del class="diff-old">the
value
is
</del>
<a href= "http://www.ecma-international.org/ecma-262/6.0/#sec-imports">
<ins class="diff-chg">import
</ins></a>.</p></div></section><section id="the-consume-method"><h3 id="x5-2-the-consume-method"><bdi class="secno"><ins class="diff-chg">
5.2
</ins></bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="method" data-export="" id="dom-wot-consume" data-idl="operation" data-title="consume()" data-dfn-for="WOT" data-type="Promise" data-lt= "WOT.consume()|WOT.consume|consume()|consume">
<code>
<del class="diff-old">"any"
,
use
the
widest
discovery
</del>
<ins class="diff-chg">consume()
</ins></code></dfn>
method
<del class="diff-old">supported
by
</del>
<a class="self-link" aria-label="§" href= "#the-consume-method">
</a>
</h3>
<pre class="idl def"><span data-idl="" class="idlInterface" id=
<ins class="diff-chg">"idl-def-wot-partial-1" data-title=
"WOT">partial interface <a class="internalDFN idlID" data-link-for=
"" data-link-type="interface" href=
"#dom-wot"><code>WOT</code></a> {<span data-idl="" class=
"idlMethod" id="idl-def-wot-consume-td" data-title="consume"
data-dfn-for="WOT"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
href="#dom-consumedthing" class="internalDFN" data-link-type=
"idl"><code>ConsumedThing</code></a>&gt;</span> <a class=
"internalDFN idlName" data-link-for="WOT" data-link-type="method"
href="#dom-wot-consume"><code>consume</code></a>(<span class=
"idlType"><a data-xref-type="_IDL_" href="#dom-thingdescription"
class="internalDFN" data-link-type=
"idl"><code>ThingDescription</code></a></span> <span class=
"idlParamName">td</span>);</span>
};
</ins></span></pre><div><p><ins class="diff-chg">
Belongs
to
</ins>
the
<del class="diff-old">underlying
platform.
Otherwise
if
</del>
<a href="#dfn-wot-consumer" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">WoT
Consumer
</ins></a><ins class="diff-chg">
conformance
class.
Expects
an
</ins>
<var>
<del class="diff-old">filter.method
</del>
<ins class="diff-chg">td
</ins>
</var>
<del class="diff-old">is
"local"
,
use
the
local
Thing
Directory
</del>
<ins class="diff-chg">argument
and
returns
a
</ins><a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects"><ins class="diff-chg">
Promise
</ins>
</a>
<del class="diff-old">for
discovery.
Usually
</del>
that
<del class="diff-old">defines
Thing
s
deployed
in
the
same
device,
or
connected
to
the
device
in
slave
mode
(e.g.
sensors
connected
via
Bluetooth
or
</del>
<ins class="diff-chg">resolves
with
</ins>
a
<del class="diff-old">serial
connection).
Otherwise
if
filter.method
is
</del>
<a href="#dom-consumedthing" class= "internalDFN" data-link-type="idl">
<code>
<del class="diff-old">"directory"
,
use
the
remote
Thing
Directory
</del>
<ins class="diff-chg">ConsumedThing
</ins></code>
</a>
<del class="diff-old">specified
in
filter.url
.
Otherwise
if
filter.method
is
"multicast"
,
use
all
the
multicast
discovery
protocols
supported
by
the
underlying
platform.
Whenever
</del>
<ins class="diff-chg">object
that
represents
</ins>
a
<del class="diff-old">new
item
td
is
discovered
by
</del>
<ins class="diff-chg">client
interface
to
operate
with
</ins>
the
<del class="diff-old">underlying
platform,
</del>
<a href="#dfn-things" class="internalDFN" data-link-type= "dfn">
<ins class="diff-chg">Thing
</ins></a>.<ins class="diff-chg">
The
method
</ins><em class="rfc2119" title= "MUST"><ins class="diff-chg">
MUST
</ins></em>
run
the
following
<del class="diff-old">sub-steps:
</del>
<ins class="diff-chg">steps:
</ins></p>
<ol>
<li>
<del class="diff-old">If
filter.query
is
defined,
check
if
td
is
</del>
<ins class="diff-chg">Return
</ins>
a
<del class="diff-old">match
for
the
query.
The
matching
algorithm
is
encapsulated
by
implementations.
If
that
returns
false
,
discard
</del>
<a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects">
<ins class="diff-chg">Promise
</ins></a>
<var>
<del class="diff-old">td
</del>
<ins class="diff-chg">promise
</ins>
</var>
and
<del class="diff-old">continue
</del>
<ins class="diff-chg">execute
</ins>
the
<del class="diff-old">discovery
process.
</del>
<ins class="diff-chg">next
steps
</ins><a data-link-type= "dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-chg">
in
parallel
</ins></a>.
</li>
<li>
If
<del class="diff-old">filter.fragment
</del>
<ins class="diff-chg">invoking
this
method
</ins>
is
<del class="diff-old">defined,
</del>
<ins class="diff-chg">not
allowed
</ins>
for
<del class="diff-old">each
property
defined
in
it,
check
if
that
property
exists
in
</del>
<ins class="diff-chg">the
current
scripting
context
for
security
reasons,
reject
</ins>
<var>
<del class="diff-old">td
</del>
<ins class="diff-chg">promise
</ins>
</var>
<del class="diff-old">and
has
the
same
value.
If
this
is
</del>
<ins class="diff-chg">with
</ins>
<code>
<del class="diff-old">false
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
<del class="diff-old">in
any
checks,
discard
td
</del>
and
<del class="diff-old">continue
the
discovery
process.
</del>
<ins class="diff-chg">terminate
these
steps.
</ins>
</li>
<li>
<del class="diff-old">Otherwise
if
</del>
<ins class="diff-chg">Run
the
</ins><a href="#dfn-validate-a-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
validate
a
TD
</ins></a><ins class="diff-chg">
steps
on
</ins>
<var>
td
<del class="diff-old">has
not
been
discarded
in
the
previous
steps,
invoke
the
</del>
</var>.
<ins class="diff-chg">If
that
throws,
reject
</ins>
<var>
<del class="diff-old">handler
</del>
<ins class="diff-chg">promise
</ins>
</var>
<del class="diff-old">function
</del>
with
<del class="diff-old">td
as
parameter.
Whenever
an
error
occurs
during
</del>
the
<del class="diff-old">discovery
process,
</del>
<ins class="diff-chg">error
</ins>
and
<del class="diff-old">if
</del>
<ins class="diff-chg">terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Let
</ins>
<var>
<del class="diff-old">errorHandler
</del>
<ins class="diff-chg">thing
</ins>
</var>
<del class="diff-old">is
defined,
invoke
it
with
an
argument
of
type
Error
whose
message
property
is
set
to
</del>
<ins class="diff-chg">be
a
new
</ins><a href="#dom-consumedthing" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">UnknownError
</del>
<ins class="diff-chg">ConsumedThing
</ins>
</code>
<del class="diff-old">unless
there
was
an
error
code
provided
by
the
Protocol
Bindings
,
in
which
case
set
it
to
that
value.
</del>
</a>
<ins class="diff-chg">object
constructed
from
</ins><var><ins class="diff-chg">
td
</ins></var>.
</li>
<li>
<del class="diff-old">When
</del>
<ins class="diff-chg">Set
up
</ins>
the
<del class="diff-old">discovery
process
is
finished,
</del>
<a href="#dfn-wot-interactions" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">WoT
Interactions
</ins></a><ins class="diff-chg">
based
on
introspecting
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
td
</ins></a><ins class="diff-chg">
as
explained
in
[
</ins><cite><a class="bibref" href="#bib-wot-td" title= "WoT Thing Description " data-link-type="biblio"><ins class="diff-chg">
WOT-TD
</ins></a></cite><ins class="diff-chg">
]
</ins>
and
<del class="diff-old">if
onComplete
is
defined,
invoke
it
run
the
cancel
discovery
</del>
<ins class="diff-chg">[
</ins><cite><a class="bibref" href="#bib-wot-protocol-bindings" title="Web of Things Protocol Binding Templates" data-link-type= "biblio"><ins class="diff-chg">
WOT-PROTOCOL-BINDINGS
</ins>
</a>
<del class="diff-old">steps.
When
the
obs.unsubscribe()
method
is
called,
run
the
following
cancel
discovery
steps:
Request
</del>
</cite>
<ins class="diff-chg">].
Make
a
request
to
</ins>
the
underlying
platform
to
<del class="diff-old">stop
</del>
<ins class="diff-chg">initialize
</ins>
the
<del class="diff-old">discovery
process.
If
this
returns
an
error,
or
if
it
is
not
possible,
for
instance
when
discovery
is
based
on
open
ended
multicast
requests,
</del>
<a href= "#dfn-protocol-bindings" class="internalDFN" data-link-type= "dfn">
<ins class="diff-chg">Protocol
Bindings
</ins></a>.<ins class="diff-chg">
The
details
are
private
to
</ins>
the
<del class="diff-old">implementation
SHOULD
discard
subsequent
discovered
items.
</del>
<ins class="diff-chg">implementations
and
out
of
scope
of
this
specification.
</ins>
</li>
<li>
<del class="diff-old">Set
</del>
<ins class="diff-chg">Resolve
</ins>
<var>
<del class="diff-old">obs.closed
</del>
<ins class="diff-chg">promise
</ins>
</var>
<del class="diff-old">to
false
.
</del>
<ins class="diff-chg">with
</ins><var><ins class="diff-chg">
thing
</ins></var>.
</li>
</ol>
</div>
</section>
<section id="the-produce-method">
<h3 id="x5-3-the-produce-method">
<del class="diff-old">3.2
</del>
<bdi class="secno">
<ins class="diff-chg">5.3
</ins></bdi>
The
<dfn data-dfn-type="method" data-export="" id="dom-wot-produce" data-idl="operation" data-title="produce()" data-dfn-for="WOT" data-type="Promise" data-lt= "WOT.produce()|WOT.produce|produce()|produce">
<code>
<del class="diff-old">fetch()
</del>
<ins class="diff-chg">produce()
</ins>
</code>
</dfn>
method
<a class="self-link" aria-label="§" href= "#the-produce-method">
</a>
</h3>
<pre class="idl def"><span data-idl="" class="idlInterface" id=
<ins class="diff-new">"idl-def-wot-partial-2" data-title=
"WOT">partial interface <a class="internalDFN idlID" data-link-for=
"" data-link-type="interface" href=
"#dom-wot"><code>WOT</code></a> {<span data-idl="" class=
"idlMethod" id="idl-def-wot-produce-td" data-title="produce"
data-dfn-for="WOT"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-new">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
href="#dom-exposedthing" class="internalDFN" data-link-type=
"idl"><code>ExposedThing</code></a>&gt;</span> <a class=
"internalDFN idlName" data-link-for="WOT" data-link-type="method"
href="#dom-wot-produce"><code>produce</code></a>(<span class=
"idlType"><a data-xref-type="_IDL_" href="#dom-thingdescription"
class="internalDFN" data-link-type=
"idl"><code>ThingDescription</code></a></span> <span class=
"idlParamName">td</span>);</span>
};
</ins></span></pre><div>
<p>
<del class="diff-old">Accepts
an
url
argument
of
type
USVString
that
represents
</del>
<ins class="diff-chg">Belongs
to
the
</ins><a href="#dfn-wot-producer" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
WoT
Producer
</ins></a><ins class="diff-chg">
conformance
class.
Expects
</ins>
a
<del class="diff-old">URL
(e.g.
"file://..."
or
</del>
<code>
<del class="diff-old">"https://..."
</del>
<ins class="diff-chg">td
</ins>
</code>
<del class="diff-old">)
</del>
<ins class="diff-chg">argument
</ins>
and
returns
a
<a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-promise-objects">
Promise
</a>
that
resolves
with
<del class="diff-old">a
</del>
<ins class="diff-chg">an
</ins><a href="#dom-exposedthing" class= "internalDFN" data-link-type="idl">
<code>
<del class="diff-old">ThingDescription
</del>
<ins class="diff-chg">ExposedThing
</ins>
</code>
</a>
<del class="diff-old">(a
serialized
JSON-LD
document
of
type
</del>
<ins class="diff-chg">object
that
extends
</ins><a href="#dom-consumedthing" class= "internalDFN" data-link-type="idl">
<code>
<del class="diff-old">USVString
</del>
<ins class="diff-chg">ConsumedThing
</ins>
</code>
<del class="diff-old">).
</del>
</a>
<ins class="diff-chg">with
a
server
interface,
i.e.
the
ability
to
define
request
handlers.
</ins>
The
<del class="diff-old">fetch(url)
</del>
method
<em class="rfc2119" title="MUST">
MUST
</em>
run
the
following
steps:
</p>
<ol>
<li>
Return
a
<a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects">
Promise
</a>
<var>
promise
</var>
and
execute
the
next
steps
<a data-link-type= "dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel">
in
parallel
</a>.
</li>
<li>
If
invoking
<del class="diff-old">fetch()
</del>
<ins class="diff-chg">this
method
</ins>
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
reject
<a data-link-type= "dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects">
promise
</a>
with
<code>
SecurityError
</code>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">If
the
argument
</del>
<ins class="diff-chg">Let
</ins>
<var>
<del class="diff-old">url
</del>
<ins class="diff-chg">thing
</ins>
</var>
<del class="diff-old">is
not
</del>
<ins class="diff-chg">be
</ins>
a
<del class="diff-old">URL,
reject
</del>
<ins class="diff-chg">new
</ins><a href="#dom-exposedthing" class="internalDFN" data-link-type= "idl"><code><ins class="diff-chg">
ExposedThing
</ins></code></a><ins class="diff-chg">
object
constructed
with
</ins><var><ins class="diff-chg">
td
</ins></var>.</li><li><ins class="diff-chg">
Resolve
</ins>
<var>
promise
</var>
with
<var>
<ins class="diff-new">thing
</ins></var>.</li></ol></div></section><section id="the-discover-method"><h3 id="x5-4-the-discover-method"><bdi class="secno"><ins class="diff-new">
5.4
</ins></bdi><ins class="diff-new">
The
</ins><dfn data-dfn-type="method" data-export="" id="dom-wot-discover" data-idl="operation" data-title="discover()" data-dfn-for="WOT" data-type="ThingDiscovery" data-lt= "WOT.discover()|WOT.discover|discover()|discover">
<code>
<del class="diff-old">TypeError
</del>
<ins class="diff-chg">discover()
</ins>
</code>
<del class="diff-old">and
terminate
these
steps.
Make
a
request
</del>
</dfn>
<ins class="diff-chg">method
</ins><a class="self-link" aria-label="§" href= "#the-discover-method"></a></h3><pre class="idl def"><span data-idl="" class="idlInterface" id=<ins class="diff-chg">
"idl-def-wot-partial-3" data-title=
"WOT">partial interface <a class="internalDFN idlID" data-link-for=
"" data-link-type="interface" href=
"#dom-wot"><code>WOT</code></a> {<span data-idl="" class=
"idlMethod" id="idl-def-wot-discover-filter" data-title="discover"
data-dfn-for="WOT"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" href="#dom-thingdiscovery" class=<ins class="diff-chg">
"internalDFN" data-link-type=
"idl"><code>ThingDiscovery</code></a></span> <a class=
"internalDFN idlName" data-link-for="WOT" data-link-type="method"
href=
"#dom-wot-discover"><code>discover</code></a>(optional<span class=
"idlType"> <a data-xref-type="_IDL_" href="#dom-thingfilter" class=
"internalDFN" data-link-type=
"idl"><code>ThingFilter</code></a></span> <span class=
"idlParamName">filter</span> = null);</span>
};
</ins></span></pre><div><p><ins class="diff-chg">
Belongs
</ins>
to
<del class="diff-old">fetch
the
content
of
url
as
described
by
</del>
the
<del class="diff-old">Protocol
Bindings
</del>
<a href="#dfn-wot-discovery" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">WoT
Discovery
</ins>
</a>
<del class="diff-old">and
wait
for
the
reply.
Implementations
encapsulate
</del>
<ins class="diff-chg">conformance
class.
Starts
</ins>
the
<del class="diff-old">fetching
</del>
<ins class="diff-chg">discovery
</ins>
process
<del class="diff-old">and
the
accepted
media
types
(such
as
</del>
<ins class="diff-chg">that
will
provide
</ins><a href= "#dom-thingdescription" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">application/td+json
</del>
<ins class="diff-chg">ThingDescription
</ins>
</code>
<del class="diff-old">),
as
far
as
a
valid
</del>
</a>
<ins class="diff-chg">objects
for
</ins>
<a href= "#dfn-thing-descriptions" class="internalDFN" data-link-type= "dfn">
Thing
Description
</a>
<del class="diff-old">can
be
obtained
as
defined
in
[
WOT-TD
].
Let
</del>
<ins class="diff-chg">s
that
match
an
optional
</ins>
<var>
<del class="diff-old">td
</del>
<ins class="diff-chg">filter
</ins>
</var>
<del class="diff-old">be
the
Thing
Description
string-serialized
from
the
returned
content,
as
specified
in
</del>
<ins class="diff-chg">argument.
The
method
</ins><em class="rfc2119" title= "MUST"><ins class="diff-chg">
MUST
</ins></em><ins class="diff-chg">
run
</ins>
the
<del class="diff-old">Thing
Description
serialization
.
</del>
<ins class="diff-chg">following
steps:
</ins></p><ol>
<li>
If
<del class="diff-old">there
was
an
error
during
</del>
<ins class="diff-chg">invoking
this
method
is
not
allowed
for
</ins>
the
<del class="diff-old">request,
reject
promise
with
an
Error
object
error
with
</del>
<ins class="diff-chg">current
scripting
context
for
security
reasons,
throw
</ins>
<code>
<del class="diff-old">error.message
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
<del class="diff-old">set
to
the
error
code
seen
by
the
Protocol
Bindings
</del>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">Otherwise
resolve
</del>
<ins class="diff-chg">Construct
a
</ins><a href="#dom-thingdiscovery" class="internalDFN" data-link-type="idl"><code><ins class="diff-chg">
ThingDiscovery
</ins></code></a><ins class="diff-chg">
object
</ins>
<var>
<del class="diff-old">promise
</del>
<ins class="diff-chg">discovery
</ins>
</var>
with
<var>
<del class="diff-old">td
and
terminate
these
steps.
</del>
<ins class="diff-chg">filter
</ins></var>.</li><li><ins class="diff-chg">
Invoke
the
</ins><a href="#the-start-method"><ins class="diff-chg">
discovery.start()
</ins></a><ins class="diff-chg">
method.
</ins></li><li><ins class="diff-chg">
Return
</ins><var><ins class="diff-chg">
discovery
</ins></var>.
</li>
</ol>
</div>
<p>
<ins class="diff-new">Refer
to
the
</ins><a href="#dom-thingdiscovery" class="internalDFN" data-link-type="idl"><code><ins class="diff-new">
ThingDiscovery
</ins></code></a><ins class="diff-new">
section
for
how
discovery
should
be
implemented.
</ins></p>
</section>
</section>
<section data-dfn-for="ConsumedThing" id= "the-consumedthing-interface">
<h2 id="x6-the-consumedthing-interface">
<del class="diff-old">3.3
</del>
<bdi class="secno">
<ins class="diff-chg">6.
</ins></bdi>
The
<dfn data-dfn-type="interface" data-export="" id= "dom-consumedthing" data-idl="interface" data-title= "ConsumedThing">
<code>
<del class="diff-old">consume()
</del>
<ins class="diff-chg">ConsumedThing
</ins>
</code>
</dfn>
<del class="diff-old">method
</del>
<ins class="diff-chg">interface
</ins><a class= "self-link" aria-label="§" href= "#the-consumedthing-interface">
</a>
</h2>
<p>
<del class="diff-old">Accepts
an
</del>
<ins class="diff-chg">Represents
a
client
API
to
operate
a
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a>.<ins class="diff-chg">
Belongs
to
the
</ins><a href="#dfn-wot-consumer" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
WoT
Consumer
</ins></a><ins class="diff-chg">
conformance
class.
</ins></p><pre class="idl def"><span data-idl="" class="idlInterface" id=<ins class="diff-chg">
"idl-def-consumedthing" data-title="ConsumedThing">[<span class=
"extAttr"><a data-xref-type="extended-attribute" data-cite-path=""
data-type="extended-attribute" href=
"https://heycam.github.io/webidl/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-xref-type="extended-attribute"
data-cite-path="" data-type="extended-attribute" href=
"https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<a data-xref-type="interface"
data-cite-path="window-object.html" data-type="interface" href=
"https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>,<a data-xref-type="interface"
data-lt="WorkerGlobalScope" data-cite-path="workers.html"
data-type="interface" href=
"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">Worker</a>)</span>]
interface <a class="internalDFN idlID" data-link-for=""
data-link-type="interface" href=
"#dom-consumedthing"><code>ConsumedThing</code></a> {<span data-idl=""
class="idlConstructor" id="idl-def-consumedthing-constructor-td"
data-title="constructor" data-dfn-for="ConsumedThing">
</ins>  <dfn data-export="" data-dfn-type="constructor" id=<ins class="diff-chg">
"dom-consumedthing-constructor" data-idl="constructor" data-title=
"constructor" data-dfn-for="ConsumedThing" data-lt=
"ConsumedThing.constructor()|ConsumedThing.constructor|constructor()|constructor"><code>constructor</code></dfn>(<span class="idlType"><a data-xref-type="_IDL_"
href="#dom-thingdescription" class="internalDFN" data-link-type=
"idl"><code>ThingDescription</code></a></span> <span class=
"idlParamName">td</span>);</span><span data-idl="" class=
"idlMethod" id=
"idl-def-consumedthing-readproperty-propertyname-options"
data-title="readProperty" data-dfn-for="ConsumedThing"><span class=
"idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ConsumedThing" data-link-type="method" href=
"#dom-consumedthing-readproperty"><code>readProperty</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">propertyName</span>,
                            optional<span class=
"idlType"> <a data-xref-type="_IDL_" href="#dom-interactionoptions"
class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlMethod" id=
"idl-def-consumedthing-readallproperties-options" data-title=
"readAllProperties" data-dfn-for="ConsumedThing"><span class=
"idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
href="#dom-propertymap" class="internalDFN" data-link-type=
"idl"><code>PropertyMap</code></a>&gt;</span> <a class=
"internalDFN idlName" data-link-for="ConsumedThing" data-link-type=
"method" href=
"#dom-consumedthing-readallproperties"><code>readAllProperties</code></a>(optional<span class="idlType"> <a data-xref-type="_IDL_"
href="#dom-interactionoptions" class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlMethod" id=
"idl-def-consumedthing-readmultipleproperties-propertynames-options"
data-title="readMultipleProperties" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
href="#dom-propertymap" class="internalDFN" data-link-type=
"idl"><code>PropertyMap</code></a>&gt;</span> <a class=
"internalDFN idlName" data-link-for="ConsumedThing" data-link-type=
"method" href=
"#dom-consumedthing-readmultipleproperties"><code>readMultipleProperties</code></a>(<span class="idlType">
</ins>                            <a data-xref-type="dfn" data-cite-path=<ins class="diff-chg">
"" data-type="dfn" href=
"https://heycam.github.io/webidl/#idl-sequence">sequence</a>&lt;<a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a>&gt;</span> <span class="idlParamName">propertyNames</span>,
                            optional<span class=
"idlType"> <a data-xref-type="_IDL_" href="#dom-interactionoptions"
class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlMethod" id=
"idl-def-consumedthing-writeproperty-propertyname-value-options"
data-title="writeProperty" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ConsumedThing" data-link-type="method" href=
"#dom-consumedthing-writeproperty"><code>writeProperty</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">propertyName</span>,<span class="idlType">
</ins>                              <a data-xref-type="_IDL_"<ins class="diff-chg">
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a></span> <span class="idlParamName">value</span>,
                              optional<span class=
"idlType"> <a data-xref-type="_IDL_" href="#dom-interactionoptions"
class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlMethod" id=
"idl-def-consumedthing-writemultipleproperties-valuemap-options"
data-title="writeMultipleProperties" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ConsumedThing" data-link-type="method" href=
"#dom-consumedthing-writemultipleproperties"><code>writeMultipleProperties</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
href="#dom-propertymap" class="internalDFN" data-link-type=
"idl"><code>PropertyMap</code></a></span> <span class=
"idlParamName">valueMap</span>,
                              optional<span class=
"idlType"> <a data-xref-type="_IDL_" href="#dom-interactionoptions"
class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlMethod" id=
"idl-def-consumedthing-invokeaction-actionname-params-options"
data-title="invokeAction" data-dfn-for="ConsumedThing"><span class=
"idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ConsumedThing" data-link-type="method" href=
"#dom-consumedthing-invokeaction"><code>invokeAction</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">actionName</span>,
                              optional<span class=
"idlType"> <a data-xref-type="_IDL_" data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a></span> <span class="idlParamName">params</span> = null,
                              optional<span class=
"idlType"> <a data-xref-type="_IDL_" href="#dom-interactionoptions"
class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlMethod" id=
"idl-def-consumedthing-observeproperty-name-listener-options"
data-title="observeProperty" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ConsumedThing" data-link-type="method" href=
"#dom-consumedthing-observeproperty"><code>observeProperty</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">name</span>,<span class="idlType">
</ins>                              <a data-xref-type="_IDL_" href=<ins class="diff-chg">
"#dom-wotlistener" class="internalDFN" data-link-type=
"idl"><code>WotListener</code></a></span> <span class=
"idlParamName">listener</span>,
                              optional<span class=
"idlType"> <a data-xref-type="_IDL_" href="#dom-interactionoptions"
class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlMethod" id="idl-def-consumedthing-unobserveproperty-name"
data-title="unobserveProperty" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ConsumedThing" data-link-type="method" href=
"#dom-consumedthing-unobserveproperty"><code>unobserveProperty</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">name</span>);</span><span data-idl=""
class="idlMethod" id=
"idl-def-consumedthing-subscribeevent-name-listener-options"
data-title="subscribeEvent" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ConsumedThing" data-link-type="method" href=
"#dom-consumedthing-subscribeevent"><code>subscribeEvent</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">name</span>,<span class="idlType">
</ins>                              <a data-xref-type="_IDL_" href=<ins class="diff-chg">
"#dom-wotlistener" class="internalDFN" data-link-type=
"idl"><code>WotListener</code></a></span> <span class=
"idlParamName">listener</span>,
                              optional<span class=
"idlType"> <a data-xref-type="_IDL_" href="#dom-interactionoptions"
class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlMethod" id="idl-def-consumedthing-unsubscribeevent-name"
data-title="unsubscribeEvent" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ConsumedThing" data-link-type="method" href=
"#dom-consumedthing-unsubscribeevent"><code>unsubscribeEvent</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">name</span>);</span><span data-idl=""
class="idlMethod" id="idl-def-consumedthing-getthingdescription"
data-title="getThingDescription" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" href="#dom-thingdescription" class=<ins class="diff-chg">
"internalDFN" data-link-type=
"idl"><code>ThingDescription</code></a></span> <a class=
"internalDFN idlName" data-link-for="ConsumedThing" data-link-type=
"method" href=
"#dom-consumedthing-getthingdescription"><code>getThingDescription</code></a>();</span>
};</span><span data-idl="" class="idlDictionary" id=
"idl-def-interactionoptions" data-title="InteractionOptions">
dictionary <a class="internalDFN idlID" data-link-for=""
data-link-type="dictionary" href=
"#dom-interactionoptions"><code>InteractionOptions</code></a> {<span data-idl=""
class="idlMember" id="idl-def-interactionoptions-urivariables"
data-title="uriVariables" data-dfn-for=
"InteractionOptions"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-object">object</a></span> <dfn data-export=""
data-dfn-type="dict-member" id=
"dom-interactionoptions-urivariables" data-idl="field" data-title=
"uriVariables" data-dfn-for="InteractionOptions" data-type="object"
class="idlName"><code>uriVariables</code></dfn>;</span>
};</span><span data-idl="" class="idlTypedef" id=
"idl-def-propertymap" data-title="PropertyMap">
typedef<span class="idlType"> <a data-xref-type="interface"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-object">object</a></span> <a class="internalDFN idlID"
data-link-for="" data-link-type="typedef" href=
"#dom-propertymap"><code>PropertyMap</code></a>;</span><span data-idl=""
class="idlCallback" id="idl-def-wotlistener" data-title=
"WotListener">
callback <a class="internalDFN idlID" data-link-for=""
data-link-type="callback" href=
"#dom-wotlistener"><code>WotListener</code></a> =<span class=
"idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type=
"interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a></span>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any">
</ins>
<code>
<del class="diff-old">td
</del>
<ins class="diff-chg">any
</ins>
</code>
<del class="diff-old">argument
of
type
</del>
</a>
</span>
<span class="idlParamName">
<ins class="diff-chg">data
</ins></span><ins class="diff-chg">
);
</ins></span>
</pre>
<section id="constructing-consumedthing">
<h3 id="x6-1-constructing-consumedthing">
<bdi class= "secno">
<ins class="diff-new">6.1
</ins></bdi><ins class="diff-new">
Constructing
</ins>
<code>
<del class="diff-old">ThingDescription
</del>
<ins class="diff-chg">ConsumedThing
</ins>
</code>
<a class= "self-link" aria-label="§" href= "#constructing-consumedthing">
</a>
<del class="diff-old">and
returns
</del>
</h3>
<p>
<ins class="diff-chg">After
</ins><a href="#fetching-a-thing-description"><ins class="diff-chg">
fetching
</ins></a>
a
<a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Thing
Description
</ins></a><ins class="diff-chg">
as
a
JSON
object,
one
can
create
a
</ins><a href="#dom-consumedthing" class="internalDFN" data-link-type="idl">
<code>
ConsumedThing
</code>
</a>
<del class="diff-old">object
instantiated
based
on
parsing
that
description.
</del>
<ins class="diff-chg">object.
</ins>
</p>
<div>
<p>
<del class="diff-old">The
</del>
<ins class="diff-chg">To
create
</ins><a href="#dom-consumedthing" class="internalDFN" data-link-type="idl">
<code>
<del class="diff-old">consume(td)
</del>
<ins class="diff-chg">ConsumedThing
</ins>
</code>
<del class="diff-old">method
must
</del>
</a>
<ins class="diff-chg">with
the
</ins><a href="#dom-thingdescription" class="internalDFN" data-link-type= "idl"><code><ins class="diff-chg">
ThingDescription
</ins></code></a><var><ins class="diff-chg">
td
</ins></var>,
run
the
following
steps:
</p>
<ol>
<li>
<del class="diff-old">If
</del>
<ins class="diff-chg">Run
</ins>
the
<del class="diff-old">argument
td
is
not
a
string,
throw
</del>
<a href="#dfn-expand-a-td" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">expand
</ins>
a
<del class="diff-old">TypeError
and
terminate
these
steps.
Let
stub
be
the
result
of
running
the
</del>
TD
<del class="diff-old">parsing
algorithm
</del>
</a>
<del class="diff-old">with
</del>
<ins class="diff-chg">steps
on
</ins>
<var>
td
<del class="diff-old">as
argument.
</del>
</var>.
If
that
<del class="diff-old">throws
an
error,
</del>
<ins class="diff-chg">fails,
</ins>
re-throw
the
error
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">If
</del>
<ins class="diff-chg">Let
</ins>
<var>
<del class="diff-old">stub
</del>
<ins class="diff-chg">thing
</ins>
</var>
<del class="diff-old">does
not
have
an
own
property
that
is
defined
in
ThingFragment
with
a
default
value,
add
that
property
and
value
to
stub
.
Create
</del>
<ins class="diff-chg">be
</ins>
a
<ins class="diff-chg">new
</ins><a href="#dom-consumedthing" class="internalDFN" data-link-type= "idl">
<code>
ConsumedThing
</code>
</a>
<del class="diff-old">object
</del>
<ins class="diff-chg">object.
</ins></li><li><ins class="diff-chg">
Let
|
</ins><var><ins class="diff-chg">
td
</ins></var><ins class="diff-chg">
|
be
an
internal
slot
of
</ins>
<var>
thing
</var>
<del class="diff-old">initialized
from
</del>
<ins class="diff-chg">and
let
</ins>
<var>
<del class="diff-old">stub
</del>
<ins class="diff-chg">td
</ins>
</var>
<del class="diff-old">that
implements
</del>
<ins class="diff-chg">be
its
value.
</ins></li><li><ins class="diff-chg">
Return
</ins><var><ins class="diff-chg">
thing
</ins></var>.</li></ol></div></section><section id="the-getthingdescription-method"><h3 id="x6-2-the-getthingdescription-method">
<bdi class= "secno">
<ins class="diff-new">6.2
</ins></bdi><ins class="diff-new">
The
</ins><dfn data-dfn-type="method" data-export="" id="dom-consumedthing-getthingdescription" data-idl="operation" data-title="getThingDescription()" data-dfn-for="ConsumedThing" data-type="ThingDescription" data-lt= "ConsumedThing.getThingDescription()|ConsumedThing.getThingDescription|getThingDescription()|getThingDescription">
<code>
<del class="diff-old">Observable
</del>
<ins class="diff-chg">getThingDescription()
</ins>
</code>
<del class="diff-old">.
Add
</del>
</dfn>
<ins class="diff-chg">method
</ins><a class="self-link" aria-label="§" href="#the-getthingdescription-method"></a></h3><p><ins class="diff-chg">
Returns
</ins>
the
<del class="diff-old">read()
and
write()
methods
to
</del>
<ins class="diff-chg">internal
slot
|
</ins><var><ins class="diff-chg">
td
</ins></var><ins class="diff-chg">
|
of
</ins>
the
<a href= "#dom-consumedthing" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">ThingProperty
</del>
<ins class="diff-chg">ConsumedThing
</ins>
</code>
</a>
<del class="diff-old">elements
so
</del>
<ins class="diff-chg">object
</ins>
that
<del class="diff-old">they
make
requests
to
access
</del>
<ins class="diff-chg">represents
</ins>
the
<del class="diff-old">remote
</del>
<a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn">
Thing
<ins class="diff-new">Description
</ins>
</a>
<del class="diff-old">s
and
wait
for
the
reply,
as
defined
by
</del>
<ins class="diff-chg">of
</ins>
the
<del class="diff-old">Protocol
Bindings
.
Also,
all
</del>
<a href= "#dom-consumedthing" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">ThingProperty
</del>
<ins class="diff-chg">ConsumedThing
</ins>
</code>
</a>.
<ins class="diff-new">Applications
may
consult
the
</ins><a href="#dfn-things" class="internalDFN" data-link-type= "dfn"><ins class="diff-new">
Thing
</ins>
</a>
<del class="diff-old">elements
SHOULD
implement
</del>
<ins class="diff-chg">metadata
stored
in
|
</ins><var><ins class="diff-chg">
td
</ins></var><ins class="diff-chg">
|
in
order
to
introspect
its
capabilities
before
interacting
with
it.
</ins></p></section><section id="the-interactionoptions-dictionary"><h3 id="x6-3-the-interactionoptions-dictionary">
<del class="diff-old">Observable
</del>
<bdi class= "secno">
<ins class="diff-chg">6.3
</ins></bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="dictionary" data-export= "" id="dom-interactionoptions" data-idl="dictionary" data-title= "InteractionOptions">
<del class="diff-old">,
i.e.
define
a
</del>
<code>
<del class="diff-old">subscribe()
</del>
<ins class="diff-chg">InteractionOptions
</ins>
</code>
<del class="diff-old">method
</del>
</dfn>
<ins class="diff-chg">dictionary
</ins><a class="self-link" aria-label="§" href= "#the-interactionoptions-dictionary"></a></h3><p><ins class="diff-chg">
Holds
the
interaction
options
</ins>
that
<del class="diff-old">should
make
request
</del>
<ins class="diff-chg">need
to
be
exposed
for
application
scripts
according
</ins>
to
<del class="diff-old">observe
the
given
Properties
as
defined
by
</del>
the
<del class="diff-old">Protocol
Bindings
</del>
<a href= "#dfn-thing-descriptions" class="internalDFN" data-link-type= "dfn">
<ins class="diff-chg">Thing
Description
</ins>
</a>.
<del class="diff-old">Add
</del>
<ins class="diff-chg">In
this
version
of
</ins>
the
<del class="diff-old">invoke()
methods
to
</del>
<ins class="diff-chg">specification
only
URI
template
variables
are
used,
represented
as
</ins><a href= "https://infra.spec.whatwg.org/#parse-json-from-bytes"><ins class="diff-chg">
parsed
JSON
objects
</ins></a><ins class="diff-chg">
defined
in
[
</ins><cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type= "biblio"><ins class="diff-chg">
WOT-TD
</ins></a></cite><ins class="diff-chg">
].
</ins></p><div class="note" id="issue-container-generatedID-4"><div role="heading" class="ednote-title marker" id="h-ednote-1" aria-level="4"><span><ins class="diff-chg">
Editor's
note
</ins></span></div><p class=""><ins class="diff-chg">
The
support
for
URI
variables
comes
from
</ins>
the
<ins class="diff-chg">need
exposed
by
[
</ins><cite>
<del class="diff-old">ThingAction
</del>
<a class="bibref" href="#bib-wot-td" title= "WoT Thing Description " data-link-type="biblio">
<ins class="diff-chg">WOT-TD
</ins></a>
</cite>
<ins class="diff-new">]
to
be
able
to
describe
existing
</ins><a href="#dfn-td" class= "internalDFN" data-link-type="dfn"><ins class="diff-new">
TD
</ins>
</a>
<del class="diff-old">elements
so
</del>
<ins class="diff-chg">s
</ins>
that
<del class="diff-old">they
make
requests
</del>
<ins class="diff-chg">use
them,
but
it
should
be
possible
</ins>
to
<del class="diff-old">the
remote
</del>
<ins class="diff-chg">write
a
</ins><a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn">
Thing
<ins class="diff-new">Description
</ins>
</a>
<del class="diff-old">to
invoke
its
actions,
as
defined
by
</del>
<ins class="diff-chg">that
would
use
</ins><a href="#dfn-actions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Action
</ins></a><ins class="diff-chg">
s
for
representing
</ins>
the
<del class="diff-old">Protocol
Bindings
.
Add
</del>
<ins class="diff-chg">interactions
that
need
URI
variables
and
represent
</ins>
the
<del class="diff-old">subscribe()
method
</del>
<ins class="diff-chg">URI
variables
as
parameters
</ins>
to
<del class="diff-old">all
ThingEvent
</del>
<ins class="diff-chg">the
</ins><a href="#dfn-actions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Action
</ins>
</a>
<del class="diff-old">elements
so
</del>
<ins class="diff-chg">and
in
</ins>
that
<del class="diff-old">they
make
requests
to
subscribe
to
the
events
defined
</del>
<ins class="diff-chg">case
that
could
be
encapsulated
</ins>
by
the
<del class="diff-old">remote
Thing
,
as
defined
by
</del>
<ins class="diff-chg">implementations
and
</ins>
the
<del class="diff-old">Protocol
Bindings
.
Return
</del>
<var>
<del class="diff-old">thing
.
</del>
<ins class="diff-chg">options
</ins></var><ins class="diff-chg">
parameter
could
be
dismissed
from
the
methods
exposed
by
this
API.
</ins></p></div>
</section>
<section id="the-propertymap-type">
<h3 id="x6-4-the-propertymap-type">
<del class="diff-old">3.4
</del>
<bdi class="secno">
<ins class="diff-chg">6.4
</ins></bdi>
The
<dfn data-dfn-type="typedef" data-export="" id="dom-propertymap" data-idl="typedef" data-title= "PropertyMap">
<code>
<del class="diff-old">produce()
</del>
<ins class="diff-chg">PropertyMap
</ins>
</code>
</dfn>
<del class="diff-old">method
</del>
<ins class="diff-chg">type
</ins><a class= "self-link" aria-label="§" href="#the-propertymap-type">
</a>
</h3>
<p>
<del class="diff-old">Accepts
</del>
<ins class="diff-chg">Represents
</ins>
a
<del class="diff-old">model
argument
</del>
<ins class="diff-chg">map
</ins>
of
<del class="diff-old">type
</del>
<a href="#dfn-properties" class= "internalDFN" data-link-type="dfn">
<ins class="diff-chg">Property
</ins></a><ins class="diff-chg">
names
as
strings
to
a
value
that
the
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
can
take.
It
is
used
as
a
property
bag
for
interactions
that
involve
multiple
</ins><a href= "#dfn-properties" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Properties
</ins></a><ins class="diff-chg">
at
once.
</ins></p><div class="note" id="issue-container-generatedID-5"><div role="heading" class="ednote-title marker" id="h-ednote-2" aria-level="4">
<span>
<ins class="diff-chg">Editor's
note
</ins></span></div><p class=""><ins class="diff-chg">
It
could
be
defined
in
Web
IDL
(as
well
as
</ins><a href= "#dom-thingdescription" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">ThingModel
</del>
<ins class="diff-chg">ThingDescription
</ins>
</code>
</a>
<ins class="diff-new">)
as
a
</ins><a href= "https://heycam.github.io/webidl/#idl-maplike"><ins class="diff-new">
maplike
</ins></a><ins class="diff-new">
interface
from
</ins><i><ins class="diff-new">
string
</ins></i><ins class="diff-new">
to
</ins><i><ins class="diff-new">
any
</ins></i>.</p></div></section><section id="the-readproperty-method"><h3 id="x6-5-the-readproperty-method">
<bdi class="secno">
<ins class="diff-new">6.5
</ins></bdi><ins class="diff-new">
The
</ins><dfn data-dfn-type="method" data-export="" id= "dom-consumedthing-readproperty" data-idl="operation" data-title= "readProperty()" data-dfn-for="ConsumedThing" data-type="Promise" data-lt= "ConsumedThing.readProperty()|ConsumedThing.readProperty|readProperty()|readProperty"><code><ins class="diff-new">
readProperty()
</ins>
</code>
</dfn>
<ins class="diff-new">method
</ins><a class="self-link" aria-label="§" href="#the-readproperty-method"></a></h3><div><p><ins class="diff-new">
Reads
a
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Property
</ins></a><ins class="diff-new">
value.
Takes
a
string
argument
</ins><var><ins class="diff-new">
propertyName
</ins></var><ins class="diff-new">
and
</ins>
and
<del class="diff-old">returns
</del>
an
<ins class="diff-chg">optional
</ins><a href= "#dom-interactionoptions" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">ExposedThing
</del>
<ins class="diff-chg">InteractionOptions
</ins>
</code>
</a>
<del class="diff-old">object.
The
</del>
<var>
<ins class="diff-chg">options
</ins></var><ins class="diff-chg">
argument.
It
returns
a
</ins><a href="#dfn-properties" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
value
represented
as
</ins>
<code>
<del class="diff-old">produce(model)
</del>
<ins class="diff-chg">any
</ins>
</code>
<ins class="diff-new">type.
The
</ins>
method
<em class="rfc2119" title= "MUST">
MUST
</em>
run
the
following
steps:
</p>
<ol>
<li>
<ins class="diff-new">Return
a
</ins><a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects"><ins class="diff-new">
Promise
</ins></a><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
and
execute
the
next
steps
</ins><a data-link-type= "dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-new">
in
parallel
</ins></a>.</li><li>
If
invoking
<del class="diff-old">produce()
</del>
<ins class="diff-chg">this
method
</ins>
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
<del class="diff-old">throw
</del>
<ins class="diff-chg">reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
<code>
SecurityError
</code>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">If
</del>
<ins class="diff-chg">Make
a
request
to
</ins>
the
<del class="diff-old">argument
</del>
<ins class="diff-chg">underlying
platform
(via
the
</ins><a href= "#dfn-protocol-bindings" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Protocol
Bindings
</ins></a><ins class="diff-chg">
)
to
retrieve
the
value
of
the
</ins><a href= "#dfn-properties" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
given
by
</ins>
<var>
<del class="diff-old">model
</del>
<ins class="diff-chg">propertyName
</ins>
</var>
<del class="diff-old">is
a
string,
then
run
the
TD
parsing
algorithm
</del>
with
<ins class="diff-new">optional
URI
templates
given
in
</ins>
<var>
<del class="diff-old">model
passed
as
parameter.
</del>
<ins class="diff-chg">options.uriVariables
</ins></var>.</li><li>
If
<del class="diff-old">it
throws
an
error,
re-throw
that
</del>
<ins class="diff-chg">the
request
fails,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
the
</ins>
error
<ins class="diff-new">received
from
the
</ins><a href="#dfn-protocol-bindings" class= "internalDFN" data-link-type="dfn"><ins class="diff-new">
Protocol
Bindings
</ins></a>
and
terminate
<del class="diff-old">this
algorithm.
Otherwise
let
</del>
<ins class="diff-chg">these
steps.
</ins></li><li><ins class="diff-chg">
Let
</ins>
<var>
<del class="diff-old">model
</del>
<ins class="diff-chg">value
</ins>
</var>
be
the
<del class="diff-old">returned
value.
</del>
<ins class="diff-chg">result
of
the
request.
</ins>
</li>
<li>
<del class="diff-old">If
</del>
<ins class="diff-chg">Run
the
</ins><dfn data-dfn-type="dfn" id= "dfn-validate-property-value"><ins class="diff-chg">
validate
Property
value
</ins></dfn><ins class="diff-chg">
sub-steps
on
</ins>
<var>
<del class="diff-old">model
</del>
<ins class="diff-chg">value
</ins></var>:<ol><li><ins class="diff-chg">
Based
on
the
</ins><a href= "https://www.w3.org/TR/2019/CR-wot-thing-description-20190516/#dataschema"><ins class="diff-chg">
DataSchema
definition
</ins></a>,<var><ins class="diff-chg">
value
</ins>
</var>
<em class="rfc2119" title="MUST">
<ins class="diff-new">MUST
</ins></em><ins class="diff-new">
be
a
JSON
value
and
comply
to
the
data
schema
defined
for
the
</ins><a href="#dfn-properties" class= "internalDFN" data-link-type="dfn"><ins class="diff-new">
Property
</ins></a><ins class="diff-new">
that
</ins>
is
<del class="diff-old">not
an
object,
</del>
<ins class="diff-chg">found
in
</ins><code><ins class="diff-chg">
this.getThingDescription().properties[
</ins></code><var><ins class="diff-chg">
propertyName
</ins></var><code><ins class="diff-chg">
]
</ins></code>.</li><li><ins class="diff-chg">
If
this
fails,
</ins>
throw
<code>
<del class="diff-old">TypeError
</del>
<ins class="diff-chg">SyntaxError
</ins></code>,<ins class="diff-chg">
otherwise
return
</ins><var><ins class="diff-chg">
value
</ins></var>.</li></ol></li><li><ins class="diff-chg">
If
these
above
steps
failed,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins><code><ins class="diff-chg">
SyntaxError
</ins>
</code>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">If
</del>
<ins class="diff-chg">Otherwise
resolve
</ins>
<var>
<del class="diff-old">model
</del>
<ins class="diff-chg">promise
</ins>
</var>
<del class="diff-old">does
not
have
an
own
property
that
is
defined
in
</del>
<ins class="diff-chg">with
</ins><var><ins class="diff-chg">
value
</ins></var>.</li></ol></div></section><section id="the-readmultipleproperties-method"><h3 id="x6-6-the-readmultipleproperties-method">
<bdi class= "secno">
<ins class="diff-new">6.6
</ins></bdi><ins class="diff-new">
The
</ins><dfn data-dfn-type="method" data-export="" id="dom-consumedthing-readmultipleproperties" data-idl="operation" data-title="readMultipleProperties()" data-dfn-for="ConsumedThing" data-type="Promise" data-lt= "ConsumedThing.readMultipleProperties()|ConsumedThing.readMultipleProperties|readMultipleProperties()|readMultipleProperties">
<code>
<del class="diff-old">ThingFragment
</del>
<ins class="diff-chg">readMultipleProperties()
</ins>
</code>
</dfn>
<ins class="diff-new">method
</ins><a class= "self-link" aria-label="§" href= "#the-readmultipleproperties-method">
</a>
</h3>
<div>
<p>
<ins class="diff-new">Reads
multiple
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Property
</ins></a><ins class="diff-new">
values
</ins>
with
<ins class="diff-new">one
or
multiple
requests.
Takes
the
</ins><var><ins class="diff-new">
propertyNames
</ins></var><ins class="diff-new">
argument
as
</ins>
a
<del class="diff-old">default
value,
add
that
property
</del>
<ins class="diff-chg">sequence
of
strings
</ins>
and
<del class="diff-old">value
to
model
.
Create
</del>
an
<ins class="diff-chg">optional
</ins><a href="#dom-interactionoptions" class= "internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">ExposedThing
</del>
<ins class="diff-chg">InteractionOptions
</ins>
</code>
</a>
<del class="diff-old">object
</del>
<var>
<del class="diff-old">thing
</del>
<ins class="diff-chg">options
</ins>
</var>
<del class="diff-old">initialized
</del>
<ins class="diff-chg">argument.
It
returns
an
object
with
keys
</ins>
from
<var>
<del class="diff-old">model
.
</del>
<ins class="diff-chg">propertyNames
</ins></var><ins class="diff-chg">
and
values
returned
by
this
algorithm.
The
method
</ins><em class="rfc2119" title="MUST"><ins class="diff-chg">
MUST
</ins></em><ins class="diff-chg">
run
the
following
steps:
</ins></p><ol><li><ins class="diff-chg">
Return
a
</ins><a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects"><ins class="diff-chg">
Promise
</ins></a><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
and
execute
the
next
steps
</ins><a data-link-type= "dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-chg">
in
parallel
</ins></a>.
</li>
<li>
<del class="diff-old">For
each
property
of
</del>
<ins class="diff-chg">If
invoking
this
method
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
<code>
<del class="diff-old">ExposedThing
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
<del class="diff-old">defined
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Let
</ins><var><ins class="diff-chg">
result
</ins></var><ins class="diff-chg">
be
an
object
and
for
each
string
</ins><var><ins class="diff-chg">
name
</ins></var>
in
<var>
<ins class="diff-chg">propertyNames
</ins></var><ins class="diff-chg">
add
a
property
with
key
</ins><var><ins class="diff-chg">
name
</ins></var><ins class="diff-chg">
and
the
value
</ins>
<code>
<del class="diff-old">ThingFragment
,
initialize
</del>
<ins class="diff-chg">null
</ins></code>.</li><li><ins class="diff-chg">
Make
a
request
to
</ins>
the
<del class="diff-old">property
based
on
</del>
<ins class="diff-chg">underlying
platform
(via
</ins>
the
<del class="diff-old">provided
initial
or
default
values
provided
</del>
<a href= "#dfn-protocol-bindings" class="internalDFN" data-link-type= "dfn">
<ins class="diff-chg">Protocol
Bindings
</ins></a><ins class="diff-chg">
)
</ins>
to
<ins class="diff-new">retrieve
</ins>
the
<del class="diff-old">local
WoT
Runtime
</del>
<a href= "#dfn-properties" class="internalDFN" data-link-type= "dfn">
<ins class="diff-chg">Property
</ins>
</a>
<del class="diff-old">implementation,
for
instance
initialize:
</del>
<ins class="diff-chg">values
given
by
</ins><var><ins class="diff-chg">
propertyNames
</ins></var><ins class="diff-chg">
with
optional
URI
templates
given
in
</ins><var><ins class="diff-chg">
options.uriVariables
</ins></var>.</li>
<li>
<del class="diff-old">the
id
property
to
</del>
<ins class="diff-chg">If
this
cannot
</ins>
be
<ins class="diff-new">done
with
a
single
request
with
</ins>
the
<del class="diff-old">final
unique
identifier
</del>
<a href= "#dfn-protocol-bindings" class="internalDFN" data-link-type= "dfn">
<ins class="diff-chg">Protocol
Bindings
</ins></a>
of
the
<a href="#dfn-things" class= "internalDFN" data-link-type="dfn">
Thing
</a>,
<del class="diff-old">the
security
object
of
type
</del>
<ins class="diff-chg">then
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
<code>
<del class="diff-old">SecurityScheme
</del>
<ins class="diff-chg">NotSupportedError
</ins>
</code>
<del class="diff-old">to
represent
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Process
</ins>
the
<del class="diff-old">actual
security
scheme
</del>
<ins class="diff-chg">reply
</ins>
and
<del class="diff-old">its
</del>
<ins class="diff-chg">update
all
</ins>
properties
<del class="diff-old">as
set
up
by
</del>
<ins class="diff-chg">in
</ins><var><ins class="diff-chg">
result
</ins></var><ins class="diff-chg">
with
</ins>
the
<del class="diff-old">implementation,
</del>
<ins class="diff-chg">values
obtained
in
the
reply.
</ins>
</li>
<li>
<ins class="diff-new">If
</ins>
the
<ins class="diff-new">above
step
fails
at
any
point,
reject
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
</ins>
<code>
<del class="diff-old">properties
</del>
<ins class="diff-chg">SyntaxError
</ins>
</code>
<del class="diff-old">property
to
be
an
object
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Resolve
</ins><var><ins class="diff-chg">
promise
</ins></var>
with
<del class="diff-old">all
properties
being
</del>
<var>
<ins class="diff-chg">result
</ins></var>.</li></ol></div></section><section id="the-readallproperties-method"><h3 id="x6-7-the-readallproperties-method">
<bdi class= "secno">
<ins class="diff-new">6.7
</ins></bdi><ins class="diff-new">
The
</ins><dfn data-dfn-type="method" data-export="" id="dom-consumedthing-readallproperties" data-idl="operation" data-title="readAllProperties()" data-dfn-for="ConsumedThing" data-type="Promise" data-lt= "ConsumedThing.readAllProperties()|ConsumedThing.readAllProperties|readAllProperties()|readAllProperties">
<code>
<del class="diff-old">ThingProperty
</del>
<ins class="diff-chg">readAllProperties()
</ins>
</code>
</dfn>
<ins class="diff-new">method
</ins><a class="self-link" aria-label="§" href="#the-readallproperties-method">
</a>
<del class="diff-old">objects
in
which
</del>
</h3>
<div>
<p>
<ins class="diff-chg">Reads
all
properties
of
</ins>
the
<a href="#dfn-things" class= "internalDFN" data-link-type="dfn">
<ins class="diff-new">Thing
</ins></a><ins class="diff-new">
with
one
or
multiple
requests.
Takes
an
optional
</ins><a href="#dom-interactionoptions" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">read()
and
write()
</del>
<ins class="diff-chg">InteractionOptions
</ins>
</code>
<del class="diff-old">methods
are
provided
to
define
local
methods
to
get
and
set
the
</del>
</a>
<var>
<ins class="diff-chg">options
</ins></var><ins class="diff-chg">
argument.
It
returns
an
object
with
keys
from
</ins>
<a href= "#dfn-properties" class="internalDFN" data-link-type= "dfn">
Property
</a>
<del class="diff-old">values,
</del>
<ins class="diff-chg">names
and
values
returned
by
this
algorithm.
The
method
</ins><em class="rfc2119" title="MUST"><ins class="diff-chg">
MUST
</ins></em><ins class="diff-chg">
run
the
following
steps:
</ins></p><ol><li><ins class="diff-chg">
Return
a
</ins><a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects"><ins class="diff-chg">
Promise
</ins></a><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
and
execute
the
next
steps
</ins><a data-link-type= "dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-chg">
in
parallel
</ins></a>.
</li>
<li>
<ins class="diff-new">If
invoking
this
method
is
not
allowed
for
</ins>
the
<ins class="diff-new">current
scripting
context
for
security
reasons,
reject
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
</ins>
<code>
<del class="diff-old">actions
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
<del class="diff-old">property
to
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Let
</ins><var><ins class="diff-chg">
result
</ins></var>
be
an
object
<del class="diff-old">with
all
properties
being
ThingAction
objects
</del>
<ins class="diff-chg">and
for
each
string
</ins><var><ins class="diff-chg">
name
</ins></var>
in
<del class="diff-old">which
</del>
<var>
<ins class="diff-chg">propertyNames
</ins></var><ins class="diff-chg">
add
a
property
with
key
</ins><var><ins class="diff-chg">
name
</ins></var><ins class="diff-chg">
and
</ins>
the
<ins class="diff-new">value
</ins>
<code>
<del class="diff-old">invoke()
method
is
provided
to
define
</del>
<ins class="diff-chg">null
</ins></code>.</li><li><ins class="diff-chg">
Make
</ins>
a
<del class="diff-old">local
method
</del>
<ins class="diff-chg">request
</ins>
to
<del class="diff-old">run
</del>
the
<del class="diff-old">defined
Action
</del>
<ins class="diff-chg">underlying
platform
(via
the
</ins><a href= "#dfn-protocol-bindings" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Protocol
Bindings
</ins>
</a>
<del class="diff-old">s,
</del>
<ins class="diff-chg">)
to
retrieve
the
value
of
the
all
the
</ins><a href="#dfn-properties" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
definitions
from
the
</ins><a href="#dfn-td" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
TD
</ins></a><ins class="diff-chg">
with
optional
URI
templates
given
in
</ins><var><ins class="diff-chg">
options.uriVariables
</ins></var>.
</li>
<li>
<del class="diff-old">the
events
property
to
</del>
<ins class="diff-chg">If
this
cannot
</ins>
be
<del class="diff-old">an
object
</del>
<ins class="diff-chg">done
</ins>
with
<del class="diff-old">all
properties
being
ExposedEvent
</del>
<ins class="diff-chg">a
single
request
with
the
</ins><a href= "#dfn-protocol-bindings" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Protocol
Bindings
</ins>
</a>
<del class="diff-old">objects
in
which
</del>
<ins class="diff-chg">of
</ins>
the
<a href="#dfn-things" class= "internalDFN" data-link-type="dfn">
<ins class="diff-new">Thing
</ins></a>,<ins class="diff-new">
then
reject
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
</ins>
<code>
<del class="diff-old">emit()
</del>
<ins class="diff-chg">NotSupportedError
</ins>
</code>
<del class="diff-old">method
is
provided
to
define
a
local
way
to
trigger
sending
notifications
to
all
subscribed
clients,
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins>
</li>
<li>
<ins class="diff-new">If
the
request
fails,
reject
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
the
error
received
from
the
</ins><a href="#dfn-protocol-bindings" class= "internalDFN" data-link-type="dfn"><ins class="diff-new">
Protocol
Bindings
</ins></a>
and
<del class="diff-old">initialize
</del>
<ins class="diff-chg">terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Process
</ins>
the
<del class="diff-old">other
</del>
<ins class="diff-chg">reply
and
update
all
</ins>
properties
<del class="diff-old">as
initialized
from
</del>
<ins class="diff-chg">in
</ins>
<var>
<del class="diff-old">model
.
</del>
<ins class="diff-chg">result
</ins></var><ins class="diff-chg">
with
the
values
obtained
in
the
reply.
</ins>
</li>
<li>
<del class="diff-old">Return
</del>
<ins class="diff-chg">Resolve
</ins>
<var>
<del class="diff-old">thing
</del>
<ins class="diff-chg">promise
</ins></var><ins class="diff-chg">
with
</ins><var><ins class="diff-chg">
result
</ins>
</var>.
</li>
</ol>
</div>
</section>
<section id="the-writeproperty-method">
<h3 id="x6-8-the-writeproperty-method">
<bdi class="secno">
<ins class="diff-chg">6.8
</ins></bdi>
The
<del class="diff-old">TD
parsing
algorithm
</del>
<dfn data-dfn-type="method" data-export="" id= "dom-consumedthing-writeproperty" data-idl="operation" data-title= "writeProperty()" data-dfn-for="ConsumedThing" data-type="Promise" data-lt= "ConsumedThing.writeProperty()|ConsumedThing.writeProperty|writeProperty()|writeProperty">
<code>
<ins class="diff-chg">writeProperty()
</ins></code>
</dfn>
<del class="diff-old">takes
</del>
<ins class="diff-chg">method
</ins><a class="self-link" aria-label="§" href="#the-writeproperty-method"></a></h3><div><p><ins class="diff-chg">
Writes
a
single
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a>.<ins class="diff-chg">
Takes
</ins>
a
string
<ins class="diff-new">argument
</ins>
<var>
<del class="diff-old">td
as
</del>
<ins class="diff-chg">propertyName
</ins></var>,<ins class="diff-chg">
a
value
</ins>
argument
<var>
<ins class="diff-new">value
</ins></var>
and
<del class="diff-old">runs
</del>
<ins class="diff-chg">an
optional
</ins><a href="#dom-interactionoptions" class="internalDFN" data-link-type="idl"><code><ins class="diff-chg">
InteractionOptions
</ins></code></a><var><ins class="diff-chg">
options
</ins></var><ins class="diff-chg">
argument.
It
returns
success
or
failure.
The
method
</ins><em class="rfc2119" title="MUST"><ins class="diff-chg">
MUST
</ins></em><ins class="diff-chg">
run
</ins>
the
following
steps:
</p>
<ol>
<li>
<del class="diff-old">Parse
</del>
<ins class="diff-chg">Return
a
</ins><a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects"><ins class="diff-chg">
Promise
</ins></a>
<var>
<del class="diff-old">td
</del>
<ins class="diff-chg">promise
</ins>
</var>
<del class="diff-old">according
to
</del>
<ins class="diff-chg">and
execute
</ins>
the
<del class="diff-old">WoT
Thing
Description
</del>
<ins class="diff-chg">next
steps
</ins><a data-link-type= "dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel">
in
<del class="diff-old">order
to
produce
a
JSON
object
</del>
<ins class="diff-chg">parallel
</ins></a>.</li><li><ins class="diff-chg">
If
invoking
this
method
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins><code><ins class="diff-chg">
SecurityError
</ins></code><ins class="diff-chg">
and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Run
the
</ins><a href="#dfn-validate-property-value" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
validate
Property
value
</ins>
</a>
<ins class="diff-new">steps
on
</ins>
<var>
<del class="diff-old">json
</del>
<ins class="diff-chg">value
</ins>
</var>.
<del class="diff-old">Update
</del>
<ins class="diff-chg">If
that
fails,
reject
</ins><a data-link-type= "dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects"><ins class="diff-chg">
promise
</ins></a><ins class="diff-chg">
with
</ins><code><ins class="diff-chg">
SyntaxError
</ins></code><ins class="diff-chg">
and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Make
a
request
to
the
underlying
platform
(via
the
</ins><a href= "#dfn-protocol-bindings" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Protocol
Bindings
</ins></a><ins class="diff-chg">
)
to
write
</ins>
<var>
<del class="diff-old">thing
</del>
<ins class="diff-chg">value
</ins>
</var>
<del class="diff-old">with
</del>
<ins class="diff-chg">to
</ins>
the
<del class="diff-old">properties
and
values
defined
</del>
<a href="#dfn-properties" class="internalDFN" data-link-type= "dfn">
<ins class="diff-chg">Property
</ins></a><ins class="diff-chg">
given
by
</ins><var><ins class="diff-chg">
propertyName
</ins></var><ins class="diff-chg">
with
optional
URI
templates
given
</ins>
in
<var>
<del class="diff-old">json
</del>
<ins class="diff-chg">options.uriVariables
</ins>
</var>.
</li>
<li>
If
<del class="diff-old">there
was
an
error
during
</del>
the
<del class="diff-old">parsing,
throw
that
</del>
<ins class="diff-chg">request
fails,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
the
</ins>
error
<ins class="diff-new">received
from
the
</ins><a href="#dfn-protocol-bindings" class= "internalDFN" data-link-type="dfn"><ins class="diff-new">
Protocol
Bindings
</ins></a>
and
terminate
these
steps.
</li>
<li>
Otherwise
<del class="diff-old">return
</del>
<ins class="diff-chg">resolve
</ins>
<var>
<del class="diff-old">json
</del>
<ins class="diff-chg">promise
</ins>
</var>.
</li>
</ol>
</div>
</section>
<section id="the-writemultipleproperties-method">
<h3 id="x6-9-the-writemultipleproperties-method">
<del class="diff-old">3.5
</del>
<bdi class= "secno">
<ins class="diff-chg">6.9
</ins></bdi>
The
<dfn data-dfn-type="method" data-export="" id="dom-consumedthing-writemultipleproperties" data-idl="operation" data-title="writeMultipleProperties()" data-dfn-for="ConsumedThing" data-type="Promise" data-lt= "ConsumedThing.writeMultipleProperties()|ConsumedThing.writeMultipleProperties|writeMultipleProperties()|writeMultipleProperties">
<code>
<del class="diff-old">register()
</del>
<ins class="diff-chg">writeMultipleProperties()
</ins>
</code>
</dfn>
method
<a class= "self-link" aria-label="§" href= "#the-writemultipleproperties-method">
</a>
</h3>
<div>
<p>
<ins class="diff-new">Writes
a
multiple
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Property
</ins></a><ins class="diff-new">
values
with
one
request.
</ins>
Takes
<del class="diff-old">two
mandatory
arguments:
directory
denoting
</del>
a
<del class="diff-old">Thing
Directory
,
and
thing
denoting
</del>
<var>
<ins class="diff-chg">properties
</ins></var><ins class="diff-chg">
argument
as
</ins>
an
<del class="diff-old">ExposedThing
object.
Generate
the
Thing
Description
</del>
<ins class="diff-chg">object
with
keys
being
</ins><a href="#dfn-properties" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Property
</ins>
</a>
<ins class="diff-new">names
and
values
</ins>
as
<del class="diff-old">td
,
given
the
Properties
,
Action
</del>
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Property
</ins>
</a>
<del class="diff-old">s
</del>
<ins class="diff-chg">values
</ins>
and
<del class="diff-old">Event
s
defined
for
this
</del>
<ins class="diff-chg">an
optional
</ins><a href="#dom-interactionoptions" class="internalDFN" data-link-type="idl">
<code>
<del class="diff-old">ExposedThing
</del>
<ins class="diff-chg">InteractionOptions
</ins>
</code>
</a>
<del class="diff-old">object.
Then
make
a
request
to
register
</del>
<var>
<del class="diff-old">td
</del>
<ins class="diff-chg">options
</ins>
</var>
<del class="diff-old">to
the
given
WoT
Thing
Directory
.
3.6
</del>
<ins class="diff-chg">argument.
It
returns
success
or
failure.
</ins>
The
<del class="diff-old">unregister()
</del>
method
<del class="diff-old">Takes
two
mandatory
arguments:
</del>
<em class="rfc2119" title="MUST">
<ins class="diff-chg">MUST
</ins></em><ins class="diff-chg">
run
the
following
steps:
</ins>
</p>
<ol>
<li>
<del class="diff-old">directory
denoting
</del>
<ins class="diff-chg">Return
</ins>
a
<del class="diff-old">Thing
Directory
,
</del>
<a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects">
<ins class="diff-chg">Promise
</ins></a><var><ins class="diff-chg">
promise
</ins></var>
and
<ins class="diff-new">execute
the
next
steps
</ins><a data-link-type= "dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-new">
in
parallel
</ins></a>.
</li>
<li>
<ins class="diff-chg">If
invoking
this
method
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
<code>
<del class="diff-old">thing
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
<del class="diff-old">denoting
an
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
For
each
key
</ins><var><ins class="diff-chg">
name
</ins></var><ins class="diff-chg">
on
</ins><var><ins class="diff-chg">
properties
</ins></var>,<ins class="diff-chg">
take
its
value
as
</ins><var><ins class="diff-chg">
value
</ins></var><ins class="diff-chg">
and
run
the
</ins><a href= "#dfn-validate-property-value" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
validate
Property
value
</ins></a><ins class="diff-chg">
steps
on
</ins><var><ins class="diff-chg">
value
</ins></var>.<ins class="diff-chg">
If
that
fails
in
for
any
</ins><var><ins class="diff-chg">
name
</ins></var>,<ins class="diff-chg">
reject
</ins><a data-link-type= "dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects"><ins class="diff-chg">
promise
</ins></a><ins class="diff-chg">
with
</ins>
<code>
<del class="diff-old">ExposedThing
</del>
<ins class="diff-chg">SyntaxError
</ins>
</code>
<del class="diff-old">object.
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins>
</li>
<del class="diff-old">Makes
</del>
<li>
<ins class="diff-chg">Make
</ins>
a
<ins class="diff-new">single
</ins>
request
to
<del class="diff-old">unregister
</del>
the
<del class="diff-old">thing
from
</del>
<ins class="diff-chg">underlying
platform
(via
</ins>
the
<del class="diff-old">given
WoT
Thing
Directory
.
3.7
Examples
Example
1
</del>
<a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Protocol
Bindings
</ins>
</a>
<del class="diff-old">:
Discover
Things
via
directory
&lt;span class=
"hljs-keyword"&gt;let discoveryFilter = {
  : &lt;span class=
"hljs-string"&gt;"directory",
  : &lt;span class=
"hljs-string"&gt;"http://directory.wotservice.org"
};
&lt;span class=
"hljs-keyword"&gt;let subscription = wot.discover(discoveryFilter).subscribe(
  &lt;span class=
"hljs-params"&gt;td {
    .log(&lt;span class=
"hljs-string"&gt;"Found Thing " + td.name);
    &lt;span class=
"hljs-comment"&gt;// fetch the TD and create a ConsumedThing
     thing = wot.consume(td);
  },
  error =&gt; { &lt;span class=
"hljs-built_in"&gt;console.log(&lt;span class=
"hljs-string"&gt;"Discovery finished because an error: " + error.message); },
  () =&gt; { &lt;span class=
"hljs-built_in"&gt;console.log(&lt;span class=
"hljs-string"&gt;"Discovery finished successfully");}
);
setTimeout( &lt;span class=
"hljs-params"&gt;() {
    subscription.unsubscribe();
    .log(&lt;span class=
"hljs-string"&gt;"Discovery timeout");
  },
5000
);
Example
2
</del>
<ins class="diff-chg">)
to
write
the
each
</ins><a href="#dfn-properties" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Property
</ins>
</a>
<del class="diff-old">:
Discover
Things
exposed
by
local
hardware
&lt;span class=
"hljs-keyword"&gt;let }).subscribe(
  &lt;span class=
"hljs-params"&gt;td { &lt;span class=
"hljs-built_in"&gt;console.log(&lt;span class=
"hljs-string"&gt;"Found local Thing " + td.name); },
  error =&gt; { &lt;span class=
"hljs-built_in"&gt;console.log(&lt;span class=
"hljs-string"&gt;"Discovery error: " + error.message); },
  () =&gt; { &lt;span class=
"hljs-built_in"&gt;console.log(&lt;span class=
"hljs-string"&gt;"Discovery finished successfully");}
);
Example
3
</del>
<ins class="diff-chg">provided
in
</ins><var><ins class="diff-chg">
properties
</ins></var><ins class="diff-chg">
with
optional
URI
templates
given
in
</ins><var><ins class="diff-chg">
options.uriVariables
</ins></var>.</li><li><ins class="diff-chg">
If
this
cannot
be
done
with
a
single
request
with
the
</ins><a href= "#dfn-protocol-bindings" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Protocol
Bindings
</ins>
</a>
<del class="diff-old">:
Same
as
above
but
</del>
<ins class="diff-chg">of
the
</ins><a href="#dfn-things" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a>,<ins class="diff-chg">
then
reject
</ins><var><ins class="diff-chg">
promise
</ins></var>
with
<del class="diff-old">different
Observable
syntax
&lt;span class=
"hljs-keyword"&gt;let }).subscribe({
  td =&gt; { &lt;span class=
"hljs-built_in"&gt;console.log(&lt;span class=
"hljs-string"&gt;"Found local Thing " + td.name); },
  : &lt;span class=
"hljs-function"&gt;&lt;span class=
"hljs-params"&gt;err { &lt;span class=
"hljs-built_in"&gt;console.log(&lt;span class=
"hljs-string"&gt;"Discovery error: " + err.message); },
  : &lt;span class=
"hljs-function"&gt;&lt;span class=
"hljs-params"&gt;() { &lt;span class=
"hljs-built_in"&gt;console.log(&lt;span class=
"hljs-string"&gt;"Discovery finished successfully");}
});
</del>
<code>
<ins class="diff-chg">NotSupportedError
</ins></code><ins class="diff-chg">
and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
If
the
request
fails,
return
the
error
received
from
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins></a><ins class="diff-chg">
and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Otherwise
resolve
</ins><var><ins class="diff-chg">
promise
</ins></var>.</li></ol>
</div>
</section>
<section id="the-wotlistener-callback">
<h3 id="x6-10-the-wotlistener-callback">
<del class="diff-old">4.
</del>
<bdi class= "secno">
<ins class="diff-chg">6.10
</ins></bdi>
The
<dfn data-dfn-type="callback" data-export="" id="dom-wotlistener" data-idl="callback" data-title= "WotListener">
<code>
<del class="diff-old">ConsumedThing
</del>
<ins class="diff-chg">WotListener
</ins>
</code>
</dfn>
<del class="diff-old">interface
</del>
<ins class="diff-chg">callback
</ins><a class= "self-link" aria-label="§" href= "#the-wotlistener-callback">
</a>
</h3>
<p>
<del class="diff-old">Represents
an
object
</del>
<ins class="diff-chg">User
provided
callback
</ins>
that
<del class="diff-old">extends
a
</del>
<ins class="diff-chg">takes
</ins>
<code>
<del class="diff-old">ThingFragment
</del>
<ins class="diff-chg">any
</ins>
</code>
<del class="diff-old">with
methods
for
client
interactions
(send
request
for
reading
and
writing
Properties
),
invoke
Action
s,
subscribe
</del>
<ins class="diff-chg">argument
</ins>
and
<del class="diff-old">unsubscribe
</del>
<ins class="diff-chg">is
used
</ins>
for
<ins class="diff-new">observing
</ins>
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
changes
and
<ins class="diff-chg">handling
</ins><a href= "#dfn-events" class="internalDFN" data-link-type="dfn">
Event
</a>
<del class="diff-old">s.
</del>
<ins class="diff-chg">notifications.
Since
subscribing
to
these
are
WoT
interactions,
they
are
not
modelled
with
software
events.
</ins>
</p>
<del class="diff-old">&lt;span class="idlInterface" id=
"idl-def-consumedthing" data-idl="" data-title=
"ConsumedThing"&gt;interface &lt;span class=
"idlInterfaceID"&gt;&lt;a data-no-default="" data-link-for="" data-lt=""
href="#dom-consumedthing" class="internalDFN" data-link-type=
"dfn"&gt; : &lt;span class=
"idlSuperclass"&gt;&lt;a href="#dom-thingfragment" class="internalDFN"
data-link-type=
"dfn"&gt; {&lt;span class=
"idlAttribute" id="idl-def-consumedthing-id" data-idl=""
data-title="id" data-dfn-for="consumedthing"&gt;
  readonly attribute &lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString&lt;a data-no-default=""
data-link-for="consumedthing" data-lt="consumedthing.id|id" href=
"#dom-consumedthing-id" class="internalDFN" data-link-type=
"dfn"&gt;&lt;span class="idlAttribute"
id="idl-def-consumedthing-name" data-idl="" data-title="name"
data-dfn-for="consumedthing"&gt;
  readonly attribute &lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString&lt;a data-no-default=""
data-link-for="consumedthing" data-lt="consumedthing.name|name"
href="#dom-consumedthing-name" class="internalDFN" data-link-type=
"dfn"&gt;&lt;span class=
"idlAttribute" id="idl-def-consumedthing-base" data-idl=""
data-title="base" data-dfn-for="consumedthing"&gt;
  readonly attribute &lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString&lt;a data-no-default=""
data-link-for="consumedthing" data-lt="consumedthing.base|base"
href="#dom-consumedthing-base" class="internalDFN" data-link-type=
"dfn"&gt;&lt;span class=
"idlAttribute" id="idl-def-consumedthing-properties" data-idl=""
data-title="properties" data-dfn-for="consumedthing"&gt;
  readonly attribute &lt;a data-link-for=""
href="#dom-propertymap" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlAttrName"&gt;&lt;a data-no-default="" data-link-for="consumedthing"
data-lt="consumedthing.properties|properties" href=
"#dom-consumedthing-properties" class="internalDFN" data-link-type=
"dfn"&gt;&lt;span class=
"idlAttribute" id="idl-def-consumedthing-actions" data-idl=""
data-title="actions" data-dfn-for="consumedthing"&gt;
  readonly attribute &lt;a data-link-for=""
href="#dom-actionmap" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlAttrName"&gt;&lt;a data-no-default="" data-link-for="consumedthing"
data-lt="consumedthing.actions|actions" href=
"#dom-consumedthing-actions" class="internalDFN" data-link-type=
"dfn"&gt;&lt;span class=
"idlAttribute" id="idl-def-consumedthing-events" data-idl=""
data-title="events" data-dfn-for="consumedthing"&gt;
  readonly attribute &lt;a data-link-for=""
href="#dom-eventmap" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlAttrName"&gt;&lt;a data-no-default="" data-link-for="consumedthing"
data-lt="consumedthing.events|events" href=
"#dom-consumedthing-events" class="internalDFN" data-link-type=
"dfn"&gt;&lt;span class="idlMethod"
id="idl-def-consumedthing--name" data-idl="" data-title=""
data-dfn-for="consumedthing"&gt;
  // getter for ThingFragment properties
   &lt;a href=
"https://heycam.github.io/webidl/#idl-any"&gt;any
};&lt;span class="idlInterface" id="idl-def-propertymap"
data-idl="" data-title="PropertyMap"&gt;
[&lt;a href=
"https://heycam.github.io/webidl/#NoInterfaceObject"&gt;NoInterfaceObject]
interface &lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-propertymap" class=
"internalDFN" data-link-type=
"dfn"&gt; {&lt;span class="idlMaplike"
id="idl-def-propertymap-maplike" data-idl="" data-title="iterable"
data-dfn-for="propertymap"&gt;
  readonly maplike&lt;&lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString, &lt;a data-link-for=""
href="#dom-thingproperty" class="internalDFN" data-link-type=
"dfn"&gt;
};&lt;span class="idlInterface" id="idl-def-actionmap"
data-idl="" data-title="ActionMap"&gt;
[&lt;a href=
"https://heycam.github.io/webidl/#NoInterfaceObject"&gt;NoInterfaceObject]
interface &lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-actionmap" class=
"internalDFN" data-link-type=
"dfn"&gt; {&lt;span class="idlMaplike"
id="idl-def-actionmap-maplike" data-idl="" data-title="iterable"
data-dfn-for="actionmap"&gt;
  readonly maplike&lt;&lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString, &lt;a data-link-for=""
href="#dom-thingaction" class="internalDFN" data-link-type=
"dfn"&gt;
};&lt;span class="idlInterface" id="idl-def-eventmap" data-idl=
"" data-title="EventMap"&gt;
[&lt;a href=
"https://heycam.github.io/webidl/#NoInterfaceObject"&gt;NoInterfaceObject]
interface &lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-eventmap" class=
"internalDFN" data-link-type=
"dfn"&gt; {&lt;span class="idlMaplike"
id="idl-def-eventmap-maplike" data-idl="" data-title="iterable"
data-dfn-for="eventmap"&gt;
  readonly maplike&lt;&lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString, &lt;a data-link-for=""
href="#dom-thingevent" class="internalDFN" data-link-type=
"dfn"&gt;
};
&lt;a href="#dom-consumedthing" class="internalDFN" data-link-type=
"dfn"&gt; includes &lt;a href=
"#dom-observable" class="internalDFN" data-link-type=
"dfn"&gt;&lt;span class=
"idlSectionComment"&gt;
//
for
TD
changes
</del>
</section>
<section id="the-observeproperty-method">
<h3 id="x6-11-the-observeproperty-method">
<bdi class= "secno">
<ins class="diff-chg">6.11
</ins></bdi>
The
<dfn data-dfn-type="method" data-export="" id="dom-consumedthing-observeproperty" data-idl="operation" data-title="observeProperty()" data-dfn-for="ConsumedThing" data-type="Promise" data-lt= "ConsumedThing.observeProperty()|ConsumedThing.observeProperty|observeProperty()|observeProperty">
<code>
<del class="diff-old">id
</del>
<ins class="diff-chg">observeProperty()
</ins>
</code>
</dfn>
<del class="diff-old">attribute
represents
the
unique
identifier
of
the
Thing
instance,
typically
a
URI,
IRI,
or
URN
as
USVString
.
The
name
</del>
<ins class="diff-chg">method
</ins><a class="self-link" aria-label="§" href="#the-observeproperty-method">
<del class="diff-old">attribute
represents
the
name
of
the
Thing
</del>
</a>
<del class="diff-old">as
DOMString
.
The
base
</del>
<del class="diff-old">attribute
represents
the
base
URI
that
is
valid
for
all
defined
local
interaction
resources.
</del>
</h3>
<div>
<p>
<del class="diff-old">The
properties
attribute
represents
</del>
<ins class="diff-chg">Makes
</ins>
a
<del class="diff-old">dictionary
of
ThingProperty
</del>
<ins class="diff-chg">request
for
</ins><a href="#dfn-properties" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins>
</a>
<del class="diff-old">items.
The
</del>
<ins class="diff-chg">value
change
notifications.
Takes
a
string
argument
</ins><var><ins class="diff-chg">
propertyName
</ins></var>,<ins class="diff-chg">
a
</ins><a href="#dom-wotlistener" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">PropertyMap
</del>
<ins class="diff-chg">WotListener
</ins>
</code>
<del class="diff-old">interface
represents
a
maplike
dictionary
where
all
values
are
</del>
</a>
<ins class="diff-chg">callback
function
</ins><var><ins class="diff-chg">
listener
</ins></var><ins class="diff-chg">
and
an
optional
</ins><a href= "#dom-interactionoptions" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">ThingProperty
</del>
<ins class="diff-chg">InteractionOptions
</ins>
</code>
</a>
<del class="diff-old">objects.
</del>
<var>
<ins class="diff-chg">options
</ins></var><ins class="diff-chg">
argument.
It
returns
success
or
failure.
</ins>
The
<ins class="diff-new">method
</ins><em class= "rfc2119" title="MUST"><ins class="diff-new">
MUST
</ins></em><ins class="diff-new">
run
the
following
steps:
</ins></p><ol><li><ins class="diff-new">
Return
a
</ins><a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects"><ins class="diff-new">
Promise
</ins></a><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
and
execute
the
next
steps
</ins><a data-link-type= "dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-new">
in
parallel
</ins></a>.</li><li><ins class="diff-new">
If
invoking
this
method
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
reject
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
</ins>
<code>
<del class="diff-old">read()
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
and
<ins class="diff-new">terminate
these
steps.
</ins></li><li><ins class="diff-new">
If
</ins><var><ins class="diff-new">
listener
</ins></var><ins class="diff-new">
is
not
a
function,
reject
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
</ins>
<code>
<del class="diff-old">write()
</del>
<ins class="diff-chg">"TypeError"
</ins>
</code>
<del class="diff-old">methods
make
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Make
</ins>
a
request
to
<del class="diff-old">access
</del>
the
<ins class="diff-new">underlying
platform
(via
the
</ins><a href= "#dfn-protocol-bindings" class="internalDFN" data-link-type= "dfn"><ins class="diff-new">
Protocol
Bindings
</ins></a><ins class="diff-new">
)
to
observe
</ins>
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
<del class="diff-old">Properties
</del>
<ins class="diff-chg">Property
</ins>
</a>
<del class="diff-old">on
</del>
<ins class="diff-chg">identified
by
</ins><var><ins class="diff-chg">
propertyName
</ins></var><ins class="diff-chg">
with
optional
URI
templates
given
in
</ins><var><ins class="diff-chg">
options.uriVariables
</ins></var>.</li><li><ins class="diff-chg">
If
</ins>
the
<del class="diff-old">remote
Thing
</del>
<ins class="diff-chg">request
fails,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
the
error
received
from
the
</ins><a href="#dfn-protocol-bindings" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins>
</a>
<del class="diff-old">represented
by
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Otherwise
resolve
</ins><var><ins class="diff-chg">
promise
</ins></var>.</li><li><ins class="diff-chg">
Whenever
the
underlying
platform
receives
a
notification
for
</ins>
this
<del class="diff-old">ConsumedThing
</del>
<ins class="diff-chg">subscription
with
new
</ins><a href="#dfn-properties" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins>
</a>
<del class="diff-old">proxy
object.
The
</del>
<ins class="diff-chg">value
</ins><var><ins class="diff-chg">
value
</ins></var>,<ins class="diff-chg">
run
the
following
sub-steps:
</ins><ul><li><ins class="diff-chg">
If
running
the
</ins><a href="#dfn-validate-property-value" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
validate
Property
value
</ins></a><ins class="diff-chg">
steps
on
</ins><var><ins class="diff-chg">
value
</ins></var><ins class="diff-chg">
fails,
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Invoke
</ins><var><ins class="diff-chg">
listener
</ins></var><ins class="diff-chg">
with
</ins><var><ins class="diff-chg">
value
</ins></var><ins class="diff-chg">
as
parameter.
</ins></li></ul></li></ol></div></section><section id="the-unobserveproperty-method"><h3 id="x6-12-the-unobserveproperty-method">
<bdi class= "secno">
<ins class="diff-new">6.12
</ins></bdi><ins class="diff-new">
The
</ins><dfn data-dfn-type="method" data-export="" id="dom-consumedthing-unobserveproperty" data-idl="operation" data-title="unobserveProperty()" data-dfn-for="ConsumedThing" data-type="Promise" data-lt= "ConsumedThing.unobserveProperty()|ConsumedThing.unobserveProperty|unobserveProperty()|unobserveProperty">
<code>
<del class="diff-old">actions
</del>
<ins class="diff-chg">unobserveProperty()
</ins>
</code>
</dfn>
<del class="diff-old">attribute
represents
a
dictionary
of
ThingAction
</del>
<ins class="diff-chg">method
</ins><a class="self-link" aria-label="§" href="#the-unobserveproperty-method">
</a>
<del class="diff-old">items.
The
ActionMap
</del>
<del class="diff-old">interface
represents
</del>
</h3>
<div>
<p>
<ins class="diff-chg">Makes
</ins>
a
<del class="diff-old">maplike
dictionary
where
all
values
are
ThingAction
</del>
<ins class="diff-chg">request
for
unsubscribing
from
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins>
</a>
<del class="diff-old">objects.
</del>
<ins class="diff-chg">value
change
notifications.
Takes
a
string
argument
</ins><var><ins class="diff-chg">
propertyName
</ins></var><ins class="diff-chg">
and
returns
success
or
failure.
</ins>
The
<del class="diff-old">invoke()
</del>
method
<del class="diff-old">represents
a
request
to
invoke
the
Action
on
</del>
<em class="rfc2119" title= "MUST">
<ins class="diff-chg">MUST
</ins></em><ins class="diff-chg">
run
</ins>
the
<del class="diff-old">remote
Thing
.
</del>
<ins class="diff-chg">following
steps:
</ins>
</p>
<del class="diff-old">The
events
attribute
represents
</del>
<ol>
<li>
<ins class="diff-chg">Return
</ins>
a
<del class="diff-old">dictionary
of
ThingEvent
</del>
<a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects">
<ins class="diff-chg">Promise
</ins>
</a>
<del class="diff-old">items.
The
</del>
<var>
<ins class="diff-chg">promise
</ins></var><ins class="diff-chg">
and
execute
the
next
steps
</ins><a data-link-type= "dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-chg">
in
parallel
</ins></a>.</li><li><ins class="diff-chg">
If
invoking
this
method
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
<code>
<del class="diff-old">EventMap
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
<del class="diff-old">interface
represents
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Make
</ins>
a
<del class="diff-old">maplike
dictionary
where
all
values
are
ThingEvent
objects.
Subscribing
</del>
<ins class="diff-chg">request
</ins>
to
the
<del class="diff-old">events
involves
setting
up
an
observation
(subscription)
mechanism
on
</del>
<ins class="diff-chg">underlying
platform
(via
</ins>
the
<del class="diff-old">remote
object.
4.1
Examples
</del>
<a href= "#dfn-protocol-bindings" class="internalDFN" data-link-type= "dfn">
<ins class="diff-chg">Protocol
Bindings
</ins>
</a>
<del class="diff-old">Below
a
ConsumedThing
</del>
<ins class="diff-chg">)
to
stop
observing
the
</ins><a href= "#dfn-properties" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Property
</ins>
</a>
<del class="diff-old">interface
example
is
given.
Example
4
</del>
<ins class="diff-chg">identified
by
</ins><var><ins class="diff-chg">
propertyName
</ins></var>.</li><li><ins class="diff-chg">
If
the
request
fails,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
the
error
received
from
the
</ins><a href="#dfn-protocol-bindings" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins>
</a>
<del class="diff-old">:
Consume
a
Thing
&lt;span class=
"hljs-keyword"&gt;try {
  &lt;span class=
"hljs-keyword"&gt;let }).subscribe(
    &lt;span class=
"hljs-params"&gt;td {
      &lt;span class=
"hljs-keyword"&gt;let thing = wot.consume(td);
      .log(&lt;span class=
"hljs-string"&gt;"Thing " + thing.name + &lt;span class=
"hljs-string"&gt;" has been consumed.");
      &lt;span class=
"hljs-keyword"&gt;let subscription = thing[&lt;span class=
"hljs-string"&gt;"temperature"].subscribe(&lt;span class=
"hljs-function"&gt;&lt;span class=
"hljs-keyword"&gt;function(&lt;span class=
"hljs-params"&gt;value{
          &lt;span class=
"hljs-built_in"&gt;console.log(&lt;span class=
"hljs-string"&gt;"Temperature: " + value);
        });
      thing.actions[&lt;span class=
"hljs-string"&gt;"startMeasurement"].invoke({ &lt;span class=
"hljs-attr"&gt;units: &lt;span class=
"hljs-string"&gt;"Celsius" })
        .then(&lt;span class=
"hljs-params"&gt;() { &lt;span class=
"hljs-built_in"&gt;console.log(&lt;span class=
"hljs-string"&gt;"Temperature measurement started."); })
        .catch(&lt;span class=
"hljs-params"&gt;e {
           &lt;span class=
"hljs-built_in"&gt;console.log(&lt;span class=
"hljs-string"&gt;"Error starting measurement.");
           subscription.unsubscribe();
         })
    },
    error =&gt; { &lt;span class=
"hljs-built_in"&gt;console.log(&lt;span class=
"hljs-string"&gt;"Discovery error: " + error.message); },
    () =&gt; { &lt;span class=
"hljs-built_in"&gt;console.log(&lt;span class=
"hljs-string"&gt;"Discovery finished successfully");}
  );
} (error) {
  .log(&lt;span class=
"hljs-string"&gt;"Error: " + error.message);
};
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Otherwise
resolve
</ins><var><ins class="diff-chg">
promise
</ins></var>.</li></ol>
</div>
</section>
<section id="the-invokeaction-method">
<h3 id="x6-13-the-invokeaction-method">
<del class="diff-old">5.
</del>
<bdi class= "secno">
<ins class="diff-chg">6.13
</ins></bdi>
The
<dfn data-dfn-type="method" data-export="" id="dom-consumedthing-invokeaction" data-idl="operation" data-title="invokeAction()" data-dfn-for="ConsumedThing" data-type= "Promise" data-lt= "ConsumedThing.invokeAction()|ConsumedThing.invokeAction|invokeAction()|invokeAction">
<code>
<del class="diff-old">ExposedThing
</del>
<ins class="diff-chg">invokeAction()
</ins>
</code>
</dfn>
<del class="diff-old">interface
</del>
<ins class="diff-chg">method
</ins><a class="self-link" aria-label="§" href="#the-invokeaction-method">
</a>
</h3>
<div>
<p>
<del class="diff-old">The
ExposedThing
interface
is
the
server
API
that
allows
defining
</del>
<ins class="diff-chg">Makes
a
</ins>
request
<del class="diff-old">handlers,
properties,
Actions
,
and
Events
</del>
<ins class="diff-chg">for
invoking
an
</ins><a href="#dfn-actions" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
Action
</ins>
</a>
<del class="diff-old">to
a
Thing
.
It
also
implements
</del>
<ins class="diff-chg">and
return
</ins>
the
<ins class="diff-chg">result.
Takes
a
string
argument
</ins><var><ins class="diff-chg">
actionName
</ins></var>,<ins class="diff-chg">
an
optional
argument
</ins><var><ins class="diff-chg">
params
</ins></var><ins class="diff-chg">
of
type
</ins>
<code>
<del class="diff-old">Observable
</del>
<ins class="diff-chg">any
</ins>
</code>
<del class="diff-old">interface.
An
</del>
<ins class="diff-chg">and
an
optional
</ins><a href="#dom-interactionoptions" class="internalDFN" data-link-type="idl">
<code>
<del class="diff-old">ExposedThing
</del>
<ins class="diff-chg">InteractionOptions
</ins>
</code>
</a>
<del class="diff-old">is
created
by
</del>
<var>
<ins class="diff-chg">options
</ins></var><ins class="diff-chg">
argument.
It
returns
</ins>
the
<del class="diff-old">produce()
method.
&lt;span class="idlInterface" id=
"idl-def-exposedthing" data-idl="" data-title=
"ExposedThing"&gt;interface &lt;span class=
"idlInterfaceID"&gt;&lt;a data-no-default="" data-link-for="" data-lt=""
href="#dom-exposedthing" class="internalDFN" data-link-type=
"dfn"&gt; : &lt;span class=
"idlSuperclass"&gt;&lt;a href="#dom-thingfragment" class="internalDFN"
data-link-type=
"dfn"&gt; {&lt;span class=
"idlAttribute" id="idl-def-exposedthing-properties" data-idl=""
data-title="properties" data-dfn-for="exposedthing"&gt;
  readonly attribute &lt;a data-link-for=""
href="#dom-propertymap" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlAttrName"&gt;&lt;a data-no-default="" data-link-for="exposedthing"
data-lt="exposedthing.properties|properties" href=
"#dom-exposedthing-properties" class="internalDFN" data-link-type=
"dfn"&gt;&lt;span class=
"idlAttribute" id="idl-def-exposedthing-actions" data-idl=""
data-title="actions" data-dfn-for="exposedthing"&gt;
  readonly attribute &lt;a data-link-for=""
href="#dom-actionmap" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlAttrName"&gt;&lt;a data-no-default="" data-link-for="exposedthing"
data-lt="exposedthing.actions|actions" href=
"#dom-exposedthing-actions" class="internalDFN" data-link-type=
"dfn"&gt;&lt;span class=
"idlAttribute" id="idl-def-exposedthing-events" data-idl=""
data-title="events" data-dfn-for="exposedthing"&gt;
  readonly attribute &lt;a data-link-for=""
href="#dom-exposedevents" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlAttrName"&gt;&lt;a data-no-default="" data-link-for="exposedthing"
data-lt="exposedthing.events|events" href=
"#dom-exposedthing-events" class="internalDFN" data-link-type=
"dfn"&gt;&lt;span class="idlMethod"
id="idl-def-exposedthing--name" data-idl="" data-title=""
data-dfn-for="exposedthing"&gt;
  // getter for ThingFragment properties
   &lt;a href=
"https://heycam.github.io/webidl/#idl-any"&gt;any&lt;span class="idlMethod"
id="idl-def-exposedthing--name-value" data-idl="" data-title=""
data-dfn-for="exposedthing"&gt;
  // setter for ThingFragment properties
   (&lt;span class=
"idlParam"&gt;&lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString&lt;span class="idlMethod"
id="idl-def-exposedthing-expose" data-idl="" data-title="expose"
data-dfn-for="exposedthing"&gt;&lt;span class=
"idlSectionComment"&gt;
  // methods to expose and destroy the Thing
  &lt;a href=
"https://heycam.github.io/webidl/#idl-promise"&gt;Promise&lt;a data-no-default=""
data-link-for="exposedthing" data-lt=
"exposedthing.expose()|exposedthing.expose|expose()|expose" href=
"#dom-exposedthing-expose" class="internalDFN" data-link-type=
"dfn"&gt;&lt;span class=
"idlMethod" id="idl-def-exposedthing-destroy" data-idl=""
data-title="destroy" data-dfn-for="exposedthing"&gt;&lt;span class=
"idlMethType"&gt;
  &lt;a href=
"https://heycam.github.io/webidl/#idl-promise"&gt;Promise&lt;a data-no-default=""
data-link-for="exposedthing" data-lt=
"exposedthing.destroy()|exposedthing.destroy|destroy()|destroy"
href="#dom-exposedthing-destroy" class="internalDFN"
data-link-type="dfn"&gt;&lt;span class="idlMethod"
id="idl-def-exposedthing-addproperty-name-property-initvalue"
data-idl="" data-title="addProperty" data-dfn-for=
"exposedthing"&gt;&lt;span class=
"idlSectionComment"&gt;
  // define Properties
  &lt;a data-link-for="" href="#dom-exposedthing" class=
"internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlMethName"&gt;&lt;a data-no-default="" data-link-for="exposedthing"
data-lt=
"exposedthing.addproperty()|exposedthing.addproperty|addproperty()|addproperty"
href="#dom-exposedthing-addproperty" class="internalDFN"
data-link-type=
"dfn"&gt;(&lt;span class=
"idlParam"&gt;&lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString &lt;a data-link-for=""
href="#dom-propertyfragment" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlParamName"&gt;property,&lt;span class=
"idlParam"&gt; optional &lt;a href=
"https://heycam.github.io/webidl/#idl-any"&gt;any&lt;span class="idlMethod"
id="idl-def-exposedthing-setpropertyreadhandler-name-readhandler"
data-idl="" data-title="setPropertyReadHandler" data-dfn-for=
"exposedthing"&gt;
  &lt;a data-link-for="" href="#dom-exposedthing" class="internalDFN"
data-link-type=
"dfn"&gt; &lt;span class=
"idlMethName"&gt;&lt;a data-no-default="" data-link-for="exposedthing"
data-lt=
"exposedthing.setpropertyreadhandler()|exposedthing.setpropertyreadhandler|setpropertyreadhandler()|setpropertyreadhandler"
href="#dom-exposedthing-setpropertyreadhandler" class="internalDFN"
data-link-type=
"dfn"&gt;(&lt;span class=
"idlParam"&gt;&lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString &lt;a data-link-for=""
href="#dom-propertyreadhandler" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlParamName"&gt;readHandler&lt;span class=
"idlMethod" id=
"idl-def-exposedthing-setpropertywritehandler-name-writehandler"
data-idl="" data-title="setPropertyWriteHandler" data-dfn-for=
"exposedthing"&gt;
  &lt;a data-link-for="" href="#dom-exposedthing" class="internalDFN"
data-link-type=
"dfn"&gt; &lt;span class=
"idlMethName"&gt;&lt;a data-no-default="" data-link-for="exposedthing"
data-lt=
"exposedthing.setpropertywritehandler()|exposedthing.setpropertywritehandler|setpropertywritehandler()|setpropertywritehandler"
href="#dom-exposedthing-setpropertywritehandler" class=
"internalDFN" data-link-type=
"dfn"&gt;(&lt;span class=
"idlParam"&gt;&lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString &lt;a data-link-for=""
href="#dom-propertywritehandler" class="internalDFN"
data-link-type="dfn"&gt;&lt;span class="idlMethod"
id="idl-def-exposedthing-removeproperty-name" data-idl=""
data-title="removeProperty" data-dfn-for=
"exposedthing"&gt;
  &lt;a data-link-for="" href="#dom-exposedthing" class="internalDFN"
data-link-type=
"dfn"&gt; &lt;span class=
"idlMethName"&gt;&lt;a data-no-default="" data-link-for="exposedthing"
data-lt=
"exposedthing.removeproperty()|exposedthing.removeproperty|removeproperty()|removeproperty"
href="#dom-exposedthing-removeproperty" class="internalDFN"
data-link-type=
"dfn"&gt;(&lt;span class=
"idlParam"&gt;&lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString&lt;span class="idlMethod"
id="idl-def-exposedthing-addaction-name-init-action" data-idl=""
data-title="addAction" data-dfn-for="exposedthing"&gt;&lt;span class=
"idlMethType"&gt;
  // define Actions
  &lt;a data-link-for="" href="#dom-exposedthing" class=
"internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlMethName"&gt;&lt;a data-no-default="" data-link-for="exposedthing"
data-lt=
"exposedthing.addaction()|exposedthing.addaction|addaction()|addaction"
href="#dom-exposedthing-addaction" class="internalDFN"
data-link-type="dfn"&gt;(&lt;span class=
"idlParam"&gt;&lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString &lt;a data-link-for=""
href="#dom-actionfragment" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlParamName"&gt;init,&lt;span class=
"idlParam"&gt; &lt;a data-link-for="" href=
"#dom-actionhandler" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlParamName"&gt;action&lt;span class="idlMethod"
id="idl-def-exposedthing-removeaction-name" data-idl="" data-title=
"removeAction" data-dfn-for="exposedthing"&gt;&lt;span class=
"idlMethType"&gt;
  &lt;a data-link-for="" href="#dom-exposedthing" class="internalDFN"
data-link-type=
"dfn"&gt; &lt;span class=
"idlMethName"&gt;&lt;a data-no-default="" data-link-for="exposedthing"
data-lt=
"exposedthing.removeaction()|exposedthing.removeaction|removeaction()|removeaction"
href="#dom-exposedthing-removeaction" class="internalDFN"
data-link-type=
"dfn"&gt;(&lt;span class=
"idlParam"&gt;&lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString&lt;span class="idlMethod"
id="idl-def-exposedthing-setactionhandler-name-action" data-idl=""
data-title="setActionHandler" data-dfn-for=
"exposedthing"&gt;
  &lt;a data-link-for="" href="#dom-exposedthing" class="internalDFN"
data-link-type=
"dfn"&gt; &lt;span class=
"idlMethName"&gt;&lt;a data-no-default="" data-link-for="exposedthing"
data-lt=
"exposedthing.setactionhandler()|exposedthing.setactionhandler|setactionhandler()|setactionhandler"
href="#dom-exposedthing-setactionhandler" class="internalDFN"
data-link-type=
"dfn"&gt;(&lt;span class=
"idlParam"&gt;&lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString &lt;a data-link-for=""
href="#dom-actionhandler" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlParamName"&gt;action&lt;span class="idlMethod"
id="idl-def-exposedthing-addevent-name-event" data-idl=""
data-title="addEvent" data-dfn-for="exposedthing"&gt;&lt;span class=
"idlMethType"&gt;
  // define Events
  &lt;a data-link-for="" href="#dom-exposedthing" class=
"internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlMethName"&gt;&lt;a data-no-default="" data-link-for="exposedthing"
data-lt=
"exposedthing.addevent()|exposedthing.addevent|addevent()|addevent"
href="#dom-exposedthing-addevent" class="internalDFN"
data-link-type="dfn"&gt;(&lt;span class=
"idlParam"&gt;&lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString &lt;a data-link-for=""
href="#dom-eventfragment" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlParamName"&gt;event&lt;span class="idlMethod"
id="idl-def-exposedthing-removeevent-name" data-idl="" data-title=
"removeEvent" data-dfn-for="exposedthing"&gt;&lt;span class=
"idlMethType"&gt;
  &lt;a data-link-for="" href="#dom-exposedthing" class="internalDFN"
data-link-type=
"dfn"&gt; &lt;span class=
"idlMethName"&gt;&lt;a data-no-default="" data-link-for="exposedthing"
data-lt=
"exposedthing.removeevent()|exposedthing.removeevent|removeevent()|removeevent"
href="#dom-exposedthing-removeevent" class="internalDFN"
data-link-type=
"dfn"&gt;(&lt;span class=
"idlParam"&gt;&lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString
};&lt;span class="idlInterface" id="idl-def-exposedevents"
data-idl="" data-title="ExposedEvents"&gt;
[&lt;a href=
"https://heycam.github.io/webidl/#NoInterfaceObject"&gt;NoInterfaceObject]
interface &lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-exposedevents" class=
"internalDFN" data-link-type=
"dfn"&gt; {&lt;span class=
"idlMaplike" id="idl-def-exposedevents-maplike" data-idl=""
data-title="iterable" data-dfn-for="exposedevents"&gt;
  maplike&lt;&lt;a href=
"https://heycam.github.io/webidl/#idl-DOMString"&gt;DOMString, &lt;a data-link-for=""
href="#dom-exposedevent" class="internalDFN" data-link-type=
"dfn"&gt;
};&lt;span class="idlCallback" id="idl-def-propertyreadhandler"
data-idl="" data-title="PropertyReadHandler"&gt;
callback &lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-propertyreadhandler" class=
"internalDFN" data-link-type=
"dfn"&gt; =&lt;span class=
"idlCallbackType"&gt; &lt;a href=
"https://heycam.github.io/webidl/#idl-promise"&gt;Promise&lt;span class="idlCallback"
id="idl-def-propertywritehandler" data-idl="" data-title=
"PropertyWriteHandler"&gt;
callback &lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-propertywritehandler" class=
"internalDFN" data-link-type=
"dfn"&gt; =&lt;span class=
"idlCallbackType"&gt; &lt;a href=
"https://heycam.github.io/webidl/#idl-promise"&gt;Promise&lt;span class="idlCallback"
id="idl-def-actionhandler" data-idl="" data-title="ActionHandler"&gt;
callback &lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-actionhandler" class=
"internalDFN" data-link-type=
"dfn"&gt; =&lt;span class=
"idlCallbackType"&gt; &lt;a href=
"https://heycam.github.io/webidl/#idl-promise"&gt;
Promise
&lt;
&lt;a
href="https://heycam.github.io/webidl/#idl-any"&gt;
any
&gt;
(
any
</del>
<ins class="diff-chg">result
of
the
</ins><a href= "#dfn-actions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Action
</ins>
</a>
<del class="diff-old">parameters
);
</del>
<ins class="diff-chg">or
an
error.
</ins>
The
<del class="diff-old">properties
attribute
represents
</del>
<ins class="diff-chg">method
</ins><em class="rfc2119" title="MUST"><ins class="diff-chg">
MUST
</ins></em><ins class="diff-chg">
run
the
following
steps:
</ins></p><ol><li><ins class="diff-chg">
Return
</ins>
a
<del class="diff-old">dictionary
of
ThingProperty
</del>
<a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects">
<ins class="diff-chg">Promise
</ins>
</a>
<del class="diff-old">items
</del>
<var>
<ins class="diff-chg">promise
</ins></var><ins class="diff-chg">
and
execute
the
next
steps
</ins><a data-link-type= "dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel">
in
<del class="diff-old">which
</del>
<ins class="diff-chg">parallel
</ins></a>.</li><li><ins class="diff-chg">
If
invoking
this
method
is
not
allowed
for
</ins>
the
<ins class="diff-new">current
scripting
context
for
security
reasons,
reject
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
</ins>
<code>
<del class="diff-old">read()
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
and
<del class="diff-old">write()
methods
define
local
methods
that
access
</del>
<ins class="diff-chg">terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Make
a
request
to
</ins>
the
<del class="diff-old">physical
representations
of
</del>
<ins class="diff-chg">underlying
platform
(via
</ins>
the
<del class="diff-old">Properties
.
The
actions
attribute
represents
a
dictionary
of
ThingAction
</del>
<a href= "#dfn-protocol-bindings" class="internalDFN" data-link-type= "dfn">
<ins class="diff-chg">Protocol
Bindings
</ins>
</a>
<del class="diff-old">items
in
which
the
invoke()
method
represents
a
local
method
</del>
<ins class="diff-chg">)
</ins>
to
invoke
the
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
<del class="diff-old">.
The
events
attribute
represents
a
dictionary
of
ExposedEvent
</del>
</a>
<del class="diff-old">items
that
add
</del>
<ins class="diff-chg">identified
by
</ins><var><ins class="diff-chg">
actionName
</ins></var><ins class="diff-chg">
with
parameters
provided
in
</ins><var><ins class="diff-chg">
params
</ins></var><ins class="diff-chg">
with
optional
URI
templates
given
in
</ins><var><ins class="diff-chg">
options.uriVariables
</ins></var>.</li><li><ins class="diff-chg">
If
</ins>
the
<del class="diff-old">emit()
method
to
</del>
<ins class="diff-chg">request
fails
locally
or
returns
an
error
over
</ins>
the
<del class="diff-old">ThingEvent
</del>
<ins class="diff-chg">network,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
the
error
received
from
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins>
</a>
<del class="diff-old">definition.
The
ExposedEvents
interface
represents
a
maplike
dictionary
where
all
values
are
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Otherwise
let
</ins><var><ins class="diff-chg">
value
</ins></var><ins class="diff-chg">
be
the
result
returned
in
the
reply
and
run
the
</ins><a href="#dfn-validate-property-value" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
validate
Property
value
</ins></a><ins class="diff-chg">
steps
on
it.
If
that
fails,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
<code>
<del class="diff-old">ExposedEvent
</del>
<ins class="diff-chg">SyntaxError
</ins>
</code>
<ins class="diff-new">and
terminate
these
steps.
</ins></li><li><ins class="diff-new">
Reject
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
</ins><var><ins class="diff-new">
value
</ins></var>.</li></ol></div></section><section id="the-subscribeevent-method"><h3 id="x6-14-the-subscribeevent-method">
<del class="diff-old">objects.
5.1
</del>
<bdi class= "secno">
<ins class="diff-chg">6.14
</ins></bdi>
The
<dfn data-dfn-type="method" data-export="" id="dom-consumedthing-subscribeevent" data-idl="operation" data-title="subscribeEvent()" data-dfn-for="ConsumedThing" data-type="Promise" data-lt= "ConsumedThing.subscribeEvent()|ConsumedThing.subscribeEvent|subscribeEvent()|subscribeEvent">
<code>
<del class="diff-old">expose()
</del>
<ins class="diff-chg">subscribeEvent()
</ins>
</code>
</dfn>
method
<a class="self-link" aria-label="§" href="#the-subscribeevent-method">
</a>
</h3>
<div>
<p>
<del class="diff-old">Start
serving
external
requests
</del>
<ins class="diff-chg">Makes
a
request
</ins>
for
<del class="diff-old">the
Thing
,
so
that
WoT
Interactions
</del>
<ins class="diff-chg">subscribing
to
</ins><a href="#dfn-events" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins>
</a>
<del class="diff-old">using
Properties
,
Action
</del>
<ins class="diff-chg">notifications.
Takes
a
string
argument
</ins><var><ins class="diff-chg">
eventName
</ins></var>,<ins class="diff-chg">
a
</ins><a href="#dom-wotlistener" class="internalDFN" data-link-type= "idl"><code><ins class="diff-chg">
WotListener
</ins></code>
</a>
<del class="diff-old">s
</del>
<ins class="diff-chg">callback
function
</ins><var><ins class="diff-chg">
listener
</ins></var>
and
<del class="diff-old">Event
s
will
be
possible.
The
</del>
<ins class="diff-chg">an
optional
</ins><a href= "#dom-interactionoptions" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">expose()
</del>
<ins class="diff-chg">InteractionOptions
</ins>
</code>
</a>
<var>
<ins class="diff-new">options
</ins></var><ins class="diff-new">
argument.
It
returns
success
or
failure.
The
</ins>
method
<em class= "rfc2119" title="MUST">
MUST
</em>
run
the
following
steps:
</p>
<ol>
<li>
Return
a
<a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects">
Promise
</a>
<var>
promise
</var>
and
execute
the
next
steps
<a data-link-type= "dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel">
in
parallel
</a>.
</li>
<li>
If
invoking
<del class="diff-old">expose()
</del>
<ins class="diff-chg">this
method
</ins>
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
reject
<var>
promise
</var>
with
<code>
SecurityError
</code>
and
terminate
these
steps.
</li>
<li>
<ins class="diff-new">If
</ins><var><ins class="diff-new">
listener
</ins></var><ins class="diff-new">
is
not
a
function,
reject
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
</ins><code><ins class="diff-new">
"TypeError"
</ins></code><ins class="diff-new">
and
terminate
these
steps.
</ins></li><li>
Make
a
request
to
the
underlying
platform
<del class="diff-old">to
attach
protocol
handlers
and
start
serving
external
requests
for
WoT
Interactions
(read,
write
and
observe
Properties
,
invoke
Action
</del>
<ins class="diff-chg">(via
the
</ins><a href= "#dfn-protocol-bindings" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Protocol
Bindings
</ins>
</a>
<del class="diff-old">s
and
manage
</del>
<ins class="diff-chg">)
to
subscribe
to
an
</ins>
<a href= "#dfn-events" class="internalDFN" data-link-type="dfn">
Event
</a>
<del class="diff-old">subscriptions),
based
on
the
Protocol
Bindings
.
</del>
<ins class="diff-chg">identified
by
</ins><var><ins class="diff-chg">
eventName
</ins></var><ins class="diff-chg">
with
optional
URI
templates
given
in
</ins><var><ins class="diff-chg">
options.uriVariables
</ins></var>.
</li>
<li>
If
<del class="diff-old">there
was
an
error
during
</del>
the
<del class="diff-old">request,
</del>
<ins class="diff-chg">request
fails,
</ins>
reject
<var>
promise
</var>
with
<del class="diff-old">an
Error
object
error
with
error.message
set
to
</del>
the
error
<del class="diff-old">code
seen
by
</del>
<ins class="diff-chg">received
from
</ins>
the
<a href="#dfn-protocol-bindings" class= "internalDFN" data-link-type="dfn">
Protocol
Bindings
</a>
and
terminate
these
steps.
</li>
<li>
Otherwise
resolve
<var>
promise
<del class="diff-old">with
</del>
</var>.
</li>
<li>
<ins class="diff-chg">Whenever
the
underlying
platform
receives
a
notification
for
this
</ins><a href="#dfn-events" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
subscription,
implementations
</ins><em class="rfc2119" title="SHOULD"><ins class="diff-chg">
SHOULD
</ins></em><ins class="diff-chg">
invoke
</ins>
<var>
<del class="diff-old">td
and
terminate
these
steps.
</del>
<ins class="diff-chg">listener
</ins></var>,<ins class="diff-chg">
giving
the
data
provided
with
the
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
as
parameter.
</ins>
</li>
</ol>
</div>
</section>
<section id="the-unsubscribeevent-method">
<h3 id="x6-15-the-unsubscribeevent-method">
<del class="diff-old">5.2
</del>
<bdi class= "secno">
<ins class="diff-chg">6.15
</ins></bdi>
The
<dfn data-dfn-type="method" data-export="" id="dom-consumedthing-unsubscribeevent" data-idl="operation" data-title="unsubscribeEvent()" data-dfn-for="ConsumedThing" data-type="Promise" data-lt= "ConsumedThing.unsubscribeEvent()|ConsumedThing.unsubscribeEvent|unsubscribeEvent()|unsubscribeEvent">
<code>
<del class="diff-old">destroy()
</del>
<ins class="diff-chg">unsubscribeEvent()
</ins>
</code>
</dfn>
method
<a class="self-link" aria-label="§" href="#the-unsubscribeevent-method">
</a>
</h3>
<div>
<p>
<del class="diff-old">Stop
serving
external
requests
</del>
<ins class="diff-chg">Makes
a
request
</ins>
for
<del class="diff-old">the
Thing
</del>
<ins class="diff-chg">unsubscribing
from
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins>
</a>
<ins class="diff-new">notifications.
Takes
a
string
argument
</ins><var><ins class="diff-new">
eventName
</ins></var>
and
<del class="diff-old">destroy
the
object.
Note
that
eventual
unregistering
should
be
done
before
invoking
this
method.
</del>
<ins class="diff-chg">returns
success
or
failure.
</ins>
The
<del class="diff-old">destroy()
</del>
method
<em class="rfc2119" title="MUST">
MUST
</em>
run
the
following
steps:
</p>
<ol>
<li>
Return
a
<a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects">
Promise
</a>
<var>
promise
</var>
and
execute
the
next
steps
<a data-link-type= "dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel">
in
parallel
</a>.
</li>
<li>
If
invoking
<del class="diff-old">destroy()
</del>
<ins class="diff-chg">this
method
</ins>
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
reject
<var>
promise
</var>
with
<code>
SecurityError
</code>
and
terminate
these
steps.
</li>
<li>
Make
a
request
to
the
underlying
platform
<del class="diff-old">to
stop
serving
external
requests
for
WoT
Interactions
,
based
on
</del>
<ins class="diff-chg">(via
</ins>
the
<a href= "#dfn-protocol-bindings" class="internalDFN" data-link-type= "dfn">
Protocol
Bindings
<del class="diff-old">.
</del>
</a>
<ins class="diff-chg">)
to
unsubscribe
from
the
</ins><a href= "#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
identified
by
</ins><var><ins class="diff-chg">
eventName
</ins></var>.
</li>
<li>
If
<del class="diff-old">there
was
an
error
during
</del>
the
<del class="diff-old">request,
</del>
<ins class="diff-chg">request
fails,
</ins>
reject
<var>
promise
</var>
with
<del class="diff-old">an
Error
object
error
with
error.message
set
to
</del>
the
error
<del class="diff-old">code
seen
by
</del>
<ins class="diff-chg">received
from
</ins>
the
<a href="#dfn-protocol-bindings" class= "internalDFN" data-link-type="dfn">
Protocol
Bindings
</a>
and
terminate
these
steps.
</li>
<li>
Otherwise
resolve
<var>
promise
<del class="diff-old">with
td
and
terminate
these
steps.
</del>
</var>.
</li>
</ol>
</div>
</section>
<del class="diff-old">5.3
The
addProperty()
</del>
<section id="consumedthing-examples">
<h3 id="x6-16-consumedthing-examples">
<del class="diff-old">method
</del>
<bdi class="secno">
<ins class="diff-chg">6.16
</ins></bdi><ins class="diff-chg">
ConsumedThing
Examples
</ins><a class="self-link" aria-label="§" href= "#consumedthing-examples">
</a>
</h3>
<p>
<del class="diff-old">Adds
</del>
<ins class="diff-chg">The
next
example
illustrates
how
to
fetch
</ins>
a
<del class="diff-old">Property
</del>
<a href="#dfn-td" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">TD
</ins>
</a>
<del class="diff-old">with
name
defined
by
the
name
argument,
the
data
schema
provided
</del>
by
<del class="diff-old">the
property
argument
of
type
</del>
<ins class="diff-chg">URL,
create
a
</ins><a href="#dom-consumedthing" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">PropertyFragment
</del>
<ins class="diff-chg">ConsumedThing
</ins>
</code>
</a>,
<del class="diff-old">and
optionally
an
initial
value
provided
in
the
argument
initValue
whose
type
should
match
the
one
defined
in
the
type
</del>
<ins class="diff-chg">read
metadata
(title),
read
</ins>
property
<del class="diff-old">according
</del>
<ins class="diff-chg">value,
subscribe
</ins>
to
<del class="diff-old">the
value-matching
algorithm
.
If
initValue
is
not
provided,
it
SHOULD
be
initialized
as
undefined
.
Implementations
SHOULD
update
the
Thing
Description
.
Throws
on
error.
Returns
a
reference
</del>
<ins class="diff-chg">property
change,
subscribe
</ins>
to
<del class="diff-old">the
same
object
for
supporting
chaining.
</del>
<ins class="diff-chg">a
WoT
event,
unsubscribe.
</ins>
</p>
<div class="example" id="example-2-thing-client-api-example">
<div class="marker">
<del class="diff-old">5.4
</del>
<a class="self-link" href= "#example-2-thing-client-api-example">
<ins class="diff-chg">Example
</ins><bdi><ins class="diff-chg">
2
</ins></bdi></a><span class="example-title">:<ins class="diff-chg">
Thing
Client
API
example
</ins></span></div><pre aria-busy="false"><code class="hljs javascript"><span class=<ins class="diff-chg">
"hljs-keyword">try</span> {
</ins>  <span class="hljs-keyword">let</span> res = <span class=<ins class="diff-chg">
"hljs-keyword">await</span> fetch(<span class=
"hljs-string">"https://tds.mythings.org/sensor11"</span>);
</ins>  <span class="hljs-keyword">let</span> td = res.json();  <span class="hljs-keyword">let</span> thing = <span class=<ins class="diff-chg">
"hljs-keyword">new</span> ConsumedThing(td);
</ins>  <span class="hljs-built_in">console</span>.log(<span class=<ins class="diff-chg">
"hljs-string">"Thing "</span> + thing.getThingDescription().title + <span class="hljs-string">" consumed."</span>);
} <span class="hljs-keyword">catch</span>(e) {
</ins>  <span class="hljs-built_in">console</span>.log(<span class=<ins class="diff-chg">
"hljs-string">"TD fetch error: "</span> + e.message); },
};
</ins><span class="hljs-keyword">try</span> {  <span class=<ins class="diff-chg">
"hljs-comment">// subscribe to property change for “temperature”</span>
</ins>  <span class=<ins class="diff-chg">
"hljs-keyword">await</span> thing.observeProperty(<span class=
"hljs-string">"temperature"</span>, value =&gt; {
</ins>    <span class="hljs-built_in">console</span>.log(<span class=<ins class="diff-chg">
"hljs-string">"Temperature changed to: "</span> + value);
  });
</ins>  <span class=<ins class="diff-chg">
"hljs-comment">// subscribe to the “ready” event defined in the TD</span>
</ins>  <span class=<ins class="diff-chg">
"hljs-keyword">await</span> thing.subscribeEvent(<span class=
"hljs-string">"ready"</span>, eventData =&gt; {
</ins>    <span class="hljs-built_in">console</span>.log(<span class=<ins class="diff-chg">
"hljs-string">"Ready; index: "</span> + eventData);
</ins>    <span class=<ins class="diff-chg">
"hljs-comment">// run the “startMeasurement” action defined by TD</span>
</ins>    <span class=<ins class="diff-chg">
"hljs-keyword">await</span> thing.invokeAction(<span class=
"hljs-string">"startMeasurement"</span>, { <span class=
"hljs-attr">units</span>: <span class=
"hljs-string">"Celsius"</span> });
</ins>    <span class="hljs-built_in">console</span>.log(<span class=<ins class="diff-chg">
"hljs-string">"Measurement started."</span>);
  });
} <span class="hljs-keyword">catch</span>(e) {
</ins>  <span class="hljs-built_in">console</span>.log(<span class=<ins class="diff-chg">
"hljs-string">"Error starting measurement."</span>);
}
setTimeout( <span class="hljs-function"><span class=
"hljs-params">()</span> =&gt;</span> {
</ins>  <span class=<ins class="diff-chg">
"hljs-built_in">console</span>.log(“Temperature: “ + <span class=
"hljs-keyword">await</span> thing.readProperty(“temperature”));
</ins>  <span class=<ins class="diff-chg">
"hljs-keyword">await</span> thing.unsubscribe(“ready”);
</ins>  <span class="hljs-built_in">console</span>.log(<span class=<ins class="diff-chg">
"hljs-string">"Unsubscribed from the ‘ready’ event."</span>);
},
</ins><span class="hljs-number"><ins class="diff-chg">
10000
</ins>
</span>
<ins class="diff-new">);
</ins></code></pre></div></section></section><section data-dfn-for="ExposedThing" id= "the-exposedthing-interface"><h2 id="x7-the-exposedthing-interface"><bdi class="secno"><ins class="diff-new">
7.
</ins></bdi>
The
<dfn data-dfn-type="interface" data-export="" id= "dom-exposedthing" data-idl="interface" data-title= "ExposedThing">
<code>
<del class="diff-old">removeProperty()
</del>
<ins class="diff-chg">ExposedThing
</ins>
</code>
</dfn>
<del class="diff-old">method
</del>
<ins class="diff-chg">interface
</ins><a class= "self-link" aria-label="§" href= "#the-exposedthing-interface">
</a>
</h2>
<p>
<del class="diff-old">Removes
the
Property
specified
by
the
</del>
<ins class="diff-chg">The
</ins><a href="#dom-exposedthing" class="internalDFN" data-link-type="idl">
<code>
<del class="diff-old">name
</del>
<ins class="diff-chg">ExposedThing
</ins>
</code>
<del class="diff-old">argument
and
updates
</del>
</a>
<ins class="diff-chg">interface
is
</ins>
the
<del class="diff-old">Thing
Description
.
Throws
on
error.
Returns
a
reference
</del>
<ins class="diff-chg">server
API
</ins>
to
<ins class="diff-new">operate
</ins>
the
<del class="diff-old">same
object
for
supporting
chaining.
</del>
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Thing
</ins></a><ins class="diff-chg">
that
allows
defining
request
handlers,
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a>,<a href="#dfn-actions" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
Action
</ins></a>,<ins class="diff-chg">
and
</ins><a href= "#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
interactions.
</ins>
</p>
<del class="diff-old">5.5
</del>
<pre class="idl def"><span data-idl="" class="idlInterface" id=
<ins class="diff-chg">"idl-def-exposedthing" data-title="ExposedThing">[<span class=
"extAttr"><a data-xref-type="extended-attribute" data-cite-path=""
data-type="extended-attribute" href=
"https://heycam.github.io/webidl/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-xref-type="extended-attribute"
data-cite-path="" data-type="extended-attribute" href=
"https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<a data-xref-type="interface"
data-cite-path="window-object.html" data-type="interface" href=
"https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>,<a data-xref-type="interface"
data-lt="WorkerGlobalScope" data-cite-path="workers.html"
data-type="interface" href=
"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">Worker</a>)</span>]
interface <a class="internalDFN idlID" data-link-for=""
data-link-type="interface" href=
"#dom-exposedthing"><code>ExposedThing</code></a>: <span class=
"idlSuperclass"><a data-xref-type="_IDL_" href="#dom-consumedthing"
class="internalDFN" data-link-type=
"idl"><code>ConsumedThing</code></a></span> {<span data-idl=""
class="idlMethod" id=
"idl-def-exposedthing-setpropertyreadhandler-name-readhandler"
data-title="setPropertyReadHandler" data-dfn-for=
"ExposedThing"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" href="#dom-exposedthing" class=<ins class="diff-chg">
"internalDFN" data-link-type=
"idl"><code>ExposedThing</code></a></span> <a class=
"internalDFN idlName" data-link-for="ExposedThing" data-link-type=
"method" href=
"#dom-exposedthing-setpropertyreadhandler"><code>setPropertyReadHandler</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">name</span>,<span class="idlType">
</ins>          <a data-xref-type="_IDL_" href="#dom-propertyreadhandler"<ins class="diff-chg">
class="internalDFN" data-link-type=
"idl"><code>PropertyReadHandler</code></a></span> <span class=
"idlParamName">readHandler</span>);</span><span data-idl="" class=
"idlMethod" id=
"idl-def-exposedthing-setpropertywritehandler-name-writehandler"
data-title="setPropertyWriteHandler" data-dfn-for=
"ExposedThing"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" href="#dom-exposedthing" class=<ins class="diff-chg">
"internalDFN" data-link-type=
"idl"><code>ExposedThing</code></a></span> <a class=
"internalDFN idlName" data-link-for="ExposedThing" data-link-type=
"method" href=
"#dom-exposedthing-setpropertywritehandler"><code>setPropertyWriteHandler</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">name</span>,<span class="idlType">
</ins>          <a data-xref-type="_IDL_" href=<ins class="diff-chg">
"#dom-propertywritehandler" class="internalDFN" data-link-type=
"idl"><code>PropertyWriteHandler</code></a></span> <span class=
"idlParamName">writeHandler</span>);</span><span data-idl="" class=
"idlMethod" id="idl-def-exposedthing-setactionhandler-name-action"
data-title="setActionHandler" data-dfn-for=
"ExposedThing"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" href="#dom-exposedthing" class=<ins class="diff-chg">
"internalDFN" data-link-type=
"idl"><code>ExposedThing</code></a></span> <a class=
"internalDFN idlName" data-link-for="ExposedThing" data-link-type=
"method" href=
"#dom-exposedthing-setactionhandler"><code>setActionHandler</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">name</span>,<span class="idlType"> <a data-xref-type="_IDL_"
href="#dom-actionhandler" class="internalDFN" data-link-type=
"idl"><code>ActionHandler</code></a></span> <span class=
"idlParamName">action</span>);</span><span data-idl="" class=
"idlMethod" id="idl-def-exposedthing-emitevent-name-data"
data-title="emitEvent" data-dfn-for="ExposedThing"><span class=
"idlType">
</ins>  <a data-xref-type="_IDL_" data-cite-path="" data-type="interface"<ins class="diff-chg">
href=
"https://heycam.github.io/webidl/#idl-void">void</a></span> <a class="internalDFN idlName"
data-link-for="ExposedThing" data-link-type="method" href=
"#dom-exposedthing-emitevent"><code>emitEvent</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">name</span>,<span class="idlType"> <a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a></span> <span class="idlParamName">data</span>);</span><span data-idl=""
class="idlMethod" id="idl-def-exposedthing-expose" data-title=
"expose" data-dfn-for="ExposedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ExposedThing" data-link-type="method" href=
"#dom-exposedthing-expose"><code>expose</code></a>();</span><span data-idl=""
class="idlMethod" id="idl-def-exposedthing-destroy" data-title=
"destroy" data-dfn-for="ExposedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ExposedThing" data-link-type="method" href=
"#dom-exposedthing-destroy"><code>destroy</code></a>();</span>
};</span><span data-idl="" class="idlCallback" id=
"idl-def-propertyreadhandler" data-title="PropertyReadHandler">
callback <a class="internalDFN idlID" data-link-for=""
data-link-type="callback" href=
"#dom-propertyreadhandler"><code>PropertyReadHandler</code></a> =<span class="idlType"> <a data-xref-type="interface"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a>&gt;</span>(
        optional<span class="idlType"> <a data-xref-type="_IDL_"
href="#dom-interactionoptions" class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlCallback" id="idl-def-propertywritehandler" data-title=
"PropertyWriteHandler">
callback <a class="internalDFN idlID" data-link-for=""
data-link-type="callback" href=
"#dom-propertywritehandler"><code>PropertyWriteHandler</code></a> =<span class="idlType"> <a data-xref-type="interface"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a></span> <span class="idlParamName">value</span>,
        optional<span class="idlType"> <a data-xref-type="_IDL_"
href="#dom-interactionoptions" class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlCallback" id="idl-def-actionhandler" data-title=
"ActionHandler">
callback <a class="internalDFN idlID" data-link-for=""
data-link-type="callback" href=
"#dom-actionhandler"><code>ActionHandler</code></a> =<span class=
"idlType"> <a data-xref-type="interface" data-cite-path=""
data-type="interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a>&gt;</span>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a></span> <span class="idlParamName">params</span>,
        optional<span class="idlType"> <a data-xref-type="_IDL_"
href="#dom-interactionoptions" class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">
options
</ins>
</span>
<del class="diff-old">The
</del>
<ins class="diff-chg">=
null);
</ins></span></pre><section id="constructing-exposedthing"><h3 id="x7-1-constructing-exposedthing"><bdi class= "secno"><ins class="diff-chg">
7.1
</ins></bdi><ins class="diff-chg">
Constructing
</ins>
<code>
<del class="diff-old">addAction()
</del>
<ins class="diff-chg">ExposedThing
</ins>
</code>
<del class="diff-old">method
</del>
<a class= "self-link" aria-label="§" href= "#constructing-exposedthing">
</a>
</h3>
<p>
<del class="diff-old">Adds
to
the
</del>
<ins class="diff-chg">The
</ins>
<code>
<del class="diff-old">actions
</del>
<ins class="diff-chg">ExposedThing
</ins>
</code>
<del class="diff-old">property
of
</del>
<ins class="diff-chg">interface
extends
</ins><a href= "#dom-consumedthing" class="internalDFN" data-link-type= "idl"><code><ins class="diff-chg">
ConsumedThing
</ins></code></a>.<ins class="diff-chg">
It
is
constructed
from
</ins>
a
<del class="diff-old">Thing
</del>
<ins class="diff-chg">full
or
partial
</ins><a href="#dom-thingdescription" class="internalDFN" data-link-type="idl"><code><ins class="diff-chg">
ThingDescription
</ins></code>
</a>
<del class="diff-old">object
</del>
<ins class="diff-chg">object.
</ins></p><div class="note" role="note" id="issue-container-generatedID-6"><div role="heading" class="note-title marker" id="h-note-2" aria-level="4"><span><ins class="diff-chg">
Note
</ins></span></div><p class=""><ins class="diff-chg">
Note
that
</ins>
an
<del class="diff-old">Action
</del>
<ins class="diff-chg">existing
</ins><a href="#dom-thingdescription" class="internalDFN" data-link-type= "idl"><code><ins class="diff-chg">
ThingDescription
</ins></code>
</a>
<del class="diff-old">with
name
defined
</del>
<ins class="diff-chg">object
can
be
optionally
modified
(for
instance
</ins>
by
<del class="diff-old">the
</del>
<ins class="diff-chg">adding
or
removing
elements
on
its
</ins>
<var>
<del class="diff-old">name
</del>
<ins class="diff-chg">properties
</ins></var>,<var><ins class="diff-chg">
actions
</ins>
</var>
<del class="diff-old">argument,
defines
input
</del>
and
<del class="diff-old">output
data
format
by
the
</del>
<var>
<del class="diff-old">init
</del>
<ins class="diff-chg">events
</ins>
</var>
<del class="diff-old">argument
of
type
</del>
<ins class="diff-chg">internal
properties)
and
the
resulting
object
can
used
for
constructing
an
</ins><a href="#dom-exposedthing" class="internalDFN" data-link-type="idl">
<code>
<del class="diff-old">ActionFragment
</del>
<ins class="diff-chg">ExposedThing
</ins>
</code>
</a>
<ins class="diff-new">object.
This
is
the
current
way
of
adding
and
removing
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Property
</ins>
</a>,
<a href= "#dfn-actions" class="internalDFN" data-link-type="dfn">
<ins class="diff-new">Action
</ins></a>
and
<del class="diff-old">adds
the
function
provided
in
the
action
argument
</del>
<a href="#dfn-events" class="internalDFN" data-link-type= "dfn">
<ins class="diff-chg">Event
</ins></a><ins class="diff-chg">
definitions,
</ins>
as
<del class="diff-old">a
handler,
then
updates
</del>
<ins class="diff-chg">illustrated
in
</ins>
the
<del class="diff-old">Thing
Description
</del>
<a href= "#exposedthing-examples">
<ins class="diff-chg">examples
</ins>
</a>.
<del class="diff-old">Throws
on
error.
Returns
a
reference
to
the
same
object
for
supporting
chaining.
</del>
</p>
<del class="diff-old">The
provided
action
callback
function
will
implement
invoking
an
Action
and
SHOULD
be
called
by
implementations
when
a
request
for
</del>
</div>
<div class="note" role="note" id="issue-container-generatedID-7">
<div role="heading" class="note-title marker" id="h-note-3" aria-level="4">
<span>
<ins class="diff-chg">Note
</ins></span></div><p class=""><ins class="diff-chg">
Before
</ins>
invoking
<a href= "#dom-exposedthing-expose">
<ins class="diff-new">expose()
</ins></a>,
the
<del class="diff-old">Action
</del>
<a href= "#dom-exposedthing" class="internalDFN" data-link-type= "idl">
<code>
<ins class="diff-chg">ExposedThing
</ins></code>
</a>
<del class="diff-old">is
received
from
the
underlying
platform.
The
callback
will
receive
a
</del>
<ins class="diff-chg">object
does
not
serve
any
requests.
This
allows
first
constructing
</ins><a href= "#dom-exposedthing" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">parameters
</del>
<ins class="diff-chg">ExposedThing
</ins>
</code>
<del class="diff-old">dictionary
argument
according
to
the
definition
in
the
init.input
argument
</del>
</a>
and
<del class="diff-old">will
return
a
value
of
type
defined
by
the
init.output
argument
according
to
the
value-matching
algorithm
.
</del>
<ins class="diff-chg">then
initialize
its
</ins><a href="#dfn-properties" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Properties
</ins></a><ins class="diff-chg">
and
service
handlers
before
starting
serving
requests.
</ins>
</p>
</div>
<div>
<p>
<del class="diff-old">There
SHOULD
be
exactly
one
handler
for
any
given
Action
.
If
no
handler
is
initialized
for
any
given
Action
,
implementations
SHOULD
throw
a
TypeError
.
</del>
<ins class="diff-chg">To
construct
an
</ins><a href="#dom-exposedthing" class="internalDFN" data-link-type="idl">
<del class="diff-old">5.6
The
</del>
<code>
<del class="diff-old">removeAction()
</del>
<ins class="diff-chg">ExposedThing
</ins>
</code>
<del class="diff-old">method
</del>
</a>
<del class="diff-old">Removes
</del>
<ins class="diff-chg">with
</ins>
the
<del class="diff-old">Action
</del>
<a href="#dom-thingdescription" class="internalDFN" data-link-type= "idl">
<code>
<ins class="diff-chg">ThingDescription
</ins></code>
</a>
<del class="diff-old">specified
by
</del>
<var>
<ins class="diff-chg">td
</ins></var>,<ins class="diff-chg">
run
the
following
steps:
</ins></p><ol><li><ins class="diff-chg">
If
invoking
this
method
is
not
allowed
for
</ins>
the
<ins class="diff-new">current
scripting
context
for
security
reasons,
throw
</ins>
<code>
<del class="diff-old">name
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
<del class="diff-old">argument
</del>
and
<del class="diff-old">updates
</del>
<ins class="diff-chg">terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Run
</ins>
the
<del class="diff-old">Thing
Description
.
Throws
on
error.
Returns
</del>
<a href="#dfn-expand-a-td" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">expand
</ins>
a
<del class="diff-old">reference
to
</del>
<ins class="diff-chg">TD
</ins></a><ins class="diff-chg">
steps
on
</ins><var><ins class="diff-chg">
td
</ins></var>.<ins class="diff-chg">
If
that
fails,
re-throw
</ins>
the
<del class="diff-old">same
object
for
supporting
chaining.
</del>
<ins class="diff-chg">error
and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Let
</ins><var><ins class="diff-chg">
thing
</ins></var><ins class="diff-chg">
be
a
new
</ins><a href="#dom-exposedthing" class="internalDFN" data-link-type= "idl">
<del class="diff-old">5.7
The
</del>
<code>
<del class="diff-old">addEvent()
</del>
<ins class="diff-chg">ExposedThing
</ins>
</code>
<del class="diff-old">method
</del>
</a>
<del class="diff-old">Adds
</del>
<ins class="diff-chg">object.
</ins></li><li><ins class="diff-chg">
Let
|
</ins><var><ins class="diff-chg">
td
</ins></var><ins class="diff-chg">
|
be
</ins>
an
<del class="diff-old">event
with
name
defined
by
the
</del>
<ins class="diff-chg">internal
slot
of
</ins>
<var>
<del class="diff-old">name
</del>
<ins class="diff-chg">thing
</ins>
</var>
<del class="diff-old">argument
</del>
and
<del class="diff-old">qualifiers
and
initialization
value
provided
by
the
</del>
<ins class="diff-chg">let
</ins>
<var>
<del class="diff-old">event
</del>
<ins class="diff-chg">td
</ins>
</var>
<del class="diff-old">argument
of
type
</del>
<ins class="diff-chg">be
its
value.
</ins></li><li><ins class="diff-chg">
Return
</ins><var><ins class="diff-chg">
thing
</ins></var>.</li></ol></div></section><section id="methods-inherited-from-consumedthing"><h3 id="x7-2-methods-inherited-from-consumedthing"><bdi class= "secno"><ins class="diff-chg">
7.2
</ins></bdi><ins class="diff-chg">
Methods
inherited
from
</ins><a href= "#dom-consumedthing" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">EventFragment
</del>
<ins class="diff-chg">ConsumedThing
</ins>
</code>
</a>
<del class="diff-old">to
the
Thing
object
and
updates
the
Thing
Description
.
Throws
on
error.
Returns
a
reference
to
the
same
object
for
supporting
chaining.
</del>
<del class="diff-old">5.8
The
removeEvent()
method
</del>
<a class="self-link" aria-label="§" href= "#methods-inherited-from-consumedthing">
</a>
</h3>
<p>
<del class="diff-old">Removes
the
event
specified
by
</del>
<ins class="diff-chg">The
</ins><code><ins class="diff-chg">
readProperty()
</ins></code>,<code><ins class="diff-chg">
readMultipleProperties()
</ins></code>,<code><ins class="diff-chg">
readAllProperties()
</ins></code>,<code><ins class="diff-chg">
writeProperty()
</ins></code>,<code><ins class="diff-chg">
writeMultipleProperties()
</ins></code>,<code><ins class="diff-chg">
writeAllProperties()
</ins></code><ins class="diff-chg">
methods
have
</ins>
the
<ins class="diff-new">same
algorithmic
steps
as
described
in
</ins><a href= "#the-consumedthing-interface">
<code>
<del class="diff-old">name
</del>
<ins class="diff-chg">ConsumedThing
</ins>
</code>
<del class="diff-old">argument
and
updates
</del>
</a>,
<ins class="diff-chg">with
</ins>
the
<del class="diff-old">Thing
Description
.
Returns
</del>
<ins class="diff-chg">difference
that
making
</ins>
a
<del class="diff-old">reference
</del>
<ins class="diff-chg">request
</ins>
to
the
<del class="diff-old">same
object
for
supporting
chaining.
</del>
<ins class="diff-chg">underlying
platform
</ins><em class="rfc2119" title="MAY"><ins class="diff-chg">
MAY
</ins></em><ins class="diff-chg">
be
implemented
with
local
methods
or
libraries
and
don't
necessarily
need
to
involve
network
operations.
</ins>
</p>
<del class="diff-old">5.9
</del>
<p>
The
<ins class="diff-chg">implementation
of
</ins><a href="#dom-consumedthing" class= "internalDFN" data-link-type="idl">
<code>
<del class="diff-old">PropertyReadHandler
</del>
<ins class="diff-chg">ConsumedThing
</ins>
</code>
<del class="diff-old">callback
</del>
</a>
<ins class="diff-chg">interface
in
an
</ins><a href="#dom-exposedthing" class="internalDFN" data-link-type="idl"><code><ins class="diff-chg">
ExposedThing
</ins></code>
</a>
<ins class="diff-new">provide
the
</ins><i><ins class="diff-new">
default
</ins></i><ins class="diff-new">
methods
to
interact
with
the
</ins><a href= "#dom-exposedthing" class="internalDFN" data-link-type= "idl">
<code>
<ins class="diff-chg">ExposedThing
</ins></code></a>.</p>
<p>
<del class="diff-old">A
function
that
is
called
when
</del>
<ins class="diff-chg">After
constructing
</ins>
an
<del class="diff-old">external
request
for
reading
</del>
<a href="#dom-exposedthing" class= "internalDFN" data-link-type="idl">
<code>
<ins class="diff-chg">ExposedThing
</ins></code></a>,
a
<del class="diff-old">Property
</del>
<ins class="diff-chg">script
can
initialize
its
</ins><a href="#dfn-properties" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
Properties
</ins>
</a>
<del class="diff-old">is
received.
It
should
return
a
Promise
</del>
and
<del class="diff-old">resolves
it
with
</del>
<ins class="diff-chg">can
set
up
</ins>
the
<del class="diff-old">value
of
</del>
<ins class="diff-chg">optional
read,
write
and
action
request
handlers
(the
default
ones
are
provided
by
</ins>
the
<del class="diff-old">Property
matching
</del>
<ins class="diff-chg">implementation).
The
script
provided
handlers
</ins><em class="rfc2119" title="MAY"><ins class="diff-chg">
MAY
</ins></em><ins class="diff-chg">
use
the
default
handlers,
thereby
extending
the
default
behavior,
but
they
can
also
bypass
them,
overriding
the
default
behavior.
Finally,
</ins>
the
<ins class="diff-new">script
would
call
</ins><a href="#the-expose-method">
<code>
<del class="diff-old">name
</del>
<ins class="diff-chg">expose()
</ins>
</code>
<del class="diff-old">argument
to
</del>
</a>
<ins class="diff-chg">on
</ins>
the
<a href="#dom-exposedthing" class="internalDFN" data-link-type="idl">
<code>
<del class="diff-old">setPropertyReadHandler
</del>
<ins class="diff-chg">ExposedThing
</ins>
</code>
<del class="diff-old">function,
or
rejects
with
an
error
if
the
property
is
not
found
or
the
value
cannot
be
retrieved.
</del>
</a>
<ins class="diff-chg">in
order
to
start
serving
external
requests.
</ins>
</p>
</section>
<section data-dfn-for="PropertyReadHandler" id= "the-propertyreadhandler-callback">
<h3 id="x7-3-the-propertyreadhandler-callback">
<del class="diff-old">5.10
</del>
<bdi class= "secno">
<ins class="diff-chg">7.3
</ins></bdi>
The
<dfn data-dfn-type="callback" data-export="" id="dom-propertyreadhandler" data-idl="callback" data-title= "PropertyReadHandler">
<code>
<del class="diff-old">PropertyWriteHandler
</del>
<ins class="diff-chg">PropertyReadHandler
</ins>
</code>
</dfn>
callback
<a class="self-link" aria-label="§" href= "#the-propertyreadhandler-callback">
</a>
</h3>
<p>
A
function
that
is
called
when
an
external
request
for
<del class="diff-old">writing
</del>
<ins class="diff-chg">reading
</ins>
a
<a href="#dfn-properties" class="internalDFN" data-link-type= "dfn">
Property
</a>
is
<del class="diff-old">received.
It
is
given
the
requested
new
value
as
argument
</del>
<ins class="diff-chg">received
</ins>
and
<del class="diff-old">should
return
</del>
<ins class="diff-chg">defines
what
to
do
with
such
requests.
It
returns
</ins>
a
<a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects">
Promise
<del class="diff-old">which
is
resolved
</del>
</a>
<ins class="diff-chg">and
resolves
it
</ins>
when
the
value
of
the
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
<del class="diff-old">that
matches
</del>
<ins class="diff-chg">matching
</ins>
the
<code>
name
</code>
argument
<del class="diff-old">has
been
updated
with
value
,
</del>
<ins class="diff-chg">is
obtained,
</ins>
or
rejects
with
an
error
if
the
property
is
not
found
or
the
value
cannot
be
<del class="diff-old">updated.
Editor's
note
Note
that
this
function
is
invoked
by
implementations
before
the
property
is
updated
and
it
actually
defines
what
to
do
when
a
write
request
is
received.
The
code
in
this
callback
function
can
invoke
the
read()
method
to
find
out
the
old
value
of
the
property,
if
needed.
Therefore
the
old
value
is
not
provided
to
this
function.
5.11
The
ActionHandler
callback
A
function
called
with
a
parameters
dictionary
argument
assembled
by
the
WoT
runtime
based
on
the
Thing
Description
and
the
external
client
request.
It
returns
a
Promise
that
rejects
with
an
error
or
resolves
if
the
action
is
successful
or
ongoing
(may
also
resolve
with
a
control
object
such
as
an
Observable
for
actions
that
need
progress
notifications
or
that
can
be
canceled).
</del>
<ins class="diff-chg">retrieved.
</ins>
</p>
</section>
<section id="the-setpropertyreadhandler-method">
<h3 id="x7-4-the-setpropertyreadhandler-method">
<del class="diff-old">5.12
</del>
<bdi class= "secno">
<ins class="diff-chg">7.4
</ins></bdi>
The
<dfn data-dfn-type="method" data-export="" id="dom-exposedthing-setpropertyreadhandler" data-idl="operation" data-title="setPropertyReadHandler()" data-dfn-for="ExposedThing" data-type="ExposedThing" data-lt= "ExposedThing.setPropertyReadHandler()|ExposedThing.setPropertyReadHandler|setPropertyReadHandler()|setPropertyReadHandler">
<code>
setPropertyReadHandler()
</code>
</dfn>
method
<a class= "self-link" aria-label="§" href= "#the-setpropertyreadhandler-method">
</a>
</h3>
<p>
Takes
<code>
name
</code>
as
string
argument
and
<code>
readHandler
</code>
as
argument
of
type
<a href= "#dom-propertyreadhandler" class="internalDFN" data-link-type= "idl">
<code>
PropertyReadHandler
</code>
</a>.
Sets
the
<ins class="diff-new">service
</ins>
handler
<del class="diff-old">function
</del>
for
reading
the
specified
<a href="#dfn-properties" class= "internalDFN" data-link-type="dfn">
Property
</a>
matched
by
<code>
name
</code>.
Throws
on
error.
Returns
a
reference
to
<del class="diff-old">the
same
</del>
<var>
<ins class="diff-chg">this
</ins></var>
object
for
supporting
chaining.
</p>
<p>
The
<code>
readHandler
</code>
callback
function
<del class="diff-old">will
</del>
<ins class="diff-chg">should
</ins>
implement
reading
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
and
<em class="rfc2119" title= "SHOULD">
SHOULD
</em>
be
called
by
implementations
when
a
request
for
reading
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
is
received
from
the
underlying
platform.
</p>
<p>
There
<del class="diff-old">SHOULD
</del>
<em class="rfc2119" title="MUST">
<ins class="diff-chg">MUST
</ins>
</em>
be
at
most
one
handler
for
any
given
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
<del class="diff-old">and
</del>
</a>,
<ins class="diff-chg">so
</ins>
newly
added
handlers
<em class="rfc2119" title="MUST">
<ins class="diff-new">MUST
</ins></em>
replace
the
<del class="diff-old">old
</del>
<ins class="diff-chg">previous
</ins>
handlers.
If
no
handler
is
initialized
for
any
given
<a href= "#dfn-properties" class="internalDFN" data-link-type= "dfn">
Property
</a>,
implementations
<em class="rfc2119" title= "SHOULD">
SHOULD
</em>
implement
a
default
property
read
<del class="diff-old">handler.
</del>
<ins class="diff-chg">handler
based
on
the
</ins><a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Description
</ins></a>.
</p>
</section>
<section id="handling-property-read-requests">
<h3 id="x7-5-handling-property-read-requests">
<bdi class= "secno">
<ins class="diff-new">7.5
</ins></bdi><ins class="diff-new">
Handling
</ins><a href="#dfn-properties" class= "internalDFN" data-link-type="dfn"><ins class="diff-new">
Property
</ins></a><ins class="diff-new">
read
requests
</ins><a class="self-link" aria-label="§" href= "#handling-property-read-requests"></a></h3><div>
<p>
When
<del class="diff-old">an
external
</del>
<ins class="diff-chg">a
network
</ins>
request
for
reading
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
<var>
propertyName
</var>
is
<del class="diff-old">received,
</del>
<ins class="diff-chg">received
by
</ins>
the
<del class="diff-old">runtime
SHOULD
execute
</del>
<ins class="diff-chg">implementation,
run
</ins>
the
following
steps:
</p>
<ol>
<li>
<del class="diff-old">Return
a
Promise
promise
and
execute
the
next
steps
in
parallel
.
</del>
If
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
with
<var>
propertyName
</var>
does
not
exist,
<del class="diff-old">reject
promise
with
a
</del>
<ins class="diff-chg">return
</ins>
<code>
ReferenceError
</code>
<ins class="diff-new">in
the
reply
and
terminate
these
steps.
</ins></li><li><ins class="diff-new">
If
there
is
a
user
provided
read
handler
registered
with
</ins><code><ins class="diff-new">
setPropertyReadHandler()
</ins></code>,<ins class="diff-new">
invoke
that
wih
</ins><var><ins class="diff-new">
propertyName
</ins></var>,<ins class="diff-new">
return
the
value
with
the
reply
</ins>
and
terminate
these
steps.
</li>
<li>
Otherwise,
if
<del class="diff-old">no
</del>
<ins class="diff-chg">there
is
a
default
</ins>
read
handler
<del class="diff-old">has
been
defined
for
</del>
<ins class="diff-chg">provided
by
the
implementation,
invoke
it
with
</ins>
<var>
propertyName
</var>,
<del class="diff-old">resolve
promise
with
</del>
<ins class="diff-chg">return
</ins>
the
value
<del class="diff-old">of
</del>
<ins class="diff-chg">with
the
reply
and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
if
there
is
no
default
handler
defined
by
the
implementation,
return
</ins><a data-link-type="dfn" href= "https://heycam.github.io/webidl/#notsupportederror"><code><ins class="diff-chg">
NotSupportedError
</ins></code></a><ins class="diff-chg">
with
</ins>
the
<ins class="diff-new">reply
and
terminate
these
steps.
</ins></li></ol></div></section><section id="handling-property-observe-requests"><h3 id="x7-6-handling-property-observe-requests"><bdi class= "secno"><ins class="diff-new">
7.6
</ins></bdi><ins class="diff-new">
Handling
</ins><a href="#dfn-properties" class= "internalDFN" data-link-type="dfn"><ins class="diff-new">
Property
</ins></a><ins class="diff-new">
observe
requests
</ins><a class="self-link" aria-label="§" href= "#handling-property-observe-requests"></a></h3><div><p><ins class="diff-new">
When
a
network
request
for
observing
a
</ins>
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
<del class="diff-old">named
</del>
<var>
propertyName
</var>
<del class="diff-old">provided
</del>
<ins class="diff-chg">is
received
</ins>
by
the
<del class="diff-old">runtime
implementation
</del>
<ins class="diff-chg">implementation,
run
the
following
steps:
</ins></p><ol><li><ins class="diff-chg">
If
a
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
with
</ins><var><ins class="diff-chg">
propertyName
</ins></var><ins class="diff-chg">
does
not
exist,
return
an
error
in
the
reply
(as
defined
in
the
</ins><a href= "#dfn-thing-descriptions" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Thing
Description
</ins></a><ins class="diff-chg">
)
</ins>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">Otherwise,
invoke
</del>
<ins class="diff-chg">Save
</ins>
the
<del class="diff-old">read
handler
associated
with
propertyName
.
If
it
rejects,
then
reject
promise
</del>
<ins class="diff-chg">request
sender
information
to
the
</ins><a href= "#dfn-properties" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
's
</ins><a href="#dfn-internal-observer-list" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
internal
observer
list
</ins></a><ins class="diff-chg">
in
order
to
be
able
to
notify
about
</ins><a href="#dfn-properties" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
value
changes.
</ins></li></ol></div></section><section data-dfn-for="PropertyWriteHandler" id= "the-propertywritehandler-callback"><h3 id="x7-7-the-propertywritehandler-callback"><bdi class= "secno"><ins class="diff-chg">
7.7
</ins></bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="callback" data-export="" id="dom-propertywritehandler" data-idl="callback" data-title= "PropertyWriteHandler"><code><ins class="diff-chg">
PropertyWriteHandler
</ins></code></dfn><ins class="diff-chg">
callback
</ins><a class="self-link" aria-label="§" href= "#the-propertywritehandler-callback"></a></h3><p><ins class="diff-chg">
A
function
that
is
called
when
an
external
request
for
writing
a
</ins><a href="#dfn-properties" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
is
received
and
defines
what
to
do
</ins>
with
<ins class="diff-new">such
requests.
It
expects
</ins>
the
<del class="diff-old">same
error,
</del>
<ins class="diff-chg">requested
new
</ins><code><ins class="diff-chg">
value
</ins></code><ins class="diff-chg">
as
argument
</ins>
and
<del class="diff-old">resolve
promise
</del>
<ins class="diff-chg">returns
a
</ins><a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects"><ins class="diff-chg">
Promise
</ins></a><ins class="diff-chg">
which
is
resolved
when
the
value
of
the
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins>
</a>
<ins class="diff-new">that
matches
the
</ins><code><ins class="diff-new">
name
</ins></code><ins class="diff-new">
argument
has
been
updated
</ins>
with
<code>
<ins class="diff-new">value
</ins></code>,<ins class="diff-new">
or
rejects
with
an
error
if
</ins>
the
<del class="diff-old">same
value.
</del>
<ins class="diff-chg">property
is
not
found
or
the
value
cannot
be
updated.
</ins></p><div class="note" id="issue-container-generatedID-8"><div role="heading" class="ednote-title marker" id="h-ednote-3" aria-level="4"><span><ins class="diff-chg">
Editor's
note
</ins></span></div><p class=""><ins class="diff-chg">
Note
that
the
code
in
this
callback
function
can
read
the
property
before
updating
it
in
order
to
find
out
the
old
value,
if
needed.
Therefore
the
old
value
is
not
provided
to
this
function.
</ins></p></div>
</section>
<section id="the-setpropertywritehandler-method">
<h3 id="x7-8-the-setpropertywritehandler-method">
<del class="diff-old">5.13
</del>
<bdi class= "secno">
<ins class="diff-chg">7.8
</ins></bdi>
The
<dfn data-dfn-type="method" data-export="" id="dom-exposedthing-setpropertywritehandler" data-idl="operation" data-title="setPropertyWriteHandler()" data-dfn-for="ExposedThing" data-type="ExposedThing" data-lt= "ExposedThing.setPropertyWriteHandler()|ExposedThing.setPropertyWriteHandler|setPropertyWriteHandler()|setPropertyWriteHandler">
<code>
setPropertyWriteHandler()
</code>
</dfn>
method
<a class= "self-link" aria-label="§" href= "#the-setpropertywritehandler-method">
</a>
</h3>
<p>
Takes
<code>
name
</code>
as
string
argument
and
<code>
writeHandler
</code>
as
argument
of
type
<a href= "#dom-propertywritehandler" class="internalDFN" data-link-type= "idl">
<code>
PropertyWriteHandler
</code>
</a>.
Sets
the
<ins class="diff-new">service
</ins>
handler
<del class="diff-old">function
</del>
for
writing
the
specified
<a href="#dfn-properties" class= "internalDFN" data-link-type="dfn">
Property
</a>
matched
by
<code>
name
</code>.
Throws
on
error.
Returns
a
reference
to
<del class="diff-old">the
same
</del>
<var>
<ins class="diff-chg">this
</ins></var>
object
for
supporting
chaining.
</p>
<p>
There
<del class="diff-old">SHOULD
</del>
<em class="rfc2119" title="MUST">
<ins class="diff-chg">MUST
</ins>
</em>
be
at
most
one
write
handler
for
any
given
<a href="#dfn-properties" class= "internalDFN" data-link-type="dfn">
Property
<del class="diff-old">and
</del>
</a>,
<ins class="diff-chg">so
</ins>
newly
added
handlers
<em class="rfc2119" title="MUST">
<ins class="diff-new">MUST
</ins></em>
replace
the
<del class="diff-old">old
</del>
<ins class="diff-chg">previous
</ins>
handlers.
If
no
write
handler
is
initialized
for
any
given
<a href="#dfn-properties" class="internalDFN" data-link-type= "dfn">
Property
</a>,
implementations
<em class="rfc2119" title= "SHOULD">
SHOULD
</em>
implement
default
property
update
and
notifying
observers
on
<del class="diff-old">change.
</del>
<ins class="diff-chg">change,
based
on
the
</ins><a href= "#dfn-thing-descriptions" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Thing
Description
</ins></a>.
</p>
</section>
<section id="handling-property-write-requests">
<h3 id="x7-9-handling-property-write-requests">
<bdi class= "secno">
<ins class="diff-new">7.9
</ins></bdi><ins class="diff-new">
Handling
</ins><a href="#dfn-properties" class= "internalDFN" data-link-type="dfn"><ins class="diff-new">
Property
</ins></a><ins class="diff-new">
write
requests
</ins><a class="self-link" aria-label="§" href= "#handling-property-write-requests"></a></h3><div>
<p>
When
<del class="diff-old">an
external
</del>
<ins class="diff-chg">a
network
</ins>
request
for
writing
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
<var>
propertyName
</var>
with
a
new
value
<var>
value
</var>
is
received,
<del class="diff-old">the
runtime
</del>
<ins class="diff-chg">implementations
</ins>
<em class="rfc2119" title= "SHOULD">
SHOULD
</em>
<del class="diff-old">execute
</del>
<ins class="diff-chg">run
</ins>
the
following
<del class="diff-old">steps:
</del>
<dfn data-dfn-type="dfn" id= "dfn-update-property-steps">
<ins class="diff-chg">update
property
steps
</ins></dfn>,<ins class="diff-chg">
given
</ins><var><ins class="diff-chg">
propertyName
</ins></var>,<var><ins class="diff-chg">
value
</ins></var><ins class="diff-chg">
and
</ins><var><ins class="diff-chg">
mode
</ins></var><ins class="diff-chg">
set
to
</ins><code><ins class="diff-chg">
"single"
</ins></code>:
</p>
<ol>
<li>
<del class="diff-old">Return
a
Promise
promise
and
execute
the
next
steps
in
parallel
.
</del>
If
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
with
<var>
propertyName
</var>
does
not
exist,
<del class="diff-old">reject
promise
with
a
</del>
<ins class="diff-chg">return
</ins>
<code>
ReferenceError
</code>
<ins class="diff-new">in
the
reply
</ins>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">Otherwise,
</del>
<ins class="diff-chg">If
there
is
a
user
provided
write
handler
registered
with
</ins><code><ins class="diff-chg">
setPropertyWriteHandler()
</ins></code>,<ins class="diff-chg">
or
</ins>
if
<del class="diff-old">no
</del>
<ins class="diff-chg">there
is
a
default
</ins>
write
<ins class="diff-new">handler,
</ins><ol><li><ins class="diff-new">
Invoke
the
</ins>
handler
<del class="diff-old">has
been
defined
for
</del>
<ins class="diff-chg">with
</ins>
<var>
propertyName
<del class="diff-old">,
</del>
</var>.
<ins class="diff-chg">If
it
fails,
return
</ins>
the
<del class="diff-old">runtime
implementation
SHOULD
update
</del>
<ins class="diff-chg">error
in
</ins>
the
<ins class="diff-chg">reply
and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Otherwise,
if
</ins><var><ins class="diff-chg">
mode
</ins></var><ins class="diff-chg">
is
</ins><code><ins class="diff-chg">
"single"
</ins></code>,<ins class="diff-chg">
reply
to
the
request
with
the
new
value,
following
to
the
</ins><a href= "#dfn-protocol-bindings" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Protocol
Bindings
</ins></a>.</li><li><ins class="diff-chg">
For
each
item
stored
in
the
</ins><a href= "#dfn-internal-observer-list" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
internal
observer
list
</ins></a><ins class="diff-chg">
of
the
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
<del class="diff-old">value
</del>
with
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">propertyName
</ins>
</var>,
<del class="diff-old">resolve
promise
</del>
<ins class="diff-chg">send
an
observe
reply
with
the
new
value
attached.
</ins></li></ol></li><li><ins class="diff-chg">
If
there
is
no
handler
to
handle
the
request,
return
</ins><a data-link-type="dfn" href= "https://heycam.github.io/webidl/#notsupportederror"><code><ins class="diff-chg">
NotSupportedError
</ins></code></a><ins class="diff-chg">
in
the
reply
</ins>
and
terminate
these
steps.
</li>
<del class="diff-old">Otherwise,
invoke
</del>
</ol>
</div>
<div>
<p>
<ins class="diff-chg">When
a
network
request
for
writing
multiple
</ins><a href= "#dfn-properties" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Properties
</ins></a><ins class="diff-chg">
given
in
an
object
</ins><var><ins class="diff-chg">
propertyNames
</ins></var><ins class="diff-chg">
is
received,
run
</ins>
the
<del class="diff-old">write
handler
associated
</del>
<ins class="diff-chg">following
steps:
</ins></p><ol><li><ins class="diff-chg">
For
each
property
</ins>
with
<ins class="diff-new">key
</ins>
<var>
<del class="diff-old">propertyName
</del>
<ins class="diff-chg">name
</ins>
</var>
<del class="diff-old">providing
</del>
<ins class="diff-chg">and
value
</ins>
<var>
value
</var>
<del class="diff-old">as
argument.
If
it
rejects,
then
reject
</del>
<ins class="diff-chg">defined
in
</ins>
<var>
<del class="diff-old">promise
with
</del>
<ins class="diff-chg">propertyNames
</ins></var>,<ins class="diff-chg">
run
</ins>
the
<del class="diff-old">same
error,
and
resolve
promise
</del>
<a href="#dfn-update-property-steps" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">update
property
steps
</ins>
</a>
with
<var>
<ins class="diff-new">name
</ins></var>,<var><ins class="diff-new">
value
</ins></var><ins class="diff-new">
and
</ins><var><ins class="diff-new">
mode
</ins></var><ins class="diff-new">
set
to
</ins><code><ins class="diff-new">
"multiple"
</ins></code>.</li><li><ins class="diff-new">
Reply
to
</ins>
the
<del class="diff-old">same
value.
</del>
<ins class="diff-chg">request
(by
sending
a
single
or
multiple
replies)
according
to
the
</ins><a href="#dfn-protocol-bindings" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins></a><ins class="diff-chg">
defined
for
the
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a>.
</li>
</ol>
</div>
</section>
<section data-dfn-for="ActionHandler" id= "the-actionhandler-callback">
<h3 id="x7-10-the-actionhandler-callback">
<bdi class= "secno">
<ins class="diff-new">7.10
</ins></bdi><ins class="diff-new">
The
</ins><dfn data-dfn-type="callback" data-export="" id="dom-actionhandler" data-idl="callback" data-title= "ActionHandler"><code><ins class="diff-new">
ActionHandler
</ins></code></dfn><ins class="diff-new">
callback
</ins><a class= "self-link" aria-label="§" href= "#the-actionhandler-callback"></a></h3><p><ins class="diff-new">
A
function
that
is
called
when
an
external
request
for
invoking
an
</ins><a href="#dfn-actions" class="internalDFN" data-link-type= "dfn"><ins class="diff-new">
Action
</ins></a><ins class="diff-new">
is
received
and
defines
what
to
do
with
such
requests.
It
is
invoked
with
a
</ins><code><ins class="diff-new">
params
</ins></code><ins class="diff-new">
dictionary
argument.
It
returns
a
</ins><a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects"><ins class="diff-new">
Promise
</ins></a><ins class="diff-new">
that
rejects
with
an
error
or
resolves
if
the
action
is
successful.
</ins></p>
</section>
<section id="the-setactionhandler-method">
<h3 id="x7-11-the-setactionhandler-method">
<del class="diff-old">5.14
</del>
<bdi class= "secno">
<ins class="diff-chg">7.11
</ins></bdi>
The
<dfn data-dfn-type="method" data-export="" id="dom-exposedthing-setactionhandler" data-idl="operation" data-title="setActionHandler()" data-dfn-for="ExposedThing" data-type="ExposedThing" data-lt= "ExposedThing.setActionHandler()|ExposedThing.setActionHandler|setActionHandler()|setActionHandler">
<code>
setActionHandler()
</code>
</dfn>
method
<a class="self-link" aria-label="§" href="#the-setactionhandler-method">
</a>
</h3>
<p>
Takes
<code>
name
</code>
as
string
argument
and
<code>
action
</code>
as
argument
of
type
<a href= "#dom-actionhandler" class="internalDFN" data-link-type= "idl">
<code>
ActionHandler
</code>
</a>.
Sets
the
handler
function
for
the
specified
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
</a>
matched
by
<code>
name
</code>.
Throws
on
error.
Returns
a
reference
to
<del class="diff-old">the
same
</del>
<var>
<ins class="diff-chg">this
</ins></var>
object
for
supporting
chaining.
</p>
<p>
The
<code>
action
</code>
callback
function
will
implement
an
<a href="#dfn-actions" class="internalDFN" data-link-type= "dfn">
Action
</a>
and
<em class="rfc2119" title="SHOULD">
SHOULD
</em>
be
called
by
implementations
when
a
request
for
invoking
the
<a href="#dfn-actions" class="internalDFN" data-link-type= "dfn">
Action
</a>
is
received
from
the
underlying
platform.
</p>
<p>
There
<del class="diff-old">SHOULD
</del>
<em class="rfc2119" title="MUST">
<ins class="diff-chg">MUST
</ins>
</em>
be
at
most
one
handler
for
any
given
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
<del class="diff-old">and
</del>
</a>,
<ins class="diff-chg">so
</ins>
newly
added
handlers
<em class= "rfc2119" title="MUST">
<ins class="diff-new">MUST
</ins></em>
replace
the
<del class="diff-old">old
</del>
<ins class="diff-chg">previous
</ins>
handlers.
</p>
</section>
<section id="handling-action-requests">
<h3 id="x7-12-handling-action-requests">
<bdi class= "secno">
<ins class="diff-new">7.12
</ins></bdi><ins class="diff-new">
Handling
</ins><a href="#dfn-actions" class= "internalDFN" data-link-type="dfn"><ins class="diff-new">
Action
</ins></a><ins class="diff-new">
requests
</ins><a class= "self-link" aria-label="§" href= "#handling-action-requests"></a></h3><div>
<p>
When
<del class="diff-old">an
external
</del>
<ins class="diff-chg">a
network
</ins>
request
for
invoking
the
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
</a>
identified
by
<var>
name
</var>
is
received,
the
runtime
<em class="rfc2119" title= "SHOULD">
SHOULD
</em>
execute
the
following
steps:
</p>
<ol>
<li>
<del class="diff-old">Return
a
Promise
promise
and
execute
the
next
steps
in
parallel
.
</del>
If
an
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
</a>
identified
by
<var>
name
</var>
does
not
exist,
<del class="diff-old">reject
promise
with
a
</del>
<ins class="diff-chg">return
</ins>
<code>
ReferenceError
</code>
<ins class="diff-new">in
the
reply
</ins>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">Otherwise,
if
no
</del>
<ins class="diff-chg">If
there
is
a
user
provided
</ins>
action
handler
<del class="diff-old">has
been
defined
for
</del>
<ins class="diff-chg">registered
with
</ins><code><ins class="diff-chg">
setActionHandler()
</ins></code>,<ins class="diff-chg">
invoke
that
wih
</ins>
<var>
name
</var>,
<del class="diff-old">reject
promise
</del>
<ins class="diff-chg">return
the
resulting
value
with
the
reply
and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Otherwise
return
</ins><a data-link-type="dfn" href= "https://heycam.github.io/webidl/#notsupportederror"><code><ins class="diff-chg">
NotSupportedError
</ins></code>
</a>
with
<ins class="diff-new">the
reply
and
terminate
these
steps.
</ins></li></ol></div></section><section id="the-emitevent-method"><h3 id="x7-13-the-emitevent-method"><bdi class="secno"><ins class="diff-new">
7.13
</ins></bdi><ins class="diff-new">
The
</ins><dfn data-dfn-type="method" data-export="" id= "dom-exposedthing-emitevent" data-idl="operation" data-title= "emitEvent()" data-dfn-for="ExposedThing" data-type="void" data-lt= "ExposedThing.emitEvent()|ExposedThing.emitEvent|emitEvent()|emitEvent"><code><ins class="diff-new">
emitEvent()
</ins></code></dfn><ins class="diff-new">
method
</ins><a class="self-link" aria-label="§" href="#the-emitevent-method"></a></h3><div><p><ins class="diff-new">
Takes
</ins><var><ins class="diff-new">
name
</ins></var><ins class="diff-new">
as
string
argument
denoting
an
</ins><a href= "#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Event
</ins></a><ins class="diff-new">
name,
and
</ins>
a
<var>
<ins class="diff-new">data
</ins></var><ins class="diff-new">
argument
of
</ins>
<code>
<del class="diff-old">ReferenceError
</del>
<ins class="diff-chg">any
</ins></code><ins class="diff-chg">
type.
The
method
</ins><em class="rfc2119" title="MUST"><ins class="diff-chg">
MUST
</ins></em><ins class="diff-chg">
run
the
following
steps:
</ins></p><ol><li><ins class="diff-chg">
If
invoking
this
method
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
throw
</ins><code><ins class="diff-chg">
SecurityError
</ins>
</code>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">Otherwise,
invoke
the
Action
</del>
<ins class="diff-chg">If
an
</ins><a href="#dfn-events" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Event
</ins>
</a>
<del class="diff-old">handler
associated
</del>
with
<ins class="diff-new">the
name
</ins>
<var>
name
<del class="diff-old">.
If
it
rejects
with
</del>
</var>
<ins class="diff-chg">is
not
found
in
</ins>
<var>
<del class="diff-old">error
</del>
<ins class="diff-chg">this.getThingDescription().events
</ins>
</var>,
<ins class="diff-new">throw
</ins><code><ins class="diff-new">
NotFoundError
</ins></code><ins class="diff-new">
and
terminate
these
steps.
</ins></li><li><ins class="diff-new">
Make
a
request
to
the
underlying
platform
to
send
an
</ins><a href= "#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Event
</ins></a><ins class="diff-new">
with
</ins><var><ins class="diff-new">
data
</ins></var><ins class="diff-new">
attached
as
property,
using
the
</ins><a href= "#dfn-protocol-bindings" class="internalDFN" data-link-type= "dfn"><ins class="diff-new">
Protocol
Bindings
</ins></a>,
then
<ins class="diff-new">terminate
these
steps.
</ins></li></ol></div></section><section id="the-expose-method"><h3 id="x7-14-the-expose-method"><bdi class="secno"><ins class="diff-new">
7.14
</ins></bdi><ins class="diff-new">
The
</ins><dfn data-dfn-type="method" data-export="" id= "dom-exposedthing-expose" data-idl="operation" data-title= "expose()" data-dfn-for="ExposedThing" data-type="Promise" data-lt= "ExposedThing.expose()|ExposedThing.expose|expose()|expose"><code><ins class="diff-new">
expose()
</ins></code></dfn><ins class="diff-new">
method
</ins><a class="self-link" aria-label="§" href= "#the-expose-method"></a></h3><div><p><ins class="diff-new">
Start
serving
external
requests
for
the
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Thing
</ins></a>,<ins class="diff-new">
so
that
</ins><a href="#dfn-wot-interactions" class="internalDFN" data-link-type= "dfn"><ins class="diff-new">
WoT
Interactions
</ins></a><ins class="diff-new">
using
</ins><a href="#dfn-properties" class= "internalDFN" data-link-type="dfn"><ins class="diff-new">
Properties
</ins></a>,<a href= "#dfn-actions" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Action
</ins></a><ins class="diff-new">
s
and
</ins><a href="#dfn-events" class="internalDFN" data-link-type= "dfn"><ins class="diff-new">
Event
</ins></a><ins class="diff-new">
s
will
be
possible.
The
method
</ins><em class="rfc2119" title="MUST"><ins class="diff-new">
MUST
</ins></em><ins class="diff-new">
run
the
following
steps:
</ins></p><ol><li><ins class="diff-new">
Return
a
</ins><a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects"><ins class="diff-new">
Promise
</ins></a><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
and
execute
the
next
steps
</ins><a data-link-type= "dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-new">
in
parallel
</ins></a>.</li><li><ins class="diff-new">
If
invoking
this
method
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
</ins>
reject
<var>
promise
</var>
with
<code>
<ins class="diff-new">SecurityError
</ins></code><ins class="diff-new">
and
terminate
these
steps.
</ins></li><li><ins class="diff-new">
Run
</ins>
the
<del class="diff-old">same
</del>
<a href="#dfn-expand-a-td" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">expand
a
TD
</ins></a><ins class="diff-chg">
steps
on
the
internal
slot
|
</ins>
<var>
<del class="diff-old">error
,
otherwise
if
it
resolves
</del>
<ins class="diff-chg">td
</ins></var><ins class="diff-chg">
|.
</ins></li><li><ins class="diff-chg">
Run
the
</ins><a href="#dfn-validate-a-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
validate
a
TD
</ins></a><ins class="diff-chg">
on
|
</ins><var><ins class="diff-chg">
td
</ins></var><ins class="diff-chg">
|.
If
that
fails,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var>
with
<code>
<ins class="diff-new">"TypeError"
</ins></code><ins class="diff-new">
and
terminate
these
steps.
</ins></li><li><ins class="diff-new">
For
each
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Property
</ins></a><ins class="diff-new">
definition
in
</ins>
<var>
<ins class="diff-new">this.instance.properties
</ins></var><ins class="diff-new">
initialize
an
|
</ins><dfn data-dfn-type="dfn" id="dfn-internal-observer-list"><ins class="diff-new">
internal
observer
list
</ins></dfn><ins class="diff-new">
|
internal
slot
in
order
to
store
observe
request
data
needed
to
notify
the
observers
on
</ins>
value
<del class="diff-old">,
</del>
<ins class="diff-chg">changes.
</ins></li><li><ins class="diff-chg">
Set
up
the
</ins><a href="#dfn-wot-interactions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
WoT
Interactions
</ins></a><ins class="diff-chg">
based
on
introspecting
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
td
</ins></a><ins class="diff-chg">
as
explained
in
[
</ins><cite><a class="bibref" href="#bib-wot-td" title= "WoT Thing Description " data-link-type="biblio"><ins class="diff-chg">
WOT-TD
</ins></a></cite><ins class="diff-chg">
]
and
[
</ins><cite><a class="bibref" href="#bib-wot-protocol-bindings" title="Web of Things Protocol Binding Templates" data-link-type= "biblio"><ins class="diff-chg">
WOT-PROTOCOL-BINDINGS
</ins></a></cite><ins class="diff-chg">
].
Make
a
request
to
the
underlying
platform
to
initialize
the
</ins><a href= "#dfn-protocol-bindings" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Protocol
Bindings
</ins></a><ins class="diff-chg">
and
</ins>
then
<ins class="diff-new">start
serving
external
requests
for
</ins><a href="#dfn-wot-interactions" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
WoT
Interactions
</ins></a><ins class="diff-new">
(read,
write
and
observe
</ins><a href="#dfn-properties" class="internalDFN" data-link-type= "dfn"><ins class="diff-new">
Properties
</ins></a>,<ins class="diff-new">
invoke
</ins><a href="#dfn-actions" class= "internalDFN" data-link-type="dfn"><ins class="diff-new">
Action
</ins></a><ins class="diff-new">
s
and
manage
</ins><a href= "#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Event
</ins></a><ins class="diff-new">
subscriptions),
based
on
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Protocol
Bindings
</ins></a>.<ins class="diff-new">
The
details
are
private
to
the
implementations
and
out
of
scope
of
this
specification.
</ins></li><li><ins class="diff-new">
If
there
was
an
error
during
the
request,
reject
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
an
</ins><code><ins class="diff-new">
Error
</ins></code><ins class="diff-new">
object
</ins><var><ins class="diff-new">
error
</ins></var><ins class="diff-new">
with
</ins><code><ins class="diff-new">
error.message
</ins></code><ins class="diff-new">
set
to
the
error
code
seen
by
the
</ins><a href="#dfn-protocol-bindings" class= "internalDFN" data-link-type="dfn"><ins class="diff-new">
Protocol
Bindings
</ins></a><ins class="diff-new">
and
terminate
these
steps.
</ins></li><li><ins class="diff-new">
Otherwise
</ins>
resolve
<var>
promise
</var>
<ins class="diff-new">and
terminate
these
steps.
</ins></li></ol></div></section><section id="the-destroy-method"><h3 id="x7-15-the-destroy-method"><bdi class="secno"><ins class="diff-new">
7.15
</ins></bdi><ins class="diff-new">
The
</ins><dfn data-dfn-type="method" data-export="" id= "dom-exposedthing-destroy" data-idl="operation" data-title= "destroy()" data-dfn-for="ExposedThing" data-type="Promise" data-lt="ExposedThing.destroy()|ExposedThing.destroy|destroy()|destroy"><code><ins class="diff-new">
destroy()
</ins></code></dfn><ins class="diff-new">
method
</ins><a class="self-link" aria-label= "§" href="#the-destroy-method"></a></h3><div><p><ins class="diff-new">
Stop
serving
external
requests
for
the
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Thing
</ins></a><ins class="diff-new">
and
destroy
the
object.
Note
that
eventual
unregistering
should
be
done
before
invoking
this
method.
The
method
</ins><em class="rfc2119" title= "MUST"><ins class="diff-new">
MUST
</ins></em><ins class="diff-new">
run
the
following
steps:
</ins></p><ol><li><ins class="diff-new">
Return
a
</ins><a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects"><ins class="diff-new">
Promise
</ins>
</a>
<var>
<ins class="diff-new">promise
</ins></var><ins class="diff-new">
and
execute
the
next
steps
</ins><a data-link-type= "dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-new">
in
parallel
</ins></a>.</li><li><ins class="diff-new">
If
invoking
this
method
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
reject
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
</ins><code><ins class="diff-new">
SecurityError
</ins></code><ins class="diff-new">
and
terminate
these
steps.
</ins></li><li><ins class="diff-new">
Make
a
request
to
the
underlying
platform
to
stop
serving
external
requests
for
</ins><a href="#dfn-wot-interactions" class= "internalDFN" data-link-type="dfn"><ins class="diff-new">
WoT
Interactions
</ins></a>,<ins class="diff-new">
based
on
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Protocol
Bindings
</ins></a>.</li><li><ins class="diff-new">
If
there
was
an
error
during
the
request,
reject
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
an
</ins><code><ins class="diff-new">
Error
</ins></code><ins class="diff-new">
object
</ins><var><ins class="diff-new">
error
</ins></var>
with
<code>
<ins class="diff-new">error.message
</ins></code><ins class="diff-new">
set
to
</ins>
the
<del class="diff-old">same
</del>
<ins class="diff-chg">error
code
seen
by
the
</ins><a href="#dfn-protocol-bindings" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins></a><ins class="diff-chg">
and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Otherwise
resolve
</ins>
<var>
<del class="diff-old">value
.
</del>
<ins class="diff-chg">promise
</ins></var><ins class="diff-chg">
and
terminate
these
steps.
</ins>
</li>
</ol>
</div>
</section>
<section id="exposedthing-examples">
<h3 id="x7-16-exposedthing-examples">
<del class="diff-old">5.15
</del>
<bdi class="secno">
<ins class="diff-chg">7.16
</ins></bdi><ins class="diff-chg">
ExposedThing
</ins>
Examples
<a class="self-link" aria-label="§" href= "#exposedthing-examples">
</a>
</h3>
<p>
<del class="diff-old">Below
some
</del>
<ins class="diff-chg">The
next
example
illustrates
how
to
create
an
</ins>
<code>
<a href= "#dom-exposedthing" class="internalDFN" data-link-type= "idl">
<code>
ExposedThing
</code>
</a>
</code>
<del class="diff-old">interface
examples
are
given.
</del>
<ins class="diff-chg">based
on
a
partial
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
TD
</ins></a><ins class="diff-chg">
object
constructed
beforehands.
</ins>
</p>
<div class="example" id= "example-3-create-exposedthing-with-a-simple-property">
<div class="marker">
<a class="self-link" href= "#example-3-create-exposedthing-with-a-simple-property">
Example
<del class="diff-old">5
</del>
<bdi>
<ins class="diff-chg">3
</ins></bdi>
</a>
<span class="example-title">:
Create
<del class="diff-old">a
new
exposed
Thing
</del>
<ins class="diff-chg">ExposedThing
</ins>
with
a
simple
<del class="diff-old">property
</del>
<ins class="diff-chg">Property
</ins>
</span>
</div>
<del class="diff-old">         {
</del>
<pre class="highlight" aria-busy="false"><code class=
<ins class="diff-chg">"hljs javascript"><span class="hljs-keyword">try</span> {
</ins>
  <span class=
<del class="diff-old">"hljs-keyword"&gt;var temperatureValueDefinition = {
</del>
<ins class="diff-chg">"hljs-keyword">let</span> temperaturePropertyDefinition = {
</ins>
    <span class="hljs-attr">type</span>: <span class=
"hljs-string">"number"</span>,
    <span class="hljs-attr">minimum</span>: <span class=
"hljs-number">-50</span>,
    <span class="hljs-attr">maximum</span>: <span class=
"hljs-number">10000</span>
  };
<del class="diff-old">  &lt;span class=
"hljs-keyword"&gt;var temperaturePropertyDefinition = temperatureValueDefinition;
  
  temperaturePropertyDefinition.forms = [ ... ];
   thing = WoT.produce({
    : &lt;span class=
"hljs-string"&gt;"tempSensor",
</del>
  <span class="hljs-keyword">let</span> tdFragment = {
    <span class="hljs-attr">properties</span>: {
      <span class=
"hljs-attr">temperature</span>: temperaturePropertyDefinition
    },
    <span class="hljs-attr">actions</span>: {
      <span class="hljs-attr">reset</span>: {
        <span class="hljs-attr">description</span>: <span class=
"hljs-string">"Reset the temperature sensor"</span>,
        <span class="hljs-attr">input</span>: {
          <span class=
"hljs-attr">temperature</span>: temperatureValueDefinition
        },
        <span class="hljs-attr">output</span>: <span class=
"hljs-literal">null</span>,
        <span class="hljs-attr">forms</span>: []
      },
    },
    <span class="hljs-attr">events</span>: {
      <span class=
"hljs-attr">onchange</span>: temperatureValueDefinition
<del class="diff-old">    },
    : []
  });
   thing.expose();
   wot.register(&lt;span class=
"hljs-string"&gt;"https://mydirectory.org", thing);
  
  setInterval(  () =&gt; {
     mock = &lt;span class=
"hljs-built_in"&gt;Math.random()*&lt;span class=
"hljs-number"&gt;100;
     old = &lt;span class=
"hljs-keyword"&gt;await thing[&lt;span class=
"hljs-string"&gt;"temperature"].read();
     (old &lt; mock) {
       thing[&lt;span class=
"hljs-string"&gt;"temperature"].write(mock);
      thing.emitEvent(&lt;span class=
"hljs-string"&gt;"onchange", mock);
</del>
    }
<del class="diff-old">  }, );
</del>
<ins class="diff-chg">  };
</ins>  <span class="hljs-keyword">let</span> thing1 = <span class=<ins class="diff-chg">
"hljs-keyword">await</span> WOT.produce(tdFragment);
</ins>  <span class="hljs-comment">// initialize Properties</span>  <span class=<ins class="diff-chg">
"hljs-keyword">await</span> thing1.writeProperty(<span class=
"hljs-string">"temperature"</span>, <span class=
"hljs-number">0</span>);
</ins>  <span class="hljs-comment">// add service handlers</span><ins class="diff-chg">
  thing1.setPropertyReadHandler(<span class=
"hljs-string">"temperature"</span>, () =&gt; {
</ins>     <span class=<ins class="diff-chg">
"hljs-keyword">return</span> readLocalTemperatureSensor();  <span class="hljs-comment">// Promise</span>
  });
</ins>  <span class="hljs-comment">// start serving requests</span>  <span class="hljs-keyword">await</span> thing1.expose();
} <span class="hljs-keyword">catch</span> (err) {
   <span class="hljs-built_in">console</span>.log(<span class=
"hljs-string">"Error creating ExposedThing: "</span> + err);
}
</code>
</pre>
</div>
<p>
<ins class="diff-chg">The
next
example
illustrates
how
to
add
or
modify
a
</ins><a href= "#dfn-properties" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
definition
on
an
existing
</ins><code><a href= "#dom-exposedthing" class="internalDFN" data-link-type= "idl"><code><ins class="diff-chg">
ExposedThing
</ins></code></a></code>:<ins class="diff-chg">
take
its
</ins><var><ins class="diff-chg">
td
</ins></var><ins class="diff-chg">
property,
add
or
modify
it,
then
create
another
</ins><a href= "#dom-exposedthing" class="internalDFN" data-link-type= "idl"><code><ins class="diff-chg">
ExposedThing
</ins></code></a><ins class="diff-chg">
with
that.
</ins></p><div class="example" id="example-4-add-an-object-property">
<div class="marker">
<a class="self-link" href= "#example-4-add-an-object-property">
Example
<del class="diff-old">6
</del>
<bdi>
<ins class="diff-chg">4
</ins></bdi>
</a>
<span class="example-title">:
<del class="diff-old">Create
a
new
exposed
Thing
with
</del>
<ins class="diff-chg">Add
an
</ins>
object
<del class="diff-old">property
</del>
<ins class="diff-chg">Property
</ins>
</span>
</div>
<del class="diff-old">         {
   statusValueDefinition = {
</del>
<pre class="highlight" aria-busy="false"><code class=
<ins class="diff-chg">"hljs javascript"><span class="hljs-keyword">try</span> {
</ins>  <span class=<ins class="diff-chg">
"hljs-comment">// create a deep copy of thing1's TD</span>
</ins>  <span class="hljs-keyword">let</span> instance = <span class=<ins class="diff-chg">
"hljs-built_in">JSON</span>.parse(<span class=
"hljs-built_in">JSON</span>.stringify(thing1.td));
</ins>  <span class="hljs-keyword">const</span> statusValueDefinition = {
    <span class="hljs-attr">type</span>: <span class=
"hljs-string">"object"</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">brightness</span>: {
        <span class="hljs-attr">type</span>: <span class=
"hljs-string">"number"</span>,
        <span class="hljs-attr">minimum</span>: <span class=
"hljs-number">0.0</span>,
        <span class="hljs-attr">maximum</span>: <span class=
"hljs-number">100.0</span>,
        <span class="hljs-attr">required</span>: <span class=
"hljs-literal">true</span>
      },
      <span class="hljs-attr">rgb</span>: {
        <span class="hljs-attr">type</span>: <span class=
"hljs-string">"array"</span>,
        <span class="hljs-string">"minItems"</span>: <span class=
"hljs-number">3</span>,
        <span class="hljs-string">"maxItems"</span>: <span class=
"hljs-number">3</span>,
        <span class="hljs-attr">items</span> : {
            <span class="hljs-string">"type"</span> : <span class=
"hljs-string">"number"</span>,
            <span class=
"hljs-string">"minimum"</span>: <span class="hljs-number">0</span>,
            <span class=
"hljs-string">"maximum"</span>: <span class="hljs-number">255</span>
        }
      }
  };
<del class="diff-old">  &lt;span class=
"hljs-keyword"&gt;var statusPropertyDefinition = statusValueDefinition;
  
  statusPropertyDefinition[&lt;span class=
"hljs-string"&gt;"forms"] = [];
   thing = WoT.produce({
    : &lt;span class=
"hljs-string"&gt;"mySensor",
    : {
      : {
        : &lt;span class=
</del>
<ins class="diff-chg">  instance[<span class="hljs-string">"name"</span>] = <span class=
"hljs-string">"mySensor"</span>;
  instance.properties[<span class=
"hljs-string">"brightness"</span>] = {
</ins>    <span class="hljs-attr">type</span>: <span class=
"hljs-string">"number"</span>,
<del class="diff-old">        : &lt;span class=
</del>
    <span class="hljs-attr">minimum</span>: <span class=
"hljs-number">0.0</span>,
<del class="diff-old">        : &lt;span class=
</del>
    <span class="hljs-attr">maximum</span>: <span class=
"hljs-number">100.0</span>,
<del class="diff-old">        : &lt;span class=
</del>
    <span class="hljs-attr">required</span>: <span class=
"hljs-literal">true</span>,
<del class="diff-old">      },
      &lt;span class=
"hljs-attr"&gt;status: statusPropertyDefinition
    },
    : {
      : {
        : &lt;span class=
</del>
<ins class="diff-chg">  };
  instance.properties[<span class=
"hljs-string">"status"</span>] = statusValueDefinition;
  instance.actions[<span class=
"hljs-string">"getStatus"</span>] = {
</ins>    <span class="hljs-attr">description</span>: <span class=
"hljs-string">"Get status object"</span>,
<del class="diff-old">        : &lt;span class=
</del>
    <span class="hljs-attr">input</span>: <span class=
"hljs-literal">null</span>,
<del class="diff-old">        : {
          &lt;span class=
"hljs-attr"&gt;status : statusValueDefinition;
        },
        : []
      },
    },
    : {
</del>
    <span class="hljs-attr">output</span>: {
      <span class=
<del class="diff-old">"hljs-attr"&gt;onstatuschange: statusValueDefinition;
</del>
<ins class="diff-chg">"hljs-attr">status</span> : statusValueDefinition;
</ins>
    },
<del class="diff-old">    : []
  });
  thing.expose().then(&lt;span class=
"hljs-params"&gt;() {
      thing.register();
</del>
    <span class="hljs-attr">forms</span>: [...]
<ins class="diff-chg">  };
  instance.events[<span class=
"hljs-string">"onstatuschange"</span>] = statusValueDefinition;
  instance.forms = [...];  <span class=
"hljs-comment">// update</span>
</ins>  <span class="hljs-keyword">var</span> thing2 = <span class=<ins class="diff-chg">
"hljs-keyword">new</span> ExposedThing(instance);
</ins>  <span class="hljs-comment">// <span class=<ins class="diff-chg">
"hljs-doctag">TODO:</span> add service handlers</span>
</ins>  <span class="hljs-keyword">await</span> thing2.expose();
  });
} <span class="hljs-keyword">catch</span> (err) {
   <span class="hljs-built_in">console</span>.log(<span class=
"hljs-string">"Error creating ExposedThing: "</span> + err);
}
<del class="diff-old">Example
7
:
Create
a
new
exposed
Thing
from
a
Thing
Description
        &lt;span class=
"hljs-keyword"&gt;let thingDescription = &lt;span class=
"hljs-string"&gt;'{ \
  "name": "mySensor", \
  "@context": [ "http://www.w3.org/ns/td",\
     "https://w3c.github.io/wot/w3c-wot-common-context.jsonld" ],\
  "@type": [ "Thing", "Sensor" ], \
  "geo:location": "testspace", \
  "properties": { \
    "prop1": { \
      "type": "number",\
      "@type": [ "Property", "Temperature" ], \
      "saref:TemperatureUnit": "degree_Celsius" \
  } } }';
 {
  &lt;span class=
"hljs-comment"&gt;// note that produce() fails if thingDescription contains error
  &lt;span class=
"hljs-keyword"&gt;let thing = WoT.produce(thingDescription);
  &lt;span class=
"hljs-comment"&gt;// Interactions were added from TD
  &lt;span class=
"hljs-comment"&gt;// WoT adds generic handler for reading any property
  &lt;span class=
"hljs-comment"&gt;// define a specific handler for one property
   name = &lt;span class=
"hljs-string"&gt;"examplePropertyName";
  thing.setPropertyReadHandler(name, () =&gt; {
    .log(&lt;span class=
"hljs-string"&gt;"Handling read request for " + name);
     &lt;span class=
"hljs-keyword"&gt;new &lt;span class=
"hljs-built_in"&gt;Promise(&lt;span class=
"hljs-function"&gt;(&lt;span class=
"hljs-params"&gt;resolve, reject {
        &lt;span class=
"hljs-keyword"&gt;let examplePropertyValue = &lt;span class=
"hljs-number"&gt;5;
        resolve(examplePropertyValue);
      },
      e =&gt; {
        .log(&lt;span class=
"hljs-string"&gt;"Error");
      });
  });
  thing.expose();
} (err) {
   .log(&lt;span class=
"hljs-string"&gt;"Error creating ExposedThing: " + err);
}
Example
8
:
Create
a
new
exposed
Thing
from
a
TD
URI
</del>
</code>
<del class="diff-old">        &lt;span class=
"hljs-comment"&gt;// fetch an external TD, e.g., to set up a proxy for that Thing
WoT.fetch(&lt;span class=
"hljs-string"&gt;"http://myservice.org/mySensor/description" {
  &lt;span class=
"hljs-comment"&gt;// WoT.produce() ignores instance-specific metadata (security, form)
   thing = WoT.produce(td);
  &lt;span class=
"hljs-comment"&gt;// Interactions were added from TD
  
  
});
</del>
</pre>
</div>
</section>
</section>
<del class="diff-old">6.
Data
types
and
structures
The
[
WOT-TD
</del>
<section data-dfn-for="ThingDiscovery" id= "the-thingdiscovery-interface">
<h2 id="x8-the-thingdiscovery-interface">
<del class="diff-old">]
specification
defines
the
WoT
information
model
,
i.e.
the
data
types
and
data
structures
used
in
WoT
Interactions
.
In
this
API
these
definitions
translate
to
dictionary
objects
that
are
extended
with
methods
by
the
interfaces
defined
in
this
specification.
In
order
to
avoid
duplication
of
definitions,
references
to
these
data
types
and
structures
is
defined
in
this
section,
but
for
their
full
description
please
refer
to
the
Thing
Description
specification
.
6.1
</del>
<bdi class= "secno">
<ins class="diff-chg">8.
</ins></bdi>
The
<dfn data-dfn-type="interface" data-export="" id="dom-thingdiscovery" data-idl="interface" data-title= "ThingDiscovery">
<code>
<del class="diff-old">DataSchema
</del>
<ins class="diff-chg">ThingDiscovery
</ins>
</code>
</dfn>
<del class="diff-old">dictionary
and
its
subclasses
</del>
<ins class="diff-chg">interface
</ins><a class="self-link" aria-label="§" href= "#the-thingdiscovery-interface">
</a>
</h2>
<p>
<del class="diff-old">Value
types
basically
represent
types
</del>
<ins class="diff-chg">Discovery
is
a
distributed
application
</ins>
that
<del class="diff-old">may
be
used
in
JSON
object
definitions
and
are
used
in
ThingFragment
to
define
Properties
,
Event
s
and
Action
parameters.
Value
types
are
represented
as
dictionary
objects
whose
properties
</del>
<ins class="diff-chg">requires
provisioning
</ins>
and
<del class="diff-old">possible
sub-classes
are
defined
in
</del>
<ins class="diff-chg">support
from
participating
network
nodes
(clients,
servers,
directory
services).
This
API
models
</ins>
the
<del class="diff-old">DataSchema
section
</del>
<ins class="diff-chg">client
side
</ins>
of
<del class="diff-old">[
WOT-TD
].
</del>
<ins class="diff-chg">typical
discovery
schemes
supported
by
various
IoT
deployments.
</ins>
</p>
<p>
<del class="diff-old">One
property
of
all
</del>
<ins class="diff-chg">The
</ins><a href="#dom-thingdiscovery" class="internalDFN" data-link-type="idl">
<code>
<del class="diff-old">DataSchema
</del>
<ins class="diff-chg">ThingDiscovery
</ins>
</code>
</a>
<del class="diff-old">dictionary
is
the
type
property
whose
value
</del>
<ins class="diff-chg">object
</ins>
is
<del class="diff-old">from
</del>
<ins class="diff-chg">constructed
given
</ins>
a
<del class="diff-old">set
of
enumerated
strings
defined
in
</del>
<ins class="diff-chg">filter
and
provides
</ins>
the
<del class="diff-old">DataSchema
section
of
[
WOT-TD
]
</del>
<ins class="diff-chg">properties
</ins>
and
<del class="diff-old">is
referred
as
DataType
in
this
specification.
Based
on
type
,
</del>
<ins class="diff-chg">methods
controlling
</ins>
the
<del class="diff-old">following
sub-classes
of
DataSchema
are
defined
in
[
WOT-TD
]:
BooleanSchema
,
NumberSchema
,
IntegerSchema
,
StringSchema
,
ObjectSchema
</del>
<ins class="diff-chg">discovery
process.
</ins></p><pre class="idl def"><span data-idl="" class="idlInterface" id=<ins class="diff-chg">
"idl-def-thingdiscovery" data-title="ThingDiscovery">[<span class=
"extAttr"><a data-xref-type="extended-attribute" data-cite-path=""
data-type="extended-attribute" href=
"https://heycam.github.io/webidl/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-xref-type="extended-attribute"
data-cite-path="" data-type="extended-attribute" href=
"https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<a data-xref-type="interface"
data-cite-path="window-object.html" data-type="interface" href=
"https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>,<a data-xref-type="interface"
data-lt="WorkerGlobalScope" data-cite-path="workers.html"
data-type="interface" href=
"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">Worker</a>)</span>]
interface <a class="internalDFN idlID" data-link-for=""
data-link-type="interface" href=
"#dom-thingdiscovery"><code>ThingDiscovery</code></a> {<span data-idl=""
class="idlConstructor" id=
"idl-def-thingdiscovery-constructor-filter" data-title=
"constructor" data-dfn-for="ThingDiscovery">
</ins>  <dfn data-export="" data-dfn-type="constructor" id=<ins class="diff-chg">
"dom-thingdiscovery-constructor" data-idl="constructor" data-title=
"constructor" data-dfn-for="ThingDiscovery" data-lt=
"ThingDiscovery.constructor()|ThingDiscovery.constructor|constructor()|constructor"><code>constructor</code></dfn>(optional<span class="idlType"> <a data-xref-type="_IDL_"
href="#dom-thingfilter" class="internalDFN" data-link-type=
"idl"><code>ThingFilter</code></a></span> <span class=
"idlParamName">filter</span> = null);</span><span data-idl=""
class="idlAttribute" id="idl-def-thingdiscovery-filter" data-title=
"filter" data-dfn-for="ThingDiscovery">
  readonly attribute<span class="idlType"> <a data-xref-type=
"_IDL_" href="#dom-thingfilter" class="internalDFN" data-link-type=
"idl"><code>ThingFilter</code></a>?</span> <a class=
"internalDFN idlName" data-link-for="ThingDiscovery"
data-link-type="attribute" href=
"#dom-thingdiscovery-filter"><code>filter</code></a>;</span><span data-idl=""
class="idlAttribute" id="idl-def-thingdiscovery-active" data-title=
"active" data-dfn-for="ThingDiscovery">
  readonly attribute<span class="idlType"> <a data-xref-type=
"_IDL_" data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-boolean">boolean</a></span> <a class="internalDFN idlName"
data-link-for="ThingDiscovery" data-link-type="attribute" href=
"#dom-thingdiscovery-active"><code>active</code></a>;</span><span data-idl=""
class="idlAttribute" id="idl-def-thingdiscovery-done" data-title=
"done" data-dfn-for="ThingDiscovery">
  readonly attribute<span class="idlType"> <a data-xref-type=
"_IDL_" data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-boolean">boolean</a></span> <a class="internalDFN idlName"
data-link-for="ThingDiscovery" data-link-type="attribute" href=
"#dom-thingdiscovery-done"><code>done</code></a>;</span><span data-idl=""
class="idlAttribute" id="idl-def-thingdiscovery-error" data-title=
"error" data-dfn-for="ThingDiscovery">
  readonly attribute<span class="idlType"> <a data-xref-type=
"_IDL_" data-link-type="dfn" href=
"https://tc39.github.io/ecma262/#sec-error-objects">Error</a>?</span> <a class="internalDFN idlName"
data-link-for="ThingDiscovery" data-link-type="attribute" href=
"#dom-thingdiscovery-error"><code>error</code></a>;</span><span data-idl=""
class="idlMethod" id="idl-def-thingdiscovery-start" data-title=
"start" data-dfn-for="ThingDiscovery"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" data-cite-path="" data-type="interface"<ins class="diff-chg">
href=
"https://heycam.github.io/webidl/#idl-void">void</a></span> <a class="internalDFN idlName"
data-link-for="ThingDiscovery" data-link-type="method" href=
"#dom-thingdiscovery-start"><code>start</code></a>();</span><span data-idl=""
class="idlMethod" id="idl-def-thingdiscovery-next" data-title=
"next" data-dfn-for="ThingDiscovery"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
href="#dom-thingdescription" class="internalDFN" data-link-type=
"idl"><code>ThingDescription</code></a>&gt;</span> <a class=
"internalDFN idlName" data-link-for="ThingDiscovery"
data-link-type="method" href=
"#dom-thingdiscovery-next"><code>next</code></a>();</span><span data-idl=""
class="idlMethod" id="idl-def-thingdiscovery-stop" data-title=
"stop" data-dfn-for="ThingDiscovery"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" data-cite-path="" data-type="interface"<ins class="diff-chg">
href=
"https://heycam.github.io/webidl/#idl-void">void</a></span> <a class="internalDFN idlName"
data-link-for="ThingDiscovery" data-link-type="method" href=
"#dom-thingdiscovery-stop"><code>stop</code></a>();</span>
};
</ins></span>
<del class="diff-old">,
ArraySchema
</del>
</pre>
<div class="note" id="issue-container-generatedID-9">
<div role="heading" class="ednote-title marker" id="h-ednote-4" aria-level="3">
<del class="diff-old">.
6.2
</del>
<span>
<ins class="diff-chg">Editor's
note
</ins>
</span>
</div>
<p class="">
The
<a href="#dom-thingdiscovery" class="internalDFN" data-link-type="idl">
<code>
<del class="diff-old">SecurityScheme
</del>
<ins class="diff-chg">ThingDiscovery
</ins>
</code>
<del class="diff-old">dictionary
and
its
subclasses
</del>
</a>
<del class="diff-old">Security
metadata
is
represented
as
dictionary
objects
whose
properties
</del>
<ins class="diff-chg">interface
has
a
</ins><code><ins class="diff-chg">
next()
</ins></code><ins class="diff-chg">
method
</ins>
and
<del class="diff-old">sub-classes
are
defined
in
the
SecurityScheme
section
of
[
WOT-TD
</del>
<ins class="diff-chg">a
</ins><code><ins class="diff-chg">
done
</ins></code><ins class="diff-chg">
property,
but
it
is
not
an
</ins><a href=""><ins class="diff-chg">
Iterable
</ins></a>.<ins class="diff-chg">
Look
into
</ins><a href= "https://github.com/w3c/wot-scripting-api/issues/177"><ins class="diff-chg">
Issue
177
</ins>
</a>
<del class="diff-old">].
</del>
<ins class="diff-chg">for
rationale.
</ins>
</p>
</div>
<p>
<del class="diff-old">One
property
of
</del>
<ins class="diff-chg">The
</ins><dfn data-dfn-type="dfn" id= "dfn-discovery-results"><ins class="diff-chg">
discovery
results
</ins></dfn><ins class="diff-chg">
internal
slot
is
an
internal
queue
for
temporarily
storing
</ins>
the
<ins class="diff-chg">found
</ins><a href= "#dom-thingdescription" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">SecurityScheme
</del>
<ins class="diff-chg">ThingDescription
</ins>
</code>
</a>
<del class="diff-old">dictionary
is
</del>
<ins class="diff-chg">objects
until
they
are
consumed
by
</ins>
the
<del class="diff-old">scheme
property
whose
value
is
from
a
set
of
enumerated
strings
defined
in
</del>
<ins class="diff-chg">application
using
</ins>
the
<del class="diff-old">SecurityScheme
</del>
<a href= "#the-next-method">
<ins class="diff-chg">next()
</ins>
</a>
<del class="diff-old">section
</del>
<ins class="diff-chg">method.
Implementations
</ins><em class= "rfc2119" title="MAY"><ins class="diff-chg">
MAY
</ins></em><ins class="diff-chg">
optimize
the
size
</ins>
of
<del class="diff-old">[
WOT-TD
].
Based
</del>
<ins class="diff-chg">this
queue
based
</ins>
on
<del class="diff-old">type
,
multiple
subclasses
</del>
<ins class="diff-chg">e.g.
the
available
resources
and
the
frequency
</ins>
of
<del class="diff-old">SecurityScheme
</del>
<ins class="diff-chg">invoking
the
</ins><a href="#the-next-method"><ins class="diff-chg">
next()
</ins>
</a>
<del class="diff-old">are
defined.
</del>
<ins class="diff-chg">method.
</ins>
</p>
<del class="diff-old">6.3
</del>
<p>
The
<dfn data-dfn-type="attribute" data-export="" id= "dom-thingdiscovery-filter" data-idl="attribute" data-title= "filter" data-dfn-for="ThingDiscovery" data-type="ThingFilter" data-lt="ThingDiscovery.filter|filter">
<code>
<del class="diff-old">Link
</del>
<ins class="diff-chg">filter
</ins>
</code>
</dfn>
<del class="diff-old">dictionary
Represents
a
Web
Link
with
properties
defined
in
</del>
<ins class="diff-chg">property
represents
</ins>
the
<del class="diff-old">Link
section
</del>
<ins class="diff-chg">discovery
filter
</ins>
of
<del class="diff-old">[
WOT-TD
].
6.4
The
</del>
<ins class="diff-chg">type
</ins><a href= "#dom-thingfilter" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">Form
</del>
<ins class="diff-chg">ThingFilter
</ins>
</code>
<del class="diff-old">dictionary
</del>
</a>
<del class="diff-old">Represents
metadata
describing
service
details,
with
properties
defined
in
</del>
<ins class="diff-chg">specified
for
</ins>
the
<del class="diff-old">Form
section
of
[
WOT-TD
].
</del>
<ins class="diff-chg">discovery.
</ins>
</p>
<del class="diff-old">6.5
The
InteractionFragment
dictionary
</del>
<p>
<del class="diff-old">Represents
the
common
properties
of
WoT
Interactions
,
one
of
Property
,
Action
or
Event
,
as
defined
in
the
InteractionPattern
section
of
[
WOT-TD
].
Its
subclasses
are
referred
as
</del>
<ins class="diff-chg">The
</ins><dfn data-dfn-type="attribute" data-export="" id= "dom-thingdiscovery-active" data-idl="attribute" data-title= "active" data-dfn-for="ThingDiscovery" data-type="boolean" data-lt= "ThingDiscovery.active|active">
<code>
<del class="diff-old">PropertyFragment
</del>
<ins class="diff-chg">active
</ins>
</code>
<del class="diff-old">,
</del>
</dfn>
<ins class="diff-chg">property
is
</ins>
<code>
<del class="diff-old">ActionFragment
</del>
<ins class="diff-chg">true
</ins>
</code>
<ins class="diff-chg">when
the
discovery
is
actively
ongoing
on
protocol
level
(i.e.
new
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
TD
</ins>
</a>
<ins class="diff-new">s
may
still
arrive)
</ins>
and
<code>
<del class="diff-old">EventFragment
</del>
<ins class="diff-chg">false
</ins>
</code>
<del class="diff-old">.
</del>
<ins class="diff-chg">otherwise.
</ins>
</p>
<del class="diff-old">6.6
</del>
<p>
The
<dfn data-dfn-type="attribute" data-export="" id= "dom-thingdiscovery-done" data-idl="attribute" data-title="done" data-dfn-for="ThingDiscovery" data-type="boolean" data-lt= "ThingDiscovery.done|done">
<code>
<del class="diff-old">PropertyFragment
</del>
<ins class="diff-chg">done
</ins>
</code>
</dfn>
<del class="diff-old">dictionary
Represents
the
Property
interaction
data
that
initializes
a
</del>
<ins class="diff-chg">property
is
</ins>
<code>
<del class="diff-old">ThingProperty
</del>
<ins class="diff-chg">true
</ins>
</code>
<del class="diff-old">object.
Its
properties
are
defined
in
</del>
<ins class="diff-chg">if
</ins>
the
<del class="diff-old">Property
</del>
<ins class="diff-chg">discovery
has
been
completed
with
no
more
results
to
report
</ins>
and
<del class="diff-old">InteractionPattern
sections
of
[
WOT-TD
</del>
<a href="#dfn-discovery-results" class= "internalDFN" data-link-type="dfn">
<ins class="diff-chg">discovery
results
</ins>
</a>
<del class="diff-old">].
</del>
<ins class="diff-chg">is
also
empty.
</ins>
</p>
<del class="diff-old">6.7
</del>
<p>
The
<dfn data-dfn-type="attribute" data-export="" id= "dom-thingdiscovery-error" data-idl="attribute" data-title="error" data-dfn-for="ThingDiscovery" data-type="Error" data-lt= "ThingDiscovery.error|error">
<code>
<del class="diff-old">ActionFragment
</del>
<ins class="diff-chg">error
</ins>
</code>
</dfn>
<del class="diff-old">dictionary
Represents
</del>
<ins class="diff-chg">property
represents
</ins>
the
<del class="diff-old">Action
interaction
data
</del>
<ins class="diff-chg">last
error
</ins>
that
<del class="diff-old">initializes
a
ThingAction
object.
Its
properties
are
defined
in
</del>
<ins class="diff-chg">occured
during
</ins>
the
<del class="diff-old">Action
and
InteractionPattern
sections
of
[
WOT-TD
].
</del>
<ins class="diff-chg">discovery
process.
Typically
used
for
critical
errors
that
stop
discovery.
</ins>
</p>
<del class="diff-old">6.8
The
</del>
<section id="constructing-thingdiscovery">
<h3 id="x8-1-constructing-thingdiscovery">
<bdi class= "secno">
<ins class="diff-new">8.1
</ins></bdi><ins class="diff-new">
Constructing
</ins>
<code>
<del class="diff-old">EventFragment
</del>
<ins class="diff-chg">ThingDiscovery
</ins>
</code>
<del class="diff-old">dictionary
</del>
<a class= "self-link" aria-label="§" href= "#constructing-thingdiscovery">
</a>
</h3>
<div>
<p>
<del class="diff-old">Represents
the
Event
interaction
data
that
initializes
a
</del>
<ins class="diff-chg">To
create
</ins><a href="#dom-thingdiscovery" class="internalDFN" data-link-type="idl">
<code>
<del class="diff-old">ThingEvent
</del>
<ins class="diff-chg">ThingDiscovery
</ins>
</code>
</a>
<del class="diff-old">object.
Its
properties
are
defined
in
</del>
<ins class="diff-chg">with
</ins>
the
<del class="diff-old">Event
section
of
[
WOT-TD
].
6.9
The
ThingFragment
dictionary
The
</del>
<a href="#dom-thingfilter" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">ThingFragment
</del>
<ins class="diff-chg">ThingFilter
</ins>
</code>
</a>
<del class="diff-old">dictionary
is
defined
as
Thing
in
[
WOT-TD
].
It
is
a
dictionary
that
contains
properties
representing
semantic
metadata
and
interactions
(
Properties
,
Action
s
and
Event
s).
It
</del>
<var>
<ins class="diff-chg">filter
</ins></var>,<ins class="diff-chg">
run
the
following
steps:
</ins></p><ol><li><ins class="diff-chg">
If
</ins><var><ins class="diff-chg">
filter
</ins></var>
is
<del class="diff-old">used
for
initializing
</del>
<ins class="diff-chg">not
</ins>
an
<del class="diff-old">internal
representation
of
a
Thing
Description
and
its
properties
may
be
used
in
</del>
<ins class="diff-chg">object
or
</ins>
<code>
<del class="diff-old">ThingFilter
</del>
<ins class="diff-chg">null
</ins></code>,<ins class="diff-chg">
throw
</ins><code><ins class="diff-chg">
"TypeError"
</ins>
</code>
<del class="diff-old">.
6.10
The
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Let
</ins><var><ins class="diff-chg">
discovery
</ins></var><ins class="diff-chg">
be
a
new
</ins><a href="#dom-thingdiscovery" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">ThingDescription
</del>
<ins class="diff-chg">ThingDiscovery
</ins>
</code>
<del class="diff-old">type
</del>
</a>
<del class="diff-old">Serialized
representation
of
</del>
<ins class="diff-chg">object.
</ins></li><li><ins class="diff-chg">
Set
</ins>
the
<del class="diff-old">Thing
Description
</del>
<a href="#dom-thingdiscovery-filter">
<ins class="diff-chg">filter
</ins>
</a>
<del class="diff-old">(a
JSON-LD
</del>
<ins class="diff-chg">property
to
</ins><var><ins class="diff-chg">
filter
</ins></var>.</li><li><ins class="diff-chg">
Set
</ins><a href="#dom-thingdiscovery-active"><ins class="diff-chg">
active
</ins>
</a>
<del class="diff-old">document).
Note
In
this
version
of
the
API,
Thing
Description
</del>
<ins class="diff-chg">and
</ins><a href="#dom-thingdiscovery-done"><ins class="diff-chg">
done
</ins>
</a>
<del class="diff-old">s
are
represented
as
an
opaque
</del>
<ins class="diff-chg">to
</ins>
<code>
<del class="diff-old">USVString
that
can
be
transmitted
between
devices.
7.
Interfaces
for
WoT
Interactions
</del>
<ins class="diff-chg">false
</ins></code>.<ins class="diff-chg">
Set
</ins><a href="#dom-thingdiscovery-error"><ins class="diff-chg">
error
</ins>
</a>
<ins class="diff-chg">to
</ins><code><ins class="diff-chg">
null
</ins></code>.</li><li><ins class="diff-chg">
Return
</ins><var><ins class="diff-chg">
discovery
</ins></var>.</li></ol></div>
<p>
The
<del class="diff-old">data
types
and
structures
imported
from
[
WOT-TD
</del>
<a href="#the-start-method">
<ins class="diff-chg">start()
</ins>
</a>
<del class="diff-old">]
are
extended
by
this
specification
in
order
to
provide
the
interfaces
for
WoT
Interactions
.
Every
Thing
</del>
<ins class="diff-chg">method
sets
</ins><a href= "#dom-thingdiscovery-active"><ins class="diff-chg">
active
</ins>
</a>
<del class="diff-old">describes
its
metadata
as
defined
in
</del>
<ins class="diff-chg">to
</ins>
<code>
<del class="diff-old">ThingFragment
,
and
basic
interactions
defined
as
Properties
,
Action
</del>
<ins class="diff-chg">true
</ins></code>.<ins class="diff-chg">
The
</ins><a href="#the-stop-method"><ins class="diff-chg">
stop()
</ins>
</a>
<del class="diff-old">s
and
Event
</del>
<ins class="diff-chg">method
sets
</ins><a href= "#dom-thingdiscovery-active"><ins class="diff-chg">
active
</ins>
</a>
<del class="diff-old">s.
The
following
interfaces
are
used
for
representing
these
interactions.
7.1
The
</del>
<ins class="diff-chg">to
</ins><var><ins class="diff-chg">
false
</ins></var>,<ins class="diff-chg">
but
</ins><a href="#dom-thingdiscovery-done"><ins class="diff-chg">
done
</ins></a><ins class="diff-chg">
may
be
still
</ins>
<code>
<del class="diff-old">Interaction
</del>
<ins class="diff-chg">false
</ins>
</code>
<del class="diff-old">interface
The
</del>
<ins class="diff-chg">if
there
are
</ins><a href="#dom-thingdescription" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">Interaction
</del>
<ins class="diff-chg">ThingDescription
</ins>
</code>
</a>
<del class="diff-old">interface
is
an
abstract
class
to
represent
Thing
interactions:
Properties
,
Actions
</del>
<ins class="diff-chg">objects
in
the
</ins><a href= "#dfn-discovery-results" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
discovery
results
</ins>
</a>
<del class="diff-old">and
Events
</del>
<ins class="diff-chg">not
yet
consumed
with
</ins><a href= "#the-next-method"><ins class="diff-chg">
next()
</ins>
</a>.
</p>
<p>
<del class="diff-old">The
InteractionFragment
dictionary
holds
the
common
properties
</del>
<ins class="diff-chg">During
successive
calls
</ins>
of
<del class="diff-old">PropertyFragment
,
ActionFragment
and
EventFragment
dictionaries
used
for
initializing
ThingProperty
</del>
<a href= "#the-next-method">
<ins class="diff-chg">next()
</ins>
</a>,
<del class="diff-old">ThingAction
</del>
<a href= "#dom-thingdiscovery-active">
<ins class="diff-chg">active
</ins>
</a>
<del class="diff-old">and
</del>
<ins class="diff-chg">may
be
</ins>
<code>
<del class="diff-old">ThingEvent
</del>
<ins class="diff-chg">true
</ins>
</code>
<del class="diff-old">objects
in
a
</del>
<ins class="diff-chg">or
</ins>
<code>
<del class="diff-old">ThingFragment
</del>
<ins class="diff-chg">false
</ins></code>,<ins class="diff-chg">
but
</ins><a href="#dom-thingdiscovery-done"><ins class="diff-chg">
done
</ins>
</a>
<del class="diff-old">dictionary
used
for
creating
an
</del>
<ins class="diff-chg">is
set
to
</ins>
<code>
<del class="diff-old">ExposedThing
</del>
<ins class="diff-chg">false
</ins>
</code>
<ins class="diff-chg">by
</ins><a href= "#the-next-method"><ins class="diff-chg">
next()
</ins>
</a>
<del class="diff-old">object.
&lt;span class="idlInterface" id=
"idl-def-interaction" data-idl="" data-title=
"Interaction"&gt;interface &lt;span class=
"idlInterfaceID"&gt;&lt;a data-no-default="" data-link-for="" data-lt=""
href="#dom-interaction" class="internalDFN" data-link-type=
"dfn"&gt; {&lt;span class=
"idlAttribute" id="idl-def-interaction-forms" data-idl=""
data-title="forms" data-dfn-for="interaction"&gt;
  readonly attribute (&lt;a data-link-for=""
href="#dom-form" class="internalDFN" data-link-type=
"dfn"&gt; or &lt;a href=
"https://heycam.github.io/webidl/#idl-frozen-array"&gt;FrozenArray&lt;&lt;a data-link-for=""
href="#dom-form" class="internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlAttrName"&gt;&lt;a data-no-default="" data-link-for="interaction"
data-lt="interaction.forms|forms" href="#dom-interaction-forms"
class="internalDFN" data-link-type=
"dfn"&gt;
};
&lt;a href="#dom-interaction" class="internalDFN" data-link-type=
"dfn"&gt; includes &lt;a href=
"#dfn-interactionfragment" class="internalDFN" data-link-type=
"dfn"&gt;
InteractionFragment
</del>
<ins class="diff-chg">only
when
both
</ins><a href= "#dom-thingdiscovery-active"><ins class="diff-chg">
active
</ins>
</a>
<del class="diff-old">;
The
</del>
<ins class="diff-chg">is
</ins>
<code>
<del class="diff-old">forms
</del>
<ins class="diff-chg">false
</ins>
</code>
<del class="diff-old">read-only
property
represents
the
protocol
bindings
initialization
data
</del>
and
<a href="#dfn-discovery-results" class="internalDFN" data-link-type="dfn">
<ins class="diff-new">discovery
results
</ins></a>
is
<del class="diff-old">initialized
by
the
WoT
Runtime
.
</del>
<ins class="diff-chg">empty.
</ins>
</p>
</section>
<section data-dfn-for="DiscoveryMethod" id= "the-discoverymethod-enumeration">
<h3 id="x8-2-the-discoverymethod-enumeration">
<del class="diff-old">7.2
</del>
<bdi class= "secno">
<ins class="diff-chg">8.2
</ins></bdi>
The
<dfn data-dfn-type="typedef" data-export="" id="dom-discoverymethod" data-idl="typedef" data-title= "DiscoveryMethod">
<code>
<del class="diff-old">ThingProperty
</del>
<ins class="diff-chg">DiscoveryMethod
</ins>
</code>
</dfn>
<del class="diff-old">interface
</del>
<ins class="diff-chg">enumeration
</ins><a class="self-link" aria-label="§" href= "#the-discoverymethod-enumeration">
</a>
</h3>
<del class="diff-old">The
</del>
<pre class="idl def"><span data-idl="" class="idlTypedef" id=
<ins class="diff-chg">"idl-def-discoverymethod" data-title=
"DiscoveryMethod">typedef<span class="idlType"> <a data-xref-type=
"_IDL_" data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <a class="internalDFN idlID"
data-link-for="" data-link-type="typedef" href=
"#dom-discoverymethod">
</ins>
<code>
<del class="diff-old">ThingProperty
</del>
<ins class="diff-chg">DiscoveryMethod
</ins>
</code>
</a>
<del class="diff-old">interface
is
used
in
ConsumedThing
</del>
<ins class="diff-chg">;
</ins></span>
<del class="diff-old">and
</del>
</pre>
<p>
<ins class="diff-chg">Represents
the
discovery
type
to
be
used:
</ins></p><ul><li>
<del class="diff-old">ExposedThing
</del>
<dfn data-dfn-type="dfn" id="dfn-any">
<ins class="diff-chg">"any"
</ins></dfn><ins class="diff-chg">
does
not
provide
any
restriction
</ins></li><li>
<del class="diff-old">objects
to
represent
</del>
<dfn data-dfn-type="dfn" id="dfn-local">
<ins class="diff-chg">"local"
</ins></dfn><ins class="diff-chg">
for
discovering
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>
<del class="diff-old">Property
interactions.
The
</del>
<ins class="diff-chg">s
defined
in
the
same
device
or
connected
to
the
device
by
wired
or
wireless
means.
</ins></li><li>
<del class="diff-old">PropertyFragment
</del>
<dfn data-dfn-type="dfn" id="dfn-directory">
<ins class="diff-chg">"directory"
</ins></dfn><ins class="diff-chg">
for
discovery
based
on
a
service
provided
by
a
</ins><a href= "#dfn-thing-directory" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Thing
Directory
</ins></a>.</li><li>
<del class="diff-old">dictionary
is
used
</del>
<dfn data-dfn-type="dfn" id="dfn-multicast">
<ins class="diff-chg">"multicast"
</ins></dfn>
for
<del class="diff-old">initializing
Property
</del>
<ins class="diff-chg">discovering
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins>
</a>
<del class="diff-old">objects
</del>
<ins class="diff-chg">s
</ins>
in
<ins class="diff-new">the
device's
network
by
using
</ins>
a
<ins class="diff-chg">supported
multicast
protocol.
</ins></li></ul></section><section data-dfn-for="ThingFilter" id= "the-thingfilter-dictionary"><h3 id="x8-3-the-thingfilter-dictionary"><bdi class= "secno"><ins class="diff-chg">
8.3
</ins></bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="dictionary" data-export= "" id="dom-thingfilter" data-idl="dictionary" data-title= "ThingFilter">
<code>
<del class="diff-old">ThingFragment
</del>
<ins class="diff-chg">ThingFilter
</ins>
</code>
</dfn>
dictionary
<del class="diff-old">used
for
creating
an
ExposedThing
</del>
<a class= "self-link" aria-label="§" href= "#the-thingfilter-dictionary">
</a>
<del class="diff-old">object.
It
MUST
implement
one
of
the
DataSchema
</del>
</h3>
<p>
<ins class="diff-new">Represents
an
object
containing
the
constraints
for
discovering
</ins><a href="#dfn-things" class="internalDFN" data-link-type= "dfn"><ins class="diff-new">
Thing
</ins>
</a>
<del class="diff-old">dictionaries.
</del>
<ins class="diff-chg">s
as
key-value
pairs.
</ins>
</p>
<del class="diff-old">&lt;span class="idlInterface" id=
"idl-def-thingproperty" data-idl="" data-title=
"ThingProperty"&gt;interface &lt;span class=
"idlInterfaceID"&gt;&lt;a data-no-default="" data-link-for="" data-lt=""
href="#dom-thingproperty" class="internalDFN" data-link-type=
"dfn"&gt; : &lt;span class=
"idlSuperclass"&gt;&lt;a href="#dom-interaction" class="internalDFN"
data-link-type=
"dfn"&gt; {&lt;span class="idlMethod"
id="idl-def-thingproperty--name" data-idl="" data-title=""
data-dfn-for="thingproperty"&gt;
  // getter for PropertyFragment properties
   &lt;a href=
"https://heycam.github.io/webidl/#idl-any"&gt;any&lt;span class="idlMethod"
id="idl-def-thingproperty-read" data-idl="" data-title="read"
data-dfn-for="thingproperty"&gt;&lt;span class=
"idlSectionComment"&gt;
  // get and set interface for the Property
  &lt;a href=
"https://heycam.github.io/webidl/#idl-promise"&gt;Promise&lt;a data-no-default=""
data-link-for="thingproperty" data-lt=
"thingproperty.read()|thingproperty.read|read()|read" href=
"#dom-thingproperty-read" class="internalDFN" data-link-type=
"dfn"&gt;&lt;span class="idlMethod"
id="idl-def-thingproperty-write-value" data-idl="" data-title=
"write" data-dfn-for="thingproperty"&gt;
  &lt;a href=
"https://heycam.github.io/webidl/#idl-promise"&gt;Promise&lt;a data-no-default=""
data-link-for="thingproperty" data-lt=
"thingproperty.write()|thingproperty.write|write()|write" href=
"#dom-thingproperty-write" class="internalDFN" data-link-type=
"dfn"&gt;(&lt;span class=
"idlParam"&gt;&lt;a href=
"https://heycam.github.io/webidl/#idl-any"&gt;any
};
&lt;a href="#dom-thingproperty" class="internalDFN" data-link-type=
"dfn"&gt; includes &lt;a href=
"#dom-propertyfragment" class="internalDFN" data-link-type=
"dfn"&gt;&lt;span class=
"idlIncludes"&gt;
&lt;a href="#dom-thingproperty" class="internalDFN" data-link-type=
"dfn"&gt; includes &lt;a href=
"#dom-observable" class="internalDFN" data-link-type=
"dfn"&gt;
Observable
;
</del>
<pre class="idl def"><span data-idl="" class="idlDictionary" id=
<ins class="diff-chg">"idl-def-thingfilter" data-title="ThingFilter">dictionary <a class=
"internalDFN idlID" data-link-for="" data-link-type="dictionary"
href=
"#dom-thingfilter"><code>ThingFilter</code></a> {<span data-idl=""
class="idlMember" id="idl-def-thingfilter-method" data-title=
"method" data-dfn-for="ThingFilter"><span class="idlType">
  (<a data-xref-type="_IDL_" href="#dom-discoverymethod" class=
"internalDFN" data-link-type=
"idl"><code>DiscoveryMethod</code></a> or <a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a>)</span> <a class="internalDFN idlName"
data-link-for="ThingFilter" data-link-type="dict-member" href=
"#dom-thingfilter-method"><code>method</code></a> = "any";</span><span data-idl=""
class="idlMember" id="idl-def-thingfilter-url" data-title="url"
data-dfn-for="ThingFilter"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" data-cite-path="" data-type="interface"<ins class="diff-chg">
href=
"https://heycam.github.io/webidl/#idl-USVString">USVString</a>?</span> <a class="internalDFN idlName"
data-link-for="ThingFilter" data-link-type="dict-member" href=
"#dom-thingfilter-url"><code>url</code></a>;</span><span data-idl=
"" class="idlMember" id="idl-def-thingfilter-query" data-title=
"query" data-dfn-for="ThingFilter"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" data-cite-path="" data-type="interface"<ins class="diff-chg">
href=
"https://heycam.github.io/webidl/#idl-USVString">USVString</a>?</span> <a class="internalDFN idlName"
data-link-for="ThingFilter" data-link-type="dict-member" href=
"#dom-thingfilter-query"><code>query</code></a>;</span><span data-idl=""
class="idlMember" id="idl-def-thingfilter-fragment" data-title=
"fragment" data-dfn-for="ThingFilter"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-object">object</a>?</span> <a class="internalDFN idlName"
data-link-for="ThingFilter" data-link-type="dict-member" href=
"#dom-thingfilter-fragment"><code>fragment</code></a>;</span>
};
</ins>
</span>
</pre>
<p>
The
<del class="diff-old">ThingProperty
interface
contains
all
the
properties
defined
on
</del>
<dfn data-dfn-type="dict-member" data-export="" id= "dom-thingfilter-method" data-idl="field" data-title="method" data-dfn-for="ThingFilter" data-type= "DiscoveryMethod|DOMString">
<code>
<del class="diff-old">PropertyFragment
</del>
<ins class="diff-chg">method
</ins>
</code>
<del class="diff-old">as
read-only
properties.
The
type
</del>
</dfn>
<del class="diff-old">read-only
</del>
property
represents
the
<ins class="diff-new">discovery
</ins>
type
<del class="diff-old">definition
for
the
Property
as
a
DataSchema
dictionary
object.
The
writable
read-only
property
tells
whether
the
Property
value
can
</del>
<ins class="diff-chg">that
should
</ins>
be
<del class="diff-old">updated.
If
it
is
false
,
then
the
set(value)
method
SHOULD
always
reject.
The
observable
read-only
property
tells
whether
the
Property
supports
subscribing
to
value
change
notifications.
If
it
is
false
,
then
</del>
<ins class="diff-chg">used
in
</ins>
the
<del class="diff-old">subscribe()
method
SHOULD
always
fail.
</del>
<ins class="diff-chg">discovery
process.
</ins>
The
<del class="diff-old">constant
read-only
property
-
</del>
<ins class="diff-chg">possible
values
are
</ins>
defined
<del class="diff-old">in
DataSchema
-
tells
whether
the
Property
value
is
a
constant.
If
true
,
</del>
<ins class="diff-chg">by
</ins>
the
<code>
<del class="diff-old">set()
and
subscribe()
methods
SHOULD
always
fail.
The
</del>
<del class="diff-old">required
read-only
property
-
defined
in
</del>
<a href= "#dom-discoverymethod" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">DataSchema
</del>
<ins class="diff-chg">DiscoveryMethod
</ins>
</code>
</a>
<del class="diff-old">-
tells
whether
the
Property
should
be
always
present
on
the
</del>
<del class="diff-old">ExposedThing
</del>
</code>
<del class="diff-old">object.
</del>
<ins class="diff-chg">enumeration
that
</ins><em class="rfc2119" title="MAY"><ins class="diff-chg">
MAY
</ins></em><ins class="diff-chg">
be
extended
by
string
values
defined
by
solutions
(with
no
guarantee
of
interoperability).
</ins>
</p>
<p>
The
<dfn data-dfn-type="dict-member" data-export="" id= "dom-thingfilter-url" data-idl="field" data-title="url" data-dfn-for="ThingFilter" data-type= "USVString">
<code>
<del class="diff-old">read()
</del>
<ins class="diff-chg">url
</ins>
</code>
</dfn>
<del class="diff-old">method
will
fetch
</del>
<ins class="diff-chg">property
represents
additional
information
for
</ins>
the
<del class="diff-old">value
</del>
<ins class="diff-chg">discovery
method,
such
as
the
URL
</ins>
of
the
<del class="diff-old">Property
.
Returns
a
Promise
that
resolves
with
</del>
<ins class="diff-chg">target
entity
serving
</ins>
the
<del class="diff-old">value,
or
rejects
with
an
error.
The
write()
method
will
attempt
to
set
</del>
<ins class="diff-chg">discovery
request,
for
instance
</ins>
the
<del class="diff-old">value
</del>
<ins class="diff-chg">URL
</ins>
of
<del class="diff-old">the
Property
</del>
<ins class="diff-chg">a
</ins><a href="#dfn-thing-directory" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Thing
Directory
</ins>
</a>
<del class="diff-old">specified
in
the
</del>
<ins class="diff-chg">(if
</ins>
<code>
<del class="diff-old">value
</del>
<ins class="diff-chg">method
</ins>
</code>
<del class="diff-old">argument
whose
type
SHOULD
match
the
one
specified
by
the
</del>
<ins class="diff-chg">is
</ins>
<code>
<del class="diff-old">type
</del>
<ins class="diff-chg">"directory"
</ins>
</code>
<del class="diff-old">property.
Returns
</del>
<ins class="diff-chg">)
or
that
of
</ins>
a
<del class="diff-old">Promise
</del>
<a href="#dfn-things" class= "internalDFN" data-link-type="dfn">
<ins class="diff-chg">Thing
</ins>
</a>
<del class="diff-old">that
resolves
on
success,
or
rejects
on
an
error.
</del>
<ins class="diff-chg">(otherwise).
</ins>
</p>
<del class="diff-old">7.3
The
ThingAction
interface
&lt;span class="idlInterface" id=
"idl-def-thingaction" data-idl="" data-title=
"ThingAction"&gt;interface &lt;span class=
"idlInterfaceID"&gt;&lt;a data-no-default="" data-link-for="" data-lt=""
href="#dom-thingaction" class="internalDFN" data-link-type=
"dfn"&gt; : &lt;span class=
"idlSuperclass"&gt;&lt;a href="#dom-interaction" class="internalDFN"
data-link-type=
"dfn"&gt; {&lt;span class="idlMethod"
id="idl-def-thingaction-invoke-inputvalue" data-idl="" data-title=
"invoke" data-dfn-for="thingaction"&gt;
  &lt;a href=
"https://heycam.github.io/webidl/#idl-promise"&gt;Promise&lt;a data-no-default=""
data-link-for="thingaction" data-lt=
"thingaction.invoke()|thingaction.invoke|invoke()|invoke" href=
"#dom-thingaction-invoke" class="internalDFN" data-link-type=
"dfn"&gt;(&lt;span class=
"idlParam"&gt;optional &lt;a href=
"https://heycam.github.io/webidl/#idl-any"&gt;any
};
&lt;a href="#dom-thingaction" class="internalDFN" data-link-type=
"dfn"&gt; includes &lt;a href=
"#dom-actionfragment" class="internalDFN" data-link-type=
"dfn"&gt;
ActionFragment
;
</del>
<p>
The
<dfn data-dfn-type="dict-member" data-export="" id= "dom-thingfilter-query" data-idl="field" data-title="query" data-dfn-for="ThingFilter" data-type= "USVString">
<code>
<del class="diff-old">invoke()
</del>
<ins class="diff-chg">query
</ins>
</code>
</dfn>
<del class="diff-old">method
when
invoked,
starts
the
Action
interaction
with
the
input
value
provided
</del>
<ins class="diff-chg">property
represents
a
query
string
accepted
</ins>
by
the
<del class="diff-old">inputValue
argument.
If
inputValue
is
null
,
the
action
does
not
take
any
arguments
and
rejects
if
any
arguments
are
provided.
If
the
value
is
undefined
,
the
action
will
ignore
any
arguments
provided.
Otherwise
the
type
of
inputValue
SHOULD
match
the
DataSchema
definition
</del>
<ins class="diff-chg">implementation,
for
instance
a
SPARQL
or
JSON
query.
Support
may
be
implemented
locally
</ins>
in
the
<del class="diff-old">input
property.
Returns
a
Promise
</del>
<a href= "#dfn-wot-runtime" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">WoT
Runtime
</ins>
</a>
<del class="diff-old">that
will
reject
with
an
error
</del>
or
<del class="diff-old">will
resolve
with
</del>
<ins class="diff-chg">remotely
as
</ins>
a
<del class="diff-old">value
of
type
defined
by
the
output
property.
</del>
<ins class="diff-chg">service
in
a
</ins><a href= "#dfn-thing-directory" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Thing
Directory
</ins></a>.
</p>
<del class="diff-old">7.4
</del>
<p>
The
<dfn data-dfn-type="dict-member" data-export="" id= "dom-thingfilter-fragment" data-idl="field" data-title="fragment" data-dfn-for="ThingFilter" data-type= "object">
<code>
<del class="diff-old">ThingEvent
</del>
<ins class="diff-chg">fragment
</ins>
</code>
</dfn>
<del class="diff-old">interface
&lt;span class="idlInterface" id=
"idl-def-thingevent" data-idl="" data-title=
"ThingEvent"&gt;interface &lt;span class=
"idlInterfaceID"&gt;&lt;a data-no-default="" data-link-for="" data-lt=""
href="#dom-thingevent" class="internalDFN" data-link-type=
"dfn"&gt; : &lt;span class=
"idlSuperclass"&gt;&lt;a href="#dom-interaction" class="internalDFN"
data-link-type="dfn"&gt; {
};
&lt;a href="#dom-thingevent" class="internalDFN" data-link-type=
"dfn"&gt; includes &lt;a href=
"#dom-eventfragment" class="internalDFN" data-link-type=
"dfn"&gt;&lt;span class=
"idlIncludes"&gt;
&lt;a href="#dom-thingevent" class="internalDFN" data-link-type=
"dfn"&gt; includes &lt;a href=
"#dom-thingproperty" class="internalDFN" data-link-type=
"dfn"&gt;
ThingProperty
;
Since
ThingEvent
implements
Observable
through
the
ThingProperty
interface,
event
subscription
is
done
by
invoking
the
subscribe()
method
on
the
event
object
that
returns
</del>
<ins class="diff-chg">property
represents
</ins>
a
<del class="diff-old">cancelable
Subscription
.
</del>
<ins class="diff-chg">template
object
used
for
matching
property
by
property
against
discovered
</ins><a href="#dfn-things" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s.
</ins>
</p>
</section>
<section id="the-start-method">
<h3 id="x8-4-the-start-method">
<del class="diff-old">7.5
</del>
<bdi class="secno">
<ins class="diff-chg">8.4
</ins></bdi>
The
<dfn data-dfn-type="method" data-export="" id= "dom-thingdiscovery-start" data-idl="operation" data-title= "start()" data-dfn-for="ThingDiscovery" data-type="void" data-lt= "ThingDiscovery.start()|ThingDiscovery.start|start()|start">
<code>
<del class="diff-old">ExposedEvent
</del>
<ins class="diff-chg">start()
</ins>
</code>
</dfn>
<del class="diff-old">interface
</del>
<ins class="diff-chg">method
</ins><a class="self-link" aria-label="§" href= "#the-start-method">
</a>
</h3>
<div>
<del class="diff-old">&lt;span class="idlInterface" id=
"idl-def-exposedevent" data-idl="" data-title=
"ExposedEvent"&gt;interface &lt;span class=
"idlInterfaceID"&gt;&lt;a data-no-default="" data-link-for="" data-lt=""
href="#dom-exposedevent" class="internalDFN" data-link-type=
"dfn"&gt; : &lt;span class=
"idlSuperclass"&gt;&lt;a href="#dom-thingevent" class="internalDFN"
data-link-type=
"dfn"&gt; {&lt;span class="idlMethod"
id="idl-def-exposedevent-emit-payload" data-idl="" data-title=
"emit" data-dfn-for="exposedevent"&gt;
  void&lt;a data-no-default=""
data-link-for="exposedevent" data-lt=
"exposedevent.emit()|exposedevent.emit|emit()|emit" href=
"#dom-exposedevent-emit" class="internalDFN" data-link-type=
"dfn"&gt;(&lt;span class=
"idlParam"&gt;&lt;a href=
"https://heycam.github.io/webidl/#idl-any"&gt;any
};
7.5.1
</del>
<p>
<ins class="diff-chg">Starts
the
discovery
process.
</ins>
The
<del class="diff-old">emit()
</del>
method
<del class="diff-old">Emits
an
event
that
carries
data
specified
by
</del>
<em class="rfc2119" title="MUST">
<ins class="diff-chg">MUST
</ins></em><ins class="diff-chg">
run
</ins>
the
<del class="diff-old">payload
argument.
</del>
<ins class="diff-chg">following
steps:
</ins>
</p>
<del class="diff-old">7.6
The
value-matching
algorithm
The
value-matching
algorithm
</del>
<ol>
<li>
<ins class="diff-chg">If
invoking
this
method
</ins>
is
<del class="diff-old">applied
to
a
</del>
<ins class="diff-chg">not
allowed
for
the
current
scripting
context
for
security
reasons,
set
</ins>
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">this.error
</ins>
</var>
<del class="diff-old">input
in
relation
</del>
to
<del class="diff-old">a
valueType
property
of
type
</del>
<code>
<del class="diff-old">DataSchema
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
<del class="diff-old">,
for
instance
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
If
discovery
is
not
supported
by
</ins>
the
<ins class="diff-new">implementation,
set
</ins><var><ins class="diff-new">
this.error
</ins></var><ins class="diff-new">
to
</ins>
<code>
<del class="diff-old">value
</del>
<ins class="diff-chg">NotSupportedError
</ins>
</code>
and
<del class="diff-old">type
properties
of
</del>
<ins class="diff-chg">terminate
these
steps.
</ins></li><li><ins class="diff-chg">
If
</ins><var><ins class="diff-chg">
this.filter
</ins></var><ins class="diff-chg">
is
defined,
</ins><ul><li><ins class="diff-chg">
Let
</ins><var><ins class="diff-chg">
filter
</ins></var><ins class="diff-chg">
denote
</ins><var><ins class="diff-chg">
this.filter
</ins></var>.</li><li><ins class="diff-chg">
If
</ins><var><ins class="diff-chg">
filter.query
</ins></var><ins class="diff-chg">
is
defined,
pass
it
as
an
opaque
string
to
the
underlying
implementation
to
be
matched
against
discovered
items.
The
underlying
implementation
is
responsible
to
parse
it
e.g.
as
</ins>
a
<del class="diff-old">PropertyFragment
object,
</del>
<ins class="diff-chg">SPARQL
</ins>
or
<ins class="diff-new">JSON
query
and
match
it
against
</ins>
the
<a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn">
<ins class="diff-new">Thing
Description
</ins></a><ins class="diff-new">
s
found
during
the
discovery
process.
If
queries
are
not
supported,
set
</ins>
<var>
<del class="diff-old">inputValue
</del>
<ins class="diff-chg">this.error
</ins>
</var>
<del class="diff-old">parameter
</del>
to
<del class="diff-old">the
</del>
<code>
<del class="diff-old">invoke()
</del>
<ins class="diff-chg">NotSupportedError
</ins>
</code>
<del class="diff-old">method
of
a
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li></ul></li><li><ins class="diff-chg">
Create
the
</ins><a href="#dfn-discovery-results" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
discovery
results
</ins></a><ins class="diff-chg">
internal
slot
for
storing
discovered
</ins><a href="#dom-thingdescription" class= "internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">ThingAction
</del>
<ins class="diff-chg">ThingDescription
</ins>
</code>
</a>
<del class="diff-old">object
in
relation
</del>
<ins class="diff-chg">objects.
</ins></li><li><ins class="diff-chg">
Request
the
underlying
platform
</ins>
to
<ins class="diff-new">start
</ins>
the
<del class="diff-old">same
object.
It
executes
</del>
<ins class="diff-chg">discovery
process,
with
</ins>
the
following
<del class="diff-old">steps:
</del>
<ins class="diff-chg">parameters:
</ins><ul>
<li>
If
<var>
<del class="diff-old">valueType.type
</del>
<ins class="diff-chg">filter.method
</ins>
</var>
is
not
<del class="diff-old">defined,
</del>
<ins class="diff-chg">defined
</ins>
or
<del class="diff-old">does
not
fully
match
a
string
enumerated
in
DataType
,
return
false
.
Otherwise,
if
valueType.type
is
"null"
:
if
</del>
<ins class="diff-chg">the
</ins>
value
is
<code>
<del class="diff-old">null
,
return
true
</del>
<ins class="diff-chg">"any"
</ins>
</code>,
<del class="diff-old">otherwise
return
false
.
</del>
<ins class="diff-chg">use
the
widest
discovery
method
supported
by
the
underlying
platform.
</ins>
</li>
<li>
<del class="diff-old">Otherwise,
if
valueType.type
is
"boolean"
:
</del>
<ins class="diff-chg">Otherwise
</ins>
if
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">filter.method
</ins>
</var>
is
<del class="diff-old">either
true
or
</del>
<code>
<del class="diff-old">false
,
then
return
true
</del>
<ins class="diff-chg">"local"
</ins>
</code>,
<del class="diff-old">otherwise
return
false
.
</del>
<ins class="diff-chg">use
the
local
</ins><a href="#dfn-thing-directory" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Directory
</ins></a><ins class="diff-chg">
for
discovery.
Usually
that
defines
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s
deployed
in
the
same
device,
or
connected
to
the
device
in
slave
mode
(e.g.
sensors
connected
via
Bluetooth
or
a
serial
connection).
</ins>
</li>
<li>
<del class="diff-old">Otherwise,
if
valueType.type
is
"integer"
:
</del>
<ins class="diff-chg">Otherwise
</ins>
if
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">filter.method
</ins>
</var>
is
<del class="diff-old">not
an
integer
type
defined
by
the
underlying
platform
(such
as
long
or
</del>
<code>
<del class="diff-old">long
long
),
then
return
false
</del>
<ins class="diff-chg">"directory"
</ins>
</code>,
<del class="diff-old">otherwise
execute
</del>
<ins class="diff-chg">use
</ins>
the
<del class="diff-old">following
sub-steps:
If
valueType.minimum
is
defined
and
value
is
not
greater
or
equal
than
that
value,
return
</del>
<ins class="diff-chg">remote
</ins><a href= "#dfn-thing-directory" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Thing
Directory
</ins></a><ins class="diff-chg">
specified
in
</ins>
<var>
<del class="diff-old">false
</del>
<ins class="diff-chg">filter.url
</ins>
</var>.
</li>
<li>
<del class="diff-old">If
valueType.maximum
is
defined
and
</del>
<ins class="diff-chg">Otherwise
if
</ins>
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">filter.method
</ins>
</var>
is
<del class="diff-old">not
less
or
equal
than
that
value,
return
false
.
</del>
<code>
<ins class="diff-chg">"multicast"
</ins></code>,<ins class="diff-chg">
use
all
the
multicast
discovery
protocols
supported
by
the
underlying
platform.
</ins></li></ul>
</li>
<li>
<del class="diff-old">Return
</del>
<ins class="diff-chg">When
the
underlying
platform
has
started
the
discovery
process,
set
the
</ins><code><ins class="diff-chg">
active
</ins></code><ins class="diff-chg">
property
to
</ins>
<code>
true
</code>.
</li>
<li>
<del class="diff-old">Otherwise,
if
valueType.type
is
"number"
,
if
</del>
<ins class="diff-chg">Whenever
a
new
</ins><a href="#dfn-thing-descriptions" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Description
</ins></a>
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">td
</ins>
</var>
is
<del class="diff-old">not
an
integer
or
floating
point
type
defined
</del>
<ins class="diff-chg">discovered
</ins>
by
the
underlying
<del class="diff-old">platform
(such
as
long
or
long
long
or
double
),
then
return
false
,
otherwise
otherwise
execute
</del>
<ins class="diff-chg">platform,
run
</ins>
the
following
sub-steps:
<ol>
<li>
<del class="diff-old">If
valueType.minimum
is
defined
and
</del>
<a href="https://fetch.spec.whatwg.org/#fetch-api">
<ins class="diff-chg">Fetch
</ins></a>
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">td
</ins>
</var>
<del class="diff-old">is
not
greater
or
equal
than
that
value,
return
</del>
<ins class="diff-chg">as
a
JSON
object
</ins>
<var>
<del class="diff-old">false
</del>
<ins class="diff-chg">json
</ins>
</var>.
If
<ins class="diff-new">that
fails,
set
</ins>
<var>
<del class="diff-old">valueType.maximum
</del>
<ins class="diff-chg">this.error
</ins>
</var>
<del class="diff-old">is
defined
and
</del>
<ins class="diff-chg">to
</ins><code><ins class="diff-chg">
SyntaxError
</ins></code>,<ins class="diff-chg">
discard
</ins>
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">td
</ins>
</var>
<del class="diff-old">is
not
less
or
equal
than
that
value,
return
false
.
Return
true
.
</del>
<ins class="diff-chg">and
continue
the
discovery
process.
</ins>
</li>
<li>
<del class="diff-old">Otherwise,
if
</del>
<ins class="diff-chg">If
</ins>
<var>
<del class="diff-old">valueType.type
</del>
<ins class="diff-chg">filter.query
</ins>
</var>
is
<del class="diff-old">"string"
:
</del>
<ins class="diff-chg">defined,
check
</ins>
if
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">json
</ins>
</var>
is
<del class="diff-old">not
</del>
a
<del class="diff-old">string
type
defined
by
</del>
<ins class="diff-chg">match
for
</ins>
the
<del class="diff-old">underlying
platform,
then
return
</del>
<ins class="diff-chg">query.
The
matching
algorithm
is
encapsulated
by
implementations.
If
that
returns
</ins>
<code>
false
</code>,
<del class="diff-old">otherwise
return
true
.
In
this
case
the
algorithm
expects
a
third
parameter
</del>
<ins class="diff-chg">discard
</ins>
<var>
<del class="diff-old">valueType.enum
</del>
<ins class="diff-chg">td
</ins>
</var>
and
<del class="diff-old">runs
</del>
<ins class="diff-chg">continue
</ins>
the
<del class="diff-old">following
sub-steps:
</del>
<ins class="diff-chg">discovery
process.
</ins></li>
<li>
If
<var>
<del class="diff-old">valueType.enum
</del>
<ins class="diff-chg">filter.fragment
</ins>
</var>
is
<del class="diff-old">an
array
of
strings,
then
</del>
<ins class="diff-chg">defined,
for
each
property
defined
in
it,
check
</ins>
if
<ins class="diff-new">that
property
exists
in
</ins>
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">json.properties
</ins>
</var>
<del class="diff-old">fully
matches
one
of
</del>
<ins class="diff-chg">and
has
</ins>
the
<del class="diff-old">strings
defined
</del>
<ins class="diff-chg">same
value.
If
this
is
</ins><code><ins class="diff-chg">
false
</ins></code>
in
<del class="diff-old">the
array,
return
</del>
<ins class="diff-chg">any
checks,
discard
</ins>
<var>
<del class="diff-old">true
.
</del>
<ins class="diff-chg">td
</ins></var><ins class="diff-chg">
and
continue
the
discovery
process.
</ins>
</li>
<li>
<del class="diff-old">Otherwise,
return
</del>
<ins class="diff-chg">Otherwise
add
</ins>
<var>
<del class="diff-old">false
.
</del>
<ins class="diff-chg">td
</ins></var><ins class="diff-chg">
to
the
</ins><a href= "#dfn-discovery-results" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
discovery
results
</ins></a>.
</li>
<li>
<del class="diff-old">Otherwise,
</del>
<ins class="diff-chg">At
this
point
implementations
</ins><em class="rfc2119" title= "MAY"><ins class="diff-chg">
MAY
</ins></em><ins class="diff-chg">
control
the
flow
of
the
discovery
process
(depending
on
memory
constraints,
for
instance
temporarily
stop
discovery
</ins>
if
<del class="diff-old">valueType.type
</del>
<ins class="diff-chg">the
queue
</ins>
is
<del class="diff-old">"array"
,
execute
</del>
<ins class="diff-chg">getting
too
large,
or
resume
discovery
when
</ins>
the
<del class="diff-old">following
sub-steps:
If
value
</del>
<ins class="diff-chg">queue
</ins>
is
<del class="diff-old">not
an
array,
return
false
.
</del>
<ins class="diff-chg">emptied
sufficiently).
</ins></li></ol>
</li>
<li>
<del class="diff-old">If
</del>
<ins class="diff-chg">Whenever
an
error
occurs
during
the
discovery
process,
</ins><ol><li><ins class="diff-chg">
Set
</ins>
<var>
<del class="diff-old">valueType.minItems
</del>
<ins class="diff-chg">this.error
</ins>
</var>
<del class="diff-old">is
defined,
and
</del>
<ins class="diff-chg">to
a
new
</ins><code><ins class="diff-chg">
Error
</ins></code><ins class="diff-chg">
object
</ins>
<var>
<del class="diff-old">value
does
not
contain
at
least
</del>
<ins class="diff-chg">error
</ins></var>.<ins class="diff-chg">
Set
</ins>
<var>
<del class="diff-old">valueType.minItems
</del>
<ins class="diff-chg">error.name
</ins>
</var>
<del class="diff-old">elements,
return
false
.
</del>
<ins class="diff-chg">to
</ins><code><ins class="diff-chg">
'DiscoveryError'
</ins></code>.
</li>
<li>
If
<ins class="diff-new">there
was
an
error
code
or
message
provided
by
the
</ins><a href= "#dfn-protocol-bindings" class="internalDFN" data-link-type= "dfn"><ins class="diff-new">
Protocol
Bindings
</ins></a>,<ins class="diff-new">
set
</ins>
<var>
<del class="diff-old">valueType.maxItems
</del>
<ins class="diff-chg">error.message
</ins>
</var>
<del class="diff-old">is
defined,
and
</del>
<ins class="diff-chg">to
that
</ins>
value
<del class="diff-old">contains
more
than
valueType.maxItems
elements,
return
false
.
</del>
<ins class="diff-chg">as
string.
</ins>
</li>
<li>
<del class="diff-old">Otherwise,
if
valueType.items
</del>
<ins class="diff-chg">If
the
error
</ins>
is
<ins class="diff-new">irrecoverable
and
discovery
has
been
stopped
by
the
underlying
platform,
set
</ins>
<code>
<del class="diff-old">undefined
,
return
</del>
<ins class="diff-chg">this.active
</ins></code><ins class="diff-chg">
to
</ins>
<code>
false
</code>.
</li>
<del class="diff-old">Otherwise,
if
valueType.items
is
null
,
return
true
(i.e.
any
type
is
accepted
as
array
element,
including
heterogenous
arrays).
</del>
</ol>
</li>
<li>
<del class="diff-old">Otherwise,
for
each
element
of
the
array
value
run
</del>
<ins class="diff-chg">When
</ins>
the
<del class="diff-old">value-matching
algorithm
against
</del>
<ins class="diff-chg">underlying
platform
reports
</ins>
the
<ins class="diff-new">discovery
process
has
completed,
set
</ins>
<var>
<del class="diff-old">valueType.items
</del>
<ins class="diff-chg">this.active
</ins>
</var>
<del class="diff-old">object.
If
any
of
these
runs
returns
false
,
then
return
</del>
<ins class="diff-chg">to
</ins>
<code>
false
</code>.
</li>
<del class="diff-old">Otherwise,
return
true
.
</del>
</ol>
<del class="diff-old">Otherwise,
if
type
is
</del>
</div>
</section>
<section id="the-next-method">
<h3 id="x8-5-the-next-method">
<bdi class="secno">
<ins class="diff-chg">8.5
</ins></bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="method" data-export="" id= "dom-thingdiscovery-next" data-idl="operation" data-title="next()" data-dfn-for="ThingDiscovery" data-type="Promise" data-lt= "ThingDiscovery.next()|ThingDiscovery.next|next()|next">
<code>
<del class="diff-old">"object"
,
execute
</del>
<ins class="diff-chg">next()
</ins></code></dfn><ins class="diff-chg">
method
</ins><a class="self-link" aria-label="§" href= "#the-next-method"></a></h3><div><p><ins class="diff-chg">
Provides
the
next
discovered
</ins><a href="#dom-thingdescription" class="internalDFN" data-link-type= "idl"><code><ins class="diff-chg">
ThingDescription
</ins></code></a><ins class="diff-chg">
object.
The
method
</ins><em class="rfc2119" title="MUST"><ins class="diff-chg">
MUST
</ins></em><ins class="diff-chg">
run
</ins>
the
following
<del class="diff-old">sub-steps:
</del>
<ins class="diff-chg">steps:
</ins></p>
<ol>
<li>
<del class="diff-old">If
</del>
<ins class="diff-chg">Return
a
</ins><a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects"><ins class="diff-chg">
Promise
</ins></a>
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">promise
</ins>
</var>
<del class="diff-old">is
not
an
Object
,
return
false
.
</del>
<ins class="diff-chg">and
execute
the
next
steps
</ins><a data-link-type= "dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-chg">
in
parallel
</ins></a>.
</li>
<li>
If
<var>
<del class="diff-old">valueType.properties
</del>
<ins class="diff-chg">this.active
</ins>
</var>
is
<del class="diff-old">not
defined,
return
</del>
<code>
<del class="diff-old">false
.
</del>
<ins class="diff-chg">true
</ins></code>,<ins class="diff-chg">
wait
until
the
</ins><a href="#dfn-discovery-results" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
discovery
results
</ins></a><ins class="diff-chg">
internal
slot
is
not
empty.
</ins>
</li>
<li>
If
<a href="#dfn-discovery-results" class="internalDFN" data-link-type="dfn">
<ins class="diff-new">discovery
results
</ins></a><ins class="diff-new">
is
empty
and
</ins>
<var>
<del class="diff-old">valueType.properties
</del>
<ins class="diff-chg">this.active
</ins>
</var>
is
<code>
<del class="diff-old">null
</del>
<ins class="diff-chg">false
</ins>
</code>,
<del class="diff-old">return
</del>
<ins class="diff-chg">set
</ins><var><ins class="diff-chg">
this.done
</ins></var><ins class="diff-chg">
to
</ins>
<code>
true
</code>
<del class="diff-old">(i.e.
accept
any
object
value).
</del>
<ins class="diff-chg">and
reject
</ins><var><ins class="diff-chg">
promise
</ins></var>.
</li>
<li>
<del class="diff-old">For
each
string
in
the
valueType.required
array,
if
it
does
not
match
a
property
name
in
</del>
<ins class="diff-chg">Remove
</ins>
the
<del class="diff-old">value.properties
</del>
<ins class="diff-chg">first
</ins><a href="#dom-thingdescription" class= "internalDFN" data-link-type= "idl"><code><ins class="diff-chg">
ThingDescription
</ins></code></a>
object
<del class="diff-old">or
in
the
</del>
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">td
</ins>
</var>
<del class="diff-old">object,
then
return
false
.
</del>
<ins class="diff-chg">from
</ins><a href="#dfn-discovery-results" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
discovery
results
</ins></a>.
</li>
<li>
<del class="diff-old">For
each
property
with
name
propName
and
value
</del>
<ins class="diff-chg">Resolve
</ins>
<var>
<del class="diff-old">propDataSchema
</del>
<ins class="diff-chg">promise
</ins>
</var>
<del class="diff-old">found
in
valueType.properties
,
run
the
following
sub-steps:
If
the
result
of
applying
the
value-matching
algorithm
on
the
value
</del>
<ins class="diff-chg">with
</ins>
<var>
<del class="diff-old">value[propName]
</del>
<ins class="diff-chg">td
</ins>
</var>
and
<del class="diff-old">propDataSchema
is
false
,
then
return
false
.
Return
true
.
</del>
<ins class="diff-chg">terminate
these
steps.
</ins>
</li>
</ol>
</div>
</section>
<section id="the-stop-method">
<h3 id="x8-6-the-stop-method">
<del class="diff-old">8.
Observables
</del>
<bdi class="secno">
<ins class="diff-chg">8.6
</ins></bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="method" data-export="" id= "dom-thingdiscovery-stop" data-idl="operation" data-title="stop()" data-dfn-for="ThingDiscovery" data-type="void" data-lt= "ThingDiscovery.stop()|ThingDiscovery.stop|stop()|stop">
<code>
<ins class="diff-chg">stop()
</ins></code>
</dfn>
<ins class="diff-chg">method
</ins><a class="self-link" aria-label="§" href= "#the-stop-method">
<del class="diff-old">This
section
is
non-normative.
</del>
</a>
</h3>
<div>
<p>
<del class="diff-old">Observables
are
proposed
to
</del>
<ins class="diff-chg">Stops
or
suppresses
the
discovery
process.
It
might
not
</ins>
be
<del class="diff-old">included
in
ECMAScript
</del>
<ins class="diff-chg">supported
by
all
discovery
methods
</ins>
and
<del class="diff-old">are
used
for
handling
pushed
data
associated
with
various
possible
sources,
for
instance
events,
timers,
streams,
etc.
A
minimal
required
implementation
is
described
here.
Editor's
note
This
section
is
informal
</del>
<ins class="diff-chg">endpoints,
however,
any
further
discovery
results
or
errors
will
be
discarded
</ins>
and
<del class="diff-old">contains
rather
laconic
information
for
implementations
on
what
to
support
for
interoperability.
&lt;span class="idlInterface" id=
"idl-def-observable" data-idl="" data-title=
"Observable"&gt;interface &lt;span class=
"idlInterfaceID"&gt;&lt;a data-no-default="" data-link-for="" data-lt=""
href="#dom-observable" class="internalDFN" data-link-type=
"dfn"&gt; {&lt;span class="idlMethod"
id="idl-def-observable-subscribe-handler-errorhandler-oncomplete"
data-idl="" data-title="subscribe" data-dfn-for=
"observable"&gt;
  &lt;a data-link-for="" href="#dom-subscription" class="internalDFN"
data-link-type=
"dfn"&gt; &lt;span class=
"idlMethName"&gt;&lt;a data-no-default="" data-link-for="observable"
data-lt="subscribe|subscribe()" href="#dom-observable-subscribe"
class="internalDFN" data-link-type=
"dfn"&gt;(&lt;span class=
"idlParam"&gt;&lt;a href=
"https://www.w3.org/TR/html52/single-page.html#typedefdef-eventhandler"&gt;EventHandler
                         optional&lt;span class=
"idlParamType"&gt; &lt;a data-link-for="" href="#dom-errorhandler" class=
"internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlParamName"&gt;errorHandler
                         optional&lt;span class=
"idlParamType"&gt; &lt;a data-link-for="" href="#dom-oncomplete" class=
"internalDFN" data-link-type=
"dfn"&gt; &lt;span class=
"idlParamName"&gt;onComplete
};&lt;span class="idlInterface" id="idl-def-subscription"
data-idl="" data-title="Subscription"&gt;
interface &lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-subscription" class=
"internalDFN" data-link-type=
"dfn"&gt; {&lt;span class="idlMethod"
id="idl-def-subscription-unsubscribe" data-idl="" data-title=
"unsubscribe" data-dfn-for="subscription"&gt;&lt;span class=
"idlMethType"&gt;
  void&lt;a data-no-default=""
data-link-for="subscription" data-lt="unsubscribe|unsubscribe()"
href="#dom-subscription-unsubscribe" class="internalDFN"
data-link-type=
"dfn"&gt;&lt;span class=
"idlAttribute" id="idl-def-subscription-closed" data-idl=""
data-title="closed" data-dfn-for="subscription"&gt;
  readonly attribute &lt;a href=
"https://heycam.github.io/webidl/#idl-boolean"&gt;boolean&lt;a data-no-default=""
data-link-for="subscription" data-lt="subscription.closed|closed"
href="#dom-subscription-closed" class="internalDFN" data-link-type=
"dfn"&gt;
};&lt;span class="idlCallback" id="idl-def-eventhandler"
data-idl="" data-title="EventHandler"&gt;
callback &lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-eventhandler" class=
"internalDFN" data-link-type=
"dfn"&gt; =&lt;span class=
"idlCallbackType"&gt; void&lt;span class=
"idlParamType"&gt;&lt;a href=
"https://heycam.github.io/webidl/#idl-any"&gt;any&lt;span class="idlCallback"
id="idl-def-errorhandler" data-idl="" data-title="ErrorHandler"&gt;
callback &lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-errorhandler" class=
"internalDFN" data-link-type=
"dfn"&gt; =&lt;span class=
"idlCallbackType"&gt; void&lt;span class=
"idlParamType"&gt;&lt;a href=
"https://heycam.github.io/webidl/#idl-Error"&gt;Error&lt;span class="idlCallback"
id="idl-def-oncomplete" data-idl="" data-title="OnComplete"&gt;
callback &lt;a data-no-default=""
data-link-for="" data-lt="" href="#dom-oncomplete" class=
"internalDFN" data-link-type=
"dfn"&gt; =&lt;span class=
"idlCallbackType"&gt;
void
();
</del>
<ins class="diff-chg">the
discovery
is
marked
inactive.
</ins>
The
<ins class="diff-new">method
</ins><em class="rfc2119" title= "MUST"><ins class="diff-new">
MUST
</ins></em><ins class="diff-new">
run
the
</ins>
following
<del class="diff-old">callbacks
can
be
provided
when
subscribing
to
an
Observable
:
</del>
<ins class="diff-chg">steps:
</ins>
</p>
<ol>
<li>
<del class="diff-old">The
EventHandler
callback
takes
the
next
sample
for
</del>
<ins class="diff-chg">Request
</ins>
the
<del class="diff-old">data
in
</del>
<ins class="diff-chg">underlying
platform
to
stop
</ins>
the
<del class="diff-old">value
argument.
The
ErrorHandler
callback
takes
</del>
<ins class="diff-chg">discovery
process.
If
this
returns
</ins>
an
<del class="diff-old">error
in
the
value
argument.
It
</del>
<ins class="diff-chg">error,
or
if
it
</ins>
is
<del class="diff-old">called
</del>
<ins class="diff-chg">not
possible,
for
instance
</ins>
when
<del class="diff-old">an
error
occurred
in
producing
the
data
</del>
<ins class="diff-chg">discovery
is
based
on
open
ended
multicast
requests,
</ins>
the
<del class="diff-old">client
should
know
about.
</del>
<ins class="diff-chg">implementation
</ins><em class="rfc2119" title="SHOULD"><ins class="diff-chg">
SHOULD
</ins></em><ins class="diff-chg">
discard
subsequent
discovered
items.
</ins>
</li>
<li>
<del class="diff-old">The
</del>
<ins class="diff-chg">Set
</ins>
<code>
<del class="diff-old">OnComplete
</del>
<ins class="diff-chg">this.active
</ins>
</code>
<del class="diff-old">callback
is
called
when
the
data
source
has
finished
sending
values.
8.1
The
</del>
<ins class="diff-chg">to
</ins>
<code>
<del class="diff-old">Subscription
</del>
<ins class="diff-chg">false
</ins></code>.</li></ol></div></section><section id="discovery-examples"><h3 id="x8-7-discovery-examples">
<del class="diff-old">interface
</del>
<bdi class="secno">
<ins class="diff-chg">8.7
</ins></bdi><ins class="diff-chg">
Discovery
Examples
</ins><a class="self-link" aria-label="§" href= "#discovery-examples">
</a>
</h3>
<p>
<del class="diff-old">Contains
the
</del>
<ins class="diff-chg">The
following
example
finds
</ins><a href="#dom-thingdescription" class="internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">closed
</del>
<ins class="diff-chg">ThingDescription
</ins>
</code>
<del class="diff-old">property
</del>
</a>
<ins class="diff-chg">objects
</ins>
of
<del class="diff-old">type
boolean
</del>
<a href= "#dfn-things" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Thing
</ins></a><ins class="diff-chg">
s
</ins>
that
<del class="diff-old">tells
if
the
subscription
</del>
<ins class="diff-chg">are
exposed
by
local
hardware,
regardless
how
many
instances
of
</ins><a href="#dfn-wot-runtime" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
WoT
Runtime
</ins></a><ins class="diff-chg">
it
</ins>
is
<del class="diff-old">closed
or
active.
Also,
contains
the
unsubscribe
()
method
</del>
<ins class="diff-chg">running.
Note
</ins>
that
<del class="diff-old">cancels
</del>
the
<del class="diff-old">subscription,
i.e.
makes
a
request
to
</del>
<ins class="diff-chg">discovery
can
end
(become
inactive)
before
</ins>
the
<del class="diff-old">underlying
platform
</del>
<ins class="diff-chg">internal
</ins><a href= "#dfn-discovery-results" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
discovery
results
</ins></a><ins class="diff-chg">
queue
is
emptied,
so
we
need
</ins>
to
<del class="diff-old">stop
receiving
data
from
the
source,
and
sets
the
</del>
<ins class="diff-chg">continue
reading
</ins><a href="#dom-thingdescription" class= "internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">closed
</del>
<ins class="diff-chg">ThingDescription
</ins>
</code>
<del class="diff-old">property
to
false
.
</del>
</a>
<ins class="diff-chg">objects
until
done.
This
is
typical
with
local
and
directory
type
discoveries.
</ins>
</p>
<div class="example" id= "example-5-discover-things-exposed-by-local-hardware">
<div class="marker">
<del class="diff-old">8.2
</del>
<a class="self-link" href= "#example-5-discover-things-exposed-by-local-hardware">
<ins class="diff-chg">Example
</ins><bdi><ins class="diff-chg">
5
</ins></bdi></a><span class="example-title">:<ins class="diff-chg">
Discover
Things
exposed
by
local
hardware
</ins>
</span>
<del class="diff-old">The
</del>
<del class="diff-old">Observable
</del>
</div>
<pre aria-busy="false"><code class="hljs javascript"><span class=
<ins class="diff-chg">"hljs-keyword">let</span> discovery = <span class=
"hljs-keyword">new</span> ThingDiscovery({ <span class=
"hljs-attr">method</span>: <span class=
"hljs-string">"local"</span> });
</ins><span class="hljs-keyword">do</span> {  <span class="hljs-keyword">let</span> td = <span class=<ins class="diff-chg">
"hljs-keyword">await</span> discovery.next();
</ins>  <span class="hljs-built_in">console</span>.log(<span class=<ins class="diff-chg">
"hljs-string">"Found Thing Description for "</span> + td.title);
</ins>  <span class="hljs-keyword">let</span> thing = <span class=<ins class="diff-chg">
"hljs-keyword">new</span> ConsumedThing(td);
</ins>  <span class="hljs-built_in">console</span>.log(<span class=<ins class="diff-chg">
"hljs-string">"Thing name: "</span> + thing.getThingDescription().title);
} <span class=
"hljs-keyword">
while
</ins></span><ins class="diff-chg">
(!discovery.done);
</ins>
</code>
<del class="diff-old">interface
</del>
</pre>
</div>
<p>
The
<ins class="diff-chg">next
example
finds
</ins><a href="#dom-thingdescription" class= "internalDFN" data-link-type= "idl">
<code>
<del class="diff-old">Observable
</del>
<ins class="diff-chg">ThingDescription
</ins>
</code>
</a>
<del class="diff-old">interface
enabled
subscribing
to
pushed
data
notifications
by
the
</del>
<ins class="diff-chg">objects
of
</ins><a href= "#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s
listed
in
a
</ins><a href="#dfn-thing-directory" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Directory
</ins></a><ins class="diff-chg">
service.
We
set
a
timeout
for
safety.
</ins></p><div class="example" id="example-6-discover-things-via-directory"><div class="marker">
<del class="diff-old">subscribe
</del>
<a class="self-link" href= "#example-6-discover-things-via-directory">
<ins class="diff-chg">Example
</ins><bdi><ins class="diff-chg">
6
</ins></bdi></a><span class="example-title">:<ins class="diff-chg">
Discover
Things
via
directory
</ins></span></div><pre aria-busy="false"><code class="hljs javascript"><span class=<ins class="diff-chg">
"hljs-keyword">let</span> discoveryFilter = {
</ins>  <span class="hljs-attr">method</span>: <span class=<ins class="diff-chg">
"hljs-string">"directory"</span>,
</ins>  <span class="hljs-attr">url</span>: <span class=<ins class="diff-chg">
"hljs-string">"http://directory.wotservice.org"</span>
};
</ins><span class="hljs-keyword">let</span> discovery = <span class=<ins class="diff-chg">
"hljs-keyword">new</span> ThingDiscovery(discoveryFilter);
setTimeout( <span class="hljs-function"><span class=
"hljs-params">()</span> =&gt;</span> {
    discovery.stop();
</ins>    <span class="hljs-built_in">console</span>.log(<span class=<ins class="diff-chg">
"hljs-string">"Discovery stopped after timeout."</span>);
  },
</ins>  <span class="hljs-number">3000</span>);<span class="hljs-keyword">do</span> {  <span class="hljs-keyword">let</span> td = <span class=<ins class="diff-chg">
"hljs-keyword">await</span> discovery.next();
</ins>  <span class="hljs-built_in">console</span>.log(<span class=<ins class="diff-chg">
"hljs-string">"Found Thing Description for "</span> + td.title);
</ins>  <span class="hljs-keyword">let</span> thing = <span class=<ins class="diff-chg">
"hljs-keyword">new</span> ConsumedThing(td);
</ins>  <span class="hljs-built_in">console</span>.log(<span class=<ins class="diff-chg">
"hljs-string">"Thing name: "</span> + thing.getThingDescription().title);
} <span class="hljs-keyword">while</span> (!discovery.done);
</ins><span class="hljs-keyword">if</span> (discovery.error) {  <span class="hljs-built_in">console</span>.log(<span class=<ins class="diff-chg">
"hljs-string">"Discovery stopped because of an error: "</span> + error.message);
}
</ins>
</code>
<del class="diff-old">()
method:
Initialize
the
data
handler
callback
with
the
first
function
argument.
If
the
</del>
</pre>
</div>
<p>
<ins class="diff-chg">The
</ins>
next
<del class="diff-old">argument
is
provided
and
</del>
<ins class="diff-chg">example
</ins>
is
<del class="diff-old">a
function,
initialize
the
error
handling
callback
with
that
function,
or
throw
</del>
<ins class="diff-chg">for
an
open-ended
multicast
discovery,
which
likely
won't
complete
soon
(depending
</ins>
on
<del class="diff-old">error.
If
</del>
the
<del class="diff-old">third
argument
is
provided
and
</del>
<ins class="diff-chg">underlying
protocol),
so
stopping
it
with
a
timeout
</ins>
is
a
<del class="diff-old">function,
initialize
the
completion
handler
with
that
function,
or
throw
on
error.
After
callback
initializations,
the
implementation
should
request
the
underlying
platform
to
provide
data,
error
and
completion
notifications
for
the
supported
data
source.
</del>
<ins class="diff-chg">good
idea.
It
will
likely
deliver
results
one
by
one.
</ins></p><div class="example" id="example-7-discover-things-in-a-network"><div class="marker"><a class="self-link" href= "#example-7-discover-things-in-a-network"><ins class="diff-chg">
Example
</ins><bdi><ins class="diff-chg">
7
</ins></bdi></a><span class="example-title">:<ins class="diff-chg">
Discover
Things
in
a
network
</ins></span></div><pre aria-busy="false"><code class="hljs javascript"><span class=<ins class="diff-chg">
"hljs-keyword">let</span> discovery = <span class=
"hljs-keyword">new</span> ThingDiscovery({ <span class=
"hljs-attr">method</span>: <span class=
"hljs-string">"multicast"</span> });
setTimeout( <span class="hljs-function"><span class=
"hljs-params">()</span> =&gt;</span> {
    discovery.stop();
</ins>    <span class="hljs-built_in">console</span>.log(<span class=<ins class="diff-chg">
"hljs-string">"Stopped open-ended discovery"</span>);
  },
</ins>  <span class="hljs-number">10000</span>);<span class="hljs-keyword">do</span> {  <span class="hljs-keyword">let</span> td = <span class=<ins class="diff-chg">
"hljs-keyword">await</span> discovery.next();
</ins>  <span class="hljs-keyword">let</span> thing = <span class=<ins class="diff-chg">
"hljs-keyword">new</span> ConsumedThing(td);
</ins>  <span class="hljs-built_in">console</span>.log(<span class=<ins class="diff-chg">
"hljs-string">"Thing name: "</span> + thing.getThingDescription().title);
} <span class=
"hljs-keyword">
while
</ins></span><ins class="diff-chg">
(!discovery.done);
</ins></code></pre></div>
</section>
</section>
<section id="security-and-privacy">
<h2 id="security">
<bdi class="secno">
9.
</bdi>
Security
and
Privacy
<a class="self-link" aria-label="§" href= "#security-and-privacy">
</a>
</h2>
<p>
<del class="diff-old">In
general
the
security
measures
taken
to
protect
a
WoT
system
will
depend
on
the
threats
and
attackers
that
system
may
face
and
the
value
of
the
assets
needs
to
protect.
</del>
A
detailed
discussion
of
security
and
privacy
considerations
for
the
Web
of
Things,
including
a
threat
model
that
can
be
adapted
to
various
circumstances,
is
presented
in
the
informative
document
[
<cite>
<del class="diff-old">WOT-SECURITY-CONSIDERATIONS
</del>
<a class="bibref" href="#bib-wot-security-guidelines" title= "Web of Things Security and Privacy Guidelines" data-link-type= "biblio">
<ins class="diff-chg">WOT-SECURITY-GUIDELINES
</ins>
</a>
</cite>
].
This
section
<del class="diff-old">includes
</del>
<ins class="diff-chg">discusses
</ins>
only
<del class="diff-old">normative
recommendations
</del>
<ins class="diff-chg">security
and
privacy
risks
and
possible
mitigations
directly
</ins>
relevant
to
the
<ins class="diff-new">scripts
and
</ins>
WoT
<del class="diff-old">Thing
Description.
</del>
<ins class="diff-chg">Scripting
API.
</ins>
</p>
<p>
<del class="diff-old">When
designing
new
devices
and
services
for
use
with
the
WoT,
we
have
documented
a
</del>
<ins class="diff-chg">A
suggested
</ins>
set
of
best
practices
<ins class="diff-new">to
improve
security
for
WoT
devices
and
services
has
been
documented
</ins>
in
[
<cite>
<a class= "bibref" href="#bib-wot-security-best-practices" title= "Web of Things Security and Privacy Best Practices" data-link-type= "biblio">
WOT-SECURITY-BEST-PRACTICES
</a>
</cite>
<del class="diff-old">]
that
SHOULD
be
followed.
This
best-practices
</del>
<ins class="diff-chg">].
That
</ins>
document
may
be
updated
as
security
measures
evolve.
Following
these
practices
does
not
guarantee
security,
but
it
<del class="diff-old">at
least
will
</del>
<ins class="diff-chg">might
</ins>
help
<del class="diff-old">to
</del>
avoid
common
known
<del class="diff-old">vulnerabilities
and
pitfalls.
</del>
<ins class="diff-chg">vulnerabilities.
</ins>
</p>
<div>
<p>
<del class="diff-old">Below
are
specific
recommendations
related
to
</del>
<ins class="diff-chg">The
</ins>
WoT
<del class="diff-old">runtime
implementations:
</del>
<ins class="diff-chg">security
risks
and
possible
mitigations
are
concerning
the
following
groups:
</ins>
</p>
<ul>
<li>
<del class="diff-old">In
basic
WoT
setups,
all
scripts
running
inside
the
</del>
<ins class="diff-chg">Implementors
of
</ins>
WoT
<del class="diff-old">runtime
are
considered
trusted,
and
therefore
there
is
no
strong
need
to
perform
strict
isolation
between
each
running
script
instance.
However,
depending
on
device
capabilities
and
deployment
use
case
scenario
risk
level
it
might
be
desirable
to
</del>
<ins class="diff-chg">Runtimes
that
</ins>
do
<del class="diff-old">so.
</del>
<ins class="diff-chg">not
implement
a
Scripting
Runtime.
The
[
</ins><cite><a class="bibref" href="#bib-wot-architecture" title="Web of Things Architecture" data-link-type= "biblio"><ins class="diff-chg">
WOT-ARCHITECTURE
</ins></a></cite><ins class="diff-chg">
]
document
provides
generic
security
guidelines
for
this
group.
</ins></li>
<li>
<del class="diff-old">For
example,
if
one
script
handles
sensitive
privacy-related
data
and
well-audited,
it
might
be
desirable
to
separate
it
from
the
rest
</del>
<ins class="diff-chg">Implementors
</ins>
of
the
<del class="diff-old">script
instances
to
minimize
the
risk
of
data
exposure
</del>
<ins class="diff-chg">WoT
Scripting
API
</ins>
in
<del class="diff-old">case
some
other
script
inside
</del>
<ins class="diff-chg">a
</ins>
WoT
<del class="diff-old">gets
compromised
during
the
runtime.
Therefore
</del>
<ins class="diff-chg">Scripting
Runtime.
This
is
</ins>
the
<del class="diff-old">WoT
runtime
SHOULD
perform
isolation
of
script
instances
</del>
<ins class="diff-chg">main
scope
</ins>
and
<del class="diff-old">their
data
</del>
<ins class="diff-chg">is
covered
</ins>
in
<del class="diff-old">cases
when
scripts
handle
privacy-related
or
other
critical
security
data.
</del>
<ins class="diff-chg">the
</ins><a href= "#sec-security-consideration-runtime"><ins class="diff-chg">
Scripting
Runtime
Security
and
Privacy
Risks
</ins></a><ins class="diff-chg">
sub-section
that
contains
normative
text
regarding
security.
</ins>
</li>
<li>
<del class="diff-old">Another
example
is
mutual
co-existence
of
different
tenants
on
a
single
</del>
WoT
<del class="diff-old">device.
In
this
case
each
WoT
runtime
instance
will
be
hosting
a
different
tenant,
</del>
<ins class="diff-chg">script
developers,
covered
in
the
</ins><a href= "#sec-security-consideration-script"><ins class="diff-chg">
Script
Security
</ins>
and
<del class="diff-old">isolation
between
them
</del>
<ins class="diff-chg">Privacy
Risks
</ins></a><ins class="diff-chg">
sub-section
that
contains
informative
recommendations
concerning
security.
</ins></li></ul></div><section id="sec-security-consideration-runtime"><h3 id="x9-1-scripting-runtime-security-and-privacy-risks"><bdi class="secno"><ins class="diff-chg">
9.1
</ins></bdi><ins class="diff-chg">
Scripting
Runtime
Security
and
Privacy
Risks
</ins><a class="self-link" aria-label="§" href= "#sec-security-consideration-runtime"></a></h3><p><ins class="diff-chg">
This
section
</ins>
is
<del class="diff-old">required.
Therefore
</del>
<ins class="diff-chg">normative
and
contains
specific
risks
relevant
for
</ins>
the
WoT
<del class="diff-old">runtime
SHOULD
perform
isolation
of
WoT
runtime
instances
</del>
<ins class="diff-chg">Scripting
Runtime.
</ins></p><section id="sec-security-consideration-input"><h4 id="x9-1-1-corrupted-input-security-and-privacy-risk"><bdi class="secno"><ins class="diff-chg">
9.1.1
</ins></bdi><ins class="diff-chg">
Corrupted
Input
Security
</ins>
and
<del class="diff-old">their
data
if
</del>
<ins class="diff-chg">Privacy
Risk
</ins><a class="self-link" aria-label="§" href= "#sec-security-consideration-input"></a></h4><p><ins class="diff-chg">
A
typical
way
to
compromise
any
process
is
to
send
it
</ins>
a
<del class="diff-old">WoT
device
has
more
than
</del>
<ins class="diff-chg">corrupted
input
via
</ins>
one
<del class="diff-old">tenant.
Such
isolation
</del>
<ins class="diff-chg">of
the
exposed
interfaces.
This
</ins>
can
be
<del class="diff-old">performed
within
the
WoT
Runtime
</del>
<ins class="diff-chg">done
to
a
script
instance
</ins>
using
<del class="diff-old">platform
security
mechanisms
available
</del>
<ins class="diff-chg">WoT
interface
it
exposes.
</ins></p><dl><dt><ins class="diff-chg">
Mitigation:
</ins></dt><dd><ins class="diff-chg">
Implementors
of
this
API
</ins><em class="rfc2119" title= "SHOULD"><ins class="diff-chg">
SHOULD
</ins></em><ins class="diff-chg">
perform
validation
</ins>
on
<ins class="diff-new">all
script
inputs.
In
addition
to
input
validation,
</ins><a href= "https://en.wikipedia.org/wiki/Fuzzing"><ins class="diff-new">
fuzzing
</ins></a><ins class="diff-new">
should
be
used
to
verify
that
</ins>
the
<del class="diff-old">device.
For
more
information
see
Section
"WoT
Servient
Single-Tenant"
</del>
<ins class="diff-chg">input
processing
is
done
correctly.
There
are
many
tools
</ins>
and
<del class="diff-old">"WoT
Servient
Multi-Tenant"
of
</del>
<ins class="diff-chg">techniques
in
existence
to
do
such
validation.
More
details
can
be
found
in
</ins>
[
<cite>
<del class="diff-old">WOT-SECURITY-CONSIDERATIONS
</del>
<a class="bibref" href= "#bib-wot-security-testing" title= "Web of Things Security Testing and Validation" data-link-type= "biblio">
<ins class="diff-chg">WOT-SECURITY-TESTING
</ins>
</a>
</cite>
].
<del class="diff-old">WoT
scripts
are
using
WoT
Scripting
API
to
implement
the
functionality
</del>
</dd>
</dl>
</section>
<section id="sec-security-consideration-device-direct-access">
<h4 id= "x9-1-2-physical-device-direct-access-security-and-privacy-risk">
<bdi class="secno">
<ins class="diff-chg">9.1.2
</ins></bdi><ins class="diff-chg">
Physical
Device
Direct
Access
Security
</ins>
and
<del class="diff-old">logic
for
WoT
Things.
</del>
<ins class="diff-chg">Privacy
Risk
</ins><a class="self-link" aria-label="§" href= "#sec-security-consideration-device-direct-access"></a></h4><p>
In
<del class="diff-old">addition
to
providing
the
isolation
between
</del>
<ins class="diff-chg">case
a
</ins>
script
<del class="diff-old">and
runtime
instances,
the
WoT
runtime
needs
to
protect
</del>
<ins class="diff-chg">is
compromised
or
misbehaving,
</ins>
the
underlying
physical
device
<del class="diff-old">from
</del>
<ins class="diff-chg">(and
</ins>
potentially
<del class="diff-old">misbehaving
WoT
scripts.
Therefore
</del>
<ins class="diff-chg">surrounded
environment)
can
be
damaged
if
a
script
can
use
directly
exposed
native
device
interfaces.
If
such
interfaces
lack
safety
checks
on
their
inputs,
they
might
bring
</ins>
the
<ins class="diff-new">underlying
physical
device
(or
environment)
to
an
unsafe
state
(i.e.
device
overheats
and
explodes).
</ins></p><dl><dt><ins class="diff-new">
Mitigation:
</ins></dt><dd><ins class="diff-new">
The
</ins>
WoT
<ins class="diff-new">Scripting
</ins>
Runtime
<em class="rfc2119" title= "SHOULD">
SHOULD
</em>
avoid
directly
exposing
the
native
device
interfaces
to
the
script
developers.
<del class="diff-old">Instead
</del>
<ins class="diff-chg">Instead,
</ins>
a
WoT
<ins class="diff-new">Scripting
</ins>
Runtime
should
provide
a
hardware
abstraction
layer
for
accessing
the
native
device
interfaces.
<ins class="diff-new">Such
hardware
abstraction
layer
should
refuse
to
execute
commands
that
might
put
the
device
(or
environment)
to
an
unsafe
state.
</ins>
Additionally,
in
order
to
reduce
the
damage
to
a
physical
WoT
device
in
cases
a
<del class="diff-old">WoT
</del>
script
gets
compromised,
it
is
important
to
minimize
the
number
of
interfaces
that
are
exposed
or
accessible
to
a
particular
<del class="diff-old">WoT
script
based
on
its
functionality.
Therefore
the
WoT
Runtime
SHOULD
only
expose
a
minimal
set
of
interfaces
to
a
WoT
</del>
script
based
on
its
<del class="diff-old">intended
</del>
functionality.
</dd>
</dl>
</section>
<section id="sec-security-consideration-update-provisioning">
<h4 id="x9-1-3-provisioning-and-update-security-risk">
<bdi class= "secno">
<ins class="diff-chg">9.1.3
</ins></bdi><ins class="diff-chg">
Provisioning
and
Update
Security
Risk
</ins><a class= "self-link" aria-label="§" href= "#sec-security-consideration-update-provisioning"></a></h4><p>
If
the
WoT
<del class="diff-old">runtime
</del>
<ins class="diff-chg">Scripting
Runtime
</ins>
supports
post-manufacturing
provisioning
or
<del class="diff-old">update
</del>
<ins class="diff-chg">updates
</ins>
of
<del class="diff-old">WoT
</del>
scripts,
WoT
<del class="diff-old">runtime
</del>
<ins class="diff-chg">Scripting
Runtime
</ins>
or
any
related
data
(including
security
credentials),
it
can
be
a
major
attack
vector.
An
attacker
can
try
to
modify
any
above
described
<del class="diff-old">part
</del>
<ins class="diff-chg">element
</ins>
during
the
update
or
provisioning
process
or
simply
provision
attacker's
code
and
data
directly.
<del class="diff-old">Therefore,
if
WoT
Runtime
supports
post-manufacturing
</del>
</p>
<dl>
<dt>
<ins class="diff-chg">Mitigation:
</ins></dt><dd><ins class="diff-chg">
Post-manufacturing
</ins>
provisioning
or
update
of
<del class="diff-old">WoT
</del>
scripts,
WoT
<del class="diff-old">runtime
</del>
<ins class="diff-chg">Scripting
Runtime
</ins>
or
any
related
<del class="diff-old">data,
such
operations
SHOULD
</del>
<ins class="diff-chg">data
should
</ins>
be
done
in
a
secure
fashion.
A
set
of
recommendations
for
secure
update
and
post-manufacturing
provisioning
can
be
found
in
[
<cite>
<del class="diff-old">WOT-SECURITY-BEST-PRACTICES
</del>
<a class= "bibref" href="#bib-wot-security-guidelines" title= "Web of Things Security and Privacy Guidelines" data-link-type= "biblio">
<ins class="diff-chg">WOT-SECURITY-GUIDELINES
</ins>
</a>
</cite>
].
</dd>
</dl>
</section>
<section id="sec-security-consideration-credentials-storage">
<h4 id= "x9-1-4-security-credentials-storage-security-and-privacy-risk">
<bdi class="secno">
<ins class="diff-chg">9.1.4
</ins></bdi><ins class="diff-chg">
Security
Credentials
Storage
Security
and
Privacy
Risk
</ins><a class="self-link" aria-label="§" href= "#sec-security-consideration-credentials-storage"></a></h4><p>
Typically
the
WoT
<del class="diff-old">runtime
</del>
<ins class="diff-chg">Scripting
Runtime
</ins>
needs
to
store
the
security
credentials
that
are
provisioned
to
a
WoT
device
to
operate
in
WoT
network.
<del class="diff-old">The
</del>
<ins class="diff-chg">If
an
attacker
can
compromise
the
</ins>
confidentiality
or
integrity
of
these
<del class="diff-old">credentials
should
not
be
compromised.
Therefore
</del>
<ins class="diff-chg">credentials,
then
it
can
obtain
access
to
</ins>
the
WoT
<del class="diff-old">runtime
SHOULD
</del>
<ins class="diff-chg">assets,
impersonate
WoT
things
or
devices
or
create
Denial-Of-Service
(DoS)
attacks.
</ins></p><dl><dt><ins class="diff-chg">
Mitigation:
</ins></dt><dd><ins class="diff-chg">
The
WoT
Scripting
Runtime
should
</ins>
securely
store
the
provisioned
security
credentials,
guaranteeing
their
integrity
and
confidentiality.
In
case
there
are
more
than
one
tenant
on
a
single
WoT-enabled
device,
a
WoT
<ins class="diff-new">Scripting
</ins>
Runtime
<del class="diff-old">SHOULD
</del>
<ins class="diff-chg">should
</ins>
guarantee
isolation
of
each
tenant
provisioned
security
credentials.
Additionally,
in
order
to
minimize
a
risk
that
provisioned
security
credentials
get
compromised,
the
WoT
<del class="diff-old">runtime
</del>
<ins class="diff-chg">Scripting
Runtime
</ins>
should
not
<del class="diff-old">have
any
way
for
WoT
scripts
to
query
these
credentials.
Therefore,
the
WoT
Runtime
SHOULD
NOT
</del>
expose
any
API
for
<del class="diff-old">WoT
</del>
scripts
to
query
the
provisioned
security
credentials.
</dd>
</dl>
</section>
</section>
<section id="sec-security-consideration-script" class= "informative">
<h3 id="x9-2-script-security-and-privacy-risks">
<bdi class= "secno">
<ins class="diff-chg">9.2
</ins></bdi><ins class="diff-chg">
Script
Security
and
Privacy
Risks
</ins><a class= "self-link" aria-label="§" href= "#sec-security-consideration-script"></a></h3>
<p>
<del class="diff-old">Some
additional
</del>
<em>
<ins class="diff-chg">This
section
is
non-normative.
</ins></em></p><p><ins class="diff-chg">
This
section
describes
</ins>
specific
<del class="diff-old">recommendations
</del>
<ins class="diff-chg">risks
</ins>
relevant
for
<del class="diff-old">WoT
</del>
script
<del class="diff-old">developers:
</del>
<ins class="diff-chg">developers.
</ins>
</p>
<section id="sec-security-consideration-script-input">
<h4 id="x9-2-1-corrupted-script-input-security-and-privacy-risk">
<bdi class="secno">
<ins class="diff-chg">9.2.1
</ins></bdi><ins class="diff-chg">
Corrupted
Script
Input
Security
and
Privacy
Risk
</ins><a class="self-link" aria-label="§" href= "#sec-security-consideration-script-input"></a></h4><p>
A
<del class="diff-old">typical
way
to
compromise
any
process
is
to
send
it
a
corrupted
input
via
one
of
</del>
<ins class="diff-chg">script
instance
may
receive
data
formats
defined
by
</ins>
the
<del class="diff-old">exposed
interfaces.
Therefore
developers
</del>
<ins class="diff-chg">TD,
or
data
formats
defined
by
the
applications.
While
the
WoT
Scripting
Runtime
</ins>
<em class="rfc2119" title="SHOULD">
SHOULD
</em>
perform
validation
on
all
<del class="diff-old">WoT
</del>
<ins class="diff-chg">input
fields
defined
by
the
TD,
scripts
may
be
still
exploited
by
input
data.
</ins></p><dl><dt><ins class="diff-chg">
Mitigation:
</ins></dt><dd><ins class="diff-chg">
Script
developers
should
perform
validation
on
all
application
defined
</ins>
script
<del class="diff-old">inputs,
including
</del>
<ins class="diff-chg">inputs.
In
addition
to
input
validation,
</ins>
<a href= "https://en.wikipedia.org/wiki/Fuzzing">
fuzzing
<del class="diff-old">.
</del>
</a>
<ins class="diff-chg">could
be
used
to
verify
that
the
input
processing
is
done
correctly.
</ins>
There
are
many
<del class="diff-old">tool
</del>
<ins class="diff-chg">tools
</ins>
and
techniques
in
existence
to
do
such
validation.
More
details
can
be
found
in
[
<cite>
<a class="bibref" href= "#bib-wot-security-testing" title= "Web of Things Security Testing and Validation" data-link-type= "biblio">
WOT-SECURITY-TESTING
</a>
</cite>
].
<del class="diff-old">As
any
software,
complex
scripts
with
a
lot
of
functionality
presents
a
higher
risk
of
development
mistakes.
Such
scripts
are
also
hard
to
verify
and
test
appropriately.
Therefore
developers
SHOUD
minimize
the
functionality
and
complexity
of
WoT
scripts.
</del>
</dd>
</dl>
</section>
<section id="sec-security-consideration-script-processing">
<h4 id="x9-2-2-denial-of-service-security-risk">
<bdi class= "secno">
<ins class="diff-chg">9.2.2
</ins></bdi><ins class="diff-chg">
Denial
Of
Service
Security
Risk
</ins><a class= "self-link" aria-label="§" href= "#sec-security-consideration-script-processing"></a></h4><p>
If
a
<del class="diff-old">WoT
</del>
script
performs
a
heavy
functional
processing
on
received
requests
before
the
request
is
authenticated,
it
presents
a
great
risk
for
Denial-Of-Service
(DOS)
attacks.
<del class="diff-old">Therefore
WoT
scripts
SHOULD
</del>
</p>
<dl>
<dt>
<ins class="diff-chg">Mitigation:
</ins></dt><dd><ins class="diff-chg">
Scripts
should
</ins>
avoid
heavy
functional
processing
without
prior
successful
authentication
of
requestor.
The
set
of
recommended
authentication
mechanisms
can
be
found
in
[
<cite>
<a class="bibref" href="#bib-wot-security-best-practices" title= "Web of Things Security and Privacy Best Practices" data-link-type= "biblio">
WOT-SECURITY-BEST-PRACTICES
</a>
</cite>
].
</dd>
</dl>
</section>
<section id="sec-security-consideration-script-stale-td">
<h4 id="x9-2-3-stale-td-security-risk">
<bdi class= "secno">
<ins class="diff-chg">9.2.3
</ins></bdi><ins class="diff-chg">
Stale
TD
Security
Risk
</ins><a class="self-link" aria-label="§" href= "#sec-security-consideration-script-stale-td"></a></h4><p><ins class="diff-chg">
During
the
lifetime
of
a
</ins>
WoT
<del class="diff-old">developers
should
remember
that
</del>
<ins class="diff-chg">network,
</ins>
a
content
of
a
TD
can
<del class="diff-old">change,
including
</del>
<ins class="diff-chg">change.
This
includes
</ins>
its
<del class="diff-old">identified,
id,
</del>
<ins class="diff-chg">identifier,
</ins>
which
<del class="diff-old">is
</del>
<ins class="diff-chg">might
</ins>
not
<ins class="diff-new">be
</ins>
an
immutable
<del class="diff-old">identifier.
Therefore
WoT
scripts
SHOULD
</del>
<ins class="diff-chg">one
and
might
be
updated
periodically.
</ins></p><dl><dt><ins class="diff-chg">
Mitigation:
</ins></dt><dd><ins class="diff-chg">
Scripts
should
</ins>
use
<del class="diff-old">the
provided
WoT
script
</del>
<ins class="diff-chg">this
</ins>
API
to
subscribe
for
notifications
on
TD
<del class="diff-old">changes.
</del>
<ins class="diff-chg">changes
and
do
not
rely
on
TD
values
to
remain
persistent.
</ins></dd></dl><div class="note" id="issue-container-generatedID-10"><div role="heading" class="ednote-title marker" id="h-ednote-5" aria-level="5"><span><ins class="diff-chg">
Editor's
note
</ins>
</span>
</div>
<p class="">
<ins class="diff-chg">While
stale
TDs
can
present
a
potential
problem
for
WoT
network
operation,
it
might
not
be
a
security
risk.
</ins></p></div></section></section>
</section>
<section id="terminology-and-conventions">
<h2 id="x10-terminology-and-conventions">
<bdi class= "secno">
10.
</bdi>
Terminology
and
conventions
<a class="self-link" aria-label="§" href="#terminology-and-conventions">
</a>
</h2>
<p>
The
generic
WoT
terminology
is
defined
in
[
<cite>
<a class= "bibref" href="#bib-wot-architecture" title= "Web of Things Architecture" data-link-type= "biblio">
WOT-ARCHITECTURE
</a>
</cite>
]:
<dfn data-lt="Things|Thing" data-dfn-type="dfn" data-plurals="things" id= "dfn-things">
Thing
</dfn>,
<dfn data-lt= "Thing Descriptions|Thing Description" data-dfn-type="dfn" id= "dfn-thing-descriptions">
Thing
Description
</dfn>
(in
short
<dfn data-dfn-type="dfn" id="dfn-td">
TD
</dfn>
),
<dfn data-dfn-type= "dfn" id="dfn-web-of-things">
Web
of
Things
</dfn>
(in
short
<b>
<i>
WoT
</i>
</b>
),
<dfn data-dfn-type="dfn" id= "dfn-wot-interface">
WoT
Interface
<del class="diff-old">,
</del>
</dfn>
<ins class="diff-chg">(same
as
</ins><dfn data-dfn-type="dfn" id="dfn-wot-network-interface"><ins class="diff-chg">
WoT
network
interface
</ins></dfn><ins class="diff-chg">
),
</ins><dfn data-dfn-type="dfn" id= "dfn-protocol-bindings">
Protocol
Bindings
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-wot-runtime">
WoT
Runtime
</dfn>,
<dfn data-lt= "consume|consume a TD|consuming a TD|Consuming a Thing Description" data-dfn-type="dfn" id="dfn-consume">
Consuming
a
Thing
Description
</dfn>,
<dfn data-dfn-type="dfn" id= "dfn-thing-directory">
Thing
Directory
</dfn>,
<dfn data-dfn-type= "dfn" id="dfn-wot-interactions">
WoT
Interactions
</dfn>,
<dfn data-lt="Properties|Property" data-dfn-type="dfn" data-plurals="properties" id="dfn-properties">
Property
</dfn>,
<dfn data-lt="Actions|Action" data-dfn-type="dfn" data-plurals= "actions" id="dfn-actions">
Action
</dfn>,
<dfn data-lt= "Events|WoT-Event|Event" data-dfn-type="dfn" data-plurals="events" id="dfn-events">
Event
</dfn>
etc.
</p>
<p>
<dfn data-dfn-type="dfn" id="dfn-json-ld">
JSON-LD
</dfn>
is
defined
in
[
<cite>
<a class="bibref" href="#bib-json-ld" title= "JSON-LD 1.0" data-link-type="biblio">
JSON-LD
</a>
</cite>
]
as
a
JSON
document
that
is
augmented
with
support
for
Linked
Data.
</p>
<p>
The
terms
<dfn data-dfn-type="dfn" id="dfn-url" data-no-export= "">
<a href= "https://url.spec.whatwg.org/#concept-url">
URL
</a>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-url-scheme" data-no-export= "">
<a href="https://url.spec.whatwg.org/#concept-url-scheme">
<ins class="diff-new">URL
scheme
</ins>
</a>
<del class="diff-old">and
</del>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-url-host" data-no-export="">
<a href= "https://url.spec.whatwg.org/#concept-url-host">
<ins class="diff-chg">URL
host
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-url-path" data-no-export= ""><a href="https://url.spec.whatwg.org/#concept-url-path">
URL
path
</a>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-url-record" data-no-export="">
<a href= "https://url.spec.whatwg.org/#concept-url">
<ins class="diff-chg">URL
record
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-parse-a-url" data-no-export= ""><a href="https://url.spec.whatwg.org/#parse-a-url"><ins class="diff-chg">
parse
a
URL
</ins></a></dfn>,<dfn data-dfn-type="dfn" id= "dfn-absolute-url-string" data-no-export=""><a href= "https://url.spec.whatwg.org/#absolute-url-string"><ins class="diff-chg">
absolute-URL
string
</ins></a></dfn>,<dfn data-dfn-type="dfn" id= "dfn-path-absolute-url-string" data-no-export=""><a href= "https://url.spec.whatwg.org/#path-absolute-url-string"><ins class="diff-chg">
path-absolute-URL
string
</ins></a></dfn>,<dfn data-dfn-type="dfn" id= "dfn-basic-url-parser" data-no-export="">
<a href= "https://url.spec.whatwg.org/#concept-basic-url-parser">
<ins class="diff-new">basic
URL
parser
</ins>
</a>
</dfn>
are
defined
in
[
<cite>
<a class="bibref" href= "#bib-url" title="URL Standard" data-link-type= "biblio">
URL
</a>
</cite>
].
</p>
<p>
The
<del class="diff-old">following
</del>
terms
<dfn data-dfn-type="dfn" id="dfn-mime-type" data-no-export="">
<a href= "https://mimesniff.spec.whatwg.org/#mime-type">
<ins class="diff-new">MIME
type
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-parsing-a-mime-type" data-no-export=""><a href= "https://mimesniff.spec.whatwg.org/#parsing-a-mime-type"><ins class="diff-new">
Parsing
a
MIME
type
</ins></a></dfn>,<dfn data-dfn-type="dfn" id= "dfn-serializing-a-mime-type" data-no-export=""><a href= "https://mimesniff.spec.whatwg.org/#serializing-a-mime-type"><ins class="diff-new">
Serializing
a
MIME
type
</ins></a></dfn>,<dfn data-dfn-type="dfn" id= "dfn-valid-mime-type-string" data-no-export=""><a href= "https://mimesniff.spec.whatwg.org/#valid-mime-type"><ins class="diff-new">
valid
MIME
type
string
</ins></a></dfn>,<dfn data-dfn-type="dfn" id= "dfn-json-mime-type" data-no-export=""><a href= "https://mimesniff.spec.whatwg.org/#json-mime-type"><ins class="diff-new">
JSON
MIME
type
</ins></a></dfn>
are
defined
in
[
<cite>
<del class="diff-old">HTML52
</del>
<a class="bibref" href= "#bib-mimesniff" title="MIME Sniffing Standard" data-link-type= "biblio">
<ins class="diff-chg">MIMESNIFF
</ins>
</a>
</cite>
<del class="diff-old">]
and
</del>
<ins class="diff-chg">].
</ins></p><p><ins class="diff-chg">
The
terms
</ins><dfn data-dfn-type="dfn" id="dfn-utf-8-encoding" data-no-export=""><a href= "https://encoding.spec.whatwg.org/#utf-8"><ins class="diff-chg">
UTF-8
encoding
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-utf-8-decode" data-no-export= ""><a href="https://encoding.spec.whatwg.org/#utf-8-decode"><ins class="diff-chg">
UTF-8
decode
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-encode" data-no-export=""><a href= "https://encoding.spec.whatwg.org/#encode"><ins class="diff-chg">
encode
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-decode" data-no-export=""><a href= "https://encoding.spec.whatwg.org/#decode"><ins class="diff-chg">
decode
</ins></a></dfn>
are
<del class="diff-old">used
</del>
<ins class="diff-chg">defined
</ins>
in
<del class="diff-old">the
context
of
browser
implementations:
</del>
<ins class="diff-chg">[
</ins><cite>
<del class="diff-old">browsing
context
</del>
<a class="bibref" href="#bib-encoding" title= "Encoding Standard" data-link-type= "biblio">
<ins class="diff-chg">ENCODING
</ins></a>
<del class="diff-old">,
top-level
browsing
context
</del>
</cite>
<ins class="diff-chg">].
</ins></p><p>
<del class="diff-old">,
</del>
<dfn data-dfn-type="dfn" id="dfn-string" data-no-export= "">
<del class="diff-old">global
object
</del>
<a href= "https://infra.spec.whatwg.org/#string">
<ins class="diff-chg">string
</ins></a>
<del class="diff-old">,
incumbent
settings
object
</del>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-parse-json-from-bytes" data-no-export="">
<del class="diff-old">,
</del>
<a href= "https://infra.spec.whatwg.org/#parse-json-from-bytes">
<ins class="diff-chg">parse
JSON
from
bytes
</ins></a>
<del class="diff-old">Document
</del>
</dfn>
<ins class="diff-new">and
</ins><dfn data-dfn-type="dfn" id= "dfn-serialize-json-to-bytes" data-no-export="">
<del class="diff-old">,
</del>
<a href= "https://infra.spec.whatwg.org/#serialize-json-to-bytes">
<ins class="diff-chg">serialize
JSON
to
bytes
</ins></a>
<del class="diff-old">document
base
URL
</del>
</dfn>,
<ins class="diff-chg">are
defined
in
[
</ins><cite>
<del class="diff-old">,
</del>
<a class="bibref" href="#bib-infra" title="Infra Standard" data-link-type= "biblio">
<ins class="diff-chg">INFRA
</ins></a>
<del class="diff-old">Window
</del>
</cite>
<ins class="diff-chg">].
</ins></p><p><ins class="diff-chg">
The
terms
</ins><dfn data-dfn-type="dfn" id="dfn-throw" data-no-export="">
<del class="diff-old">,
</del>
<a href= "https://heycam.github.io/webidl/#dfn-throw">
<del class="diff-old">WindowProxy
</del>
<code>
<ins class="diff-chg">throw
</ins></code>
<del class="diff-old">,
</del>
</a>
<del class="diff-old">origin
</del>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-creating" data-no-export= "">
<del class="diff-old">,
ASCII
serialized
origin
</del>
<a href= "https://heycam.github.io/webidl/#dfn-create-exception">
<del class="diff-old">,
executing
algorithms
</del>
<code>
<ins class="diff-chg">creating
</ins></code>
<del class="diff-old">in
parallel
</del>
</a>
<del class="diff-old">,
</del>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-domstring" data-no-export= "">
<del class="diff-old">queue
a
task
</del>
<a href= "https://heycam.github.io/webidl/#idl-DOMString">
<del class="diff-old">,
</del>
<code>
<ins class="diff-chg">DOMString
</ins></code>
<del class="diff-old">task
source
</del>
</a>
<del class="diff-old">,
</del>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-dictionary" data-no-export= "">
<del class="diff-old">iframe
</del>
<a href= "https://heycam.github.io/webidl/#idl-dictionary">
<del class="diff-old">,
</del>
<code>
<ins class="diff-chg">Dictionary
</ins></code>
<del class="diff-old">valid
MIME
type
</del>
</a>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-arraybuffer" data-no-export= "">
<a href= "https://heycam.github.io/webidl/#idl-ArrayBuffer">
<code>
<ins class="diff-chg">ArrayBuffer
</ins></code>
<del class="diff-old">.
A
browsing
context
</del>
</a>
<del class="diff-old">refers
to
the
environment
in
which
Document
</del>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-buffersource" data-no-export= "">
<a href= "https://heycam.github.io/webidl/#common-BufferSource">
<code>
<ins class="diff-chg">BufferSource
</ins></code>
</a>
<del class="diff-old">objects
are
presented
to
the
user.
A
given
browsing
context
</del>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-any-0" data-no-export="">
<a href= "https://heycam.github.io/webidl/#idl-any">
<code>
<ins class="diff-chg">any
</ins></code>
</a>
<del class="diff-old">has
a
single
</del>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-not-present" data-no-export= "">
<a href="https://heycam.github.io/webidl/#dfn-present">
<ins class="diff-chg">not
present
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-domexception" data-no-export=""><a href= "https://heycam.github.io/webidl/#idl-DOMException">
<code>
<ins class="diff-new">DOMException
</ins></code>
<del class="diff-old">WindowProxy
</del>
</a>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-aborterror" data-no-export= "">
<a href= "https://heycam.github.io/webidl/#aborterror">
<code>
<ins class="diff-new">AbortError
</ins>
</code>
<del class="diff-old">object,
but
it
can
have
many
</del>
</a>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-syntaxerror" data-no-export= "">
<a href= "https://heycam.github.io/webidl/#syntaxerror">
<code>
<ins class="diff-new">SyntaxError
</ins></code>
<del class="diff-old">Document
</del>
</a>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-notsupportederror" data-no-export= "">
<a href= "https://heycam.github.io/webidl/#notsupportederror">
<code>
<ins class="diff-new">NotSupportedError
</ins>
</code>
<del class="diff-old">objects,
with
their
associated
</del>
</a>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-networkerror" data-no-export= "">
<a href= "https://heycam.github.io/webidl/#networkerror">
<code>
<ins class="diff-new">NetworkError
</ins></code>
<del class="diff-old">Window
</del>
</a>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-typeerror" data-no-export= "">
<a href= "https://heycam.github.io/webidl/#exceptiondef-typeerror">
<code>
<ins class="diff-new">TypeError
</ins>
</code>
<del class="diff-old">objects.
The
script
execution
context
</del>
</a>
<del class="diff-old">associated
with
the
browsing
context
identifies
the
entity
which
invokes
this
API,
which
can
be
a
web
app
,
a
web
page
,
or
an
iframe
.
The
term
secure
context
</del>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-notreadableerror" data-no-export= "">
<a href= "https://heycam.github.io/webidl/#notreadableerror">
<code>
<ins class="diff-chg">NotReadableError
</ins></code>
</a>
<del class="diff-old">is
</del>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-timeouterror" data-no-export= "">
<a href= "https://heycam.github.io/webidl/#timeouterror">
<code>
<ins class="diff-chg">TimeoutError
</ins></code></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-nomodificationallowederror" data-no-export=""><a href= "https://heycam.github.io/webidl/#nomodificationallowederror"><code><ins class="diff-chg">
NoModificationAllowedError
</ins></code></a></dfn>,<dfn data-dfn-type= "dfn" id="dfn-securityerror" data-no-export=""><a href= "https://heycam.github.io/webidl/#securityerror"><code><ins class="diff-chg">
SecurityError
</ins></code></a></dfn>,<ins class="diff-chg">
are
</ins>
defined
in
[
<cite>
<del class="diff-old">WEBAPPSEC
</del>
<a class="bibref" href="#bib-webidl" title= "Web IDL" data-link-type="biblio">
<ins class="diff-chg">WEBIDL
</ins>
</a>
</cite>
].
</p>
<p>
<dfn data-dfn-type="dfn" id="dfn-promise" data-no-export= "">
<del class="diff-old">Error
,
EvalError
,
RangeError
,
ReferenceError
,
SyntaxError
,
TypeError
,
URIError
</del>
<a href= "https://tc39.github.io/ecma262/#sec-promise-objects">
</a>
<del class="diff-old">,
script
execution
context
</del>
<del class="diff-old">,
</del>
<a data-link-type="dfn" href= "https://tc39.github.io/ecma262/#sec-promise-objects">
Promise
</a>
<del class="diff-old">,
</del>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-error" data-no-export="">
<a href= "https://tc39.github.io/ecma262/#sec-error-objects">
<ins class="diff-chg">Error
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-json" data-no-export=""><a href= "https://tc39.github.io/ecma262/#sec-json-object">
JSON
</a>
<del class="diff-old">,
JSON.stringify
</del>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-json-stringify" data-no-export= "">
<a href= "https://tc39.github.io/ecma262/#sec-json.stringify">
<ins class="diff-new">JSON.stringify
</ins>
</a>
<del class="diff-old">and
</del>
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-json-parse" data-no-export= "">
<a href= "https://tc39.github.io/ecma262/#sec-json.parse">
JSON.parse
</a>
</dfn>
<ins class="diff-new">and
</ins><dfn data-dfn-type="dfn" id="dfn-internal-slots" data-no-export="">
<a href= "https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots">
<ins class="diff-new">internal
slots
</ins>
</a>
</dfn>
are
defined
in
[
<cite>
<a class="bibref" href="#bib-ecmascript" title="ECMAScript Language Specification" data-link-type="biblio">
ECMASCRIPT
</a>
</cite>
].
</p>
<p>
<ins class="diff-new">The
terms
</ins><dfn data-dfn-type="dfn" id="dfn-browsing-context" data-no-export="">
<a href= "https://html.spec.whatwg.org/multipage/#browsing-context">
<ins class="diff-chg">browsing
context
</ins></a>
<del class="diff-old">DOMString
</del>
</dfn>,
<dfn data-dfn-type="dfn" id= "dfn-top-level-browsing-context" data-no-export="">
<del class="diff-old">,
</del>
<a href= "https://html.spec.whatwg.org/multipage/#top-level-browsing-context">
<ins class="diff-chg">top-level
browsing
context
</ins></a>
<del class="diff-old">USVString
</del>
</dfn>,
<dfn data-dfn-type="dfn" id= "dfn-global-object" data-no-export="">
<del class="diff-old">,
</del>
<a href= "https://html.spec.whatwg.org/multipage/#global-object">
<ins class="diff-chg">global
object
</ins></a>
<del class="diff-old">ArrayBuffer
</del>
</dfn>,
<dfn data-dfn-type="dfn" id= "dfn-current-settings-object" data-no-export="">
<del class="diff-old">,
</del>
<a href= "https://html.spec.whatwg.org/multipage/#current-settings-object">
<ins class="diff-chg">current
settings
object
</ins></a>
<del class="diff-old">BufferSource
</del>
</dfn>,
<ins class="diff-chg">executing
algorithms
</ins><dfn data-dfn-type= "dfn" id="dfn-in-parallel" data-no-export="">
<a href= "https://html.spec.whatwg.org/multipage/#in-parallel">
<ins class="diff-new">in
parallel
</ins>
</a>
<del class="diff-old">and
</del>
<del class="diff-old">any
</del>
</dfn>
are
defined
in
[
<cite>
<del class="diff-old">WEBIDL
</del>
<a class="bibref" href= "#bib-html5" title="HTML5" data-link-type= "biblio">
<ins class="diff-chg">HTML5
</ins>
</a>
</cite>
<del class="diff-old">].
</del>
<ins class="diff-chg">]
and
are
used
in
the
context
of
browser
implementations.
</ins>
</p>
<p>
The
<del class="diff-old">algorithms
utf-8
encode
,
and
utf-8
decode
</del>
<ins class="diff-chg">term
</ins><a href= "https://w3c.github.io/webappsec/specs/powerfulfeatures/#secure-context"><dfn data-dfn-type="dfn" id="dfn-secure-context"><ins class="diff-chg">
secure
context
</ins>
</dfn>
</a>
<del class="diff-old">are
</del>
<ins class="diff-chg">is
</ins>
defined
in
[
<cite>
<del class="diff-old">ENCODING
</del>
<a class="bibref" href= "#bib-webappsec" title="Secure Contexts" data-link-type= "biblio">
<ins class="diff-chg">WEBAPPSEC
</ins>
</a>
</cite>
].
</p>
<p>
<dfn data-dfn-type="dfn" id="dfn-iana-media-type">
IANA
media
type
</dfn>
s
(formerly
known
as
MIME
types)
are
defined
in
<a href= "http://tools.ietf.org/html/rfc2046">
RFC2046
</a>.
</p>
<p>
The
terms
<dfn data-dfn-type="dfn" id= "dfn-hyperlink-reference">
hyperlink
reference
</dfn>
and
<dfn data-dfn-type="dfn" id="dfn-relation-type">
relation
type
</dfn>
are
defined
in
[
<cite>
<del class="diff-old">HTML52
</del>
<a class="bibref" href="#bib-html5" title= "HTML5" data-link-type="biblio">
<ins class="diff-chg">HTML5
</ins>
</a>
</cite>
]
and
<a href= "https://tools.ietf.org/html/rfc8288">
RFC8288
</a>.
</p>
</section>
<section class="appendix" id="api-design-rationale">
<h2 id="a-api-design-rationale">
<del class="diff-old">11.
Conformance
</del>
<bdi class="secno">
<ins class="diff-chg">A.
</ins></bdi><ins class="diff-chg">
API
design
rationale
</ins><a class="self-link" aria-label="§" href= "#api-design-rationale">
</a>
</h2>
<p>
<del class="diff-old">As
well
as
sections
marked
as
non-normative,
all
authoring
guidelines,
diagrams,
examples,
and
notes
in
this
specification
are
non-normative.
Everything
else
</del>
<ins class="diff-chg">API
rationale
usually
belongs
to
a
separate
document,
but
</ins>
in
<del class="diff-old">this
specification
is
normative.
</del>
<ins class="diff-chg">the
WoT
case
the
complexity
of
the
context
justifies
including
basic
rationale
here.
</ins>
</p>
<section id="approaches-to-wot-application-development">
<h3 id="a-1-approaches-to-wot-application-development">
<bdi class= "secno">
<ins class="diff-chg">A.1
</ins></bdi><ins class="diff-chg">
Approaches
to
WoT
application
development
</ins><a class="self-link" aria-label="§" href= "#approaches-to-wot-application-development"></a></h3><p>
The
<del class="diff-old">key
words
MAY
,
MUST
,
SHOULD
,
</del>
<ins class="diff-chg">WoT
Interest
Group
</ins>
and
<del class="diff-old">SHOULD
NOT
are
</del>
<ins class="diff-chg">Working
Group
have
explored
different
approaches
to
application
development
for
WoT
that
have
been
all
implemented
and
tested.
</ins></p><section id="no-scripting-api"><h4 id="a-1-1-no-scripting-api"><bdi class="secno"><ins class="diff-chg">
A.1.1
</ins></bdi><ins class="diff-chg">
No
Scripting
API
</ins><a class="self-link" aria-label="§" href= "#no-scripting-api"></a></h4><p><ins class="diff-chg">
It
is
possible
</ins>
to
<ins class="diff-new">develop
WoT
applications
that
only
use
the
</ins><a href="#dfn-wot-network-interface" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
WoT
network
interface
</ins></a>,<ins class="diff-new">
typically
exposed
by
a
WoT
gateway
that
presents
a
REST-ful
API
towards
clients
and
implements
IoT
protocol
plugins
that
communicate
with
supported
IoT
deployments.
One
such
implementation
is
the
</ins><a href= "https://iot.mozilla.org/"><ins class="diff-new">
Mozilla
WebThings
</ins></a><ins class="diff-new">
platform.
</ins></p></section><section id="simple-scripting-api"><h4 id="a-1-2-simple-scripting-api"><bdi class="secno"><ins class="diff-new">
A.1.2
</ins></bdi><ins class="diff-new">
Simple
Scripting
API
</ins><a class="self-link" aria-label="§" href= "#simple-scripting-api"></a></h4><p><ins class="diff-new">
WoT
</ins><a href="#dfn-things" class="internalDFN" data-link-type= "dfn"><ins class="diff-new">
Thing
</ins></a><ins class="diff-new">
s
show
good
synergy
with
software
objects,
so
a
</ins><a href="#dfn-things" class="internalDFN" data-link-type= "dfn"><ins class="diff-new">
Thing
</ins></a><ins class="diff-new">
can
</ins>
be
<del class="diff-old">interpreted
</del>
<ins class="diff-chg">represented
</ins>
as
<del class="diff-old">described
</del>
<ins class="diff-chg">a
software
object,
with
</ins><a href="#dfn-properties" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Properties
</ins></a><ins class="diff-chg">
represented
as
object
properties,
</ins><a href= "#dfn-actions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Action
</ins></a><ins class="diff-chg">
s
as
methods,
and
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
s
as
events.
In
addition,
metadata
is
stored
</ins>
in
<ins class="diff-new">special
properties.
Consuming
and
exposing
is
done
with
factory
methods
that
produce
a
software
object
that
directly
represents
a
remote
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Thing
</ins></a><ins class="diff-new">
and
its
interactions.
One
such
implementation
is
the
</ins><a href= "https://github.com/draggett/arena-webhub"><ins class="diff-new">
Arena
Web
Hub
</ins></a><ins class="diff-new">
project.
</ins></p><p><ins class="diff-new">
In
the
next
example,
a
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Thing
</ins></a><ins class="diff-new">
that
represents
interactions
with
a
lock
would
look
like
the
following:
the
</ins><var><ins class="diff-new">
status
</ins></var><ins class="diff-new">
property
and
the
</ins><code><ins class="diff-new">
open()
</ins></code><ins class="diff-new">
method
are
directly
exposed
on
the
object.
</ins></p><div class="example" id="example-8-open-a-lock-with-a-simple-api"><div class="marker"><a class="self-link" href= "#example-8-open-a-lock-with-a-simple-api"><ins class="diff-new">
Example
</ins><bdi><ins class="diff-new">
8
</ins></bdi></a><span class="example-title">:<ins class="diff-new">
Open
a
lock
with
a
simple
API
</ins></span></div><pre aria-busy="false"><code class="hljs javascript"><span class=<ins class="diff-new">
"hljs-keyword">let</span> lock = <span class=
"hljs-keyword">await</span> WoT.consume(‘https:<span class=
"hljs-comment">//td.my.com/lock-00123’);</span>
</ins><span class="hljs-built_in">console</span>.log(lock.status);<ins class="diff-new">
lock.open(<span class=
"hljs-string">
'withThisKey'
</ins></span><ins class="diff-new">
);
</ins></code></pre></div></section><section id="this-api-aligned-with-wot-td"><h4 id="a-1-3-this-api-aligned-with-wot-td"><bdi class= "secno"><ins class="diff-new">
A.1.3
</ins></bdi><ins class="diff-new">
This
API,
aligned
with
</ins>
[
<cite>
<del class="diff-old">RFC2119
</del>
<a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type= "biblio">
<ins class="diff-chg">WOT-TD
</ins>
</a>
</cite>
<del class="diff-old">].
</del>
<ins class="diff-chg">]
</ins><a class="self-link" aria-label="§" href="#this-api-aligned-with-wot-td"></a></h4>
<p>
<del class="diff-old">This
document
defines
conformance
criteria
</del>
<ins class="diff-chg">Since
the
direct
mapping
of
</ins><a href="#dfn-things" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s
to
software
objects
have
had
some
challenges,
this
specification
takes
another
approach
</ins>
that
<del class="diff-old">apply
</del>
<ins class="diff-chg">exposes
software
objects
</ins>
to
<del class="diff-old">a
single
product:
</del>
<ins class="diff-chg">represent
</ins>
the
<del class="diff-old">UA
(user
agent)
that
implements
</del>
<a href= "#dfn-things" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Thing
</ins></a><ins class="diff-chg">
metadata
as
data
property
and
</ins>
the
<del class="diff-old">interfaces
it
contains.
</del>
<ins class="diff-chg">WoT
interactions
as
methods.
One
implementation
is
</ins><a href= "https://github.com/eclipse/thingweb.node-wot"><ins class="diff-chg">
node-wot
</ins></a><ins class="diff-chg">
in
the
the
</ins><a href="http://www.thingweb.io/"><ins class="diff-chg">
Eclipse
ThingWeb
</ins></a><ins class="diff-chg">
project,
which
is
the
current
reference
implementation
of
the
API
specified
in
this
document.
</ins>
</p>
<p>
<del class="diff-old">This
specification
</del>
<ins class="diff-chg">The
same
example
now
would
look
like
the
following:
the
</ins><var><ins class="diff-chg">
status
</ins></var><ins class="diff-chg">
property
and
the
</ins><code><ins class="diff-chg">
open()
</ins></code><ins class="diff-chg">
method
are
represented
indirectly.
</ins></p><div class="example" id="example-9-open-a-lock"><div class="marker"><a class="self-link" href= "#example-9-open-a-lock"><ins class="diff-chg">
Example
</ins><bdi><ins class="diff-chg">
9
</ins></bdi></a><span class= "example-title">:<ins class="diff-chg">
Open
a
lock
</ins></span></div><pre aria-busy="false"><code class="hljs javascript"><span class=<ins class="diff-chg">
"hljs-keyword">let</span> res = <span class=
"hljs-keyword">await</span> fetch(‘https:<span class=
"hljs-comment">//td.my.com/lock-00123’);</span>
</ins><span class="hljs-keyword">let</span> td = <span class=<ins class="diff-chg">
"hljs-keyword">await</span> res.json();
</ins><span class="hljs-keyword">let</span> lock = <span class=<ins class="diff-chg">
"hljs-keyword">new</span> ConsumedThing(td);
</ins><span class=<ins class="diff-chg">
"hljs-built_in">console</span>.log(lock.readProperty(‘status’));
lock.invokeAction(‘open’, <span class=
"hljs-string">
'withThisKey'
</ins></span><ins class="diff-chg">
);
</ins></code></pre></div></section><p><ins class="diff-chg">
In
conclusion,
the
WoT
WG
decided
to
explore
the
third
option
that
closely
follows
the
[
</ins><cite><a class="bibref" href= "#bib-wot-td" title="WoT Thing Description " data-link-type= "biblio"><ins class="diff-chg">
WOT-TD
</ins></a></cite><ins class="diff-chg">
]
specification.
Based
on
this,
a
simple
API
</ins>
can
<ins class="diff-new">also
</ins>
be
<del class="diff-old">used
</del>
<ins class="diff-chg">implemented.
Since
Scripting
is
an
optional
module
in
WoT,
this
leaves
room
</ins>
for
<del class="diff-old">implementing
</del>
<ins class="diff-chg">applications
that
only
use
</ins>
the
WoT
<del class="diff-old">Scripting
API
in
multiple
programming
languages.
The
interface
definitions
</del>
<ins class="diff-chg">network
interface.
Therefore
all
three
approaches
above
</ins>
are
<del class="diff-old">specified
in
</del>
<ins class="diff-chg">supported
by
</ins>
[
<cite>
<del class="diff-old">WEBIDL
</del>
<a class="bibref" href="#bib-wot-td" title= "WoT Thing Description " data-link-type= "biblio">
<ins class="diff-chg">WOT-TD
</ins>
</a>
</cite>
].
</p>
<p>
<del class="diff-old">The
user
agent
(UA)
may
</del>
<ins class="diff-chg">Moreover,
the
WoT
network
interface
can
</ins>
be
implemented
in
<del class="diff-old">the
browser,
or
</del>
<ins class="diff-chg">many
languages
and
runtimes.
Consider
this
API
an
example
for
what
needs
to
be
taken
into
consideration
when
designing
a
Scripting
API
for
WoT.
</ins></p></section><section id="fetching-and-validating-a-td"><h3 id="a-2-fetching-and-validating-a-td"><bdi class= "secno"><ins class="diff-chg">
A.2
</ins></bdi><ins class="diff-chg">
Fetching
and
validating
a
TD
</ins><a class="self-link" aria-label="§" href="#fetching-and-validating-a-td"></a></h3><p><ins class="diff-chg">
The
</ins><code><ins class="diff-chg">
fetch(url)
</ins></code><ins class="diff-chg">
method
has
been
part
of
this
API
</ins>
in
<ins class="diff-new">earlier
versions.
However,
now
fetching
</ins>
a
<del class="diff-old">separate
runtime
environment,
</del>
<a href="#dfn-td" class= "internalDFN" data-link-type="dfn">
<ins class="diff-chg">TD
</ins></a><ins class="diff-chg">
given
a
URL
should
be
done
with
an
external
method,
</ins>
such
as
<del class="diff-old">Node.js
</del>
<ins class="diff-chg">the
</ins><a href= "https://fetch.spec.whatwg.org/#fetch-api"><ins class="diff-chg">
Fetch
API
</ins>
</a>
or
<del class="diff-old">small
embedded
runtimes.
Implementations
</del>
<ins class="diff-chg">a
HTTP
client
library,
which
offer
already
standardized
options
on
specifying
fetch
details.
The
reason
is
</ins>
that
<ins class="diff-new">while
simple
fetch
operations
(covering
most
</ins>
use
<del class="diff-old">ECMAScript
executed
</del>
<ins class="diff-chg">cases)
could
be
done
</ins>
in
<del class="diff-old">a
browser
</del>
<ins class="diff-chg">this
API,
when
various
fetch
options
were
needed,
there
was
no
point
in
duplicating
existing
work
</ins>
to
<del class="diff-old">implement
the
APIs
defined
</del>
<ins class="diff-chg">re-expose
those
options
</ins>
in
this
<del class="diff-old">document
MUST
implement
them
in
</del>
<ins class="diff-chg">API.
</ins></p><p><ins class="diff-chg">
Since
fetching
</ins>
a
<del class="diff-old">manner
consistent
with
the
ECMAScript
Bindings
</del>
<a href="#dfn-td" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">TD
</ins></a><ins class="diff-chg">
has
been
scoped
out,
and
</ins><a href= "#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
TD
</ins></a><ins class="diff-chg">
validation
is
</ins>
defined
<ins class="diff-new">externally
</ins>
in
<del class="diff-old">the
Web
IDL
</del>
<ins class="diff-chg">[
</ins><cite><a class="bibref" href= "#bib-wot-td" title="WoT Thing Description " data-link-type= "biblio"><ins class="diff-chg">
WOT-TD
</ins></a></cite><ins class="diff-chg">
],
that
is
scoped
out,
too.
This
</ins>
specification
<ins class="diff-new">expects
a
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
TD
</ins></a><ins class="diff-new">
as
</ins><a href= "https://infra.spec.whatwg.org/#parse-json-from-bytes"><ins class="diff-new">
parsed
JSON
object
</ins></a><ins class="diff-new">
that
has
been
validated
according
to
the
</ins>
[
<cite>
<del class="diff-old">WEBIDL
</del>
<a class="bibref" href="#bib-wot-td" title= "WoT Thing Description " data-link-type="biblio">
<ins class="diff-chg">WOT-TD
</ins>
</a>
</cite>
<del class="diff-old">].
</del>
<ins class="diff-chg">]
specification.
</ins>
</p>
</section>
<section id="factory-vs-constructors">
<h3 id="a-3-factory-vs-constructors">
<bdi class="secno">
<ins class="diff-new">A.3
</ins></bdi><ins class="diff-new">
Factory
vs
constructors
</ins><a class="self-link" aria-label="§" href= "#factory-vs-constructors"></a></h3>
<p>
<del class="diff-old">Implementations
</del>
<ins class="diff-chg">The
factory
methods
for
consuming
and
exposing
</ins><a href= "#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s
are
asynchronous
and
fully
validate
the
input
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
TD
</ins></a>.<ins class="diff-chg">
In
addition,
one
can
also
construct
</ins><a href="#dom-consumedthing" class="internalDFN" data-link-type="idl"><code><ins class="diff-chg">
ConsumedThing
</ins></code></a><ins class="diff-chg">
and
</ins><a href= "#dom-exposedthing" class="internalDFN" data-link-type= "idl"><code><ins class="diff-chg">
ExposedThing
</ins></code></a><ins class="diff-chg">
by
providing
a
parsed
and
validated
</ins><a href="#dfn-td" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
TD
</ins></a>.<ins class="diff-chg">
Platform
initialization
is
then
done
when
needed
during
the
WoT
interactions.
So
applications
</ins>
that
<del class="diff-old">use
TypeScript
or
ECMAScript
in
</del>
<ins class="diff-chg">prefer
validating
</ins>
a
<del class="diff-old">runtime
to
implement
</del>
<a href="#dfn-td" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">TD
</ins></a><ins class="diff-chg">
themselves,
may
use
</ins>
the
<del class="diff-old">APIs
defined
in
this
document
MUST
</del>
<ins class="diff-chg">constructors,
whereas
applications
that
leave
validation
to
implementations
and
prefer
interactions
initialized
up
front
</ins><em class="rfc2119" title="SHOULD"><ins class="diff-chg">
SHOULD
</ins>
</em>
<del class="diff-old">implement
them
in
a
manner
consistent
with
</del>
<ins class="diff-chg">use
</ins>
the
<del class="diff-old">TypeScript
Bindings
defined
in
</del>
<ins class="diff-chg">factory
methods
on
</ins>
the
<del class="diff-old">TypeScript
specification
[
</del>
<a href="#dfn-wot-api-object" class= "internalDFN" data-link-type="dfn">
<ins class="diff-chg">WoT
API
object
</ins></a>.</p></section><section id="observers"><h3 id="a-4-observers"><bdi class="secno"><ins class="diff-chg">
A.4
</ins></bdi><ins class="diff-chg">
Observers
</ins><a class="self-link" aria-label="§" href= "#observers">
<del class="diff-old">TYPESCRIPT
</del>
</a>
<del class="diff-old">].
</del>
</h3>
<p>
<ins class="diff-chg">Earlier
drafts
used
the
</ins><a href= "https://github.com/tc39/proposal-observable"><ins class="diff-chg">
Observer
</ins></a><ins class="diff-chg">
construct,
but
since
it
has
not
become
standard,
a
new
design
was
needed
that
was
light
enough
for
embedded
implementations.
Therefore
observing
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
changes
and
handling
WoT
</ins><a href= "#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
s
is
done
with
callback
registrations.
</ins>
</p>
</section>
<section id="using-events">
<h3 id="a-5-using-events">
<bdi class="secno">
<ins class="diff-new">A.5
</ins></bdi><ins class="diff-new">
Using
Events
</ins><a class="self-link" aria-label="§" href= "#using-events"></a></h3><div>
<p>
This
<del class="diff-old">document
serves
a
general
description
of
</del>
<ins class="diff-chg">API
ended
up
not
using
software
events
at
all,
for
</ins>
the
<ins class="diff-new">following
reasons:
</ins></p><ul><li><ins class="diff-new">
Subscription
to
</ins>
WoT
<del class="diff-old">Scripting
API.
Language
</del>
<a href="#dfn-events" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Event
</ins></a><ins class="diff-chg">
s
may
be
different
from
handling
software
events
(subscription
might
need
parameters,
might
involve
security
tokens
etc).
</ins></li><li><ins class="diff-chg">
Most
implementations
are
for
Node.js
</ins>
and
<del class="diff-old">runtime
specific
</del>
<ins class="diff-chg">browser
implementations
will
likely
be
libraries
(because
possible
dependency
management
</ins>
issues
<del class="diff-old">are
discussed
</del>
in
<del class="diff-old">separate
extensions
</del>
<ins class="diff-chg">native
implementations),
using
Events
has
been
challenging.
</ins></li><li><ins class="diff-chg">
Observing
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
changes
and
handling
WoT
</ins><a href= "#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
s
is
done
with
the
solution
above.
</ins></li></ul></div></section><section id="polymorphic-functions"><h3 id="a-6-polymorphic-functions"><bdi class="secno"><ins class="diff-chg">
A.6
</ins></bdi><ins class="diff-chg">
Polymorphic
functions
</ins><a class="self-link" aria-label="§" href= "#polymorphic-functions"></a></h3><p><ins class="diff-chg">
The
reason
to
use
function
names
like
</ins><code><ins class="diff-chg">
readProperty()
</ins></code>,<code><ins class="diff-chg">
readMultipleProperties()
</ins></code><ins class="diff-chg">
etc.
instead
</ins>
of
<del class="diff-old">this
document.
</del>
<ins class="diff-chg">a
generic
polymorphic
</ins><code><ins class="diff-chg">
read()
</ins></code><ins class="diff-chg">
function
is
that
the
current
names
map
exactly
to
the
</ins><code><ins class="diff-chg">
"op"
</ins></code><ins class="diff-chg">
vocabulary
from
the
</ins><a href= "https://www.w3.org/TR/2019/CR-wot-thing-description-20190516/#form"><ins class="diff-chg">
Form
</ins></a><ins class="diff-chg">
definition
in
[
</ins><cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type= "biblio"><ins class="diff-chg">
WOT-TD
</ins></a></cite><ins class="diff-chg">
].
</ins>
</p>
</section>
</section>
<section class="appendix" id="Changes">
<h2 id="b-changes">
<del class="diff-old">A.
</del>
<bdi class="secno">
<ins class="diff-chg">B.
</ins></bdi>
Changes
<a class= "self-link" aria-label="§" href="#Changes">
</a>
</h2>
<div>
<p>
The
following
is
a
list
of
major
changes
to
the
document.
<ins class="diff-new">Major
versions
of
this
specification
are
the
following:
</ins></p><ul><li><ins class="diff-new">
First
Public
Working
Draft
</ins><a href= "https://www.w3.org/TR/2017/WD-wot-scripting-api-20170914/"><ins class="diff-new">
September
2017
</ins></a>.</li><li><ins class="diff-new">
Working
Draft
</ins><a href= "https://www.w3.org/TR/2018/WD-wot-scripting-api-20180405/"><ins class="diff-new">
April
2018
</ins></a>.</li><li><ins class="diff-new">
Working
Draft
</ins><a href= "https://www.w3.org/TR/2018/WD-wot-scripting-api-20181129/"><ins class="diff-new">
November
2018
</ins></a>.</li><li><ins class="diff-new">
This
version,
introducing
the
following
major
changes:
</ins><ul><li><ins class="diff-new">
Remove
</ins><code><ins class="diff-new">
fetch()
</ins></code><ins class="diff-new">
for
fetching
a
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
TD
</ins></a><ins class="diff-new">
(delegated
to
external
API).
</ins></li><li><ins class="diff-new">
Remove
</ins><code><ins class="diff-new">
Observer
</ins></code><ins class="diff-new">
and
use
</ins><a href= "https://w3ctag.github.io/design-principles/"><abbr title= "World Wide Web Consortium"><ins class="diff-new">
W3C
</ins></abbr><ins class="diff-new">
TAG
recommended
design
patterns
</ins></a>.</li><li><ins class="diff-new">
Align
the
discovery
API
to
other
similar
APIs
(such
as
</ins><a href= "https://www.w3.org/TR/generic-sensor/#the-sensor-interface"><abbr title="World Wide Web Consortium"><ins class="diff-new">
W3C
</ins></abbr><ins class="diff-new">
Generic
Sensor
API
</ins></a><ins class="diff-new">
).
</ins></li><li><ins class="diff-new">
Remove
the
large
data
definition
API
for
constructing
</ins><a href= "#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
TD
</ins></a><ins class="diff-new">
s
and
leverage
using
</ins><a href="#dom-thingdescription" class="internalDFN" data-link-type="idl"><code><ins class="diff-new">
ThingDescription
</ins></code></a><ins class="diff-new">
instead.
</ins></li><li><ins class="diff-new">
Add
missing
algorithms
and
rework
most
existing
ones.
</ins></li><li><ins class="diff-new">
Allow
constructors
for
</ins><a href="#dom-consumedthing" class= "internalDFN" data-link-type="idl"><code><ins class="diff-new">
ConsumedThing
</ins></code></a><ins class="diff-new">
and
</ins><a href="#dom-exposedthing" class="internalDFN" data-link-type= "idl"><code><ins class="diff-new">
ExposedThing
</ins></code></a>.</li><li><ins class="diff-new">
Add
API
rationale
as
an
appendix
to
this
document.
</ins></li></ul></li></ul></div><p>
For
a
complete
list
of
changes,
see
the
<a href= "https://github.com/w3c/wot-scripting-api/commits/master">
github
change
log
</a>.
You
can
also
view
the
<a href= "https://github.com/w3c/wot-scripting-api/issues?page=1&amp;state=closed">
recently
closed
issues
</a>.
</p>
<del class="diff-old">Make
the
Scripting
API
refer
to
(rather
then
locally
re-define)
the
data
structures
defined
in
the
Thing
Description
specification
.
</del>
</section>
<section id="open-issues">
<h2 class="appendix" id="openissues">
<del class="diff-old">B.
</del>
<bdi class="secno">
<ins class="diff-chg">C.
</ins></bdi>
Open
issues
<a class="self-link" aria-label="§" href= "#open-issues">
</a>
</h2>
<div>
<p>
The
following
problems
are
being
discussed
and
need
most
attention:
</p>
<ul>
<li>
<del class="diff-old">Security
</del>
<ins class="diff-chg">Script
management
and
runtime
</ins>
related
<del class="diff-old">metadata
(https://github.com/w3c/wot-scripting-api/issues/91).
</del>
<ins class="diff-chg">issues
(https://github.com/w3c/wot-scripting-api/issues/)
</ins>
</li>
<li>
<del class="diff-old">Providing
Protocol
Binding
</del>
<ins class="diff-chg">An
explicit
API
</ins>
for
<ins class="diff-chg">adding
and
removing
</ins><a href= "#dfn-properties" class="internalDFN" data-link-type= "dfn"><ins class="diff-chg">
Property
</ins></a>,<a href="#dfn-actions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Action
</ins></a><ins class="diff-chg">
and
</ins><a href="#dfn-events" class= "internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
definitions
on
</ins><a href="#dom-exposedthing" class="internalDFN" data-link-type= "idl">
<code>
ExposedThing
</code>
</a>
<del class="diff-old">(https://github.com/w3c/wot-scripting-api/issues/45).
Script
management
</del>
<ins class="diff-chg">(it
was
present
in
earlier
versions,
but
removed
for
complexity
</ins>
and
<del class="diff-old">runtime
related
issues
(https://github.com/w3c/wot-scripting-api/issues/)
</del>
<ins class="diff-chg">a
simpler
way
to
do
it.
</ins>
</li>
</ul>
</div>
</section>
<section class="appendix" id="idl-index">
<h2 id="d-full-web-idl">
<del class="diff-old">C.
</del>
<bdi class="secno">
<ins class="diff-chg">D.
</ins></bdi><ins class="diff-chg">
Full
Web
IDL
</ins><a class="self-link" aria-label="§" href="#idl-index"></a></h2><pre class="idl def" id="actual-idl-index"><span data-idl="" class=<ins class="diff-chg">
"idlTypedef" data-title="ThingDescription">typedef<span class=
"idlType"> <a data-xref-type="interface" data-cite-path=""
data-type="interface" href=
"https://heycam.github.io/webidl/#idl-object">object</a></span> <a class="internalDFN idlID"
data-link-for="" data-link-type="typedef" href=
"#dom-thingdescription"><code>ThingDescription</code></a>;</span>
</ins><span data-idl="" class="idlInterface" data-title=<ins class="diff-chg">
"WOT">[<span class="extAttr"><a data-xref-type="extended-attribute"
data-cite-path="" data-type="extended-attribute" href=
"https://heycam.github.io/webidl/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-xref-type="extended-attribute"
data-cite-path="" data-type="extended-attribute" href=
"https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<a data-xref-type="interface"
data-cite-path="window-object.html" data-type="interface" href=
"https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>,<a data-xref-type="interface"
data-lt="WorkerGlobalScope" data-cite-path="workers.html"
data-type="interface" href=
"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">Worker</a>)</span>]
interface <a class="internalDFN idlID" data-link-for=""
data-link-type="interface" href=
"#dom-wot"><code>WOT</code></a> {<span class="idlSectionComment">
  // methods defined in UA conformance classes
</ins></span>};</span><span data-idl="" class="idlInterface" data-title=<ins class="diff-chg">
"WOT">partial interface <a class="internalDFN idlID" data-link-for=
"" data-link-type="interface" href=
"#dom-wot"><code>WOT</code></a> {<span data-idl="" class=
"idlMethod" data-title="consume" data-dfn-for="WOT"><span class=
"idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
href="#dom-consumedthing" class="internalDFN" data-link-type=
"idl"><code>ConsumedThing</code></a>&gt;</span> <a class=
"internalDFN idlName" data-link-for="WOT" data-link-type="method"
href="#dom-wot-consume"><code>consume</code></a>(<span class=
"idlType"><a data-xref-type="_IDL_" href="#dom-thingdescription"
class="internalDFN" data-link-type=
"idl"><code>ThingDescription</code></a></span> <span class=
"idlParamName">td</span>);</span>
};</span>
</ins><span data-idl="" class="idlInterface" data-title=<ins class="diff-chg">
"WOT">partial interface <a class="internalDFN idlID" data-link-for=
"" data-link-type="interface" href=
"#dom-wot"><code>WOT</code></a> {<span data-idl="" class=
"idlMethod" data-title="produce" data-dfn-for="WOT"><span class=
"idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
href="#dom-exposedthing" class="internalDFN" data-link-type=
"idl"><code>ExposedThing</code></a>&gt;</span> <a class=
"internalDFN idlName" data-link-for="WOT" data-link-type="method"
href="#dom-wot-produce"><code>produce</code></a>(<span class=
"idlType"><a data-xref-type="_IDL_" href="#dom-thingdescription"
class="internalDFN" data-link-type=
"idl"><code>ThingDescription</code></a></span> <span class=
"idlParamName">td</span>);</span>
};</span>
</ins><span data-idl="" class="idlInterface" data-title=<ins class="diff-chg">
"WOT">partial interface <a class="internalDFN idlID" data-link-for=
"" data-link-type="interface" href=
"#dom-wot"><code>WOT</code></a> {<span data-idl="" class=
"idlMethod" data-title="discover" data-dfn-for="WOT"><span class=
"idlType">
</ins>  <a data-xref-type="_IDL_" href="#dom-thingdiscovery" class=<ins class="diff-chg">
"internalDFN" data-link-type=
"idl"><code>ThingDiscovery</code></a></span> <a class=
"internalDFN idlName" data-link-for="WOT" data-link-type="method"
href=
"#dom-wot-discover"><code>discover</code></a>(optional<span class=
"idlType"> <a data-xref-type="_IDL_" href="#dom-thingfilter" class=
"internalDFN" data-link-type=
"idl"><code>ThingFilter</code></a></span> <span class=
"idlParamName">filter</span> = null);</span>
};</span>
</ins><span data-idl="" class="idlInterface" data-title=<ins class="diff-chg">
"ConsumedThing">[<span class="extAttr"><a data-xref-type=
"extended-attribute" data-cite-path="" data-type=
"extended-attribute" href=
"https://heycam.github.io/webidl/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-xref-type="extended-attribute"
data-cite-path="" data-type="extended-attribute" href=
"https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<a data-xref-type="interface"
data-cite-path="window-object.html" data-type="interface" href=
"https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>,<a data-xref-type="interface"
data-lt="WorkerGlobalScope" data-cite-path="workers.html"
data-type="interface" href=
"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">Worker</a>)</span>]
interface <a class="internalDFN idlID" data-link-for=""
data-link-type="interface" href=
"#dom-consumedthing"><code>ConsumedThing</code></a> {<span data-idl=""
class="idlConstructor" data-title="constructor" data-dfn-for=
"ConsumedThing">
</ins>  <dfn data-export="" data-dfn-type="constructor" data-idl=<ins class="diff-chg">
"constructor" data-title="constructor" data-dfn-for="ConsumedThing"
data-lt=
"ConsumedThing.constructor()|ConsumedThing.constructor|constructor()|constructor"><code>constructor</code></dfn>(<span class="idlType"><a data-xref-type="_IDL_"
href="#dom-thingdescription" class="internalDFN" data-link-type=
"idl"><code>ThingDescription</code></a></span> <span class=
"idlParamName">td</span>);</span><span data-idl="" class=
"idlMethod" data-title="readProperty" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ConsumedThing" data-link-type="method" href=
"#dom-consumedthing-readproperty"><code>readProperty</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">propertyName</span>,
                            optional<span class=
"idlType"> <a data-xref-type="_IDL_" href="#dom-interactionoptions"
class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlMethod" data-title="readAllProperties" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
href="#dom-propertymap" class="internalDFN" data-link-type=
"idl"><code>PropertyMap</code></a>&gt;</span> <a class=
"internalDFN idlName" data-link-for="ConsumedThing" data-link-type=
"method" href=
"#dom-consumedthing-readallproperties"><code>readAllProperties</code></a>(optional<span class="idlType"> <a data-xref-type="_IDL_"
href="#dom-interactionoptions" class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlMethod" data-title="readMultipleProperties" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
href="#dom-propertymap" class="internalDFN" data-link-type=
"idl"><code>PropertyMap</code></a>&gt;</span> <a class=
"internalDFN idlName" data-link-for="ConsumedThing" data-link-type=
"method" href=
"#dom-consumedthing-readmultipleproperties"><code>readMultipleProperties</code></a>(<span class="idlType">
</ins>                            <a data-xref-type="dfn" data-cite-path=<ins class="diff-chg">
"" data-type="dfn" href=
"https://heycam.github.io/webidl/#idl-sequence">sequence</a>&lt;<a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a>&gt;</span> <span class="idlParamName">propertyNames</span>,
                            optional<span class=
"idlType"> <a data-xref-type="_IDL_" href="#dom-interactionoptions"
class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlMethod" data-title="writeProperty" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ConsumedThing" data-link-type="method" href=
"#dom-consumedthing-writeproperty"><code>writeProperty</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">propertyName</span>,<span class="idlType">
</ins>                              <a data-xref-type="_IDL_"<ins class="diff-chg">
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a></span> <span class="idlParamName">value</span>,
                              optional<span class=
"idlType"> <a data-xref-type="_IDL_" href="#dom-interactionoptions"
class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlMethod" data-title="writeMultipleProperties"
data-dfn-for="ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ConsumedThing" data-link-type="method" href=
"#dom-consumedthing-writemultipleproperties"><code>writeMultipleProperties</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
href="#dom-propertymap" class="internalDFN" data-link-type=
"idl"><code>PropertyMap</code></a></span> <span class=
"idlParamName">valueMap</span>,
                              optional<span class=
"idlType"> <a data-xref-type="_IDL_" href="#dom-interactionoptions"
class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlMethod" data-title="invokeAction" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ConsumedThing" data-link-type="method" href=
"#dom-consumedthing-invokeaction"><code>invokeAction</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">actionName</span>,
                              optional<span class=
"idlType"> <a data-xref-type="_IDL_" data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a></span> <span class="idlParamName">params</span> = null,
                              optional<span class=
"idlType"> <a data-xref-type="_IDL_" href="#dom-interactionoptions"
class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlMethod" data-title="observeProperty" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ConsumedThing" data-link-type="method" href=
"#dom-consumedthing-observeproperty"><code>observeProperty</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">name</span>,<span class="idlType">
</ins>                              <a data-xref-type="_IDL_" href=<ins class="diff-chg">
"#dom-wotlistener" class="internalDFN" data-link-type=
"idl"><code>WotListener</code></a></span> <span class=
"idlParamName">listener</span>,
                              optional<span class=
"idlType"> <a data-xref-type="_IDL_" href="#dom-interactionoptions"
class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlMethod" data-title="unobserveProperty" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ConsumedThing" data-link-type="method" href=
"#dom-consumedthing-unobserveproperty"><code>unobserveProperty</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">name</span>);</span><span data-idl=""
class="idlMethod" data-title="subscribeEvent" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ConsumedThing" data-link-type="method" href=
"#dom-consumedthing-subscribeevent"><code>subscribeEvent</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">name</span>,<span class="idlType">
</ins>                              <a data-xref-type="_IDL_" href=<ins class="diff-chg">
"#dom-wotlistener" class="internalDFN" data-link-type=
"idl"><code>WotListener</code></a></span> <span class=
"idlParamName">listener</span>,
                              optional<span class=
"idlType"> <a data-xref-type="_IDL_" href="#dom-interactionoptions"
class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlMethod" data-title="unsubscribeEvent" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ConsumedThing" data-link-type="method" href=
"#dom-consumedthing-unsubscribeevent"><code>unsubscribeEvent</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">name</span>);</span><span data-idl=""
class="idlMethod" data-title="getThingDescription" data-dfn-for=
"ConsumedThing"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" href="#dom-thingdescription" class=<ins class="diff-chg">
"internalDFN" data-link-type=
"idl"><code>ThingDescription</code></a></span> <a class=
"internalDFN idlName" data-link-for="ConsumedThing" data-link-type=
"method" href=
"#dom-consumedthing-getthingdescription"><code>getThingDescription</code></a>();</span>
};</span><span data-idl="" class="idlDictionary" data-title=
"InteractionOptions">
dictionary <a class="internalDFN idlID" data-link-for=""
data-link-type="dictionary" href=
"#dom-interactionoptions"><code>InteractionOptions</code></a> {<span data-idl=""
class="idlMember" data-title="uriVariables" data-dfn-for=
"InteractionOptions"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-object">object</a></span> <dfn data-export=""
data-dfn-type="dict-member" data-idl="field" data-title=
"uriVariables" data-dfn-for="InteractionOptions" data-type="object"
class="idlName"><code>uriVariables</code></dfn>;</span>
};</span><span data-idl="" class="idlTypedef" data-title=
"PropertyMap">
typedef<span class="idlType"> <a data-xref-type="interface"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-object">object</a></span> <a class="internalDFN idlID"
data-link-for="" data-link-type="typedef" href=
"#dom-propertymap"><code>PropertyMap</code></a>;</span><span data-idl=""
class="idlCallback" data-title="WotListener">
callback <a class="internalDFN idlID" data-link-for=""
data-link-type="callback" href=
"#dom-wotlistener"><code>WotListener</code></a> =<span class=
"idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type=
"interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a></span>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a></span> <span class="idlParamName">data</span>);</span>
</ins><span data-idl="" class="idlInterface" data-title=<ins class="diff-chg">
"ExposedThing">[<span class="extAttr"><a data-xref-type=
"extended-attribute" data-cite-path="" data-type=
"extended-attribute" href=
"https://heycam.github.io/webidl/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-xref-type="extended-attribute"
data-cite-path="" data-type="extended-attribute" href=
"https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<a data-xref-type="interface"
data-cite-path="window-object.html" data-type="interface" href=
"https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>,<a data-xref-type="interface"
data-lt="WorkerGlobalScope" data-cite-path="workers.html"
data-type="interface" href=
"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">Worker</a>)</span>]
interface <a class="internalDFN idlID" data-link-for=""
data-link-type="interface" href=
"#dom-exposedthing"><code>ExposedThing</code></a>: <span class=
"idlSuperclass"><a data-xref-type="_IDL_" href="#dom-consumedthing"
class="internalDFN" data-link-type=
"idl"><code>ConsumedThing</code></a></span> {<span data-idl=""
class="idlMethod" data-title="setPropertyReadHandler" data-dfn-for=
"ExposedThing"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" href="#dom-exposedthing" class=<ins class="diff-chg">
"internalDFN" data-link-type=
"idl"><code>ExposedThing</code></a></span> <a class=
"internalDFN idlName" data-link-for="ExposedThing" data-link-type=
"method" href=
"#dom-exposedthing-setpropertyreadhandler"><code>setPropertyReadHandler</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">name</span>,<span class="idlType">
</ins>          <a data-xref-type="_IDL_" href="#dom-propertyreadhandler"<ins class="diff-chg">
class="internalDFN" data-link-type=
"idl"><code>PropertyReadHandler</code></a></span> <span class=
"idlParamName">readHandler</span>);</span><span data-idl="" class=
"idlMethod" data-title="setPropertyWriteHandler" data-dfn-for=
"ExposedThing"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" href="#dom-exposedthing" class=<ins class="diff-chg">
"internalDFN" data-link-type=
"idl"><code>ExposedThing</code></a></span> <a class=
"internalDFN idlName" data-link-for="ExposedThing" data-link-type=
"method" href=
"#dom-exposedthing-setpropertywritehandler"><code>setPropertyWriteHandler</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">name</span>,<span class="idlType">
</ins>          <a data-xref-type="_IDL_" href=<ins class="diff-chg">
"#dom-propertywritehandler" class="internalDFN" data-link-type=
"idl"><code>PropertyWriteHandler</code></a></span> <span class=
"idlParamName">writeHandler</span>);</span><span data-idl="" class=
"idlMethod" data-title="setActionHandler" data-dfn-for=
"ExposedThing"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" href="#dom-exposedthing" class=<ins class="diff-chg">
"internalDFN" data-link-type=
"idl"><code>ExposedThing</code></a></span> <a class=
"internalDFN idlName" data-link-for="ExposedThing" data-link-type=
"method" href=
"#dom-exposedthing-setactionhandler"><code>setActionHandler</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">name</span>,<span class="idlType"> <a data-xref-type="_IDL_"
href="#dom-actionhandler" class="internalDFN" data-link-type=
"idl"><code>ActionHandler</code></a></span> <span class=
"idlParamName">action</span>);</span><span data-idl="" class=
"idlMethod" data-title="emitEvent" data-dfn-for=
"ExposedThing"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" data-cite-path="" data-type="interface"<ins class="diff-chg">
href=
"https://heycam.github.io/webidl/#idl-void">void</a></span> <a class="internalDFN idlName"
data-link-for="ExposedThing" data-link-type="method" href=
"#dom-exposedthing-emitevent"><code>emitEvent</code></a>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <span class="idlParamName">name</span>,<span class="idlType"> <a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a></span> <span class="idlParamName">data</span>);</span><span data-idl=""
class="idlMethod" data-title="expose" data-dfn-for=
"ExposedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ExposedThing" data-link-type="method" href=
"#dom-exposedthing-expose"><code>expose</code></a>();</span><span data-idl=""
class="idlMethod" data-title="destroy" data-dfn-for=
"ExposedThing"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName"
data-link-for="ExposedThing" data-link-type="method" href=
"#dom-exposedthing-destroy"><code>destroy</code></a>();</span>
};</span><span data-idl="" class="idlCallback" data-title=
"PropertyReadHandler">
callback <a class="internalDFN idlID" data-link-for=""
data-link-type="callback" href=
"#dom-propertyreadhandler"><code>PropertyReadHandler</code></a> =<span class="idlType"> <a data-xref-type="interface"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a>&gt;</span>(
        optional<span class="idlType"> <a data-xref-type="_IDL_"
href="#dom-interactionoptions" class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlCallback" data-title="PropertyWriteHandler">
callback <a class="internalDFN idlID" data-link-for=""
data-link-type="callback" href=
"#dom-propertywritehandler"><code>PropertyWriteHandler</code></a> =<span class="idlType"> <a data-xref-type="interface"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a></span> <span class="idlParamName">value</span>,
        optional<span class="idlType"> <a data-xref-type="_IDL_"
href="#dom-interactionoptions" class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span><span data-idl=""
class="idlCallback" data-title="ActionHandler">
callback <a class="internalDFN idlID" data-link-for=""
data-link-type="callback" href=
"#dom-actionhandler"><code>ActionHandler</code></a> =<span class=
"idlType"> <a data-xref-type="interface" data-cite-path=""
data-type="interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a>&gt;</span>(<span class="idlType"><a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-any"><code>any</code></a></span> <span class="idlParamName">params</span>,
        optional<span class="idlType"> <a data-xref-type="_IDL_"
href="#dom-interactionoptions" class="internalDFN" data-link-type=
"idl"><code>InteractionOptions</code></a></span> <span class=
"idlParamName">options</span> = null);</span>
</ins><span data-idl="" class="idlInterface" data-title=<ins class="diff-chg">
"ThingDiscovery">[<span class="extAttr"><a data-xref-type=
"extended-attribute" data-cite-path="" data-type=
"extended-attribute" href=
"https://heycam.github.io/webidl/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-xref-type="extended-attribute"
data-cite-path="" data-type="extended-attribute" href=
"https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<a data-xref-type="interface"
data-cite-path="window-object.html" data-type="interface" href=
"https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>,<a data-xref-type="interface"
data-lt="WorkerGlobalScope" data-cite-path="workers.html"
data-type="interface" href=
"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">Worker</a>)</span>]
interface <a class="internalDFN idlID" data-link-for=""
data-link-type="interface" href=
"#dom-thingdiscovery"><code>ThingDiscovery</code></a> {<span data-idl=""
class="idlConstructor" data-title="constructor" data-dfn-for=
"ThingDiscovery">
</ins>  <dfn data-export="" data-dfn-type="constructor" data-idl=<ins class="diff-chg">
"constructor" data-title="constructor" data-dfn-for=
"ThingDiscovery" data-lt=
"ThingDiscovery.constructor()|ThingDiscovery.constructor|constructor()|constructor"><code>constructor</code></dfn>(optional<span class="idlType"> <a data-xref-type="_IDL_"
href="#dom-thingfilter" class="internalDFN" data-link-type=
"idl"><code>ThingFilter</code></a></span> <span class=
"idlParamName">filter</span> = null);</span><span data-idl=""
class="idlAttribute" data-title="filter" data-dfn-for=
"ThingDiscovery">
  readonly attribute<span class="idlType"> <a data-xref-type=
"_IDL_" href="#dom-thingfilter" class="internalDFN" data-link-type=
"idl"><code>ThingFilter</code></a>?</span> <a class=
"internalDFN idlName" data-link-for="ThingDiscovery"
data-link-type="attribute" href=
"#dom-thingdiscovery-filter"><code>filter</code></a>;</span><span data-idl=""
class="idlAttribute" data-title="active" data-dfn-for=
"ThingDiscovery">
  readonly attribute<span class="idlType"> <a data-xref-type=
"_IDL_" data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-boolean">boolean</a></span> <a class="internalDFN idlName"
data-link-for="ThingDiscovery" data-link-type="attribute" href=
"#dom-thingdiscovery-active"><code>active</code></a>;</span><span data-idl=""
class="idlAttribute" data-title="done" data-dfn-for=
"ThingDiscovery">
  readonly attribute<span class="idlType"> <a data-xref-type=
"_IDL_" data-cite-path="" data-type="interface" href=
"https://heycam.github.io/webidl/#idl-boolean">boolean</a></span> <a class="internalDFN idlName"
data-link-for="ThingDiscovery" data-link-type="attribute" href=
"#dom-thingdiscovery-done"><code>done</code></a>;</span><span data-idl=""
class="idlAttribute" data-title="error" data-dfn-for=
"ThingDiscovery">
  readonly attribute<span class="idlType"> <a data-xref-type=
"_IDL_" data-link-type="dfn" href=
"https://tc39.github.io/ecma262/#sec-error-objects">Error</a>?</span> <a class="internalDFN idlName"
data-link-for="ThingDiscovery" data-link-type="attribute" href=
"#dom-thingdiscovery-error"><code>error</code></a>;</span><span data-idl=""
class="idlMethod" data-title="start" data-dfn-for=
"ThingDiscovery"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" data-cite-path="" data-type="interface"<ins class="diff-chg">
href=
"https://heycam.github.io/webidl/#idl-void">void</a></span> <a class="internalDFN idlName"
data-link-for="ThingDiscovery" data-link-type="method" href=
"#dom-thingdiscovery-start"><code>start</code></a>();</span><span data-idl=""
class="idlMethod" data-title="next" data-dfn-for=
"ThingDiscovery"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_"
href="#dom-thingdescription" class="internalDFN" data-link-type=
"idl"><code>ThingDescription</code></a>&gt;</span> <a class=
"internalDFN idlName" data-link-for="ThingDiscovery"
data-link-type="method" href=
"#dom-thingdiscovery-next"><code>next</code></a>();</span><span data-idl=""
class="idlMethod" data-title="stop" data-dfn-for=
"ThingDiscovery"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" data-cite-path="" data-type="interface"<ins class="diff-chg">
href=
"https://heycam.github.io/webidl/#idl-void">void</a></span> <a class="internalDFN idlName"
data-link-for="ThingDiscovery" data-link-type="method" href=
"#dom-thingdiscovery-stop"><code>stop</code></a>();</span>
};</span>
</ins><span data-idl="" class="idlTypedef" data-title=<ins class="diff-chg">
"DiscoveryMethod">typedef<span class="idlType"> <a data-xref-type=
"_IDL_" data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a></span> <a class="internalDFN idlID"
data-link-for="" data-link-type="typedef" href=
"#dom-discoverymethod"><code>DiscoveryMethod</code></a>;</span>
</ins><span data-idl="" class="idlDictionary" data-title=<ins class="diff-chg">
"ThingFilter">dictionary <a class="internalDFN idlID"
data-link-for="" data-link-type="dictionary" href=
"#dom-thingfilter"><code>ThingFilter</code></a> {<span data-idl=""
class="idlMember" data-title="method" data-dfn-for=
"ThingFilter"><span class="idlType">
  (<a data-xref-type="_IDL_" href="#dom-discoverymethod" class=
"internalDFN" data-link-type=
"idl"><code>DiscoveryMethod</code></a> or <a data-xref-type="_IDL_"
data-link-type="dfn" href=
"https://heycam.github.io/webidl/#idl-DOMString"><code>DOMString</code></a>)</span> <a class="internalDFN idlName"
data-link-for="ThingFilter" data-link-type="dict-member" href=
"#dom-thingfilter-method"><code>method</code></a> = "any";</span><span data-idl=""
class="idlMember" data-title="url" data-dfn-for=
"ThingFilter"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" data-cite-path="" data-type="interface"<ins class="diff-chg">
href=
"https://heycam.github.io/webidl/#idl-USVString">USVString</a>?</span> <a class="internalDFN idlName"
data-link-for="ThingFilter" data-link-type="dict-member" href=
"#dom-thingfilter-url"><code>url</code></a>;</span><span data-idl=
"" class="idlMember" data-title="query" data-dfn-for=
"ThingFilter"><span class="idlType">
</ins>  <a data-xref-type="_IDL_" data-cite-path="" data-type="interface"<ins class="diff-chg">
href=
"https://heycam.github.io/webidl/#idl-USVString">USVString</a>?</span> <a class="internalDFN idlName"
data-link-for="ThingFilter" data-link-type="dict-member" href=
"#dom-thingfilter-query"><code>query</code></a>;</span><span data-idl=""
class="idlMember" data-title="fragment" data-dfn-for=
"ThingFilter"><span class="idlType">
</ins>  <a data-xref-type="interface" data-cite-path="" data-type=<ins class="diff-chg">
"interface" href=
"https://heycam.github.io/webidl/#idl-object">object</a>?</span> <a class="internalDFN idlName"
data-link-for="ThingFilter" data-link-type="dict-member" href=
"#dom-thingfilter-fragment"><code>fragment</code></a>;</span>
};
</ins>
</span>
<del class="diff-old">Acknowledgments
</del>
</pre>
</section>
<section class="appendix" id="acknowledgements">
<h2 id="e-acknowledgements">
<bdi class="secno">
<ins class="diff-chg">E.
</ins></bdi><ins class="diff-chg">
Acknowledgements
</ins>
<a class="self-link" aria-label="§" href= "#acknowledgements">
</a>
</h2>
<p>
Special
thanks
to
former
editor
Johannes
Hund
(until
August
2017,
when
at
Siemens
AG)
<ins class="diff-new">and
Kazuaki
Nimura
(until
December
2018)
</ins>
for
developing
this
specification.
Also,
the
editors
would
like
to
thank
Dave
Raggett,
Matthias
Kovatsch,
Michael
<del class="diff-old">Koster
and
</del>
<ins class="diff-chg">Koster,
Elena
Reshetova,
</ins>
Michael
McCool
<ins class="diff-new">as
well
as
the
other
WoT
WG
members
</ins>
for
their
<del class="diff-old">comments
</del>
<ins class="diff-chg">comments,
contributions
</ins>
and
guidance.
</p>
</section>
<section id="references" class="appendix">
<h2 id="f-references">
<del class="diff-old">D.
</del>
<bdi class="secno">
<ins class="diff-chg">F.
</ins></bdi>
References
<a class="self-link" aria-label="§" href= "#references">
</a>
</h2>
<section id="normative-references">
<h3 id="f-1-normative-references">
<del class="diff-old">D.1
</del>
<bdi class="secno">
<ins class="diff-chg">F.1
</ins></bdi>
Normative
references
<a class="self-link" aria-label="§" href= "#normative-references">
</a>
</h3>
<dl class="bibliography">
<dt id="bib-ecmascript">
[ECMASCRIPT]
</dt>
<dd>
<a href="https://tc39.github.io/ecma262/">
<cite>
ECMAScript
Language
Specification
</cite>
</a>.
Ecma
International.
URL:
<a href="https://tc39.github.io/ecma262/">
https://tc39.github.io/ecma262/
</a>
</dd>
<dt id="bib-encoding">
[ENCODING]
</dt>
<dd>
<a href="https://encoding.spec.whatwg.org/">
<cite>
Encoding
<ins class="diff-new">Standard
</ins>
</cite>
</a>.
Anne
van
<del class="diff-old">Kesteren;
Joshua
Bell;
Addison
Phillips.
W3C.
15
December
2016.
W3C
Candidate
Recommendation.
</del>
<ins class="diff-chg">Kesteren.
WHATWG.
Living
Standard.
</ins>
URL:
<del class="diff-old">https://www.w3.org/TR/encoding/
</del>
<a href= "https://encoding.spec.whatwg.org/">
<ins class="diff-chg">https://encoding.spec.whatwg.org/
</ins>
</a>
</dd>
<del class="diff-old">[HTML52]
</del>
<dt id="bib-html">
<ins class="diff-chg">[HTML]
</ins>
</dt>
<dd>
<a href="https://html.spec.whatwg.org/multipage/">
<cite>
HTML
<del class="diff-old">5.2
</del>
<ins class="diff-chg">Standard
</ins></cite></a>.<ins class="diff-chg">
Anne
van
Kesteren;
Domenic
Denicola;
Ian
Hickson;
Philip
Jägenstedt;
Simon
Pieters.
WHATWG.
Living
Standard.
URL:
</ins><a href= "https://html.spec.whatwg.org/multipage/"><ins class="diff-chg">
https://html.spec.whatwg.org/multipage/
</ins></a></dd><dt id="bib-html5"><ins class="diff-chg">
[HTML5]
</ins></dt><dd><a href="https://www.w3.org/TR/html5/"><cite><ins class="diff-chg">
HTML5
</ins>
</cite>
</a>.
<ins class="diff-new">Ian
Hickson;
Robin
Berjon;
</ins>
Steve
Faulkner;
<del class="diff-old">Arron
Eicholz;
</del>
Travis
Leithead;
<del class="diff-old">Alex
Danilo;
Sangwhan
Moon;
</del>
Erika
Doyle
Navara;
Theresa
O'Connor;
<del class="diff-old">Robin
Berjon.
</del>
<ins class="diff-chg">Silvia
Pfeiffer.
</ins>
W3C.
<del class="diff-old">14
December
2017.
</del>
<ins class="diff-chg">27
March
2018.
</ins>
W3C
Recommendation.
URL:
<del class="diff-old">https://www.w3.org/TR/html52/
</del>
<a href= "https://www.w3.org/TR/html5/">
<ins class="diff-chg">https://www.w3.org/TR/html5/
</ins></a></dd><dt id="bib-infra"><ins class="diff-chg">
[INFRA]
</ins></dt><dd><a href="https://infra.spec.whatwg.org/"><cite><ins class="diff-chg">
Infra
Standard
</ins></cite></a>.<ins class="diff-chg">
Anne
van
Kesteren;
Domenic
Denicola.
WHATWG.
Living
Standard.
URL:
</ins><a href= "https://infra.spec.whatwg.org/"><ins class="diff-chg">
https://infra.spec.whatwg.org/
</ins>
</a>
</dd>
<dt id="bib-json-ld">
[JSON-LD]
</dt>
<dd>
<a href="https://www.w3.org/TR/json-ld/">
<cite>
JSON-LD
1.0
</cite>
</a>.
Manu
Sporny;
Gregg
Kellogg;
Markus
Lanthaler.
W3C.
16
January
2014.
W3C
Recommendation.
URL:
<a href= "https://www.w3.org/TR/json-ld/">
https://www.w3.org/TR/json-ld/
</a>
</dd>
<dt id="bib-mimesniff">
<ins class="diff-new">[MIMESNIFF]
</ins></dt><dd><a href="https://mimesniff.spec.whatwg.org/"><cite><ins class="diff-new">
MIME
Sniffing
Standard
</ins></cite></a>.<ins class="diff-new">
Gordon
P.
Hemsley.
WHATWG.
Living
Standard.
URL:
</ins><a href= "https://mimesniff.spec.whatwg.org/"><ins class="diff-new">
https://mimesniff.spec.whatwg.org/
</ins></a></dd>
<dt id="bib-rfc2119">
[RFC2119]
</dt>
<dd>
<a href="https://tools.ietf.org/html/rfc2119">
<cite>
Key
words
for
use
in
RFCs
to
Indicate
Requirement
Levels
</cite>
</a>.
S.
Bradner.
IETF.
March
1997.
Best
Current
Practice.
URL:
<a href= "https://tools.ietf.org/html/rfc2119">
https://tools.ietf.org/html/rfc2119
</a>
</dd>
<dt id="bib-rfc8174">
<ins class="diff-new">[RFC8174]
</ins></dt><dd><a href="https://tools.ietf.org/html/rfc8174"><cite><ins class="diff-new">
Ambiguity
of
Uppercase
vs
Lowercase
in
RFC
2119
Key
Words
</ins></cite></a>.<ins class="diff-new">
B.
Leiba.
IETF.
May
2017.
Best
Current
Practice.
URL:
</ins><a href= "https://tools.ietf.org/html/rfc8174"><ins class="diff-new">
https://tools.ietf.org/html/rfc8174
</ins></a></dd>
<dt id="bib-typescript">
[TYPESCRIPT]
</dt>
<dd>
<a href= "https://github.com/Microsoft/TypeScript/blob/master/doc/spec.md">
<cite>
TypeScript
Language
Specification
</cite>
</a>.
Microsoft.
1
October
2012.
URL:
<a href= "https://github.com/Microsoft/TypeScript/blob/master/doc/spec.md">
https://github.com/Microsoft/TypeScript/blob/master/doc/spec.md
</a>
</dd>
<dt id="bib-url">
[URL]
</dt>
<dd>
<a href="https://url.spec.whatwg.org/">
<cite>
URL
Standard
</cite>
</a>.
Anne
van
Kesteren.
WHATWG.
Living
Standard.
URL:
<a href= "https://url.spec.whatwg.org/">
https://url.spec.whatwg.org/
</a>
</dd>
<dt id="bib-webappsec">
[WEBAPPSEC]
</dt>
<dd>
<a href= "https://w3c.github.io/webappsec/specs/powerfulfeatures">
<cite>
Secure
Contexts
</cite>
</a>.
W3C.
17
July
2015.
URL:
<a href= "https://w3c.github.io/webappsec/specs/powerfulfeatures">
https://w3c.github.io/webappsec/specs/powerfulfeatures
</a>
</dd>
<dt id="bib-webidl">
[WEBIDL]
</dt>
<dd>
<a href="https://heycam.github.io/webidl/">
<cite>
Web
IDL
</cite>
</a>.
<del class="diff-old">Cameron
McCormack;
</del>
Boris
<del class="diff-old">Zbarsky;
Tobie
Langel.
</del>
<ins class="diff-chg">Zbarsky.
</ins>
W3C.
15
December
2016.
W3C
Editor's
Draft.
URL:
<a href= "https://heycam.github.io/webidl/">
https://heycam.github.io/webidl/
</a>
</dd>
<dt id="bib-wot-architecture">
[WOT-ARCHITECTURE]
</dt>
<dd>
<a href= "https://www.w3.org/TR/2019/CR-wot-architecture-20190516/">
<cite>
Web
of
Things
Architecture
</cite>
</a>.
W3C.
<ins class="diff-new">16
May
2019.
URL:
</ins><a href= "https://www.w3.org/TR/2019/CR-wot-architecture-20190516/"><ins class="diff-new">
https://www.w3.org/TR/2019/CR-wot-architecture-20190516/
</ins></a></dd><dt id="bib-wot-protocol-bindings"><ins class="diff-new">
[WOT-PROTOCOL-BINDINGS]
</ins></dt><dd><a href= "https://w3c.github.io/wot-binding-templates/"><cite><ins class="diff-new">
Web
of
Things
Protocol
Binding
Templates
</ins></cite></a>.<ins class="diff-new">
W3C.
</ins>
20
August
2017.
URL:
<del class="diff-old">https://w3c.github.io/wot-architecture/
</del>
<a href= "https://w3c.github.io/wot-binding-templates/">
<ins class="diff-chg">https://w3c.github.io/wot-binding-templates/
</ins>
</a>
</dd>
<dt id="bib-wot-security-best-practices">
[WOT-SECURITY-BEST-PRACTICES]
</dt>
<dd>
<a href= "https://github.com/w3c/wot-security/blob/master/wot-security-best-practices.md">
<cite>
Web
of
Things
Security
and
Privacy
Best
Practices
<del class="diff-old">(WIP)
</del>
</cite>
</a>.
W3C.
WIP.
URL:
<a href= "https://github.com/w3c/wot-security/blob/master/wot-security-best-practices.md">
https://github.com/w3c/wot-security/blob/master/wot-security-best-practices.md
</a>
</dd>
<del class="diff-old">[WOT-SECURITY-CONSIDERATIONS]
</del>
<dt id="bib-wot-security-guidelines">
<ins class="diff-chg">[WOT-SECURITY-GUIDELINES]
</ins>
</dt>
<dd>
<a href="https://w3c.github.io/wot-security/">
<cite>
Web
of
Things
Security
and
Privacy
<del class="diff-old">Considerations
</del>
<ins class="diff-chg">Guidelines
</ins>
</cite>
</a>.
W3C.
28
August
2017.
URL:
<a href= "https://w3c.github.io/wot-security/">
https://w3c.github.io/wot-security/
</a>
</dd>
<dt id="bib-wot-security-testing">
[WOT-SECURITY-TESTING]
</dt>
<dd>
<a href= "https://github.com/w3c/wot-security/blob/master/wot-security-testing.md">
<cite>
Web
of
Things
Security
Testing
and
Validation
</cite>
</a>.
W3C.
WIP.
URL:
<a href= "https://github.com/w3c/wot-security/blob/master/wot-security-testing.md">
https://github.com/w3c/wot-security/blob/master/wot-security-testing.md
</a>
</dd>
<dt id="bib-wot-td">
[WOT-TD]
</dt>
<dd>
<a href= "https://www.w3.org/TR/2019/CR-wot-thing-description-20190516/">
<cite>
WoT
Thing
Description
</cite>
</a>
.
W3C.
<del class="diff-old">21
October
2018.
URL:
https://www.w3.org/TR/2018/WD-wot-thing-description-20181021/
D.2
Informative
references
[HTML]
HTML
Standard
.
Anne
van
Kesteren;
Domenic
Denicola;
Ian
Hickson;
Philip
Jägenstedt;
Simon
Pieters.
WHATWG.
Living
Standard.
</del>
<ins class="diff-chg">16
May
2019.
</ins>
URL:
<del class="diff-old">https://html.spec.whatwg.org/multipage/
</del>
<a href= "https://www.w3.org/TR/2019/CR-wot-thing-description-20190516/">
<ins class="diff-chg">https://www.w3.org/TR/2019/CR-wot-thing-description-20190516/
</ins>
</a>
</dd>
</dl>
</section>
</section>
<p role="navigation" id="back-to-top">
<a href="#toc">
<abbr title= "Back to Top">
↑
</abbr>
</a>
</p>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js">
</script>
</body>
</html>
